import{s as $,z as ee,e as _,k as G,c as v,a as b,d as u,o as K,f as c,i as H,g as f,C as Q,u as q,B as fe,j as N,p as pe,q as me,t as te,b as le,h as se,n as he}from"../chunks/jBEftbNB.js";import{S as ae,i as oe,f as _e,b as re,d as ne,m as ie,t as ce,a as ue,e as de}from"../chunks/2lNU1ddO.js";import"../chunks/CPRQqKui.js";import{g as ve}from"../chunks/wUxqHZkW.js";import{c as be,b as ge,u as xe,m as we,g as ke}from"../chunks/BmtUElco.js";import{c as Ee}from"../chunks/DuCCpQXh.js";import{h as ye}from"../chunks/DB_xkffJ.js";import{S as De}from"../chunks/DB60wKrn.js";function Ie(s){let e,t=s[5].t("Cancel")+"",l,r,d;return{c(){e=_("button"),l=te(t),this.h()},l(a){e=v(a,"BUTTON",{class:!0});var i=b(e);l=le(i,t),i.forEach(u),this.h()},h(){c(e,"class","px-3 py-1.5 text-sm font-medium bg-gray-300 text-black transition rounded-full")},m(a,i){H(a,e,i),f(e,l),r||(d=q(e,"click",s[13]),r=!0)},p(a,i){i&32&&t!==(t=a[5].t("Cancel")+"")&&se(l,t)},d(a){a&&u(e),r=!1,d()}}}function Se(s){let e,t=s[5].t("Run")+"",l,r,d;return{c(){e=_("button"),l=te(t),this.h()},l(a){e=v(a,"BUTTON",{class:!0});var i=b(e);l=le(i,t),i.forEach(u),this.h()},h(){c(e,"class","px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full")},m(a,i){H(a,e,i),f(e,l),r||(d=q(e,"click",s[12]),r=!0)},p(a,i){i&32&&t!==(t=a[5].t("Run")+"")&&se(l,t)},d(a){a&&u(e),r=!1,d()}}}function Ve(s){let e,t,l,r,d,a,i,D,p,x,V,w,k,S,m,C,R,I,T,U,O;function z(n){s[9](n)}let o={placeholder:s[5].t("Select a model"),items:s[4].map(Z)};s[1]!==void 0&&(o.value=s[1]),p=new De({props:o}),ee.push(()=>_e(p,"value",z));function B(n,g){return n[2]?Ie:Se}let j=B(s),h=j(s);return{c(){e=_("div"),t=_("div"),l=_("div"),r=_("div"),d=_("div"),a=_("div"),i=_("div"),D=_("div"),re(p.$$.fragment),V=G(),w=_("div"),k=_("div"),S=_("div"),m=_("textarea"),R=G(),I=_("div"),h.c(),this.h()},l(n){e=v(n,"DIV",{class:!0});var g=b(e);t=v(g,"DIV",{class:!0});var E=b(t);l=v(E,"DIV",{class:!0});var y=b(l);r=v(y,"DIV",{class:!0});var A=b(r);d=v(A,"DIV",{class:!0});var M=b(d);a=v(M,"DIV",{class:!0});var Y=b(a);i=v(Y,"DIV",{class:!0});var F=b(i);D=v(F,"DIV",{class:!0});var J=b(D);ne(p.$$.fragment,J),J.forEach(u),F.forEach(u),Y.forEach(u),M.forEach(u),A.forEach(u),V=K(y),w=v(y,"DIV",{class:!0,id:!0});var L=b(w);k=v(L,"DIV",{class:!0});var P=b(k);S=v(P,"DIV",{class:!0});var W=b(S);m=v(W,"TEXTAREA",{id:!0,class:!0,placeholder:!0}),b(m).forEach(u),W.forEach(u),P.forEach(u),L.forEach(u),R=K(y),I=v(y,"DIV",{class:!0});var X=b(I);h.l(X),X.forEach(u),y.forEach(u),E.forEach(u),g.forEach(u),this.h()},h(){c(D,"class","max-w-full"),c(i,"class","overflow-hidden w-full"),c(a,"class","flex w-full"),c(d,"class","flex flex-col gap-1 w-full"),c(r,"class","flex flex-col justify-between mb-1 gap-1"),c(m,"id","text-completion-textarea"),c(m,"class","w-full h-full p-3 bg-transparent border border-gray-100 dark:border-gray-850 outline-hidden resize-none rounded-lg text-sm"),c(m,"placeholder",C=s[5].t("You're a helpful assistant.")),c(S,"class","flex-1"),c(k,"class","h-full w-full flex flex-col"),c(w,"class","pt-0.5 pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0"),c(w,"id","messages-container"),c(I,"class","pb-3 flex justify-end"),c(l,"class","flex flex-col h-full px-4"),c(t,"class","mx-auto w-full md:px-0 h-full"),c(e,"class","flex flex-col justify-between w-full overflow-y-auto h-full")},m(n,g){H(n,e,g),f(e,t),f(t,l),f(l,r),f(r,d),f(d,a),f(a,i),f(i,D),ie(p,D,null),f(l,V),f(l,w),f(w,k),f(k,S),f(S,m),s[10](m),Q(m,s[0]),f(l,R),f(l,I),h.m(I,null),T=!0,U||(O=q(m,"input",s[11]),U=!0)},p(n,[g]){const E={};g&32&&(E.placeholder=n[5].t("Select a model")),g&16&&(E.items=n[4].map(Z)),!x&&g&2&&(x=!0,E.value=n[1],fe(()=>x=!1)),p.$set(E),(!T||g&32&&C!==(C=n[5].t("You're a helpful assistant.")))&&c(m,"placeholder",C),g&1&&Q(m,n[0]),j===(j=B(n))&&h?h.p(n,g):(h.d(1),h=j(n),h&&(h.c(),h.m(I,null)))},i(n){T||(ce(p.$$.fragment,n),T=!0)},o(n){ue(p.$$.fragment,n),T=!1},d(n){n&&u(e),de(p),s[10](null),h.d(),U=!1,O()}}}const Z=s=>({value:s.id,label:s.name,model:s});function Te(s,e,t){let l,r,d,a,i;N(s,be,o=>t(16,l=o)),N(s,ge,o=>t(17,r=o)),N(s,xe,o=>t(18,d=o)),N(s,we,o=>t(4,a=o));const D=pe("i18n");N(s,D,o=>t(5,i=o));let p="",x="",V=!1,w=!1,k;const S=()=>{const o=k;o&&(o.scrollTop=o==null?void 0:o.scrollHeight)},m=()=>{w=!0,console.log("stopResponse")},C=async()=>{const o=a.find(h=>h.id===x),[B,j]=await Ee(localStorage.token,{model:o.id,stream:!0,messages:[{role:"assistant",content:p}]},`${ke}/api`);if(B&&B.ok){const h=B.body.pipeThrough(new TextDecoderStream).pipeThrough(ye(`
`)).getReader();for(;;){const{value:n,done:g}=await h.read();if(g||w){w&&j.abort("User: Stop Response");break}try{let E=n.split(`
`);for(const y of E)if(y!=="")if(y.includes("[DONE]"))console.log("done");else{let A=JSON.parse(y.replace(/^data: /,""));console.log(A),t(0,p+=A.choices[0].delta.content??"")}}catch(E){console.log(E)}S()}}},R=async()=>{x&&(t(2,V=!0),await C(),t(2,V=!1),w=!1)};me(async()=>{(d==null?void 0:d.role)!=="admin"&&await ve("/"),r!=null&&r.models?t(1,x=r==null?void 0:r.models[0]):l!=null&&l.default_models?t(1,x=l==null?void 0:l.default_models.split(",")[0]):t(1,x="")});function I(o){x=o,t(1,x)}function T(o){ee[o?"unshift":"push"](()=>{k=o,t(3,k)})}function U(){p=this.value,t(0,p)}return[p,x,V,k,a,i,D,m,R,I,T,U,()=>{R()},()=>{m()}]}class Ce extends ae{constructor(e){super(),oe(this,e,Te,Ve,$,{})}}function Re(s){let e,t;return e=new Ce({}),{c(){re(e.$$.fragment)},l(l){ne(e.$$.fragment,l)},m(l,r){ie(e,l,r),t=!0},p:he,i(l){t||(ce(e.$$.fragment,l),t=!0)},o(l){ue(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}class ze extends ae{constructor(e){super(),oe(this,e,null,Re,$,{})}}export{ze as component};
//# sourceMappingURL=25.CPwSwmZi.js.map
