var im=Object.defineProperty;var sm=(o,e,t)=>e in o?im(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Ko=(o,e,t)=>sm(o,typeof e!="symbol"?e+"":e,t);import{s as Qe,z as ze,e as U,k as ie,c as L,o as se,f as g,V as tt,i as z,u as Ae,B as Je,d as _,j as de,p as rn,D as $e,a as A,r as pn,v as _n,w as bn,x as yn,l as Ve,S as Hn,g as S,E as Ce,F as Ee,t as Oe,b as Ne,h as Be,G as dn,n as Ue,H as wn,W as On,q as Qn,y as oo,Z as Bo,A as Tr,C as Xn,X as lf,Y as cf,ap as dt,K as xt,L as Rt,M as so,P as Bn,a3 as gn,a2 as ye,a4 as hi,aq as xi,aj as uf,a0 as $i,N as Et,a1 as _r,R as Po,am,ar as lm,an as cm,ak as zl,ao as Fl,T as Vl,Q as Hi,m as um}from"./Bk--KVgx.js";import{S as We,i as Ye,f as Ze,b as $,d as oe,m as ee,t as T,a as O,e as te,g as Re,c as Me,j as si}from"./CoU9NT7-.js";import{g as df}from"./D0QH3NT1.js";import{t as rt}from"./DXxu2l8m.js";import{j as eo,bA as ff,bB as Ua,bC as Ys,bD as qs,aF as Sr,bE as dm,bF as fm,bG as hm,bH as gm,bI as mm}from"./B4BdvOJx.js";import{C as pm,D as _m,a as hf,b as bm,P as ym}from"./C8hcEfMI.js";import{w as et,a as xn,d as fr,g as Kl}from"./D_XIBSCa.js";import{p as Gl}from"./D-0X3nPa.js";import{t as Xo,u as bo,c as Ar,n as Ti,b as qn,p as gf,k as mf,m as nr,B as pf,T as la,g as gi,e as wm,X as Wl,Y as Wn,G as Zt,o as mi,J as Co,F as go,W as _f,i as qo,s as ca,N as vm,a as km,f as Yl,y as Cm,H as Em,z as Go,q as Im,P as Ui,C as Wo,l as Tm}from"./Cx1AvSPh.js";import{v as wo,h as Sm,E as Am,F as Rm,G as Mm,H as Pm,I as Om,J as bf,K as Ji,L as ql,q as Nm,a as Gn,m as br,k as La,p as Dm,n as es,M as Hm,N as Um,O as Lm,b as Bm,y as js,x as Qs}from"./BQs868cI.js";import{h as ua,j as rr,C as zm,u as Xs,e as Fm,a as Vm}from"./D7464H8B.js";import{d as Km}from"./BdYQM_9Z.js";import{p as Gm,c as Wm}from"./DV8vxavj.js";import{j as jl,g as Ql,k as Xl}from"./CX6ZVZP8.js";import{w as Ym,x as qm,y as jm,z as Qm,A as Xm,B as Jm,C as Zm}from"./Dl8uL88t.js";import{g as Ba,j as xm,k as $m,m as ep}from"./BQEMayK6.js";import{f as ai}from"./Cgo5ewoa.js";import Jl from"./CF4_YkFU.js";import{e as yt,u as ws,o as vs}from"./DOi8FfRu.js";import{u as tp,b as np}from"./CXOqznru.js";import"./C7mVdHWX.js";import{M as yf,a as wf,b as vf}from"./BD1cYD2K.js";import{M as zn}from"./Clho6vVM.js";import{b as za}from"./D0VtmBkg.js";import{f as ks}from"./CBc5jlPY.js";import{D as Fa}from"./Cuw40vro.js";import{T as Ft}from"./CSMXUTi0.js";import{S as op}from"./DOdgUkVE.js";import{W as rp,B as Va}from"./CTIo_Dqo.js";import{V as ip,R as sp}from"./Ce1KHyjf.js";import{F as ap}from"./UYZoEWp3.js";import{g as lp}from"./CgPSx72R.js";import{g as cp}from"./BjfCjpsn.js";import{F as kf}from"./CU2r43ac.js";import{d as up,r as dp}from"./I1CDPYOB.js";import{S as Cs}from"./R3jnHhLu.js";import{M as fp}from"./DuEzRzUF.js";import{F as Cf}from"./D9EXU4hk.js";import{I as hp}from"./Dz2bbB3I.js";import{X as Es}from"./Bus0oop7.js";import{G as gp}from"./BkEhPLPW.js";import{S as mp}from"./r6VQ1cZ2.js";import{K as pp,S as _p,M as bp}from"./B74Rqbdy.js";import{T as yp,S as wp,P as vp}from"./C6cDsHXR.js";import{S as kp}from"./BhFq3bSh.js";import{f as Cp}from"./CyTOOynw.js";import{E as Zl,h as Ep}from"./MzMpT8ak.js";import{M as Ip,U as Tp}from"./DlOTuDtj.js";import{M as Sp}from"./DnuVQ-D8.js";import{A as Ap}from"./DsP_JzDW.js";import{g as Rp,j as Mp,k as Pp,m as Op}from"./D8rSbqjm.js";import{V as Np,H as Dp}from"./DlaAdyL1.js";import{s as Hp,t as Up}from"./C7z_5WAu.js";import{D as Lp}from"./B6AwsgrP.js";import{P as Ef}from"./CCL0U8b1.js";import{g as Ho,a as pi}from"./CgU5AtxT.js";import{E as Bp}from"./CAYouX3X.js";import{A as zp}from"./C6y4dPUu.js";import{C as Fp}from"./D_cgVhu-.js";import{E as Vp}from"./LTqusBkU.js";function Kp(o){let e;for(;e=o.sourceEvent;)o=e;return o}function co(o,e){if(o=Kp(o),e===void 0&&(e=o.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=o.clientX,n.y=o.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[o.clientX-r.left-e.clientLeft,o.clientY-r.top-e.clientTop]}}return[o.pageX,o.pageY]}const Gp={passive:!1},_i={capture:!0,passive:!1};function Js(o){o.stopImmediatePropagation()}function hr(o){o.preventDefault(),o.stopImmediatePropagation()}function If(o){var e=o.document.documentElement,t=eo(o).on("dragstart.drag",hr,_i);"onselectstart"in e?t.on("selectstart.drag",hr,_i):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Tf(o,e){var t=o.document.documentElement,n=eo(o).on("dragstart.drag",null);e&&(n.on("click.drag",hr,_i),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in t?n.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const Li=o=>()=>o;function da(o,{sourceEvent:e,subject:t,target:n,identifier:r,active:i,x:s,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}da.prototype.on=function(){var o=this._.on.apply(this._,arguments);return o===this._?this:o};function Wp(o){return!o.ctrlKey&&!o.button}function Yp(){return this.parentNode}function qp(o,e){return e??{x:o.x,y:o.y}}function jp(){return navigator.maxTouchPoints||"ontouchstart"in this}function Qp(){var o=Wp,e=Yp,t=qp,n=jp,r={},i=ff("start","drag","end"),s=0,a,l,c,u,d=0;function f(I){I.on("mousedown.drag",h).filter(n).on("touchstart.drag",w).on("touchmove.drag",m,Gp).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(I,P){if(!(u||!o.call(this,I,P))){var R=y(this,e.call(this,I,P),I,P,"mouse");R&&(eo(I.view).on("mousemove.drag",p,_i).on("mouseup.drag",b,_i),If(I.view),Js(I),c=!1,a=I.clientX,l=I.clientY,R("start",I))}}function p(I){if(hr(I),!c){var P=I.clientX-a,R=I.clientY-l;c=P*P+R*R>d}r.mouse("drag",I)}function b(I){eo(I.view).on("mousemove.drag mouseup.drag",null),Tf(I.view,c),hr(I),r.mouse("end",I)}function w(I,P){if(o.call(this,I,P)){var R=I.changedTouches,k=e.call(this,I,P),N=R.length,M,H;for(M=0;M<N;++M)(H=y(this,k,I,P,R[M].identifier,R[M]))&&(Js(I),H("start",I,R[M]))}}function m(I){var P=I.changedTouches,R=P.length,k,N;for(k=0;k<R;++k)(N=r[P[k].identifier])&&(hr(I),N("drag",I,P[k]))}function v(I){var P=I.changedTouches,R=P.length,k,N;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),k=0;k<R;++k)(N=r[P[k].identifier])&&(Js(I),N("end",I,P[k]))}function y(I,P,R,k,N,M){var H=i.copy(),V=co(M||R,P),Q,J,E;if((E=t.call(I,new da("beforestart",{sourceEvent:R,target:f,identifier:N,active:s,x:V[0],y:V[1],dx:0,dy:0,dispatch:H}),k))!=null)return Q=E.x-V[0]||0,J=E.y-V[1]||0,function Y(D,W,F){var G=V,K;switch(D){case"start":r[N]=Y,K=s++;break;case"end":delete r[N],--s;case"drag":V=co(F||W,P),K=s;break}H.call(D,I,new da(D,{sourceEvent:W,subject:E,target:f,identifier:N,active:K,x:V[0]+Q,y:V[1]+J,dx:V[0]-G[0],dy:V[1]-G[1],dispatch:H}),k)}}return f.filter=function(I){return arguments.length?(o=typeof I=="function"?I:Li(!!I),f):o},f.container=function(I){return arguments.length?(e=typeof I=="function"?I:Li(I),f):e},f.subject=function(I){return arguments.length?(t=typeof I=="function"?I:Li(I),f):t},f.touchable=function(I){return arguments.length?(n=typeof I=="function"?I:Li(!!I),f):n},f.on=function(){var I=i.on.apply(i,arguments);return I===i?f:I},f.clickDistance=function(I){return arguments.length?(d=(I=+I)*I,f):Math.sqrt(d)},f}var Xp=1e-12;function xl(o){return((o=Math.exp(o))+1/o)/2}function Jp(o){return((o=Math.exp(o))-1/o)/2}function Zp(o){return((o=Math.exp(2*o))-1)/(o+1)}const xp=function o(e,t,n){function r(i,s){var a=i[0],l=i[1],c=i[2],u=s[0],d=s[1],f=s[2],h=u-a,p=d-l,b=h*h+p*p,w,m;if(b<Xp)m=Math.log(f/c)/e,w=function(k){return[a+k*h,l+k*p,c*Math.exp(e*k*m)]};else{var v=Math.sqrt(b),y=(f*f-c*c+n*b)/(2*c*t*v),I=(f*f-c*c-n*b)/(2*f*t*v),P=Math.log(Math.sqrt(y*y+1)-y),R=Math.log(Math.sqrt(I*I+1)-I);m=(R-P)/e,w=function(k){var N=k*m,M=xl(P),H=c/(t*v)*(M*Zp(e*N+P)-Jp(P));return[a+H*h,l+H*p,c*M/xl(e*N+P)]}}return w.duration=m*1e3*e/Math.SQRT2,w}return r.rho=function(i){var s=Math.max(.001,+i),a=s*s,l=a*a;return o(s,a,l)},r}(Math.SQRT2,2,4),Bi=o=>()=>o;function $p(o,{sourceEvent:e,target:t,transform:n,dispatch:r}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:r}})}function Zs(o){o.stopImmediatePropagation()}function ii(o){o.preventDefault(),o.stopImmediatePropagation()}function e_(o){return(!o.ctrlKey||o.type==="wheel")&&!o.button}function t_(){var o=this;return o instanceof SVGElement?(o=o.ownerSVGElement||o,o.hasAttribute("viewBox")?(o=o.viewBox.baseVal,[[o.x,o.y],[o.x+o.width,o.y+o.height]]):[[0,0],[o.width.baseVal.value,o.height.baseVal.value]]):[[0,0],[o.clientWidth,o.clientHeight]]}function $l(){return this.__zoom||Ua}function n_(o){return-o.deltaY*(o.deltaMode===1?.05:o.deltaMode?1:.002)*(o.ctrlKey?10:1)}function o_(){return navigator.maxTouchPoints||"ontouchstart"in this}function r_(o,e,t){var n=o.invertX(e[0][0])-t[0][0],r=o.invertX(e[1][0])-t[1][0],i=o.invertY(e[0][1])-t[0][1],s=o.invertY(e[1][1])-t[1][1];return o.translate(r>n?(n+r)/2:Math.min(0,n)||Math.max(0,r),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function i_(){var o=e_,e=t_,t=r_,n=n_,r=o_,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=xp,c=ff("start","zoom","end"),u,d,f,h=500,p=150,b=0,w=10;function m(E){E.property("__zoom",$l).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",H).filter(r).on("touchstart.zoom",V).on("touchmove.zoom",Q).on("touchend.zoom touchcancel.zoom",J).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(E,Y,D,W){var F=E.selection?E.selection():E;F.property("__zoom",$l),E!==F?P(E,Y,D,W):F.interrupt().each(function(){R(this,arguments).event(W).start().zoom(null,typeof Y=="function"?Y.apply(this,arguments):Y).end()})},m.scaleBy=function(E,Y,D,W){m.scaleTo(E,function(){var F=this.__zoom.k,G=typeof Y=="function"?Y.apply(this,arguments):Y;return F*G},D,W)},m.scaleTo=function(E,Y,D,W){m.transform(E,function(){var F=e.apply(this,arguments),G=this.__zoom,K=D==null?I(F):typeof D=="function"?D.apply(this,arguments):D,j=G.invert(K),re=typeof Y=="function"?Y.apply(this,arguments):Y;return t(y(v(G,re),K,j),F,s)},D,W)},m.translateBy=function(E,Y,D,W){m.transform(E,function(){return t(this.__zoom.translate(typeof Y=="function"?Y.apply(this,arguments):Y,typeof D=="function"?D.apply(this,arguments):D),e.apply(this,arguments),s)},null,W)},m.translateTo=function(E,Y,D,W,F){m.transform(E,function(){var G=e.apply(this,arguments),K=this.__zoom,j=W==null?I(G):typeof W=="function"?W.apply(this,arguments):W;return t(Ua.translate(j[0],j[1]).scale(K.k).translate(typeof Y=="function"?-Y.apply(this,arguments):-Y,typeof D=="function"?-D.apply(this,arguments):-D),G,s)},W,F)};function v(E,Y){return Y=Math.max(i[0],Math.min(i[1],Y)),Y===E.k?E:new Ys(Y,E.x,E.y)}function y(E,Y,D){var W=Y[0]-D[0]*E.k,F=Y[1]-D[1]*E.k;return W===E.x&&F===E.y?E:new Ys(E.k,W,F)}function I(E){return[(+E[0][0]+ +E[1][0])/2,(+E[0][1]+ +E[1][1])/2]}function P(E,Y,D,W){E.on("start.zoom",function(){R(this,arguments).event(W).start()}).on("interrupt.zoom end.zoom",function(){R(this,arguments).event(W).end()}).tween("zoom",function(){var F=this,G=arguments,K=R(F,G).event(W),j=e.apply(F,G),re=D==null?I(j):typeof D=="function"?D.apply(F,G):D,ue=Math.max(j[1][0]-j[0][0],j[1][1]-j[0][1]),X=F.__zoom,me=typeof Y=="function"?Y.apply(F,G):Y,ne=l(X.invert(re).concat(ue/X.k),me.invert(re).concat(ue/me.k));return function(q){if(q===1)q=me;else{var he=ne(q),Z=ue/he[2];q=new Ys(Z,re[0]-he[0]*Z,re[1]-he[1]*Z)}K.zoom(null,q)}})}function R(E,Y,D){return!D&&E.__zooming||new k(E,Y)}function k(E,Y){this.that=E,this.args=Y,this.active=0,this.sourceEvent=null,this.extent=e.apply(E,Y),this.taps=0}k.prototype={event:function(E){return E&&(this.sourceEvent=E),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(E,Y){return this.mouse&&E!=="mouse"&&(this.mouse[1]=Y.invert(this.mouse[0])),this.touch0&&E!=="touch"&&(this.touch0[1]=Y.invert(this.touch0[0])),this.touch1&&E!=="touch"&&(this.touch1[1]=Y.invert(this.touch1[0])),this.that.__zoom=Y,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(E){var Y=eo(this.that).datum();c.call(E,this.that,new $p(E,{sourceEvent:this.sourceEvent,target:m,type:E,transform:this.that.__zoom,dispatch:c}),Y)}};function N(E,...Y){if(!o.apply(this,arguments))return;var D=R(this,Y).event(E),W=this.__zoom,F=Math.max(i[0],Math.min(i[1],W.k*Math.pow(2,n.apply(this,arguments)))),G=co(E);if(D.wheel)(D.mouse[0][0]!==G[0]||D.mouse[0][1]!==G[1])&&(D.mouse[1]=W.invert(D.mouse[0]=G)),clearTimeout(D.wheel);else{if(W.k===F)return;D.mouse=[G,W.invert(G)],qs(this),D.start()}ii(E),D.wheel=setTimeout(K,p),D.zoom("mouse",t(y(v(W,F),D.mouse[0],D.mouse[1]),D.extent,s));function K(){D.wheel=null,D.end()}}function M(E,...Y){if(f||!o.apply(this,arguments))return;var D=E.currentTarget,W=R(this,Y,!0).event(E),F=eo(E.view).on("mousemove.zoom",re,!0).on("mouseup.zoom",ue,!0),G=co(E,D),K=E.clientX,j=E.clientY;If(E.view),Zs(E),W.mouse=[G,this.__zoom.invert(G)],qs(this),W.start();function re(X){if(ii(X),!W.moved){var me=X.clientX-K,ne=X.clientY-j;W.moved=me*me+ne*ne>b}W.event(X).zoom("mouse",t(y(W.that.__zoom,W.mouse[0]=co(X,D),W.mouse[1]),W.extent,s))}function ue(X){F.on("mousemove.zoom mouseup.zoom",null),Tf(X.view,W.moved),ii(X),W.event(X).end()}}function H(E,...Y){if(o.apply(this,arguments)){var D=this.__zoom,W=co(E.changedTouches?E.changedTouches[0]:E,this),F=D.invert(W),G=D.k*(E.shiftKey?.5:2),K=t(y(v(D,G),W,F),e.apply(this,Y),s);ii(E),a>0?eo(this).transition().duration(a).call(P,K,W,E):eo(this).call(m.transform,K,W,E)}}function V(E,...Y){if(o.apply(this,arguments)){var D=E.touches,W=D.length,F=R(this,Y,E.changedTouches.length===W).event(E),G,K,j,re;for(Zs(E),K=0;K<W;++K)j=D[K],re=co(j,this),re=[re,this.__zoom.invert(re),j.identifier],F.touch0?!F.touch1&&F.touch0[2]!==re[2]&&(F.touch1=re,F.taps=0):(F.touch0=re,G=!0,F.taps=1+!!u);u&&(u=clearTimeout(u)),G&&(F.taps<2&&(d=re[0],u=setTimeout(function(){u=null},h)),qs(this),F.start())}}function Q(E,...Y){if(this.__zooming){var D=R(this,Y).event(E),W=E.changedTouches,F=W.length,G,K,j,re;for(ii(E),G=0;G<F;++G)K=W[G],j=co(K,this),D.touch0&&D.touch0[2]===K.identifier?D.touch0[0]=j:D.touch1&&D.touch1[2]===K.identifier&&(D.touch1[0]=j);if(K=D.that.__zoom,D.touch1){var ue=D.touch0[0],X=D.touch0[1],me=D.touch1[0],ne=D.touch1[1],q=(q=me[0]-ue[0])*q+(q=me[1]-ue[1])*q,he=(he=ne[0]-X[0])*he+(he=ne[1]-X[1])*he;K=v(K,Math.sqrt(q/he)),j=[(ue[0]+me[0])/2,(ue[1]+me[1])/2],re=[(X[0]+ne[0])/2,(X[1]+ne[1])/2]}else if(D.touch0)j=D.touch0[0],re=D.touch0[1];else return;D.zoom("touch",t(y(K,j,re),D.extent,s))}}function J(E,...Y){if(this.__zooming){var D=R(this,Y).event(E),W=E.changedTouches,F=W.length,G,K;for(Zs(E),f&&clearTimeout(f),f=setTimeout(function(){f=null},h),G=0;G<F;++G)K=W[G],D.touch0&&D.touch0[2]===K.identifier?delete D.touch0:D.touch1&&D.touch1[2]===K.identifier&&delete D.touch1;if(D.touch1&&!D.touch0&&(D.touch0=D.touch1,delete D.touch1),D.touch0)D.touch0[1]=this.__zoom.invert(D.touch0[0]);else if(D.end(),D.taps===2&&(K=co(K,this),Math.hypot(d[0]-K[0],d[1]-K[1])<w)){var j=eo(this).on("dblclick.zoom");j&&j.apply(this,arguments)}}}return m.wheelDelta=function(E){return arguments.length?(n=typeof E=="function"?E:Bi(+E),m):n},m.filter=function(E){return arguments.length?(o=typeof E=="function"?E:Bi(!!E),m):o},m.touchable=function(E){return arguments.length?(r=typeof E=="function"?E:Bi(!!E),m):r},m.extent=function(E){return arguments.length?(e=typeof E=="function"?E:Bi([[+E[0][0],+E[0][1]],[+E[1][0],+E[1][1]]]),m):e},m.scaleExtent=function(E){return arguments.length?(i[0]=+E[0],i[1]=+E[1],m):[i[0],i[1]]},m.translateExtent=function(E){return arguments.length?(s[0][0]=+E[0][0],s[1][0]=+E[1][0],s[0][1]=+E[0][1],s[1][1]=+E[1][1],m):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},m.constrain=function(E){return arguments.length?(t=E,m):t},m.duration=function(E){return arguments.length?(a=+E,m):a},m.interpolate=function(E){return arguments.length?(l=E,m):l},m.on=function(){var E=c.on.apply(c,arguments);return E===c?m:E},m.clickDistance=function(E){return arguments.length?(b=(E=+E)*E,m):Math.sqrt(b)},m.tapDistance=function(E){return arguments.length?(w=+E,m):w},m}function s_(o){let e,t,n,r,i,s,a;return l(),{feed:c,reset:l};function l(){e=!0,t="",n=0,r=-1,i=void 0,s=void 0,a=""}function c(d){t=t?t+d:d,e&&a_(t)&&(t=t.slice(Sf.length)),e=!1;const f=t.length;let h=0,p=!1;for(;h<f;){p&&(t[h]===`
`&&++h,p=!1);let b=-1,w=r,m;for(let v=n;b<0&&v<f;++v)m=t[v],m===":"&&w<0?w=v-h:m==="\r"?(p=!0,b=v-h):m===`
`&&(b=v-h);if(b<0){n=f-h,r=w;break}else n=0,r=-1;u(t,h,w,b),h+=b+1}h===f?t="":h>0&&(t=t.slice(h))}function u(d,f,h,p){if(p===0){a.length>0&&(o({type:"event",id:i,event:s||void 0,data:a.slice(0,-1)}),a="",i=void 0),s=void 0;return}const b=h<0,w=d.slice(f,f+(b?p:h));let m=0;b?m=p:d[f+h+1]===" "?m=h+2:m=h+1;const v=f+m,y=p-m,I=d.slice(v,v+y).toString();if(w==="data")a+=I?"".concat(I,`
`):`
`;else if(w==="event")s=I;else if(w==="id"&&!I.includes("\0"))i=I;else if(w==="retry"){const P=parseInt(I,10);Number.isNaN(P)||o({type:"reconnect-interval",value:P})}}}const Sf=[239,187,191];function a_(o){return Sf.every((e,t)=>o.charCodeAt(t)===e)}class l_ extends TransformStream{constructor(){let e;super({start(t){e=s_(n=>{n.type==="event"&&t.enqueue(n)})},transform(t){e.feed(t)}})}}async function c_(o,e){const t=o.pipeThrough(new TextDecoderStream).pipeThrough(new l_).getReader();let n=u_(t);return e&&(n=d_(n)),n}async function*u_(o){var e,t,n;for(;;){const{value:r,done:i}=await o.read();if(i){yield{done:!0,value:""};break}if(!r)continue;const s=r.data;if(s.startsWith("[DONE]")){yield{done:!0,value:""};break}try{const a=JSON.parse(s);if(a.error){yield{done:!0,value:"",error:a.error};break}if(a.sources){yield{done:!1,value:"",sources:a.sources};continue}if(a.selected_model_id){yield{done:!1,value:"",selectedModelId:a.selected_model_id};continue}if(a.usage){yield{done:!1,value:"",usage:a.usage};continue}yield{done:!1,value:((n=(t=(e=a.choices)==null?void 0:e[0])==null?void 0:t.delta)==null?void 0:n.content)??""}}catch(a){console.error("Error extracting delta from SSE event:",a)}}}async function*d_(o){for await(const e of o){if(e.done){yield e;return}if(e.error){yield e;continue}if(e.sources){yield e;continue}if(e.selectedModelId){yield e;continue}if(e.usage){yield e;continue}let t=e.value;if(t.length<5){yield{done:!1,value:t};continue}for(;t!="";){const n=Math.min(Math.floor(Math.random()*3)+1,t.length);yield{done:!1,value:t.slice(0,n)},(document==null?void 0:document.visibilityState)!=="hidden"&&await f_(5),t=t.slice(n)}}}const f_=o=>new Promise(e=>setTimeout(e,o));let bi="",yi="";async function h_(){var t,n;const o=await fetch("/api/config");if(!o.ok)throw new Error("Failed to fetch Google Drive credentials");const e=await o.json();if(bi=(t=e.google_drive)==null?void 0:t.api_key,yi=(n=e.google_drive)==null?void 0:n.client_id,!bi||!yi)throw new Error("Google Drive API credentials not configured")}const g_=["https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.file"],m_=()=>{if(!bi||!yi)throw new Error("Google Drive API credentials not configured");if(bi===""||yi==="")throw new Error("Please configure valid Google Drive API credentials")};let zi=null,ec=!1;const p_=()=>new Promise((o,e)=>{if(typeof gapi>"u"){const t=document.createElement("script");t.src="https://apis.google.com/js/api.js",t.onload=()=>{gapi.load("picker",()=>{o(!0)})},t.onerror=e,document.body.appendChild(t)}else gapi.load("picker",()=>{o(!0)})}),__=()=>new Promise((o,e)=>{if(typeof google>"u"){const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.onload=o,t.onerror=e,document.body.appendChild(t)}else o(!0)}),b_=async()=>zi||new Promise((o,e)=>{google.accounts.oauth2.initTokenClient({client_id:yi,scope:g_.join(" "),callback:n=>{n.access_token?(zi=n.access_token,o(zi)):e(new Error("Failed to get access token"))},error_callback:n=>{e(new Error(n.message||"OAuth error occurred"))}}).requestAccessToken()}),y_=async()=>{ec||(await h_(),m_(),await Promise.all([p_(),__()]),ec=!0)},w_=()=>new Promise(async(o,e)=>{try{await y_();const t=await b_();if(!t)throw console.error("Failed to get OAuth token"),new Error("Unable to get OAuth token");new google.picker.PickerBuilder().enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).addView(new google.picker.DocsView().setIncludeFolders(!1).setSelectFolderEnabled(!1).setMimeTypes("application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.presentation")).setOAuthToken(t).setDeveloperKey(bi).setCallback(async r=>{if(r[google.picker.Response.ACTION]===google.picker.Action.PICKED)try{const i=r[google.picker.Response.DOCUMENTS][0],s=i[google.picker.Document.ID],a=i[google.picker.Document.NAME],l=i[google.picker.Document.URL];if(!s||!a)throw new Error("Required file details missing");const c=i[google.picker.Document.MIME_TYPE];let u,d;c.includes("google-apps")?(c.includes("document")?d="text/plain":c.includes("spreadsheet")?d="text/csv":c.includes("presentation")?d="text/plain":d="application/pdf",u=`https://www.googleapis.com/drive/v3/files/${s}/export?mimeType=${encodeURIComponent(d)}`):u=`https://www.googleapis.com/drive/v3/files/${s}?alt=media`;const f=await fetch(u,{headers:{Authorization:`Bearer ${t}`,Accept:"*/*"}});if(!f.ok){const b=await f.text();throw console.error("Download failed:",{status:f.status,statusText:f.statusText,error:b}),new Error(`Failed to download file (${f.status}): ${b}`)}const h=await f.blob(),p={id:s,name:a,url:u,blob:h,headers:{Authorization:`Bearer ${t}`,Accept:"*/*"}};o(p)}catch(i){e(i)}else r[google.picker.Response.ACTION]===google.picker.Action.CANCEL&&o(null)}).build().setVisible(!0)}catch(t){console.error("Google Drive Picker error:",t),e(t)}});/*! @azure/msal-common v15.2.0 2025-02-18 */const pe={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Fi={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Si=[pe.OPENID_SCOPE,pe.PROFILE_SCOPE,pe.OFFLINE_ACCESS_SCOPE],tc=[...Si,pe.EMAIL_SCOPE],Nn={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},nc={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},No={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Vi={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},mn={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},oc={PLAIN:"plain",S256:"S256"},Ai={QUERY:"query",FRAGMENT:"fragment"},v_={...Ai,FORM_POST:"form_post"},Af={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Ki={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},Pn={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},gt={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Ka="appmetadata",k_="client_info",ci="1",ts={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Vn={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},In={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},Nt={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},ui={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},rc={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},ic={username:"username",password:"password"},Gi={httpSuccess:200,httpBadRequest:400},ir={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},xs={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Yo={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},C_={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},E_=300;/*! @azure/msal-common v15.2.0 2025-02-18 */const Ga="unexpected_error",I_="post_request_failed";/*! @azure/msal-common v15.2.0 2025-02-18 */const sc={[Ga]:"Unexpected error in authentication.",[I_]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class Xt extends Error{constructor(e,t,n){const r=t?`${e}: ${t}`:e;super(r),Object.setPrototypeOf(this,Xt.prototype),this.errorCode=e||pe.EMPTY_STRING,this.errorMessage=t||pe.EMPTY_STRING,this.subError=n||pe.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function Rf(o,e){return new Xt(o,e?`${sc[o]} ${e}`:sc[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */const Wa="client_info_decoding_error",Mf="client_info_empty_error",Ya="token_parsing_error",Pf="null_or_empty_token",vo="endpoints_resolution_error",Of="network_error",Nf="openid_config_error",Df="hash_not_deserialized",yr="invalid_state",Hf="state_mismatch",ns="state_not_found",Uf="nonce_mismatch",qa="auth_time_not_found",Lf="max_age_transpired",T_="multiple_matching_tokens",S_="multiple_matching_accounts",Bf="multiple_matching_appMetadata",zf="request_cannot_be_made",Ff="cannot_remove_empty_scope",Vf="cannot_append_scopeset",fa="empty_input_scopeset",A_="device_code_polling_cancelled",R_="device_code_expired",M_="device_code_unknown_error",ja="no_account_in_silent_request",Kf="invalid_cache_record",Qa="invalid_cache_environment",ha="no_account_found",ga="no_crypto_object",ma="unexpected_credential_type",P_="invalid_assertion",O_="invalid_client_credential",Do="token_refresh_required",N_="user_timeout_reached",Gf="token_claims_cnf_required_for_signedjwt",Wf="authorization_code_missing_from_server_response",Yf="binding_key_not_removed",qf="end_session_endpoint_not_supported",Xa="key_id_missing",D_="no_network_connectivity",H_="user_canceled",U_="missing_tenant_id_error",bt="method_not_implemented",L_="nested_app_auth_bridge_disabled";/*! @azure/msal-common v15.2.0 2025-02-18 */const ac={[Wa]:"The client info could not be parsed/decoded correctly",[Mf]:"The client info was empty",[Ya]:"Token cannot be parsed",[Pf]:"The token is null or empty",[vo]:"Endpoints cannot be resolved",[Of]:"Network request failed",[Nf]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[Df]:"The hash parameters could not be deserialized",[yr]:"State was not the expected format",[Hf]:"State mismatch error",[ns]:"State not found",[Uf]:"Nonce mismatch error",[qa]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Lf]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[T_]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[S_]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[Bf]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[zf]:"Token request cannot be made without authorization code or refresh token.",[Ff]:"Cannot remove null or empty scope from ScopeSet",[Vf]:"Cannot append ScopeSet",[fa]:"Empty input ScopeSet cannot be processed",[A_]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[R_]:"Device code is expired.",[M_]:"Device code stopped polling for unknown reasons.",[ja]:"Please pass an account object, silent flow is not supported without account information",[Kf]:"Cache record object was null or undefined.",[Qa]:"Invalid environment when attempting to create cache entry",[ha]:"No account found in cache for given key.",[ga]:"No crypto object detected.",[ma]:"Unexpected credential type.",[P_]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[O_]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Do]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[N_]:"User defined timeout for device code polling reached",[Gf]:"Cannot generate a POP jwt if the token_claims are not populated",[Wf]:"Server response does not contain an authorization code to proceed",[Yf]:"Could not remove the credential's binding key from storage.",[qf]:"The provided authority does not support logout",[Xa]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[D_]:"No network connectivity. Check your internet connection.",[H_]:"User cancelled the flow.",[U_]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[bt]:"This method has not been implemented",[L_]:"The nested app auth bridge is disabled"};class Ja extends Xt{constructor(e,t){super(e,t?`${ac[e]}: ${t}`:ac[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Ja.prototype)}}function Ie(o,e){return new Ja(o,e)}/*! @azure/msal-common v15.2.0 2025-02-18 */const os={createNewGuid:()=>{throw Ie(bt)},base64Decode:()=>{throw Ie(bt)},base64Encode:()=>{throw Ie(bt)},base64UrlEncode:()=>{throw Ie(bt)},encodeKid:()=>{throw Ie(bt)},async getPublicKeyThumbprint(){throw Ie(bt)},async removeTokenBindingKey(){throw Ie(bt)},async clearKeystore(){throw Ie(bt)},async signJwt(){throw Ie(bt)},async hashString(){throw Ie(bt)}};/*! @azure/msal-common v15.2.0 2025-02-18 */var Qt;(function(o){o[o.Error=0]="Error",o[o.Warning=1]="Warning",o[o.Info=2]="Info",o[o.Verbose=3]="Verbose",o[o.Trace=4]="Trace"})(Qt||(Qt={}));class Uo{constructor(e,t,n){this.level=Qt.Info;const r=()=>{},i=e||Uo.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||r,this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level=typeof i.logLevel=="number"?i.logLevel:Qt.Info,this.correlationId=i.correlationId||pe.EMPTY_STRING,this.packageName=t||pe.EMPTY_STRING,this.packageVersion=n||pe.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Qt.Info}}clone(e,t,n){return new Uo({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const i=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${Qt[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,i,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:Qt.Error,containsPii:!1,correlationId:t||pe.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:Qt.Error,containsPii:!0,correlationId:t||pe.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:Qt.Warning,containsPii:!1,correlationId:t||pe.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:Qt.Warning,containsPii:!0,correlationId:t||pe.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:Qt.Info,containsPii:!1,correlationId:t||pe.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:Qt.Info,containsPii:!0,correlationId:t||pe.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:Qt.Verbose,containsPii:!1,correlationId:t||pe.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:Qt.Verbose,containsPii:!0,correlationId:t||pe.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:Qt.Trace,containsPii:!1,correlationId:t||pe.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:Qt.Trace,containsPii:!0,correlationId:t||pe.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v15.2.0 2025-02-18 */const jf="@azure/msal-common",Za="15.2.0";/*! @azure/msal-common v15.2.0 2025-02-18 */const xa={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v15.2.0 2025-02-18 */function Rr(o,e){const t=B_(o);try{const n=e(t);return JSON.parse(n)}catch{throw Ie(Ya)}}function B_(o){if(!o)throw Ie(Pf);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(o);if(!t||t.length<4)throw Ie(Ya);return t[2]}function Qf(o,e){if(e===0||Date.now()-3e5>o+e)throw Ie(Lf)}/*! @azure/msal-common v15.2.0 2025-02-18 */function _o(){return Math.round(new Date().getTime()/1e3)}function pa(o,e){const t=Number(o)||0;return _o()+e>t}function z_(o){return Number(o)>_o()}/*! @azure/msal-common v15.2.0 2025-02-18 */function di(o){return[G_(o),W_(o),Y_(o),q_(o),j_(o)].join(Pn.CACHE_KEY_SEPARATOR).toLowerCase()}function Is(o,e,t,n,r){return{credentialType:gt.ID_TOKEN,homeAccountId:o,environment:e,clientId:n,secret:t,realm:r}}function Ts(o,e,t,n,r,i,s,a,l,c,u,d,f,h,p){var w,m;const b={homeAccountId:o,credentialType:gt.ACCESS_TOKEN,secret:t,cachedAt:_o().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:n,realm:r,target:i,tokenType:u||Nt.BEARER};if(d&&(b.userAssertionHash=d),c&&(b.refreshOn=c.toString()),h&&(b.requestedClaims=h,b.requestedClaimsHash=p),((w=b.tokenType)==null?void 0:w.toLowerCase())!==Nt.BEARER.toLowerCase())switch(b.credentialType=gt.ACCESS_TOKEN_WITH_AUTH_SCHEME,b.tokenType){case Nt.POP:const v=Rr(t,l);if(!((m=v==null?void 0:v.cnf)!=null&&m.kid))throw Ie(Gf);b.keyId=v.cnf.kid;break;case Nt.SSH:b.keyId=f}return b}function Xf(o,e,t,n,r,i,s){const a={credentialType:gt.REFRESH_TOKEN,homeAccountId:o,environment:e,clientId:n,secret:t};return i&&(a.userAssertionHash=i),r&&(a.familyId=r),s&&(a.expiresOn=s.toString()),a}function $a(o){return o.hasOwnProperty("homeAccountId")&&o.hasOwnProperty("environment")&&o.hasOwnProperty("credentialType")&&o.hasOwnProperty("clientId")&&o.hasOwnProperty("secret")}function F_(o){return o?$a(o)&&o.hasOwnProperty("realm")&&o.hasOwnProperty("target")&&(o.credentialType===gt.ACCESS_TOKEN||o.credentialType===gt.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function V_(o){return o?$a(o)&&o.hasOwnProperty("realm")&&o.credentialType===gt.ID_TOKEN:!1}function K_(o){return o?$a(o)&&o.credentialType===gt.REFRESH_TOKEN:!1}function G_(o){return[o.homeAccountId,o.environment].join(Pn.CACHE_KEY_SEPARATOR).toLowerCase()}function W_(o){const e=o.credentialType===gt.REFRESH_TOKEN&&o.familyId||o.clientId;return[o.credentialType,e,o.realm||""].join(Pn.CACHE_KEY_SEPARATOR).toLowerCase()}function Y_(o){return(o.target||"").toLowerCase()}function q_(o){return(o.requestedClaimsHash||"").toLowerCase()}function j_(o){return o.tokenType&&o.tokenType.toLowerCase()!==Nt.BEARER.toLowerCase()?o.tokenType.toLowerCase():""}function Q_(o,e){const t=o.indexOf(In.CACHE_KEY)===0;let n=!0;return e&&(n=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&n}function X_(o,e){let t=!1;o&&(t=o.indexOf(ui.THROTTLING_PREFIX)===0);let n=!0;return e&&(n=e.hasOwnProperty("throttleTime")),t&&n}function J_({environment:o,clientId:e}){return[Ka,o,e].join(Pn.CACHE_KEY_SEPARATOR).toLowerCase()}function Z_(o,e){return e?o.indexOf(Ka)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function x_(o,e){return e?o.indexOf(ts.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function lc(){return _o()+ts.REFRESH_TIME_SECONDS}function Wi(o,e,t){o.authorization_endpoint=e.authorization_endpoint,o.token_endpoint=e.token_endpoint,o.end_session_endpoint=e.end_session_endpoint,o.issuer=e.issuer,o.endpointsFromNetwork=t,o.jwks_uri=e.jwks_uri}function $s(o,e,t){o.aliases=e.aliases,o.preferred_cache=e.preferred_cache,o.preferred_network=e.preferred_network,o.aliasesFromNetwork=t}function cc(o){return o.expiresAt<=_o()}/*! @azure/msal-common v15.2.0 2025-02-18 */const Jf="redirect_uri_empty",$_="claims_request_parsing_error",Zf="authority_uri_insecure",li="url_parse_error",xf="empty_url_error",$f="empty_input_scopes_error",eh="invalid_prompt_value",el="invalid_claims",th="token_request_empty",nh="logout_request_empty",oh="invalid_code_challenge_method",tl="pkce_params_missing",nl="invalid_cloud_discovery_metadata",rh="invalid_authority_metadata",ih="untrusted_authority",Ss="missing_ssh_jwk",sh="missing_ssh_kid",e1="missing_nonce_authentication_header",t1="invalid_authentication_header",ah="cannot_set_OIDCOptions",lh="cannot_allow_platform_broker",ch="authority_mismatch";/*! @azure/msal-common v15.2.0 2025-02-18 */const n1={[Jf]:"A redirect URI is required for all calls, and none has been set.",[$_]:"Could not parse the given claims request object.",[Zf]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[li]:"URL could not be parsed into appropriate segments.",[xf]:"URL was empty or null.",[$f]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[eh]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[el]:"Given claims parameter must be a stringified JSON object.",[th]:"Token request was empty and not found in cache.",[nh]:"The logout request was null or undefined.",[oh]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[tl]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[nl]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[rh]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[ih]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Ss]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[sh]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[e1]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[t1]:"Invalid authentication header provided",[ah]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[lh]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[ch]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class ol extends Xt{constructor(e){super(e,n1[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,ol.prototype)}}function Ut(o){return new ol(o)}/*! @azure/msal-common v15.2.0 2025-02-18 */class mo{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),r=i=>decodeURIComponent(i.replace(/\+/g," "));return n.forEach(i=>{if(i.trim()){const[s,a]=i.split(/=(.+)/g,2);s&&a&&(t[r(s)]=r(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class on{constructor(e){const t=e?mo.trimArrayEntries([...e]):[],n=t?mo.removeEmptyStringsFromArray(t):[];if(!n||!n.length)throw Ut($f);this.scopes=new Set,n.forEach(r=>this.scopes.add(r))}static fromString(e){const n=(e||pe.EMPTY_STRING).split(" ");return new on(n)}static createSearchScopes(e){const t=new on(e);return t.containsOnlyOIDCScopes()?t.removeScope(pe.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new on(t);return e?n.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return tc.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw Ie(Vf)}}removeScope(e){if(!e)throw Ie(Ff);this.scopes.delete(e.trim())}removeOIDCScopes(){tc.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw Ie(fa);const t=new Set;return e.scopes.forEach(n=>t.add(n.toLowerCase())),this.scopes.forEach(n=>t.add(n.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw Ie(fa);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):pe.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v15.2.0 2025-02-18 */function rs(o,e){if(!o)throw Ie(Mf);try{const t=e(o);return JSON.parse(t)}catch{throw Ie(Wa)}}function cr(o){if(!o)throw Ie(Wa);const e=o.split(Pn.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?pe.EMPTY_STRING:e[1]}}/*! @azure/msal-common v15.2.0 2025-02-18 */function uc(o,e){return!!o&&!!e&&o===e.split(".")[1]}function rl(o,e,t,n){if(n){const{oid:r,sub:i,tid:s,name:a,tfp:l,acr:c}=n,u=s||l||c||"";return{tenantId:u,localAccountId:r||i||"",name:a,isHomeTenant:uc(u,o)}}else return{tenantId:t,localAccountId:e,isHomeTenant:uc(t,o)}}function il(o,e,t,n){let r=o;if(e){const{isHomeTenant:i,...s}=e;r={...o,...s}}if(t){const{isHomeTenant:i,...s}=rl(o.homeAccountId,o.localAccountId,o.tenantId,t);return r={...r,...s,idTokenClaims:t,idToken:n},r}return r}/*! @azure/msal-common v15.2.0 2025-02-18 */const $n={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v15.2.0 2025-02-18 */function uh(o){return o&&(o.tid||o.tfp||o.acr)||null}/*! @azure/msal-common v15.2.0 2025-02-18 */const Eo={AAD:"AAD",OIDC:"OIDC"};/*! @azure/msal-common v15.2.0 2025-02-18 */class Dn{generateAccountId(){return[this.homeAccountId,this.environment].join(Pn.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return Dn.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(Pn.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,n){var c,u,d,f,h,p;const r=new Dn;t.authorityType===$n.Adfs?r.authorityType=Ki.ADFS_ACCOUNT_TYPE:t.protocolMode===Eo.AAD?r.authorityType=Ki.MSSTS_ACCOUNT_TYPE:r.authorityType=Ki.GENERIC_ACCOUNT_TYPE;let i;e.clientInfo&&n&&(i=rs(e.clientInfo,n)),r.clientInfo=e.clientInfo,r.homeAccountId=e.homeAccountId,r.nativeAccountId=e.nativeAccountId;const s=e.environment||t&&t.getPreferredCache();if(!s)throw Ie(Qa);r.environment=s,r.realm=(i==null?void 0:i.utid)||uh(e.idTokenClaims)||"",r.localAccountId=(i==null?void 0:i.uid)||((c=e.idTokenClaims)==null?void 0:c.oid)||((u=e.idTokenClaims)==null?void 0:u.sub)||"";const a=((d=e.idTokenClaims)==null?void 0:d.preferred_username)||((f=e.idTokenClaims)==null?void 0:f.upn),l=(h=e.idTokenClaims)!=null&&h.emails?e.idTokenClaims.emails[0]:null;if(r.username=a||l||"",r.name=((p=e.idTokenClaims)==null?void 0:p.name)||"",r.cloudGraphHostName=e.cloudGraphHostName,r.msGraphHost=e.msGraphHost,e.tenantProfiles)r.tenantProfiles=e.tenantProfiles;else{const b=rl(e.homeAccountId,r.localAccountId,r.realm,e.idTokenClaims);r.tenantProfiles=[b]}return r}static createFromAccountInfo(e,t,n){var i;const r=new Dn;return r.authorityType=e.authorityType||Ki.GENERIC_ACCOUNT_TYPE,r.homeAccountId=e.homeAccountId,r.localAccountId=e.localAccountId,r.nativeAccountId=e.nativeAccountId,r.realm=e.tenantId,r.environment=e.environment,r.username=e.username,r.name=e.name,r.cloudGraphHostName=t,r.msGraphHost=n,r.tenantProfiles=Array.from(((i=e.tenantProfiles)==null?void 0:i.values())||[]),r}static generateHomeAccountId(e,t,n,r,i){if(!(t===$n.Adfs||t===$n.Dsts)){if(e)try{const s=rs(e,r.base64Decode);if(s.uid&&s.utid)return`${s.uid}.${s.utid}`}catch{}n.warning("No client info in response")}return(i==null?void 0:i.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let r=!0;if(n){const i=e.idTokenClaims||{},s=t.idTokenClaims||{};r=i.iat===s.iat&&i.nonce===s.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&r}}/*! @azure/msal-common v15.2.0 2025-02-18 */function dh(o){return o.startsWith("#/")?o.substring(2):o.startsWith("#")||o.startsWith("?")?o.substring(1):o}function is(o){if(!o||o.indexOf("=")<0)return null;try{const e=dh(o),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw Ie(Df)}return null}/*! @azure/msal-common v15.2.0 2025-02-18 */class It{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw Ut(xf);e.includes("#")||(this._urlString=It.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return mo.endsWith(t,"?")?t=t.slice(0,-1):mo.endsWith(t,"?/")&&(t=t.slice(0,-2)),mo.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw Ut(li)}if(!e.HostNameAndPort||!e.PathSegments)throw Ut(li);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw Ut(Zf)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return It.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return e&&n.length!==0&&(n[0]===No.COMMON||n[0]===No.ORGANIZATIONS)&&(n[0]=e),It.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw Ut(li);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let r=n.AbsolutePath.split("/");return r=r.filter(i=>i&&i.length>0),n.PathSegments=r,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw Ut(li);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===pe.FORWARD_SLASH){const r=new It(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new It(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!is(e)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const fh={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},dc=fh.endpointMetadata,sl=fh.instanceDiscoveryMetadata,hh=new Set;sl.metadata.forEach(o=>{o.aliases.forEach(e=>{hh.add(e)})});function o1(o,e){var r;let t;const n=o.canonicalAuthority;if(n){const i=new It(n).getUrlComponents().HostNameAndPort;t=fc(i,(r=o.cloudDiscoveryMetadata)==null?void 0:r.metadata,Vn.CONFIG,e)||fc(i,sl.metadata,Vn.HARDCODED_VALUES,e)||o.knownAuthorities}return t||[]}function fc(o,e,t,n){if(n==null||n.trace(`getAliasesFromMetadata called with source: ${t}`),o&&e){const r=ss(e,o);if(r)return n==null||n.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),r.aliases;n==null||n.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function r1(o){return ss(sl.metadata,o)}function ss(o,e){for(let t=0;t<o.length;t++){const n=o[t];if(n.aliases.includes(e))return n}return null}/*! @azure/msal-common v15.2.0 2025-02-18 */const gh="cache_quota_exceeded",al="cache_error_unknown";/*! @azure/msal-common v15.2.0 2025-02-18 */const ea={[gh]:"Exceeded cache storage capacity.",[al]:"Unexpected error occurred when using cache storage."};class gr extends Error{constructor(e,t){const n=t||(ea[e]?ea[e]:ea[al]);super(`${e}: ${n}`),Object.setPrototypeOf(this,gr.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}/*! @azure/msal-common v15.2.0 2025-02-18 */class _a{constructor(e,t,n,r){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(jf,Za),this.staticAuthorityOptions=r}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){const t=this.getAllAccounts(e);return t.length>1?t.sort(r=>r.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){const t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(n=>this.getTenantProfilesFromAccountEntity(n,t==null?void 0:t.tenantId,t))}getTenantedAccountInfoByFilter(e,t,n,r){let i=null,s;if(r&&!this.tenantProfileMatchesFilter(n,r))return null;const a=this.getIdToken(e,t,n.tenantId);return a&&(s=Rr(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(s,r))?null:(i=il(e,n,s,a==null?void 0:a.secret),i)}getTenantProfilesFromAccountEntity(e,t,n){const r=e.getAccountInfo();let i=r.tenantProfiles||new Map;const s=this.getTokenKeys();if(t){const l=i.get(t);if(l)i=new Map([[t,l]]);else return[]}const a=[];return i.forEach(l=>{const c=this.getTenantedAccountInfoByFilter(r,s,l,n);c&&a.push(c)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,n){var r,i,s,a;if(!e)throw Ie(Kf);try{e.account&&await this.setAccount(e.account,t),e.idToken&&(n==null?void 0:n.idToken)!==!1&&await this.setIdTokenCredential(e.idToken,t),e.accessToken&&(n==null?void 0:n.accessToken)!==!1&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&(n==null?void 0:n.refreshToken)!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata)}catch(l){throw(r=this.commonLogger)==null||r.error("CacheManager.saveCacheRecord: failed"),l instanceof Error?((i=this.commonLogger)==null||i.errorPii(`CacheManager.saveCacheRecord: ${l.message}`,t),l.name==="QuotaExceededError"||l.name==="NS_ERROR_DOM_QUOTA_REACHED"||l.message.includes("exceeded the quota")?((s=this.commonLogger)==null||s.error("CacheManager.saveCacheRecord: exceeded storage quota",t),new gr(gh)):new gr(l.name,l.message)):((a=this.commonLogger)==null||a.errorPii(`CacheManager.saveCacheRecord: ${l}`,t),new gr(al))}}async saveAccessToken(e,t){const n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),i=on.fromString(e.target),s=[];r.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,n,!1))return;const l=this.getAccessTokenCredential(a);l&&this.credentialMatchesFilter(l,n)&&on.fromString(l.target).intersectingScopeSets(i)&&s.push(this.removeAccessToken(a))}),await Promise.all(s),await this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e){const t=this.getAccountKeys(),n=[];return t.forEach(r=>{var l;if(!this.isAccountKey(r,e.homeAccountId))return;const i=this.getAccount(r,this.commonLogger);if(!i||e.homeAccountId&&!this.matchHomeAccountId(i,e.homeAccountId)||e.username&&!this.matchUsername(i.username,e.username)||e.environment&&!this.matchEnvironment(i,e.environment)||e.realm&&!this.matchRealm(i,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(i,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(i,e.authorityType))return;const s={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},a=(l=i.tenantProfiles)==null?void 0:l.filter(c=>this.tenantProfileMatchesFilter(c,s));a&&a.length===0||n.push(i)}),n}isAccountKey(e,t,n){return!(e.split(Pn.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||n&&!e.toLowerCase().includes(n.toLowerCase()))}isCredentialKey(e){if(e.split(Pn.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(t.indexOf(gt.ID_TOKEN.toLowerCase())===-1&&t.indexOf(gt.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(gt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(gt.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(gt.REFRESH_TOKEN.toLowerCase())>-1){const n=`${gt.REFRESH_TOKEN}${Pn.CACHE_KEY_SEPARATOR}${this.clientId}${Pn.CACHE_KEY_SEPARATOR}`,r=`${gt.REFRESH_TOKEN}${Pn.CACHE_KEY_SEPARATOR}${ci}${Pn.CACHE_KEY_SEPARATOR}`;if(t.indexOf(n.toLowerCase())===-1&&t.indexOf(r.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===gt.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===Nt.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),n={};return t.forEach(r=>{if(!this.isAppMetadata(r))return;const i=this.getAppMetadata(r);i&&(e.environment&&!this.matchEnvironment(i,e.environment)||e.clientId&&!this.matchClientId(i,e.clientId)||(n[r]=i))}),n}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(r=>{if(!this.isAuthorityMetadata(r)||r.indexOf(this.clientId)===-1)return;const i=this.getAuthorityMetadata(r);i&&i.aliases.indexOf(e)!==-1&&(n=i)}),n}async removeAllAccounts(){const e=this.getAccountKeys(),t=[];e.forEach(n=>{t.push(this.removeAccount(n))}),await Promise.all(t)}async removeAccount(e){const t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){const t=this.getTokenKeys(),n=e.generateAccountId(),r=[];t.idToken.forEach(i=>{i.indexOf(n)===0&&this.removeIdToken(i)}),t.accessToken.forEach(i=>{i.indexOf(n)===0&&r.push(this.removeAccessToken(i))}),t.refreshToken.forEach(i=>{i.indexOf(n)===0&&this.removeRefreshToken(i)}),await Promise.all(r)}async removeAccessToken(e){const t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===gt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===Nt.POP){const r=t.keyId;if(r)try{await this.cryptoImpl.removeTokenBindingKey(r)}catch{throw Ie(Yf)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){const t=Dn.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,n,r,i){this.commonLogger.trace("CacheManager - getIdToken called");const s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:gt.ID_TOKEN,clientId:this.clientId,realm:n},a=this.getIdTokensByFilter(s,t),l=a.size;if(l<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(l>1){let c=a;if(!n){const u=new Map;a.forEach((f,h)=>{f.realm===e.tenantId&&u.set(h,f)});const d=u.size;if(d<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(d===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),u.values().next().value;c=u}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),c.forEach((u,d)=>{this.removeIdToken(d)}),r&&i&&r.addFields({multiMatchedID:a.size},i),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t){const n=t&&t.idToken||this.getTokenKeys().idToken,r=new Map;return n.forEach(i=>{if(!this.idTokenKeyMatchesFilter(i,{clientId:this.clientId,...e}))return;const s=this.getIdTokenCredential(i);s&&this.credentialMatchesFilter(s,e)&&r.set(i,s)}),r}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,n,r,i,s){this.commonLogger.trace("CacheManager - getAccessToken called");const a=on.createSearchScopes(t.scopes),l=t.authenticationScheme||Nt.BEARER,c=l&&l.toLowerCase()!==Nt.BEARER.toLowerCase()?gt.ACCESS_TOKEN_WITH_AUTH_SCHEME:gt.ACCESS_TOKEN,u={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:r||e.tenantId,target:a,tokenType:l,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},d=n&&n.accessToken||this.getTokenKeys().accessToken,f=[];d.forEach(p=>{if(this.accessTokenKeyMatchesFilter(p,u,!0)){const b=this.getAccessTokenCredential(p);b&&this.credentialMatchesFilter(b,u)&&f.push(b)}});const h=f.length;return h<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):h>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),f.forEach(p=>{this.removeAccessToken(di(p))}),i&&s&&i.addFields({multiMatchedAT:f.length},s),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),f[0])}accessTokenKeyMatchesFilter(e,t,n){const r=e.toLowerCase();if(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&r.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&r.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const i=t.target.asArray();for(let s=0;s<i.length;s++){if(n&&!r.includes(i[s].toLowerCase()))return!1;if(!n&&r.includes(i[s].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){const t=this.getTokenKeys(),n=[];return t.accessToken.forEach(r=>{if(!this.accessTokenKeyMatchesFilter(r,e,!0))return;const i=this.getAccessTokenCredential(r);i&&this.credentialMatchesFilter(i,e)&&n.push(i)}),n}getRefreshToken(e,t,n,r,i){this.commonLogger.trace("CacheManager - getRefreshToken called");const s=t?ci:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:gt.REFRESH_TOKEN,clientId:this.clientId,familyId:s},l=n&&n.refreshToken||this.getTokenKeys().refreshToken,c=[];l.forEach(d=>{if(this.refreshTokenKeyMatchesFilter(d,a)){const f=this.getRefreshTokenCredential(d);f&&this.credentialMatchesFilter(f,a)&&c.push(f)}});const u=c.length;return u<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(u>1&&r&&i&&r.addFields({multiMatchedRT:u},i),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),c[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&n.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),r=Object.keys(n).map(s=>n[s]),i=r.length;if(i<1)return null;if(i>1)throw Ie(Bf);return r[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===ci)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const n=e.oid||e.sub;return t===n}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var n;return t.toLowerCase()===((n=e.name)==null?void 0:n.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const r=o1(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var n;return((n=e.realm)==null?void 0:n.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==gt.ACCESS_TOKEN&&e.credentialType!==gt.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:on.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(Ka)!==-1}isAuthorityMetadata(e){return e.indexOf(ts.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${ts.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class i1 extends _a{async setAccount(){throw Ie(bt)}getAccount(){throw Ie(bt)}async setIdTokenCredential(){throw Ie(bt)}getIdTokenCredential(){throw Ie(bt)}async setAccessTokenCredential(){throw Ie(bt)}getAccessTokenCredential(){throw Ie(bt)}async setRefreshTokenCredential(){throw Ie(bt)}getRefreshTokenCredential(){throw Ie(bt)}setAppMetadata(){throw Ie(bt)}getAppMetadata(){throw Ie(bt)}setServerTelemetry(){throw Ie(bt)}getServerTelemetry(){throw Ie(bt)}setAuthorityMetadata(){throw Ie(bt)}getAuthorityMetadata(){throw Ie(bt)}getAuthorityMetadataKeys(){throw Ie(bt)}setThrottlingCache(){throw Ie(bt)}getThrottlingCache(){throw Ie(bt)}removeItem(){throw Ie(bt)}getKeys(){throw Ie(bt)}getAccountKeys(){throw Ie(bt)}getTokenKeys(){throw Ie(bt)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const mh={tokenRenewalOffsetSeconds:E_,preventCorsPreflight:!1},s1={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Qt.Info,correlationId:pe.EMPTY_STRING},a1={claimsBasedCachingEnabled:!1},l1={async sendGetRequestAsync(){throw Ie(bt)},async sendPostRequestAsync(){throw Ie(bt)}},c1={sku:pe.SKU,version:Za,cpu:pe.EMPTY_STRING,os:pe.EMPTY_STRING},u1={clientSecret:pe.EMPTY_STRING,clientAssertion:void 0},d1={azureCloudInstance:xa.None,tenant:`${pe.DEFAULT_COMMON_TENANT}`},f1={application:{appName:"",appVersion:""}};function h1({authOptions:o,systemOptions:e,loggerOptions:t,cacheOptions:n,storageInterface:r,networkInterface:i,cryptoInterface:s,clientCredentials:a,libraryInfo:l,telemetry:c,serverTelemetryManager:u,persistencePlugin:d,serializableCache:f}){const h={...s1,...t};return{authOptions:g1(o),systemOptions:{...mh,...e},loggerOptions:h,cacheOptions:{...a1,...n},storageInterface:r||new i1(o.clientId,os,new Uo(h)),networkInterface:i||l1,cryptoInterface:s||os,clientCredentials:a||u1,libraryInfo:{...c1,...l},telemetry:{...f1,...c},serverTelemetryManager:u||null,persistencePlugin:d||null,serializableCache:f||null}}function g1(o){return{clientCapabilities:[],azureCloudOptions:d1,skipAuthorityMetadataCache:!1,instanceAware:!1,...o}}function ba(o){return o.authOptions.authority.options.protocolMode===Eo.OIDC}/*! @azure/msal-common v15.2.0 2025-02-18 */const jn={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v15.2.0 2025-02-18 */const Jo="client_id",ph="redirect_uri",hc="response_type",m1="response_mode",p1="grant_type",_1="claims",b1="scope",y1="refresh_token",w1="state",v1="nonce",k1="prompt",C1="code",E1="code_challenge",I1="code_challenge_method",T1="code_verifier",S1="client-request-id",A1="x-client-SKU",R1="x-client-VER",M1="x-client-OS",P1="x-client-CPU",O1="x-client-current-telemetry",N1="x-client-last-telemetry",D1="x-ms-lib-capability",H1="x-app-name",U1="x-app-ver",L1="post_logout_redirect_uri",B1="id_token_hint",z1="device_code",F1="client_secret",V1="client_assertion",K1="client_assertion_type",gc="token_type",mc="req_cnf",G1="assertion",W1="requested_token_use",pc="return_spa_code",Y1="nativebroker",q1="logout_hint",j1="sid",Q1="login_hint",X1="domain_hint",J1="x-client-xtra-sku",ll="brk_client_id",ya="brk_redirect_uri";/*! @azure/msal-common v15.2.0 2025-02-18 */class sr{static validateRedirectUri(e){if(!e)throw Ut(Jf)}static validatePrompt(e){const t=[];for(const n in mn)t.push(mn[n]);if(t.indexOf(e)<0)throw Ut(eh)}static validateClaims(e){try{JSON.parse(e)}catch{throw Ut(el)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw Ut(tl);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([oc.PLAIN,oc.S256].indexOf(e)<0)throw Ut(oh)}}/*! @azure/msal-common v15.2.0 2025-02-18 */function Z1(o,e,t){if(!e)return;const n=o.get(Jo);n&&o.has(ll)&&(t==null||t.addFields({embeddedClientId:n,embeddedRedirectUri:o.get(ph)},e))}class fi{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(hc,encodeURIComponent(pe.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(hc,encodeURIComponent(`${pe.TOKEN_RESPONSE_TYPE} ${pe.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(m1,encodeURIComponent(e||v_.QUERY))}addNativeBroker(){this.parameters.set(Y1,encodeURIComponent("1"))}addScopes(e,t=!0,n=Si){t&&!n.includes("openid")&&!e.includes("openid")&&n.push("openid");const r=t?[...e||[],...n]:e||[],i=new on(r);this.parameters.set(b1,encodeURIComponent(i.printScopes()))}addClientId(e){this.parameters.set(Jo,encodeURIComponent(e))}addRedirectUri(e){sr.validateRedirectUri(e),this.parameters.set(ph,encodeURIComponent(e))}addPostLogoutRedirectUri(e){sr.validateRedirectUri(e),this.parameters.set(L1,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(B1,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(X1,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(Q1,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(Nn.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(Nn.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(j1,encodeURIComponent(e))}addClaims(e,t){const n=this.addClientCapabilitiesToClaims(e,t);sr.validateClaims(n),this.parameters.set(_1,encodeURIComponent(n))}addCorrelationId(e){this.parameters.set(S1,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(A1,e.sku),this.parameters.set(R1,e.version),e.os&&this.parameters.set(M1,e.os),e.cpu&&this.parameters.set(P1,e.cpu)}addApplicationTelemetry(e){e!=null&&e.appName&&this.parameters.set(H1,e.appName),e!=null&&e.appVersion&&this.parameters.set(U1,e.appVersion)}addPrompt(e){sr.validatePrompt(e),this.parameters.set(`${k1}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(w1,encodeURIComponent(e))}addNonce(e){this.parameters.set(v1,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(sr.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(E1,encodeURIComponent(e)),this.parameters.set(I1,encodeURIComponent(t));else throw Ut(tl)}addAuthorizationCode(e){this.parameters.set(C1,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(z1,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(y1,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(T1,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(F1,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(V1,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(K1,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(G1,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(W1,encodeURIComponent(e))}addGrantType(e){this.parameters.set(p1,encodeURIComponent(e))}addClientInfo(){this.parameters.set(k_,"1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,n])=>{!this.parameters.has(t)&&n&&this.parameters.set(t,n)})}addClientCapabilitiesToClaims(e,t){let n;if(!e)n={};else try{n=JSON.parse(e)}catch{throw Ut(el)}return t&&t.length>0&&(n.hasOwnProperty(Vi.ACCESS_TOKEN)||(n[Vi.ACCESS_TOKEN]={}),n[Vi.ACCESS_TOKEN][Vi.XMS_CC]={values:t}),JSON.stringify(n)}addUsername(e){this.parameters.set(ic.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(ic.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(gc,Nt.POP),this.parameters.set(mc,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(gc,Nt.SSH),this.parameters.set(mc,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(O1,e.generateCurrentRequestHeaderValue()),this.parameters.set(N1,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(D1,ui.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(q1,encodeURIComponent(e))}addBrokerParameters(e){const t={};t[ll]=e.brokerClientId,t[ya]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){const e=new Array;return this.parameters.forEach((t,n)=>{e.push(`${n}=${t}`)}),Z1(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}/*! @azure/msal-common v15.2.0 2025-02-18 */function x1(o){return o.hasOwnProperty("authorization_endpoint")&&o.hasOwnProperty("token_endpoint")&&o.hasOwnProperty("issuer")&&o.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v15.2.0 2025-02-18 */function $1(o){return o.hasOwnProperty("tenant_discovery_endpoint")&&o.hasOwnProperty("metadata")}/*! @azure/msal-common v15.2.0 2025-02-18 */function e0(o){return o.hasOwnProperty("error")&&o.hasOwnProperty("error_description")}/*! @azure/msal-common v15.2.0 2025-02-18 */const ae={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt"},t0={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v15.2.0 2025-02-18 */const Ao=(o,e,t,n,r)=>(...i)=>{t.trace(`Executing function ${e}`);const s=n==null?void 0:n.startMeasurement(e,r);if(r){const a=e+"CallCount";n==null||n.incrementFields({[a]:1},r)}try{const a=o(...i);return s==null||s.end({success:!0}),t.trace(`Returning result from ${e}`),a}catch(a){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s==null||s.end({success:!1},a),a}},Te=(o,e,t,n,r)=>(...i)=>{t.trace(`Executing function ${e}`);const s=n==null?void 0:n.startMeasurement(e,r);if(r){const a=e+"CallCount";n==null||n.incrementFields({[a]:1},r)}return n==null||n.setPreQueueTime(e,r),o(...i).then(a=>(t.trace(`Returning result from ${e}`),s==null||s.end({success:!0}),a)).catch(a=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s==null||s.end({success:!1},a),a})};/*! @azure/msal-common v15.2.0 2025-02-18 */class As{constructor(e,t,n,r){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=r}async detectRegion(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.RegionDiscoveryDetectRegion,this.correlationId);let n=e;if(n)t.region_source=ir.ENVIRONMENT_VARIABLE;else{const i=As.IMDS_OPTIONS;try{const s=await Te(this.getRegionFromIMDS.bind(this),ae.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(pe.IMDS_VERSION,i);if(s.status===Gi.httpSuccess&&(n=s.body,t.region_source=ir.IMDS),s.status===Gi.httpBadRequest){const a=await Te(this.getCurrentVersion.bind(this),ae.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(i);if(!a)return t.region_source=ir.FAILED_AUTO_DETECTION,null;const l=await Te(this.getRegionFromIMDS.bind(this),ae.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(a,i);l.status===Gi.httpSuccess&&(n=l.body,t.region_source=ir.IMDS)}}catch{return t.region_source=ir.FAILED_AUTO_DETECTION,null}}return n||(t.region_source=ir.FAILED_AUTO_DETECTION),n||null}async getRegionFromIMDS(e,t){var n;return(n=this.performanceClient)==null||n.addQueueMeasurement(ae.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${pe.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,pe.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(ae.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const n=await this.networkInterface.sendGetRequestAsync(`${pe.IMDS_ENDPOINT}?format=json`,e);return n.status===Gi.httpBadRequest&&n.body&&n.body["newest-versions"]&&n.body["newest-versions"].length>0?n.body["newest-versions"][0]:null}catch{return null}}}As.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v15.2.0 2025-02-18 */class Mn{constructor(e,t,n,r,i,s,a,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=a,this.correlationId=s,this.managedIdentity=l||!1,this.regionDiscovery=new As(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(pe.CIAM_AUTH_URL))return $n.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case pe.ADFS:return $n.Adfs;case pe.DSTS:return $n.Dsts}return $n.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new It(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw Ie(vo)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw Ie(vo)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw Ie(vo)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw Ie(qf);return this.replacePath(this.metadata.end_session_endpoint)}else throw Ie(vo)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw Ie(vo)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw Ie(vo)}canReplaceTenant(e){return e.PathSegments.length===1&&!Mn.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===$n.Default&&this.protocolMode===Eo.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const r=new It(this.metadata.canonical_authority).getUrlComponents(),i=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,l)=>{let c=i[l];if(l===0&&this.canReplaceTenant(r)){const u=new It(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];c!==u&&(this.logger.verbose(`Replacing tenant domain name ${c} with id ${u}`),c=u)}a!==c&&(t=t.replace(`/${c}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===$n.Adfs||this.protocolMode!==Eo.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var r,i;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await Te(this.updateCloudDiscoveryMetadata.bind(this),ae.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const n=await Te(this.updateEndpointMetadata.bind(this),ae.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),(i=this.performanceClient)==null||i.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:lc(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==Vn.CACHE&&(n==null?void 0:n.source)!==Vn.CACHE&&(e.expiresAt=lc(),e.canonical_authority=this.canonicalAuthority);const r=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(r,e),this.metadata=e}async updateEndpointMetadata(e){var r,i,s;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Vn.HARDCODED_VALUES&&(i=this.authorityOptions.azureRegionConfiguration)!=null&&i.azureRegion&&t.metadata){const a=await Te(this.updateMetadataWithRegionalInformation.bind(this),ae.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);Wi(e,a,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let n=await Te(this.getEndpointMetadataFromNetwork.bind(this),ae.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return(s=this.authorityOptions.azureRegionConfiguration)!=null&&s.azureRegion&&(n=await Te(this.updateMetadataWithRegionalInformation.bind(this),ae.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(n)),Wi(e,n,!0),Vn.NETWORK;throw Ie(Nf,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Wi(e,t,!1),{source:Vn.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const r=this.getEndpointMetadataFromHardcodedValues();if(r)return Wi(e,r,!1),{source:Vn.HARDCODED_VALUES,metadata:r};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=cc(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Vn.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new It(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw Ut(rh)}return null}async getEndpointMetadataFromNetwork(){var n;(n=this.performanceClient)==null||n.addQueueMeasurement(ae.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const r=await this.networkInterface.sendGetRequestAsync(t,e);return x1(r.body)?r.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(r){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${r}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in dc?dc[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var n,r,i;(n=this.performanceClient)==null||n.addQueueMeasurement(ae.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(r=this.authorityOptions.azureRegionConfiguration)==null?void 0:r.azureRegion;if(t){if(t!==pe.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=xs.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,Mn.replaceWithRegionalInformation(e,t);const s=await Te(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),ae.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.environmentRegion,this.regionDiscoveryMetadata);if(s)return this.regionDiscoveryMetadata.region_outcome=xs.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=s,Mn.replaceWithRegionalInformation(e,s);this.regionDiscoveryMetadata.region_outcome=xs.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const n=await Te(this.getCloudDiscoveryMetadataFromNetwork.bind(this),ae.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return $s(e,n,!0),Vn.NETWORK;throw Ut(ih)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||pe.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||pe.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||pe.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),$s(e,t,!1),Vn.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const r=r1(this.hostnameAndPort);if(r)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),$s(e,r,!1),Vn.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const n=cc(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),Vn.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===$n.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),Mn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=ss(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),Ut(nl)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),Mn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${pe.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let n=null;try{const i=await this.networkInterface.sendGetRequestAsync(e,t);let s,a;if($1(i.body))s=i.body,a=s.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${s.tenant_discovery_endpoint}`);else if(e0(i.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${i.status}`),s=i.body,s.error===pe.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${s.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${s.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=ss(a,this.hostnameAndPort)}catch(i){if(i instanceof Xt)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${i.errorCode}
Error Description: ${i.errorMessage}`);else{const s=i;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${s.name}
Error Description: ${s.message}`)}return null}return n||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),n=Mn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&It.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==xa.None){const r=t.tenant?t.tenant:pe.DEFAULT_COMMON_TENANT;n=`${t.azureCloudInstance}/${r}/`}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return pe.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw Ie(vo)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return hh.has(e)}static isPublicCloudAuthority(e){return pe.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const r=new It(e);r.validateAsUri();const i=r.getUrlComponents();let s=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(s=`${t}.${pe.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const a=It.constructAuthorityUriFromObject({...r.getUrlComponents(),HostNameAndPort:s}).urlString;return n?`${a}?${n}`:a}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=Mn.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=Mn.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=Mn.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const r=new It(e).getUrlComponents();if(r.PathSegments.length===0&&r.HostNameAndPort.endsWith(pe.CIAM_AUTH_URL)){const i=r.HostNameAndPort.split(".")[0];t=`${t}${i}${pe.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}Mn.reservedTenantDomains=new Set(["{tenant}","{tenantid}",No.COMMON,No.CONSUMERS,No.ORGANIZATIONS]);function n0(o){var r;const n=(r=new It(o).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:r.toLowerCase();switch(n){case No.COMMON:case No.ORGANIZATIONS:case No.CONSUMERS:return;default:return n}}function _h(o){return o.endsWith(pe.FORWARD_SLASH)?o:`${o}${pe.FORWARD_SLASH}`}function o0(o){const e=o.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw Ut(nl)}return{canonicalAuthority:o.authority?_h(o.authority):void 0,knownAuthorities:o.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v15.2.0 2025-02-18 */async function bh(o,e,t,n,r,i,s){s==null||s.addQueueMeasurement(ae.AuthorityFactoryCreateDiscoveredInstance,i);const a=Mn.transformCIAMAuthority(_h(o)),l=new Mn(a,e,t,n,r,i,s);try{return await Te(l.resolveEndpointsAsync.bind(l),ae.AuthorityResolveEndpointsAsync,r,s,i)(),l}catch{throw Ie(vo)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Lo extends Xt{constructor(e,t,n,r,i){super(e,t,n),this.name="ServerError",this.errorNo=r,this.status=i,Object.setPrototypeOf(this,Lo.prototype)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class uo{static generateThrottlingStorageKey(e){return`${ui.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){var i;const n=uo.generateThrottlingStorageKey(t),r=e.getThrottlingCache(n);if(r){if(r.throttleTime<Date.now()){e.removeItem(n);return}throw new Lo(((i=r.errorCodes)==null?void 0:i.join(" "))||pe.EMPTY_STRING,r.errorMessage,r.subError)}}static postProcess(e,t,n){if(uo.checkResponseStatus(n)||uo.checkResponseForRetryAfter(n)){const r={throttleTime:uo.calculateThrottleTime(parseInt(n.headers[Nn.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(uo.generateThrottlingStorageKey(t),r)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(Nn.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(Math.min(n+(t||ui.DEFAULT_THROTTLE_TIME_SECONDS),n+ui.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,n,r){const i={clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:r,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid},s=this.generateThrottlingStorageKey(i);e.removeItem(s)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Rs extends Xt{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Rs.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function _c(o,e,t){return new Rs(o,e,t)}/*! @azure/msal-common v15.2.0 2025-02-18 */class cl{constructor(e,t){this.config=h1(e),this.logger=new Uo(this.config.loggerOptions,jf,Za),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Nn.CONTENT_TYPE]=pe.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case jn.HOME_ACCOUNT_ID:try{const n=cr(e.credential);t[Nn.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case jn.UPN:t[Nn.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,n,r,i,s){var l;s&&((l=this.performanceClient)==null||l.addQueueMeasurement(s,i));const a=await this.sendPostRequest(r,e,{body:t,headers:n},i);return this.config.serverTelemetryManager&&a.status<500&&a.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async sendPostRequest(e,t,n,r){var s,a,l;uo.preProcess(this.cacheManager,e);let i;try{i=await Te(this.networkClient.sendPostRequestAsync.bind(this.networkClient),ae.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,r)(t,n);const c=i.headers||{};(a=this.performanceClient)==null||a.addFields({refreshTokenSize:((s=i.body.refresh_token)==null?void 0:s.length)||0,httpVerToken:c[Nn.X_MS_HTTP_VERSION]||"",requestId:c[Nn.X_MS_REQUEST_ID]||""},r)}catch(c){if(c instanceof Rs){const u=c.responseHeaders;throw u&&((l=this.performanceClient)==null||l.addFields({httpVerToken:u[Nn.X_MS_HTTP_VERSION]||"",requestId:u[Nn.X_MS_REQUEST_ID]||"",contentTypeHeader:u[Nn.CONTENT_TYPE]||void 0,contentLengthHeader:u[Nn.CONTENT_LENGTH]||void 0,httpStatus:c.httpStatus},r)),c.error}throw c instanceof Xt?c:Ie(Of)}return uo.postProcess(this.cacheManager,e,i),i}async updateAuthority(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(ae.UpdateTokenEndpointAuthority,t);const n=`https://${e}/${this.authority.tenant}/`,r=await bh(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=r}createTokenQueryParameters(e){const t=new fi(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}/*! @azure/msal-common v15.2.0 2025-02-18 */const as="no_tokens_found",yh="native_account_unavailable",ul="refresh_token_expired",r0="interaction_required",i0="consent_required",s0="login_required",Ms="bad_token";/*! @azure/msal-common v15.2.0 2025-02-18 */const bc=[r0,i0,s0,Ms],a0=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],l0={[as]:"No refresh token found in the cache. Please sign-in.",[yh]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[ul]:"Refresh token has expired.",[Ms]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class ro extends Xt{constructor(e,t,n,r,i,s,a,l){super(e,t,n),Object.setPrototypeOf(this,ro.prototype),this.timestamp=r||pe.EMPTY_STRING,this.traceId=i||pe.EMPTY_STRING,this.correlationId=s||pe.EMPTY_STRING,this.claims=a||pe.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=l}}function yc(o,e,t){const n=!!o&&bc.indexOf(o)>-1,r=!!t&&a0.indexOf(t)>-1,i=!!e&&bc.some(s=>e.indexOf(s)>-1);return n||i||r}function wa(o){return new ro(o,l0[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */class no{static setRequestState(e,t,n){const r=no.generateLibraryState(e,n);return t?`${r}${pe.RESOURCE_DELIM}${t}`:r}static generateLibraryState(e,t){if(!e)throw Ie(ga);const n={id:e.createNewGuid()};t&&(n.meta=t);const r=JSON.stringify(n);return e.base64Encode(r)}static parseRequestState(e,t){if(!e)throw Ie(ga);if(!t)throw Ie(yr);try{const n=t.split(pe.RESOURCE_DELIM),r=n[0],i=n.length>1?n.slice(1).join(pe.RESOURCE_DELIM):pe.EMPTY_STRING,s=e.base64Decode(r),a=JSON.parse(s);return{userRequestState:i||pe.EMPTY_STRING,libraryState:a}}catch{throw Ie(yr)}}}/*! @azure/msal-common v15.2.0 2025-02-18 */const c0={SW:"sw",UHW:"uhw"};class wr{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(ae.PopTokenGenerateCnf,e.correlationId);const n=await Te(this.generateKid.bind(this),ae.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),r=this.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:r}}async generateKid(e){var n;return(n=this.performanceClient)==null||n.addQueueMeasurement(ae.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:c0.SW}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,r){const{resourceRequestMethod:i,resourceRequestUri:s,shrClaims:a,shrNonce:l,shrOptions:c}=n,u=s?new It(s):void 0,d=u==null?void 0:u.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:_o(),m:i==null?void 0:i.toUpperCase(),u:d==null?void 0:d.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:d==null?void 0:d.AbsolutePath,q:d!=null&&d.QueryString?[[],d.QueryString]:void 0,client_claims:a||void 0,...r},t,c,n.correlationId)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class u0{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v15.2.0 2025-02-18 */function d0(o){var n,r;const e="code=",t=(n=o.error_uri)==null?void 0:n.lastIndexOf(e);return t&&t>=0?(r=o.error_uri)==null?void 0:r.substring(t+e.length):void 0}class Zo{constructor(e,t,n,r,i,s,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.serializableCache=i,this.persistencePlugin=s,this.performanceClient=a}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?Ie(ns,"Cached State"):Ie(ns,"Server State");let n,r;try{n=decodeURIComponent(e.state)}catch{throw Ie(yr,e.state)}try{r=decodeURIComponent(t)}catch{throw Ie(yr,e.state)}if(n!==r)throw Ie(Hf);if(e.error||e.error_description||e.suberror){const i=d0(e);throw yc(e.error,e.error_description,e.suberror)?new ro(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",i):new Lo(e.error||"",e.error_description,e.suberror,i)}}validateTokenResponse(e,t){var n;if(e.error||e.error_description||e.suberror){const r=`Error(s): ${e.error_codes||pe.NOT_AVAILABLE} - Timestamp: ${e.timestamp||pe.NOT_AVAILABLE} - Description: ${e.error_description||pe.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||pe.NOT_AVAILABLE} - Trace ID: ${e.trace_id||pe.NOT_AVAILABLE}`,i=(n=e.error_codes)!=null&&n.length?e.error_codes[0]:void 0,s=new Lo(e.error,r,e.suberror,i,e.status);if(t&&e.status&&e.status>=Fi.SERVER_ERROR_RANGE_START&&e.status<=Fi.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${s}`);return}else if(t&&e.status&&e.status>=Fi.CLIENT_ERROR_RANGE_START&&e.status<=Fi.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${s}`);return}throw yc(e.error,e.error_description,e.suberror)?new ro(e.error,e.error_description,e.suberror,e.timestamp||pe.EMPTY_STRING,e.trace_id||pe.EMPTY_STRING,e.correlation_id||pe.EMPTY_STRING,e.claims||pe.EMPTY_STRING,i):s}}async handleServerTokenResponse(e,t,n,r,i,s,a,l,c){var p;(p=this.performanceClient)==null||p.addQueueMeasurement(ae.HandleServerTokenResponse,e.correlation_id);let u;if(e.id_token){if(u=Rr(e.id_token||pe.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&u.nonce!==i.nonce)throw Ie(Uf);if(r.maxAge||r.maxAge===0){const b=u.auth_time;if(!b)throw Ie(qa);Qf(b,r.maxAge)}}this.homeAccountIdentifier=Dn.generateHomeAccountId(e.client_info||pe.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u);let d;i&&i.state&&(d=no.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||r.sshKid||void 0;const f=this.generateCacheRecord(e,t,n,r,u,s,i);let h;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),h=new u0(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(h)),a&&!l&&f.account){const b=f.account.generateAccountKey();if(!this.cacheStorage.getAccount(b))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await Zo.generateAuthenticationResult(this.cryptoObj,t,f,!1,r,u,d,void 0,c)}await this.cacheStorage.saveCacheRecord(f,r.correlationId,r.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&h&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(h))}return Zo.generateAuthenticationResult(this.cryptoObj,t,f,!1,r,u,d,e,c)}generateCacheRecord(e,t,n,r,i,s,a){const l=t.getPreferredCache();if(!l)throw Ie(Qa);const c=uh(i);let u,d;e.id_token&&i&&(u=Is(this.homeAccountIdentifier,l,e.id_token,this.clientId,c||""),d=dl(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,i,e.client_info,l,c,a,void 0,this.logger));let f=null;if(e.access_token){const b=e.scope?on.fromString(e.scope):new on(r.scopes||[]),w=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,m=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,v=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,y=n+w,I=y+m,P=v&&v>0?n+v:void 0;f=Ts(this.homeAccountIdentifier,l,e.access_token,this.clientId,c||t.tenant||"",b.printScopes(),y,I,this.cryptoObj.base64Decode,P,e.token_type,s,e.key_id,r.claims,r.requestedClaimsHash)}let h=null;if(e.refresh_token){let b;if(e.refresh_token_expires_in){const w=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;b=n+w}h=Xf(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,s,b)}let p=null;return e.foci&&(p={clientId:this.clientId,environment:l,familyId:e.foci}),{account:d,idToken:u,accessToken:f,refreshToken:h,appMetadata:p}}static async generateAuthenticationResult(e,t,n,r,i,s,a,l,c){var y,I,P,R,k;let u=pe.EMPTY_STRING,d=[],f=null,h,p,b=pe.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType===Nt.POP&&!i.popKid){const N=new wr(e),{secret:M,keyId:H}=n.accessToken;if(!H)throw Ie(Xa);u=await N.signPopToken(M,H,i)}else u=n.accessToken.secret;d=on.fromString(n.accessToken.target).asArray(),f=new Date(Number(n.accessToken.expiresOn)*1e3),h=new Date(Number(n.accessToken.extendedExpiresOn)*1e3),n.accessToken.refreshOn&&(p=new Date(Number(n.accessToken.refreshOn)*1e3))}n.appMetadata&&(b=n.appMetadata.familyId===ci?ci:"");const w=(s==null?void 0:s.oid)||(s==null?void 0:s.sub)||"",m=(s==null?void 0:s.tid)||"";l!=null&&l.spa_accountid&&n.account&&(n.account.nativeAccountId=l==null?void 0:l.spa_accountid);const v=n.account?il(n.account.getAccountInfo(),void 0,s,(y=n.idToken)==null?void 0:y.secret):null;return{authority:t.canonicalAuthority,uniqueId:w,tenantId:m,scopes:d,account:v,idToken:((I=n==null?void 0:n.idToken)==null?void 0:I.secret)||"",idTokenClaims:s||{},accessToken:u,fromCache:r,expiresOn:f,extExpiresOn:h,refreshOn:p,correlationId:i.correlationId,requestId:c||pe.EMPTY_STRING,familyId:b,tokenType:((P=n.accessToken)==null?void 0:P.tokenType)||pe.EMPTY_STRING,state:a?a.userRequestState:pe.EMPTY_STRING,cloudGraphHostName:((R=n.account)==null?void 0:R.cloudGraphHostName)||pe.EMPTY_STRING,msGraphHost:((k=n.account)==null?void 0:k.msGraphHost)||pe.EMPTY_STRING,code:l==null?void 0:l.spa_code,fromNativeBroker:!1}}}function dl(o,e,t,n,r,i,s,a,l,c,u){u==null||u.verbose("setCachedAccount called");const f=o.getAccountKeys().find(m=>m.startsWith(t));let h=null;f&&(h=o.getAccount(f));const p=h||Dn.createAccount({homeAccountId:t,idTokenClaims:r,clientInfo:i,environment:s,cloudGraphHostName:l==null?void 0:l.cloud_graph_host_name,msGraphHost:l==null?void 0:l.msgraph_host,nativeAccountId:c},e,n),b=p.tenantProfiles||[],w=a||p.realm;if(w&&!b.find(m=>m.tenantId===w)){const m=rl(t,p.localAccountId,w,r);b.push(m)}return p.tenantProfiles=b,p}/*! @azure/msal-common v15.2.0 2025-02-18 */async function wh(o,e,t){return typeof o=="string"?o:o({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v15.2.0 2025-02-18 */class vh extends cl{constructor(e,t){var n;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(n=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:n.defaultScopes}async getAuthCodeUrl(e){var n;(n=this.performanceClient)==null||n.addQueueMeasurement(ae.GetAuthCodeUrl,e.correlationId);const t=await Te(this.createAuthCodeUrlQueryString.bind(this),ae.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return It.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){var a,l;if((a=this.performanceClient)==null||a.addQueueMeasurement(ae.AuthClientAcquireToken,e.correlationId),!e.code)throw Ie(zf);const n=_o(),r=await Te(this.executeTokenRequest.bind(this),ae.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=(l=r.headers)==null?void 0:l[Nn.X_MS_REQUEST_ID],s=new Zo(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return s.validateTokenResponse(r.body),Te(s.handleServerTokenResponse.bind(s),ae.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,n,e,t,void 0,void 0,void 0,i)}handleFragmentResponse(e,t){if(new Zo(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw Ie(Wf);return e}getLogoutUri(e){if(!e)throw Ut(nh);const t=this.createLogoutUrlQueryString(e);return It.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var c,u;(c=this.performanceClient)==null||c.addQueueMeasurement(ae.AuthClientExecuteTokenRequest,t.correlationId);const n=this.createTokenQueryParameters(t),r=It.appendQueryString(e.tokenEndpoint,n),i=await Te(this.createTokenRequestBody.bind(this),ae.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let s;if(t.clientInfo)try{const d=rs(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${d.uid}${Pn.CLIENT_INFO_SEPARATOR}${d.utid}`,type:jn.HOME_ACCOUNT_ID}}catch(d){this.logger.verbose("Could not parse client info for CCS Header: "+d)}const a=this.createTokenRequestHeaders(s||t.ccsCredential),l={clientId:((u=t.tokenBodyParameters)==null?void 0:u.clientId)||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return Te(this.executePostToTokenEndpoint.bind(this),ae.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(r,i,a,l,t.correlationId,ae.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,i;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthClientCreateTokenRequestBody,e.correlationId);const t=new fi(e.correlationId,this.performanceClient);if(t.addClientId(e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[Jo])||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):sr.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!ba(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const s=this.config.clientCredentials.clientAssertion;t.addClientAssertion(await wh(s.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),t.addClientAssertionType(s.assertionType)}if(t.addGrantType(Af.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===Nt.POP){const s=new wr(this.cryptoUtils,this.performanceClient);let a;e.popKid?a=this.cryptoUtils.encodeKid(e.popKid):a=(await Te(s.generateCnf.bind(s),ae.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(a)}else if(e.authenticationScheme===Nt.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw Ut(Ss);(!mo.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let n;if(e.clientInfo)try{const s=rs(e.clientInfo,this.cryptoUtils.base64Decode);n={credential:`${s.uid}${Pn.CLIENT_INFO_SEPARATOR}${s.utid}`,type:jn.HOME_ACCOUNT_ID}}catch(s){this.logger.verbose("Could not parse client info for CCS Header: "+s)}else n=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&n)switch(n.type){case jn.HOME_ACCOUNT_ID:try{const s=cr(n.credential);t.addCcsOid(s)}catch(s){this.logger.verbose("Could not parse home account ID for CCS Header: "+s)}break;case jn.UPN:t.addCcsUpn(n.credential);break}return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[pc])&&t.addExtraQueryParameters({[pc]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){var i,s,a,l,c,u,d,f,h,p;const t=e.correlationId||this.config.cryptoInterface.createNewGuid();(i=this.performanceClient)==null||i.addQueueMeasurement(ae.AuthClientCreateQueryString,t);const n=new fi(t,this.performanceClient);n.addClientId(e.embeddedClientId||((s=e.extraQueryParameters)==null?void 0:s[Jo])||this.config.authOptions.clientId);const r=[...e.scopes||[],...e.extraScopesToConsent||[]];if(n.addScopes(r,!0,this.oidcDefaultScopes),n.addRedirectUri(e.redirectUri),n.addCorrelationId(t),n.addResponseMode(e.responseMode),n.addResponseTypeCode(),n.addLibraryInfo(this.config.libraryInfo),ba(this.config)||n.addApplicationTelemetry(this.config.telemetry.application),n.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&n.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&n.addPrompt(e.prompt),e.domainHint&&(n.addDomainHint(e.domainHint),(a=this.performanceClient)==null||a.addFields({domainHintFromRequest:!0},t)),(l=this.performanceClient)==null||l.addFields({prompt:e.prompt},t),e.prompt!==mn.SELECT_ACCOUNT)if(e.sid&&e.prompt===mn.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),n.addSid(e.sid),(c=this.performanceClient)==null||c.addFields({sidFromRequest:!0},t);else if(e.account){const b=this.extractAccountSid(e.account);let w=this.extractLoginHint(e.account);if(w&&e.domainHint&&(this.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),w=null),w){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),n.addLoginHint(w),(u=this.performanceClient)==null||u.addFields({loginHintFromClaim:!0},t);try{const m=cr(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(b&&e.prompt===mn.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),n.addSid(b),(d=this.performanceClient)==null||d.addFields({sidFromClaim:!0},t);try{const m=cr(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint),(f=this.performanceClient)==null||f.addFields({loginHintFromRequest:!0},t);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),n.addLoginHint(e.account.username),(h=this.performanceClient)==null||h.addFields({loginHintFromUpn:!0},t);try{const m=cr(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint),(p=this.performanceClient)==null||p.addFields({loginHintFromRequest:!0},t));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&n.addNonce(e.nonce),e.state&&n.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.embeddedClientId&&n.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),this.addExtraQueryParams(e,n),e.platformBroker&&(n.addNativeBroker(),e.authenticationScheme===Nt.POP)){const b=new wr(this.cryptoUtils);let w;e.popKid?w=this.cryptoUtils.encodeKid(e.popKid):w=(await Te(b.generateCnf.bind(b),ae.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,n.addPopToken(w)}return n.createQueryString()}createLogoutUrlQueryString(e){const t=new fi(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){var t;return((t=e.idTokenClaims)==null?void 0:t.sid)||null}extractLoginHint(e){var t;return((t=e.idTokenClaims)==null?void 0:t.login_hint)||null}}/*! @azure/msal-common v15.2.0 2025-02-18 */const f0=300;class h0 extends cl{constructor(e,t){super(e,t)}async acquireToken(e){var s,a;(s=this.performanceClient)==null||s.addQueueMeasurement(ae.RefreshTokenClientAcquireToken,e.correlationId);const t=_o(),n=await Te(this.executeTokenRequest.bind(this),ae.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),r=(a=n.headers)==null?void 0:a[Nn.X_MS_REQUEST_ID],i=new Zo(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n.body),Te(i.handleServerTokenResponse.bind(i),ae.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,r)}async acquireTokenByRefreshToken(e){var n;if(!e)throw Ut(th);if((n=this.performanceClient)==null||n.addQueueMeasurement(ae.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw Ie(ja);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await Te(this.acquireTokenWithCachedRefreshToken.bind(this),ae.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(r){const i=r instanceof ro&&r.errorCode===as,s=r instanceof Lo&&r.errorCode===rc.INVALID_GRANT_ERROR&&r.subError===rc.CLIENT_MISMATCH_ERROR;if(i||s)return Te(this.acquireTokenWithCachedRefreshToken.bind(this),ae.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw r}return Te(this.acquireTokenWithCachedRefreshToken.bind(this),ae.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var i,s,a;(i=this.performanceClient)==null||i.addQueueMeasurement(ae.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const n=Ao(this.cacheManager.getRefreshToken.bind(this.cacheManager),ae.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!n)throw wa(as);if(n.expiresOn&&pa(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||f0))throw(s=this.performanceClient)==null||s.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),wa(ul);const r={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||Nt.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:jn.HOME_ACCOUNT_ID}};try{return await Te(this.acquireToken.bind(this),ae.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(r)}catch(l){if(l instanceof ro&&((a=this.performanceClient)==null||a.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),l.subError===Ms)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const c=di(n);this.cacheManager.removeRefreshToken(c)}throw l}}async executeTokenRequest(e,t){var l,c;(l=this.performanceClient)==null||l.addQueueMeasurement(ae.RefreshTokenClientExecuteTokenRequest,e.correlationId);const n=this.createTokenQueryParameters(e),r=It.appendQueryString(t.tokenEndpoint,n),i=await Te(this.createTokenRequestBody.bind(this),ae.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),s=this.createTokenRequestHeaders(e.ccsCredential),a={clientId:((c=e.tokenBodyParameters)==null?void 0:c.clientId)||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return Te(this.executePostToTokenEndpoint.bind(this),ae.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(r,i,s,a,e.correlationId,ae.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,i,s;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,n=new fi(t,this.performanceClient);if(n.addClientId(e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[Jo])||this.config.authOptions.clientId),e.redirectUri&&n.addRedirectUri(e.redirectUri),n.addScopes(e.scopes,!0,(s=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:s.defaultScopes),n.addGrantType(Af.REFRESH_TOKEN_GRANT),n.addClientInfo(),n.addLibraryInfo(this.config.libraryInfo),n.addApplicationTelemetry(this.config.telemetry.application),n.addThrottling(),this.serverTelemetryManager&&!ba(this.config)&&n.addServerTelemetry(this.serverTelemetryManager),n.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&n.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;n.addClientAssertion(await wh(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),n.addClientAssertionType(a.assertionType)}if(e.authenticationScheme===Nt.POP){const a=new wr(this.cryptoUtils,this.performanceClient);let l;e.popKid?l=this.cryptoUtils.encodeKid(e.popKid):l=(await Te(a.generateCnf.bind(a),ae.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,n.addPopToken(l)}else if(e.authenticationScheme===Nt.SSH)if(e.sshJwk)n.addSshJwk(e.sshJwk);else throw Ut(Ss);if((!mo.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case jn.HOME_ACCOUNT_ID:try{const a=cr(e.ccsCredential.credential);n.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case jn.UPN:n.addCcsUpn(e.ccsCredential.credential);break}return e.embeddedClientId&&n.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),n.createQueryString()}}/*! @azure/msal-common v15.2.0 2025-02-18 */class g0 extends cl{constructor(e,t){super(e,t)}async acquireCachedToken(e){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(ae.SilentFlowClientAcquireCachedToken,e.correlationId);let t=Yo.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!mo.isEmptyObj(e.claims))throw this.setCacheOutcome(Yo.FORCE_REFRESH_OR_CLAIMS,e.correlationId),Ie(Do);if(!e.account)throw Ie(ja);const n=e.account.tenantId||n0(e.authority),r=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,r,n,this.performanceClient,e.correlationId);if(i){if(z_(i.cachedAt)||pa(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Yo.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),Ie(Do);i.refreshOn&&pa(i.refreshOn,0)&&(t=Yo.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Yo.NO_CACHED_ACCESS_TOKEN,e.correlationId),Ie(Do);const s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.readAccountFromCache(e.account),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,r,n,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await Te(this.generateResultFromCacheRecord.bind(this),ae.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){var n,r;(n=this.serverTelemetryManager)==null||n.setCacheOutcome(e),(r=this.performanceClient)==null||r.addFields({cacheOutcome:e},t),e!==Yo.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let n;if(e.idToken&&(n=Rr(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const i=n==null?void 0:n.auth_time;if(!i)throw Ie(qa);Qf(i,t.maxAge)}return Zo.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const m0={sendGetRequestAsync:()=>Promise.reject(Ie(bt)),sendPostRequestAsync:()=>Promise.reject(Ie(bt))};/*! @azure/msal-common v15.2.0 2025-02-18 */const wc=",",kh="|";function p0(o){const{skus:e,libraryName:t,libraryVersion:n,extensionName:r,extensionVersion:i}=o,s=new Map([[0,[t,n]],[2,[r,i]]]);let a=[];if(e!=null&&e.length){if(a=e.split(wc),a.length<4)return e}else a=Array.from({length:4},()=>kh);return s.forEach((l,c)=>{var u,d;l.length===2&&((u=l[0])!=null&&u.length)&&((d=l[1])!=null&&d.length)&&_0({skuArr:a,index:c,skuName:l[0],skuVersion:l[1]})}),a.join(wc)}function _0(o){const{skuArr:e,index:t,skuName:n,skuVersion:r}=o;t>=e.length||(e[t]=[n,r].join(kh))}class wi{constructor(e,t){this.cacheOutcome=Yo.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||pe.EMPTY_STRING,this.wrapperVer=e.wrapperVer||pe.EMPTY_STRING,this.telemetryCacheKey=In.CACHE_KEY+Pn.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${In.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n!=null&&n.length&&t.push(`broker_error=${n}`);const r=t.join(In.VALUE_SEPARATOR),i=this.getRegionDiscoveryFields(),s=[e,i].join(In.VALUE_SEPARATOR);return[In.SCHEMA_VERSION,s,r].join(In.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=wi.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(In.VALUE_SEPARATOR),r=e.errors.slice(0,t).join(In.VALUE_SEPARATOR),i=e.errors.length,s=t<i?In.OVERFLOW_TRUE:In.OVERFLOW_FALSE,a=[i,s].join(In.VALUE_SEPARATOR);return[In.SCHEMA_VERSION,e.cacheHits,n,r,a].join(In.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=In.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof Xt?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(In.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=wi.maxErrorsToSend(e),n=e.errors.length;if(t===n)this.cacheManager.removeItem(this.telemetryCacheKey);else{const r={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r)}}static maxErrorsToSend(e){let t,n=0,r=0;const i=e.errors.length;for(t=0;t<i;t++){const s=e.failedRequests[2*t]||pe.EMPTY_STRING,a=e.failedRequests[2*t+1]||pe.EMPTY_STRING,l=e.errors[t]||pe.EMPTY_STRING;if(r+=s.toString().length+a.toString().length+l.length+3,r<In.MAX_LAST_HEADER_BYTES)n+=1;else break}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||pe.EMPTY_STRING),e.push(this.regionSource||pe.EMPTY_STRING),e.push(this.regionOutcome||pe.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return p0(e)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const Ch="missing_kid_error",Eh="missing_alg_error";/*! @azure/msal-common v15.2.0 2025-02-18 */const b0={[Ch]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Eh]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class fl extends Xt{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,fl.prototype)}}function vc(o){return new fl(o,b0[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */class hl{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw vc(Ch);if(!e.alg)throw vc(Eh);const t=new hl({typ:e.typ||C_.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class kc{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class y0{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:t0.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new kc}}startPerformanceMeasurement(){return new kc}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const gl="pkce_not_created",va="crypto_nonexistent",Ps="empty_navigate_uri",Ih="hash_empty_error",ml="no_state_in_hash",Th="hash_does_not_contain_known_properties",Sh="unable_to_parse_state",Ah="state_interaction_type_mismatch",Rh="interaction_in_progress",Mh="popup_window_error",Ph="empty_window_error",xo="user_cancelled",w0="monitor_popup_timeout",Oh="monitor_window_timeout",Nh="redirect_in_iframe",Dh="block_iframe_reload",Hh="block_nested_popups",v0="iframe_closed_prematurely",Os="silent_logout_unsupported",Uh="no_account_error",k0="silent_prompt_value_error",Lh="no_token_request_cache_error",Bh="unable_to_parse_token_request_cache_error",pl="no_cached_authority_error",C0="auth_request_not_set_error",E0="invalid_cache_type",Ns="non_browser_environment",ar="database_not_open",ls="no_network_connectivity",zh="post_request_failed",Fh="get_request_failed",ka="failed_to_parse_response",Vh="unable_to_load_token",_l="crypto_key_not_found",Kh="auth_code_required",Gh="auth_code_or_nativeAccountId_required",Wh="spa_code_and_nativeAccountId_present",bl="database_unavailable",Yh="unable_to_acquire_token_from_native_platform",qh="native_handshake_timeout",jh="native_extension_not_installed",Ri="native_connection_not_established",cs="uninitialized_public_client_application",Qh="native_prompt_not_supported",Xh="invalid_base64_string",Jh="invalid_pop_token_request",Zh="failed_to_build_headers",xh="failed_to_parse_headers";/*! @azure/msal-browser v4.5.0 2025-02-26 */const yo="For more visit: aka.ms/msaljs/browser-errors",I0={[gl]:"The PKCE code challenge and verifier could not be generated.",[va]:"The crypto object or function is not available.",[Ps]:"Navigation URI is empty. Please check stack trace for more info.",[Ih]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${yo}`,[ml]:"Hash does not contain state. Please verify that the request originated from msal.",[Th]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${yo}`,[Sh]:"Unable to parse state. Please verify that the request originated from msal.",[Ah]:"Hash contains state but the interaction type does not match the caller.",[Rh]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${yo}`,[Mh]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Ph]:"window.open returned null or undefined window object.",[xo]:"User cancelled the flow.",[w0]:`Token acquisition in popup failed due to timeout.  ${yo}`,[Oh]:`Token acquisition in iframe failed due to timeout.  ${yo}`,[Nh]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Dh]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${yo}`,[Hh]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[v0]:"The iframe being monitored was closed prematurely.",[Os]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[Uh]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[k0]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Lh]:"No token request found in cache.",[Bh]:"The cached token request could not be parsed.",[pl]:"No cached authority found.",[C0]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[E0]:"Invalid cache type",[Ns]:"Login and token requests are not supported in non-browser environments.",[ar]:"Database is not open!",[ls]:"No network connectivity. Check your internet connection.",[zh]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[Fh]:"Network request failed. Please check the network trace to determine root cause.",[ka]:"Failed to parse network response. Check network trace.",[Vh]:"Error loading token to cache.",[_l]:"Cryptographic Key or Keypair not found in browser storage.",[Kh]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Gh]:"An authorization code or nativeAccountId must be provided to this flow.",[Wh]:"Request cannot contain both spa code and native account id.",[bl]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Yh]:`Unable to acquire token from native platform.  ${yo}`,[qh]:"Timed out while attempting to establish connection to browser extension",[jh]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Ri]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${yo}`,[cs]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${yo}`,[Qh]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Xh]:"Invalid base64 encoded string.",[Jh]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Zh]:"Failed to build request headers object.",[xh]:"Failed to parse response headers"};class Mi extends Xt{constructor(e,t){super(e,I0[e],t),Object.setPrototypeOf(this,Mi.prototype),this.name="BrowserAuthError"}}function je(o,e){return new Mi(o,e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Yn={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},ur={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},Qo={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Tn={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Cc={GET:"GET",POST:"POST"},Pt={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},Oo={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},Yi={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},Yt={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var ot;(function(o){o.Redirect="redirect",o.Popup="popup",o.Silent="silent",o.None="none"})(ot||(ot={}));const Ec={scopes:Si},$h="jwk",Ca="msal.db",T0=1,S0=`${Ca}.keys`,Kn={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},A0=[Kn.Default,Kn.Skip,Kn.RefreshTokenAndNetwork],R0="msal.browser.log.level",M0="msal.browser.log.pii";/*! @azure/msal-browser v4.5.0 2025-02-26 */function qi(o){return encodeURIComponent(yl(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function $o(o){return eg(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function yl(o){return eg(new TextEncoder().encode(o))}function eg(o){const e=Array.from(o,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Io(o){return new TextDecoder().decode(us(o))}function us(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw je(Xh)}const t=atob(e);return Uint8Array.from(t,n=>n.codePointAt(0)||0)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const P0="RSASSA-PKCS1-v1_5",Ds="AES-GCM",tg="HKDF",wl="SHA-256",O0=2048,N0=new Uint8Array([1,0,1]),Ic="0123456789abcdef",Tc=new Uint32Array(1),ng="raw",og="encrypt",rg="decrypt",D0="deriveKey",H0="crypto_subtle_undefined",vl={name:P0,hash:wl,modulusLength:O0,publicExponent:N0};function U0(o){if(!window)throw je(Ns);if(!window.crypto)throw je(va);if(!o&&!window.crypto.subtle)throw je(va,H0)}async function ig(o,e,t){e==null||e.addQueueMeasurement(ae.Sha256Digest,t);const r=new TextEncoder().encode(o);return window.crypto.subtle.digest(wl,r)}function L0(o){return window.crypto.getRandomValues(o)}function ta(){return window.crypto.getRandomValues(Tc),Tc[0]}function io(){const o=Date.now(),e=ta()*1024+(ta()&1023),t=new Uint8Array(16),n=Math.trunc(e/2**30),r=e&2**30-1,i=ta();t[0]=o/2**40,t[1]=o/2**32,t[2]=o/2**24,t[3]=o/2**16,t[4]=o/2**8,t[5]=o,t[6]=112|n>>>8,t[7]=n,t[8]=128|r>>>24,t[9]=r>>>16,t[10]=r>>>8,t[11]=r,t[12]=i>>>24,t[13]=i>>>16,t[14]=i>>>8,t[15]=i;let s="";for(let a=0;a<t.length;a++)s+=Ic.charAt(t[a]>>>4),s+=Ic.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(s+="-");return s}async function B0(o,e){return window.crypto.subtle.generateKey(vl,o,e)}async function na(o){return window.crypto.subtle.exportKey($h,o)}async function z0(o,e,t){return window.crypto.subtle.importKey($h,o,vl,e,t)}async function F0(o,e){return window.crypto.subtle.sign(vl,o,e)}async function V0(){const o=await window.crypto.subtle.generateKey({name:Ds,length:256},!0,[og,rg]);return window.crypto.subtle.exportKey(ng,o)}async function Sc(o){return window.crypto.subtle.importKey(ng,o,tg,!1,[D0])}async function sg(o,e,t){return window.crypto.subtle.deriveKey({name:tg,salt:e,hash:wl,info:new TextEncoder().encode(t)},o,{name:Ds,length:256},!1,[og,rg])}async function K0(o,e,t){const n=new TextEncoder().encode(e),r=window.crypto.getRandomValues(new Uint8Array(16)),i=await sg(o,r,t),s=await window.crypto.subtle.encrypt({name:Ds,iv:new Uint8Array(12)},i,n);return{data:$o(new Uint8Array(s)),nonce:$o(r)}}async function G0(o,e,t,n){const r=us(n),i=await sg(o,us(e),t),s=await window.crypto.subtle.decrypt({name:Ds,iv:new Uint8Array(12)},i,r);return new TextDecoder().decode(s)}async function ag(o){const e=await ig(o),t=new Uint8Array(e);return $o(t)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const vi="storage_not_supported",Ea="stubbed_public_client_application_called",ds="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.5.0 2025-02-26 */const Zi={[vi]:"Given storage configuration option was not supported.",[Ea]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[ds]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};Zi[vi],Zi[Ea],Zi[ds];class kl extends Xt{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,kl.prototype)}}function Cl(o){return new kl(o,Zi[o])}/*! @azure/msal-browser v4.5.0 2025-02-26 */function W0(o){o.location.hash="",typeof o.history.replaceState=="function"&&o.history.replaceState(null,"",`${o.location.origin}${o.location.pathname}${o.location.search}`)}function Y0(o){const e=o.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function El(){return window.parent!==window}function q0(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${Yn.POPUP_NAME_PREFIX}.`)===0}function ko(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function j0(){const e=new It(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function Q0(){if(It.hashContainsKnownProperties(window.location.hash)&&El())throw je(Dh)}function X0(o){if(El()&&!o)throw je(Nh)}function J0(){if(q0())throw je(Hh)}function lg(){if(typeof window>"u")throw je(Ns)}function cg(o){if(!o)throw je(cs)}function Il(o){lg(),Q0(),J0(),cg(o)}function Ac(o,e){if(Il(o),X0(e.system.allowRedirectInIframe),e.cache.cacheLocation===Tn.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw Cl(ds)}function ug(o){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(o).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function Z0(){return io()}/*! @azure/msal-browser v4.5.0 2025-02-26 */class fs{navigateInternal(e,t){return fs.defaultNavigateWindow(e,t)}navigateExternal(e,t){return fs.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(n=>{setTimeout(()=>{n(!0)},t.timeout)})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class x0{async sendGetRequestAsync(e,t){let n,r={},i=0;const s=Rc(t);try{n=await fetch(e,{method:Cc.GET,headers:s})}catch{throw je(window.navigator.onLine?Fh:ls)}r=Mc(n.headers);try{return i=n.status,{headers:r,body:await n.json(),status:i}}catch{throw _c(je(ka),i,r)}}async sendPostRequestAsync(e,t){const n=t&&t.body||"",r=Rc(t);let i,s=0,a={};try{i=await fetch(e,{method:Cc.POST,headers:r,body:n})}catch{throw je(window.navigator.onLine?zh:ls)}a=Mc(i.headers);try{return s=i.status,{headers:a,body:await i.json(),status:s}}catch{throw _c(je(ka),s,a)}}}function Rc(o){try{const e=new Headers;if(!(o&&o.headers))return e;const t=o.headers;return Object.entries(t).forEach(([n,r])=>{e.append(n,r)}),e}catch{throw je(Zh)}}function Mc(o){try{const e={};return o.forEach((t,n)=>{e[n]=t}),e}catch{throw je(xh)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const $0=6e4,Ia=1e4,eb=3e4,tb=2e3;function nb({auth:o,cache:e,system:t,telemetry:n},r){const i={clientId:pe.EMPTY_STRING,authority:`${pe.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:pe.EMPTY_STRING,authorityMetadata:pe.EMPTY_STRING,redirectUri:typeof window<"u"?ko():"",postLogoutRedirectUri:pe.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Eo.AAD,OIDCOptions:{serverResponseType:Ai.FRAGMENT,defaultScopes:[pe.OPENID_SCOPE,pe.PROFILE_SCOPE,pe.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:xa.None,tenant:pe.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},s={cacheLocation:Tn.SessionStorage,temporaryCacheLocation:Tn.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===Tn.LocalStorage),claimsBasedCachingEnabled:!1},a={loggerCallback:()=>{},logLevel:Qt.Info,piiLoggingEnabled:!1},c={...{...mh,loggerOptions:a,networkClient:r?new x0:m0,navigationClient:new fs,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||$0,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||Ia,navigateFrameWait:0,redirectNavigationTimeout:eb,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||tb,pollIntervalMilliseconds:Yn.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||a},u={application:{appName:pe.EMPTY_STRING,appVersion:pe.EMPTY_STRING},client:new y0};if((o==null?void 0:o.protocolMode)!==Eo.OIDC&&(o!=null&&o.OIDCOptions)&&new Uo(c.loggerOptions).warning(JSON.stringify(Ut(ah))),o!=null&&o.protocolMode&&o.protocolMode!==Eo.AAD&&(c!=null&&c.allowPlatformBroker))throw Ut(lh);return{auth:{...i,...o,OIDCOptions:{...i.OIDCOptions,...o==null?void 0:o.OIDCOptions}},cache:{...s,...e},system:c,telemetry:{...u,...n}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const ob="@azure/msal-browser",Hs="4.5.0";/*! @azure/msal-browser v4.5.0 2025-02-26 */class Tl{static loggerCallback(e,t){switch(e){case Qt.Error:console.error(t);return;case Qt.Info:console.info(t);return;case Qt.Verbose:return;case Qt.Warning:console.warn(t);return;default:return}}constructor(e){var l;this.browserEnvironment=typeof window<"u",this.config=nb(e,this.browserEnvironment);let t;try{t=window[Tn.SessionStorage]}catch{}const n=t==null?void 0:t.getItem(R0),r=(l=t==null?void 0:t.getItem(M0))==null?void 0:l.toLowerCase(),i=r==="true"?!0:r==="false"?!1:void 0,s={...this.config.system.loggerOptions},a=n&&Object.keys(Qt).includes(n)?Qt[n]:void 0;a&&(s.loggerCallback=Tl.loggerCallback,s.logLevel=a),i!==void 0&&(s.piiLoggingEnabled=i),this.logger=new Uo(s,ob,Hs),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class er extends Tl{getModuleName(){return er.MODULE_NAME}getId(){return er.ID}async initialize(){return this.available=typeof window<"u",this.available}}er.MODULE_NAME="";er.ID="StandardOperatingContext";/*! @azure/msal-browser v4.5.0 2025-02-26 */class rb{constructor(){this.dbName=Ca,this.version=T0,this.tableName=S0,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",r=>{r.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",r=>{const i=r;this.db=i.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t(je(bl)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(je(ar));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);s.addEventListener("success",a=>{const l=a;this.closeConnection(),t(l.target.result)}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,r)=>{if(!this.db)return r(je(ar));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),n()}),a.addEventListener("error",l=>{this.closeConnection(),r(l)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(je(ar));const s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);s.addEventListener("success",()=>{this.closeConnection(),t()}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(je(ar));const i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();i.addEventListener("success",s=>{const a=s;this.closeConnection(),e(a.target.result)}),i.addEventListener("error",s=>{this.closeConnection(),t(s)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(je(ar));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);s.addEventListener("success",a=>{const l=a;this.closeConnection(),t(l.target.result===1)}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(Ca),r=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(r),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(r),e(!0))),n.addEventListener("error",()=>(clearTimeout(r),t(!1)))})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Us{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class ib{constructor(e){this.inMemoryCache=new Us,this.indexedDBCache=new rb,this.logger=e}handleDatabaseAccessError(e){if(e instanceof Mi&&e.errorCode===bl)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(n){this.handleDatabaseAccessError(n)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(n){this.handleDatabaseAccessError(n)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(n){this.handleDatabaseAccessError(n)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class vr{constructor(e,t,n){this.logger=e,U0(n??!1),this.cache=new ib(this.logger),this.performanceClient=t}createNewGuid(){return io()}base64Encode(e){return yl(e)}base64Decode(e){return Io(e)}base64UrlEncode(e){return qi(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var u;const t=(u=this.performanceClient)==null?void 0:u.startMeasurement(ae.CryptoOptsGetPublicKeyThumbprint,e.correlationId),n=await B0(vr.EXTRACTABLE,vr.POP_KEY_USAGES),r=await na(n.publicKey),i={e:r.e,kty:r.kty,n:r.n},s=Pc(i),a=await this.hashString(s),l=await na(n.privateKey),c=await z0(l,!1,["sign"]);return await this.cache.setItem(a,{privateKey:c,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),a}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,n,r){var y;const i=(y=this.performanceClient)==null?void 0:y.startMeasurement(ae.CryptoOptsSignJwt,r),s=await this.cache.getItem(t);if(!s)throw je(_l);const a=await na(s.publicKey),l=Pc(a),c=qi(JSON.stringify({kid:t})),u=hl.getShrHeaderString({...n==null?void 0:n.header,alg:a.alg,kid:c}),d=qi(u);e.cnf={jwk:JSON.parse(l)};const f=qi(JSON.stringify(e)),h=`${d}.${f}`,b=new TextEncoder().encode(h),w=await F0(s.privateKey,b),m=$o(new Uint8Array(w)),v=`${h}.${m}`;return i&&i.end({success:!0}),v}async hashString(e){return ag(e)}}vr.POP_KEY_USAGES=["sign","verify"];vr.EXTRACTABLE=!0;function Pc(o){return JSON.stringify(o,Object.keys(o).sort())}/*! @azure/msal-browser v4.5.0 2025-02-26 */const sb=24*60*60*1e3,Ta={Lax:"Lax",None:"None"};class dg{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){const i=n[r],[s,...a]=decodeURIComponent(i).trim().split("="),l=a.join("=");if(s===t)return l}return""}getUserData(){throw Ie(bt)}setItem(e,t,n,r=!0,i=Ta.Lax){let s=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${i};`;if(n){const a=ab(n);s+=`expires=${a};`}(r||i===Ta.None)&&(s+="Secure;"),document.cookie=s}async setUserData(){return Promise.reject(Ie(bt))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(n=>{const r=decodeURIComponent(n).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}}function ab(o){const e=new Date;return new Date(e.getTime()+o*sb).toUTCString()}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Sa(o){const e=o.getItem(Oo.ACCOUNT_KEYS);return e?JSON.parse(e):[]}function Aa(o,e){const t=e.getItem(`${Oo.TOKEN_KEYS}.${o}`);if(t){const n=JSON.parse(t);if(n&&n.hasOwnProperty("idToken")&&n.hasOwnProperty("accessToken")&&n.hasOwnProperty("refreshToken"))return n}return{idToken:[],accessToken:[],refreshToken:[]}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Oc="msal.cache.encryption",lb="msal.broadcast.cache";class cb{constructor(e,t,n){if(!window.localStorage)throw Cl(vi);this.memoryStorage=new Us,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=n,this.broadcast=new BroadcastChannel(lb)}async initialize(e){this.initialized=!0;const t=new dg,n=t.getItem(Oc);let r={key:"",id:""};if(n)try{r=JSON.parse(n)}catch{}if(r.key&&r.id){const i=Ao(us,ae.Base64Decode,this.logger,this.performanceClient,e)(r.key);this.encryptionCookie={id:r.id,key:await Te(Sc,ae.GenerateHKDF,this.logger,this.performanceClient,e)(i)},await Te(this.importExistingCache.bind(this),ae.ImportExistingCache,this.logger,this.performanceClient,e)(e)}else{this.clear();const i=io(),s=await Te(V0,ae.GenerateBaseKey,this.logger,this.performanceClient,e)(),a=Ao($o,ae.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(s));this.encryptionCookie={id:i,key:await Te(Sc,ae.GenerateHKDF,this.logger,this.performanceClient,e)(s)};const l={id:i,key:a};t.setItem(Oc,JSON.stringify(l),0,!0,Ta.None)}this.broadcast.addEventListener("message",this.updateCache.bind(this))}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw je(cs);return this.memoryStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,n){if(!this.initialized||!this.encryptionCookie)throw je(cs);const{data:r,nonce:i}=await Te(K0,ae.Encrypt,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t,this.getContext(e)),s={id:this.encryptionCookie.id,nonce:i,data:r};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(s)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Sa(this).forEach(n=>this.removeItem(n));const t=Aa(this.clientId,this);t.idToken.forEach(n=>this.removeItem(n)),t.accessToken.forEach(n=>this.removeItem(n)),t.refreshToken.forEach(n=>this.removeItem(n)),this.getKeys().forEach(n=>{(n.startsWith(pe.CACHE_PREFIX)||n.indexOf(this.clientId)!==-1)&&this.removeItem(n)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Sa(this);t=await this.importArray(t,e),this.setItem(Oo.ACCOUNT_KEYS,JSON.stringify(t));const n=Aa(this.clientId,this);n.idToken=await this.importArray(n.idToken,e),n.accessToken=await this.importArray(n.accessToken,e),n.refreshToken=await this.importArray(n.refreshToken,e),this.setItem(`${Oo.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const n=this.getItem(e);if(!n)return null;let r;try{r=JSON.parse(n)}catch{return null}return!r.id||!r.nonce||!r.data?(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),null):r.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):Te(G0,ae.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,r.nonce,this.getContext(e),r.data)}async importArray(e,t){const n=[],r=[];return e.forEach(i=>{const s=this.getItemFromEncryptedCache(i,t).then(a=>{a?(this.memoryStorage.setItem(i,a),n.push(i)):this.removeItem(i)});r.push(s)}),await Promise.all(r),n}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(ae.LocalStorageUpdated);t.add({isBackground:!0});const{key:n,value:r,context:i}=e.data;if(!n){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(i&&i!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${i}`),t.end({success:!1,errorCode:"contextMismatch"});return}r?(this.memoryStorage.setItem(n,r),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(n),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class ub{constructor(){if(!window.sessionStorage)throw Cl(vi)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function fg(o,e){if(!e)return null;try{return no.parseRequestState(o,e).libraryState.meta}catch{throw Ie(yr)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const st={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ra extends _a{constructor(e,t,n,r,i,s,a){super(e,n,r,a),this.cacheConfig=t,this.logger=r,this.internalStorage=new Us,this.browserStorage=Nc(e,t.cacheLocation,r,i),this.temporaryCacheStorage=Nc(e,t.temporaryCacheLocation,r,i),this.cookieStorage=new dg,this.performanceClient=i,this.eventHandler=s}async initialize(e){await this.browserStorage.initialize(e)}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getAccount(e){this.logger.trace("BrowserCacheManager.getAccount called");const t=this.browserStorage.getUserData(e);if(!t)return this.removeAccountKeyFromMap(e),null;const n=this.validateAndParseJson(t);return!n||!Dn.isAccountEntity(n)?(this.removeAccountKeyFromMap(e),null):_a.toObject(new Dn,n)}async setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const n=e.generateAccountKey();await Te(this.browserStorage.setUserData.bind(this.browserStorage),ae.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t);const r=this.addAccountKeyToMap(n);this.cacheConfig.cacheLocation===Tn.LocalStorage&&r&&this.eventHandler.emitEvent(st.ACCOUNT_ADDED,void 0,e.getAccountInfo())}getAccountKeys(){return Sa(this.browserStorage)}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();return t.indexOf(e)===-1?(t.push(e),this.browserStorage.setItem(Oo.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),n=t.indexOf(e);n>-1?(t.splice(n,1),this.browserStorage.setItem(Oo.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}async removeAccountContext(e){await super.removeAccountContext(e),this.cacheConfig.cacheLocation===Tn.LocalStorage&&this.eventHandler.emitEvent(st.ACCOUNT_REMOVED,void 0,e.getAccountInfo())}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,gt.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,gt.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,gt.REFRESH_TOKEN)}getTokenKeys(){return Aa(this.clientId,this.browserStorage)}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const n=this.getTokenKeys();switch(t){case gt.ID_TOKEN:n.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),n.idToken.push(e));break;case gt.ACCESS_TOKEN:n.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),n.accessToken.push(e));break;case gt.REFRESH_TOKEN:n.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),n.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),Ie(ma)}this.browserStorage.setItem(`${Oo.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const n=this.getTokenKeys();switch(t){case gt.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const r=n.idToken.indexOf(e);r>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),n.idToken.splice(r,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case gt.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const i=n.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),n.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case gt.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const s=n.refreshToken.indexOf(e);s>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),n.refreshToken.splice(s,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),Ie(ma)}this.browserStorage.setItem(`${Oo.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}getIdTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,gt.ID_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!V_(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,gt.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),n)}async setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const n=di(e);await Te(this.browserStorage.setUserData.bind(this.browserStorage),ae.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,gt.ID_TOKEN)}getAccessTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,gt.ACCESS_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!F_(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,gt.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),n)}async setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const n=di(e);await Te(this.browserStorage.setUserData.bind(this.browserStorage),ae.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,gt.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,gt.REFRESH_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!K_(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,gt.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),n)}async setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const n=di(e);await Te(this.browserStorage.setUserData.bind(this.browserStorage),ae.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,gt.REFRESH_TOKEN)}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!Z_(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=J_(e);this.browserStorage.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!Q_(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.browserStorage.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&x_(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Yi.WRAPPER_SKU,e),this.internalStorage.setItem(Yi.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(Yi.WRAPPER_SKU)||pe.EMPTY_STRING,t=this.internalStorage.getItem(Yi.WRAPPER_VER)||pe.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(nc.ACTIVE_ACCOUNT_FILTERS),t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const n=this.validateAndParseJson(t);return n?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(nc.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");const n={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(n))}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t);this.eventHandler.emitEvent(st.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!X_(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.browserStorage.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const i=this.cookieStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),i}const r=this.temporaryCacheStorage.getItem(n);if(!r){if(this.cacheConfig.cacheLocation===Tn.LocalStorage){const i=this.browserStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),i}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),r}setTemporaryCache(e,t,n){const r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(r,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(pe.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(pe.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(ae.ClearTokensAndKeysWithClaims,t);const n=this.getTokenKeys(),r=[];n.accessToken.forEach(i=>{const s=this.getAccessTokenCredential(i);s!=null&&s.requestedClaimsHash&&i.includes(s.requestedClaimsHash.toLowerCase())&&r.push(this.removeAccessToken(i))}),await Promise.all(r),r.length>0&&this.logger.warning(`${r.length} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):mo.startsWith(e,pe.CACHE_PREFIX)?e:`${pe.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=no.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Pt.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=no.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Pt.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=no.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Pt.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;const r=this.generateAuthorityKey(n);return this.getTemporaryCache(r)}updateCacheEntries(e,t,n,r,i){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const s=this.generateStateKey(e);this.setTemporaryCache(s,e,!1);const a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);const l=this.generateAuthorityKey(e);if(this.setTemporaryCache(l,n,!1),i){const c={credential:i.homeAccountId,type:jn.HOME_ACCOUNT_ID};this.setTemporaryCache(Pt.CCS_CREDENTIAL,JSON.stringify(c),!0)}else if(r){const c={credential:r,type:jn.UPN};this.setTemporaryCache(Pt.CCS_CREDENTIAL,JSON.stringify(c),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(Pt.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(Pt.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(Pt.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(Pt.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(Pt.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(Pt.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n||pe.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(t.indexOf(Pt.REQUEST_STATE)===-1)return;const n=this.temporaryCacheStorage.getItem(t);if(!n)return;const r=fg(this.cryptoImpl,n);r&&r.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n))}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=yl(JSON.stringify(e));this.setTemporaryCache(Pt.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(Pt.REQUEST_PARAMS,!0);if(!t)throw je(Lh);let n;try{n=JSON.parse(Io(t))}catch(r){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${r}`),je(Bh)}if(this.removeTemporaryItem(this.generateCacheKey(Pt.REQUEST_PARAMS)),!n.authority){const r=this.generateAuthorityKey(e),i=this.getTemporaryCache(r);if(!i)throw je(pl);n.authority=i}return n}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(Pt.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${pe.CACHE_PREFIX}.${Pt.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${pe.CACHE_PREFIX}.${Pt.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw je(Rh);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}async hydrateCache(e,t){var a,l,c;const n=Is((a=e.account)==null?void 0:a.homeAccountId,(l=e.account)==null?void 0:l.environment,e.idToken,this.clientId,e.tenantId);let r;t.claims&&(r=await this.cryptoImpl.hashString(t.claims));const i=Ts((c=e.account)==null?void 0:c.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Io,void 0,e.tokenType,void 0,t.sshKid,t.claims,r),s={idToken:n,accessToken:i};return this.saveCacheRecord(s,e.correlationId)}async saveCacheRecord(e,t,n){try{await super.saveCacheRecord(e,t,n)}catch(r){if(r instanceof gr&&this.performanceClient&&t)try{const i=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:i.refreshToken.length,cacheIdCount:i.idToken.length,cacheAtCount:i.accessToken.length},t)}catch{}throw r}}}function Nc(o,e,t,n){try{switch(e){case Tn.LocalStorage:return new cb(o,t,n);case Tn.SessionStorage:return new ub;case Tn.MemoryStorage:default:break}}catch(r){t.error(r)}return new Us}const db=(o,e,t,n)=>{const r={cacheLocation:Tn.MemoryStorage,temporaryCacheLocation:Tn.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Ra(o,r,os,e,t,n)};/*! @azure/msal-browser v4.5.0 2025-02-26 */function fb(o,e,t,n){return o.verbose("getAllAccounts called"),t?e.getAllAccounts(n):[]}function hb(o,e,t){if(e.trace("getAccount called"),Object.keys(o).length===0)return e.warning("getAccount: No accountFilter provided"),null;const n=t.getAccountInfoFilteredBy(o);return n?(e.verbose("getAccount: Account matching provided filter found, returning"),n):(e.verbose("getAccount: No matching account found, returning null"),null)}function gb(o,e,t){if(e.trace("getAccountByUsername called"),!o)return e.warning("getAccountByUsername: No username provided"),null;const n=t.getAccountInfoFilteredBy({username:o});return n?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${o}`),n):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function mb(o,e,t){if(e.trace("getAccountByHomeId called"),!o)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const n=t.getAccountInfoFilteredBy({homeAccountId:o});return n?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${o}`),n):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function pb(o,e,t){if(e.trace("getAccountByLocalId called"),!o)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const n=t.getAccountInfoFilteredBy({localAccountId:o});return n?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${o}`),n):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function _b(o,e){e.setActiveAccount(o)}function bb(o){return o.getActiveAccount()}/*! @azure/msal-browser v4.5.0 2025-02-26 */const yb="msal.broadcast.event";class wb{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Uo({}),this.broadcastChannel=new BroadcastChannel(yb),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,n){if(typeof window<"u"){const r=n||Z0();return this.eventCallbacks.has(r)?(this.logger.error(`Event callback with id: ${r} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(r,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${r}`),r)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,n,r){const i={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};switch(e){case st.ACCOUNT_ADDED:case st.ACCOUNT_REMOVED:case st.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel.postMessage(i);break;default:this.invokeCallbacks(i);break}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,n],r)=>{(n.length===0||n.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${r}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel.removeEventListener("message",this.invokeCrossTabCallbacks)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class hg{constructor(e,t,n,r,i,s,a,l,c){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=s,this.nativeMessageHandler=l,this.correlationId=c||io(),this.logger=r.clone(Yn.MSAL_SKU,Hs,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e){if(e){Dn.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(Dn.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return It.getAbsoluteUrl(t,ko())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new wi(n,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,n=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const r={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e.requestAuthority||this.config.auth.authority,s=n!=null&&n.length?n==="true":this.config.auth.instanceAware,a=t&&s?this.config.auth.authority.replace(It.getDomainFromUrl(i),t.environment):i,l=Mn.generateAuthority(a,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),c=await Te(bh,ae.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(l,this.config.system.networkClient,this.browserStorage,r,this.logger,this.correlationId,this.performanceClient);if(t&&!c.isAlias(t.environment))throw Ut(ch);return c}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const vb=32;async function gg(o,e,t){o.addQueueMeasurement(ae.GeneratePkceCodes,t);const n=Ao(kb,ae.GenerateCodeVerifier,e,o,t)(o,e,t),r=await Te(Cb,ae.GenerateCodeChallengeFromVerifier,e,o,t)(n,o,e,t);return{verifier:n,challenge:r}}function kb(o,e,t){try{const n=new Uint8Array(vb);return Ao(L0,ae.GetRandomValues,e,o,t)(n),$o(n)}catch{throw je(gl)}}async function Cb(o,e,t,n){e.addQueueMeasurement(ae.GenerateCodeChallengeFromVerifier,n);try{const r=await Te(ig,ae.Sha256Digest,t,e,n)(o,e,n);return $o(new Uint8Array(r))}catch{throw je(gl)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function Sl(o,e,t,n){t.addQueueMeasurement(ae.InitializeBaseRequest,o.correlationId);const r=o.authority||e.auth.authority,i=[...o&&o.scopes||[]],s={...o,correlationId:o.correlationId,authority:r,scopes:i};if(!s.authenticationScheme)s.authenticationScheme=Nt.BEARER,n.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(s.authenticationScheme===Nt.SSH){if(!o.sshJwk)throw Ut(Ss);if(!o.sshKid)throw Ut(sh)}n.verbose(`Authentication Scheme set to "${s.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&o.claims&&!mo.isEmptyObj(o.claims)&&(s.requestedClaimsHash=await ag(o.claims)),s}async function Eb(o,e,t,n,r){n.addQueueMeasurement(ae.InitializeSilentRequest,o.correlationId);const i=await Te(Sl,ae.InitializeBaseRequest,r,n,o.correlationId)(o,t,n,r);return{...o,...i,account:e,forceRefresh:o.forceRefresh||!1}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Mr extends hg{async initializeAuthorizationCodeRequest(e,t){this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const n=t||await Te(gg,ae.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),r={...e,redirectUri:e.redirectUri,code:pe.EMPTY_STRING,codeVerifier:n.verifier};return e.codeChallenge=n.challenge,e.codeChallengeMethod=pe.S256_CODE_CHALLENGE_METHOD,r}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||io(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=It.getAbsoluteUrl(e.postLogoutRedirectUri,ko())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=It.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,ko())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=It.getAbsoluteUrl(ko(),ko())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await Te(this.getClientConfiguration.bind(this),ae.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new vh(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:i,account:s}=e;this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientGetClientConfiguration,this.correlationId);const a=await Te(this.getDiscoveredAuthority.bind(this),ae.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:i,account:s}),l=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:Yn.MSAL_SKU,version:Hs,cpu:pe.EMPTY_STRING,os:pe.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const n=this.getRedirectUri(e.redirectUri),r={interactionType:t},i=no.setRequestState(this.browserCrypto,e&&e.state||pe.EMPTY_STRING,r),a={...await Te(Sl,ae.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:n,state:i,nonce:e.nonce||io(),responseMode:this.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return a;const l=e.account||this.browserStorage.getActiveAccount();return l&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${l.homeAccountId}`,this.correlationId),a.account=l),a}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Ib="ContentError",mg="user_switch";/*! @azure/msal-browser v4.5.0 2025-02-26 */const Tb="USER_INTERACTION_REQUIRED",Sb="USER_CANCEL",Ab="NO_NETWORK",Rb="PERSISTENT_ERROR",Mb="DISABLED",Pb="ACCOUNT_UNAVAILABLE";/*! @azure/msal-browser v4.5.0 2025-02-26 */const Ob=-2147186943,Nb={[mg]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class fo extends Xt{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,fo.prototype),this.name="NativeAuthError",this.ext=n}}function lr(o){if(o.ext&&o.ext.status&&(o.ext.status===Rb||o.ext.status===Mb)||o.ext&&o.ext.error&&o.ext.error===Ob)return!0;switch(o.errorCode){case Ib:return!0;default:return!1}}function Ma(o,e,t){if(t&&t.status)switch(t.status){case Pb:return wa(yh);case Tb:return new ro(o,e);case Sb:return je(xo);case Ab:return je(ls)}return new fo(o,Nb[o]||e,t)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class pg extends Mr{async acquireToken(e){this.performanceClient.addQueueMeasurement(ae.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(Yt.acquireTokenSilent_silentFlow),n=await Te(this.getClientConfiguration.bind(this),ae.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),r=new g0(n,this.performanceClient);this.logger.verbose("Silent auth client created");try{const s=(await Te(r.acquireCachedToken.bind(r),ae.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(i){throw i instanceof Mi&&i.errorCode===_l&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),i}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t==null?void 0:t.account)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class mr extends hg{constructor(e,t,n,r,i,s,a,l,c,u,d,f){var p;super(e,t,n,r,i,s,l,c,f),this.apiId=a,this.accountId=u,this.nativeMessageHandler=c,this.nativeStorageManager=d,this.silentCacheClient=new pg(e,this.nativeStorageManager,n,r,i,s,l,c,f);const h=this.nativeMessageHandler.getExtensionId()===ur.PREFERRED_EXTENSION_ID?"chrome":(p=this.nativeMessageHandler.getExtensionId())!=null&&p.length?"unknown":void 0;this.skus=wi.makeExtraSkuString({libraryName:Yn.MSAL_SKU,libraryVersion:Hs,extensionName:h,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[J1]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(ae.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(ae.NativeInteractionClientAcquireToken,e.correlationId),n=_o(),r=this.initializeServerTelemetryManager(this.apiId);try{const i=await this.initializeNativeRequest(e);try{const u=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),u}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...s}=i,a={method:Qo.GetToken,request:s},l=await this.nativeMessageHandler.sendMessage(a),c=this.validateNativeResponse(l);return await this.handleNativeResponse(c,i,n).then(u=>(t.end({success:!0,isNativeBroker:!0,requestId:u.requestId}),r.clearNativeBrokerErrorCode(),u)).catch(u=>{throw t.end({success:!1,errorCode:u.errorCode,subErrorCode:u.subError,isNativeBroker:!0}),u})}catch(i){throw i instanceof fo&&r.setNativeBrokerErrorCode(i.errorCode),i}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:on.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),Ie(ha);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!n)throw Ie(ha);try{const r=this.createSilentCacheRequest(t,n),i=await this.silentCacheClient.acquireToken(r),s={...n,idTokenClaims:i==null?void 0:i.idTokenClaims,idToken:i==null?void 0:i.idToken};return{...i,account:s}}catch(r){throw r}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...n}=e;delete n.onRedirectNavigate;const r=await this.initializeNativeRequest(n),i={method:Qo.GetToken,request:r};try{const l=await this.nativeMessageHandler.sendMessage(i);this.validateNativeResponse(l)}catch(l){if(l instanceof fo&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(l.errorCode),lr(l)))throw l}this.browserStorage.setTemporaryCache(Pt.NATIVE_REQUEST,JSON.stringify(r),!0);const s={apiId:Yt.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,s)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const n=this.browserStorage.getCachedNativeRequest();if(!n)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:r,...i}=n;r&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Pt.NATIVE_REQUEST));const s={method:Qo.GetToken,request:i},a=_o();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const l=await this.nativeMessageHandler.sendMessage(s);this.validateNativeResponse(l);const c=this.handleNativeResponse(l,i,a);this.browserStorage.setInteractionInProgress(!1);const u=await c;return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),u}catch(l){throw this.browserStorage.setInteractionInProgress(!1),l}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){var u;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const r=Rr(e.id_token,Io),i=this.createHomeAccountIdentifier(e,r),s=(u=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId}))==null?void 0:u.homeAccountId;if(i!==s&&e.account.id!==t.accountId)throw Ma(mg);const a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),l=dl(this.browserStorage,a,i,Io,r,e.client_info,void 0,r.tid,void 0,e.account.id,this.logger),c=await this.generateAuthenticationResult(e,t,r,l,a.canonicalAuthority,n);return await this.cacheAccount(l),await this.cacheNativeTokens(e,t,i,r,e.access_token,c.tenantId,n),c}createHomeAccountIdentifier(e,t){return Dn.generateHomeAccountId(e.client_info||pe.EMPTY_STRING,$n.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?on.fromString(e.scope):on.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===Nt.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const n=new wr(this.browserCrypto),r={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw Ie(Xa);return n.signPopToken(e.access_token,t.keyId,r)}else return e.access_token}async generateAuthenticationResult(e,t,n,r,i,s){const a=this.addTelemetryFromNativeResponse(e),l=e.scope?on.fromString(e.scope):on.fromString(t.scope),c=e.account.properties||{},u=c.UID||n.oid||n.sub||pe.EMPTY_STRING,d=c.TenantId||n.tid||pe.EMPTY_STRING,f=il(r.getAccountInfo(),void 0,n,e.id_token);f.nativeAccountId!==e.account.id&&(f.nativeAccountId=e.account.id);const h=await this.generatePopAccessToken(e,t),p=t.tokenType===Nt.POP?Nt.POP:Nt.BEARER;return{authority:i,uniqueId:u,tenantId:d,scopes:l.asArray(),account:f,idToken:e.id_token,idTokenClaims:n,accessToken:h,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:new Date(Number(s+e.expires_in)*1e3),tokenType:p,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e){await this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,n,r,i,s,a){const l=Is(n,t.authority,e.id_token||"",t.clientId,r.tid||""),c=t.tokenType===Nt.POP?pe.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,u=a+c,d=this.generateScopes(e,t),f=Ts(n,t.authority,i,t.clientId,r.tid||s,d.printScopes(),u,0,Io,void 0,t.tokenType,void 0,t.keyId),h={idToken:l,accessToken:f};return this.nativeStorageManager.saveCacheRecord(h,this.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw Rf(Ga,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const n=new It(t);n.validateAsUri();const{scopes:r,...i}=e,s=new on(r||[]);s.appendScopes(Si);const a=()=>{switch(this.apiId){case Yt.ssoSilent:case Yt.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),mn.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case mn.NONE:case mn.CONSENT:case mn.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),je(Qh)}},l={...i,accountId:this.accountId,clientId:this.config.auth.clientId,authority:n.urlString,scope:s.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:a(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(l.signPopToken&&e.popKid)throw je(Jh);if(this.handleExtraBrokerParams(l),l.extraParameters=l.extraParameters||{},l.extraParameters.telemetry=ur.MATS_TELEMETRY,e.authenticationScheme===Nt.POP){const c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},u=new wr(this.browserCrypto);let d;if(l.keyId)d=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:l.keyId})),l.signPopToken=!1;else{const f=await Te(u.generateCnf.bind(u),ae.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(c,this.logger);d=f.reqCnfString,l.keyId=f.kid,l.signPopToken=!0}l.reqCnf=d}return this.addRequestSKUs(l),l}handleExtraBrokerParams(e){var i;const t=e.extraParameters&&e.extraParameters.hasOwnProperty(ll)&&e.extraParameters.hasOwnProperty(ya)&&e.extraParameters.hasOwnProperty(Jo);if(!e.embeddedClientId&&!t)return;let n="";const r=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,n=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[ya],n=e.extraParameters[Jo]),e.extraParameters={child_client_id:n,child_redirect_uri:r},(i=this.performanceClient)==null||i.addFields({embeddedClientId:n,embeddedRedirectUri:r},e.correlationId)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class ho{constructor(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(ae.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:ur.CHANNEL_ID,extensionId:this.extensionId,responseId:io(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((n,r)=>{this.resolvers.set(t.responseId,{resolve:n,reject:r})})}static async createProvider(e,t,n){e.trace("NativeMessageHandler - createProvider called.");try{const r=new ho(e,t,n,ur.PREFERRED_EXTENSION_ID);return await r.sendHandshakeRequest(),r}catch{const i=new ho(e,t,n);return await i.sendHandshakeRequest(),i}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:ur.CHANNEL_ID,extensionId:this.extensionId,responseId:io(),body:{method:Qo.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,n)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:n}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(je(qh)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==ur.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===Qo.HandshakeRequest){const n=this.handshakeResolvers.get(t.responseId);if(!n){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),n.reject(je(jh))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),r=this.handshakeResolvers.get(t.responseId);try{const i=t.body.method;if(i===Qo.Response){if(!n)return;const s=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(s)}`),s.status!=="Success")n.reject(Ma(s.code,s.description,s.ext));else if(s.result)s.result.code&&s.result.description?n.reject(Ma(s.result.code,s.result.description,s.result.ext)):n.resolve(s.result);else throw Rf(Ga,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(i===Qo.HandshakeResponse){if(!r){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),r.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(i){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${i}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(i):r&&r.reject(i)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isPlatformBrokerAvailable(e,t,n,r){if(t.trace("isPlatformBrokerAvailable called"),!e.system.allowPlatformBroker)return t.trace("isPlatformBrokerAvailable: allowPlatformBroker is not enabled, returning false"),!1;if(!n)return t.trace("isPlatformBrokerAvailable: Platform extension provider is not initialized, returning false"),!1;if(r)switch(r){case Nt.BEARER:case Nt.POP:return t.trace("isPlatformBrokerAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isPlatformBrokerAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Al{constructor(e,t,n,r,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=i}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(ae.HandleCodeResponse,t.correlationId);let n;try{n=this.authModule.handleFragmentResponse(e,t.state)}catch(r){throw r instanceof Lo&&r.subError===xo?je(xo):r}return Te(this.handleCodeResponseFromServer.bind(this),ae.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(n,t)}async handleCodeResponseFromServer(e,t,n=!0){if(this.performanceClient.addQueueMeasurement(ae.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await Te(this.authModule.updateAuthority.bind(this.authModule),ae.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const i=this.createCcsCredentials(t);i&&(this.authCodeRequest.ccsCredential=i)}return await Te(this.authModule.acquireToken.bind(this.authModule),ae.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:jn.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:jn.UPN}:null}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function _g(o,e,t){const n=is(o);if(!n)throw dh(o)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${o}`),je(Th)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),je(Ih));return n}function Db(o,e,t){if(!o.state)throw je(ml);const n=fg(e,o.state);if(!n)throw je(Sh);if(n.interactionType!==t)throw je(Ah)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Hb extends Mr{constructor(e,t,n,r,i,s,a,l,c,u){super(e,t,n,r,i,s,a,c,u),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=l}acquireToken(e,t){try{const r={popupName:this.generatePopupName(e.scopes||Si,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r,t)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r,t))}catch(n){return Promise.reject(n)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:(e==null?void 0:e.popupWindowAttributes)||{},popupWindowParent:(e==null?void 0:e.popupWindowParent)??window},r=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,r,i)):(this.logger.verbose("asyncPopup set to false, opening popup"),n.popup=this.openSizedPopup("about:blank",n),this.logoutPopupAsync(t,n,r,i))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,n){var s;this.logger.verbose("acquireTokenPopupAsync called");const r=this.initializeServerTelemetryManager(Yt.acquireTokenPopup),i=await Te(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,ot.Popup);t.popup&&ug(i.authority);try{const a=await Te(this.initializeAuthorizationCodeRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(i,n),l=await Te(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),c=ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let u;c&&(u=this.performanceClient.startMeasurement(ae.FetchAccountIdWithNativeBroker,e.correlationId));const d=await l.getAuthCodeUrl({...i,platformBroker:c}),f=new Al(l,this.browserStorage,a,this.logger,this.performanceClient),h=this.initiateAuthRequest(d,t);this.eventHandler.emitEvent(st.POPUP_OPENED,ot.Popup,{popupWindow:h},null);const p=await this.monitorPopupForHash(h,t.popupWindowParent),b=Ao(_g,ae.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(p,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(uo.removeThrottle(this.browserStorage,this.config.auth.clientId,a),b.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),u&&u.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw je(Ri);const m=new mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Yt.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,b.accountId,this.nativeStorage,i.correlationId),{userRequestState:v}=no.parseRequestState(this.browserCrypto,i.state);return await m.acquireToken({...i,state:v,prompt:void 0})}return await f.handleCodeResponse(b,i)}catch(a){throw(s=t.popup)==null||s.close(),a instanceof Xt&&(a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a)),a}}async logoutPopupAsync(e,t,n,r){var s,a,l,c;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(st.LOGOUT_START,ot.Popup,e);const i=this.initializeServerTelemetryManager(Yt.logoutPopup);try{await this.clearCacheOnLogout(e.account);const u=await Te(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:n,account:e.account||void 0});try{u.authority.endSessionEndpoint}catch{if((s=e.account)!=null&&s.homeAccountId&&e.postLogoutRedirectUri&&u.authority.protocolMode===Eo.OIDC){if(this.browserStorage.removeAccount((a=e.account)==null?void 0:a.homeAccountId),this.eventHandler.emitEvent(st.LOGOUT_SUCCESS,ot.Popup,e),r){const h={apiId:Yt.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},p=It.getAbsoluteUrl(r,ko());await this.navigationClient.navigateInternal(p,h)}(l=t.popup)==null||l.close();return}}const d=u.getLogoutUri(e);this.eventHandler.emitEvent(st.LOGOUT_SUCCESS,ot.Popup,e);const f=this.openPopup(d,t);if(this.eventHandler.emitEvent(st.POPUP_OPENED,ot.Popup,{popupWindow:f},null),await this.monitorPopupForHash(f,t.popupWindowParent).catch(()=>{}),r){const h={apiId:Yt.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},p=It.getAbsoluteUrl(r,ko());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${p}`),await this.navigationClient.navigateInternal(p,h)}else this.logger.verbose("No main window navigation requested")}catch(u){throw(c=t.popup)==null||c.close(),u instanceof Xt&&(u.setCorrelationId(this.correlationId),i.cacheFailedRequest(u)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(st.LOGOUT_FAILURE,ot.Popup,null,u),this.eventHandler.emitEvent(st.LOGOUT_END,ot.Popup),u}this.eventHandler.emitEvent(st.LOGOUT_END,ot.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),je(Ps)}monitorPopupForHash(e,t){return new Promise((n,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),r(je(xo));return}let s="";try{s=e.location.href}catch{}if(!s||s==="about:blank")return;clearInterval(i);let a="";const l=this.config.auth.OIDCOptions.serverResponseType;e&&(l===Ai.QUERY?a=e.location.search:a=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),n(a)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t)),!n)throw je(Ph);return n.focus&&n.focus(),this.currentWindow=n,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),n}catch(n){throw this.logger.error("error opening popup "+n.message),this.browserStorage.setInteractionInProgress(!1),je(Mh)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:n,popupWindowParent:r}){var h,p,b,w;const i=r.screenLeft?r.screenLeft:r.screenX,s=r.screenTop?r.screenTop:r.screenY,a=r.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=r.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=(h=n.popupSize)==null?void 0:h.width,u=(p=n.popupSize)==null?void 0:p.height,d=(b=n.popupPosition)==null?void 0:b.top,f=(w=n.popupPosition)==null?void 0:w.left;return(!c||c<0||c>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=Yn.POPUP_WIDTH),(!u||u<0||u>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),u=Yn.POPUP_HEIGHT),(!d||d<0||d>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),d=Math.max(0,l/2-Yn.POPUP_HEIGHT/2+s)),(!f||f<0||f>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),f=Math.max(0,a/2-Yn.POPUP_WIDTH/2+i)),r.open(e,t,`width=${c}, height=${u}, top=${d}, left=${f}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(ot.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${Yn.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${Yn.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Dc{constructor(e,t,n,r,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=i}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(Pt.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(Pt.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const n={apiId:Yt.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await t.navigationClient.navigateExternal(e,n);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await t.navigationClient.navigateExternal(e,n);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),je(Ps)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const n=this.browserStorage.generateStateKey(t),r=this.browserStorage.getTemporaryCache(n);if(!r)throw Ie(ns,"Cached State");let i;try{i=this.authModule.handleFragmentResponse(e,r)}catch(c){throw c instanceof Lo&&c.subError===xo?je(xo):c}const s=this.browserStorage.generateNonceKey(r),a=this.browserStorage.getTemporaryCache(s);if(this.authCodeRequest.code=i.code,i.cloud_instance_host_name&&await Te(this.authModule.updateAuthority.bind(this.authModule),ae.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(i.cloud_instance_host_name,this.authCodeRequest.correlationId),i.nonce=a||void 0,i.state=r,i.client_info)this.authCodeRequest.clientInfo=i.client_info;else{const c=this.checkCcsCredentials();c&&(this.authCodeRequest.ccsCredential=c)}const l=await this.authModule.acquireToken(this.authCodeRequest,i);return this.browserStorage.cleanRequestByState(t),l}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(Pt.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Ub(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const o=window.performance.getEntriesByType("navigation"),e=o.length?o[0]:void 0;return e==null?void 0:e.type}class Lb extends Mr{constructor(e,t,n,r,i,s,a,l,c,u){super(e,t,n,r,i,s,a,c,u),this.nativeStorage=l}async acquireToken(e){const t=await Te(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,ot.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const n=this.initializeServerTelemetryManager(Yt.acquireTokenRedirect),r=i=>{i.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(st.RESTORE_FROM_BFCACHE,ot.Redirect))};try{const i=await Te(this.initializeAuthorizationCodeRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),s=await Te(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new Dc(s,this.browserStorage,i,this.logger,this.performanceClient),l=await s.getAuthCodeUrl({...t,platformBroker:ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),c=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${c}`),window.addEventListener("pageshow",r),await a.initiateAuthRequest(l,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:c,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(i){throw i instanceof Xt&&(i.setCorrelationId(this.correlationId),n.cacheFailedRequest(i)),window.removeEventListener("pageshow",r),this.browserStorage.cleanRequestByState(t.state),i}}async handleRedirectPromise(e="",t){const n=this.initializeServerTelemetryManager(Yt.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[r,i]=this.getRedirectResponse(e||"");if(!r)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(ot.Redirect),Ub()!=="back_forward"?t.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const s=this.browserStorage.getTemporaryCache(Pt.ORIGIN_URI,!0)||pe.EMPTY_STRING,a=It.removeHashFromUrl(s),l=It.removeHashFromUrl(window.location.href);if(a===l&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),s.indexOf("#")>-1&&Y0(s),await this.handleResponse(r,n);if(this.config.auth.navigateToLoginRequestUrl){if(!El()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(Pt.URL_HASH,i,!0);const c={apiId:Yt.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let u=!0;if(!s||s==="null"){const d=j0();this.browserStorage.setTemporaryCache(Pt.ORIGIN_URI,d,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),u=await this.navigationClient.navigateInternal(d,c)}else this.logger.verbose(`Navigating to loginRequestUrl: ${s}`),u=await this.navigationClient.navigateInternal(s,c);if(!u)return await this.handleResponse(r,n)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(r,n);return null}catch(r){throw r instanceof Xt&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),this.browserStorage.cleanRequestByInteractionType(ot.Redirect),r}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===Ai.QUERY?t=window.location.search:t=window.location.hash);let n=is(t);if(n){try{Db(n,this.browserCrypto,ot.Redirect)}catch(i){return i instanceof Xt&&this.logger.error(`Interaction type validation failed due to ${i.errorCode}: ${i.errorMessage}`),[null,""]}return W0(window),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}const r=this.browserStorage.getTemporaryCache(Pt.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Pt.URL_HASH)),r&&(n=is(r),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,r]):[null,""]}async handleResponse(e,t){const n=e.state;if(!n)throw je(ml);const r=this.browserStorage.getCachedRequest(n);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw je(Ri);const l=new mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Yt.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,r.correlationId),{userRequestState:c}=no.parseRequestState(this.browserCrypto,n);return l.acquireToken({...r,state:c,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(n)})}const i=this.browserStorage.getCachedAuthority(n);if(!i)throw je(pl);const s=await Te(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:i});return uo.removeThrottle(this.browserStorage,this.config.auth.clientId,r),new Dc(s,this.browserStorage,r,this.logger,this.performanceClient).handleCodeResponse(e,n)}async logout(e){var r,i;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(Yt.logout);try{this.eventHandler.emitEvent(st.LOGOUT_START,ot.Redirect,e),await this.clearCacheOnLogout(t.account);const s={apiId:Yt.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=await Te(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:e==null?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(a.authority.protocolMode===Eo.OIDC)try{a.authority.endSessionEndpoint}catch{if((r=t.account)!=null&&r.homeAccountId){this.browserStorage.removeAccount((i=t.account)==null?void 0:i.homeAccountId),this.eventHandler.emitEvent(st.LOGOUT_SUCCESS,ot.Redirect,t);return}}const l=a.getLogoutUri(t);if(this.eventHandler.emitEvent(st.LOGOUT_SUCCESS,ot.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(l)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,s);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,s);return}}catch(s){throw s instanceof Xt&&(s.setCorrelationId(this.correlationId),n.cacheFailedRequest(s)),this.eventHandler.emitEvent(st.LOGOUT_FAILURE,ot.Redirect,null,s),this.eventHandler.emitEvent(st.LOGOUT_END,ot.Redirect),s}this.eventHandler.emitEvent(st.LOGOUT_END,ot.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return It.getAbsoluteUrl(t,ko())}}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function Bb(o,e,t,n,r){if(e.addQueueMeasurement(ae.SilentHandlerInitiateAuthRequest,n),!o)throw t.info("Navigate url is empty"),je(Ps);return r?Te(Fb,ae.SilentHandlerLoadFrame,t,e,n)(o,r,e,n):Ao(Vb,ae.SilentHandlerLoadFrameSync,t,e,n)(o)}async function zb(o,e,t,n,r,i,s){return n.addQueueMeasurement(ae.SilentHandlerMonitorIframeForHash,i),new Promise((a,l)=>{e<Ia&&r.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Ia}ms). This may result in timeouts.`);const c=window.setTimeout(()=>{window.clearInterval(u),l(je(Oh))},e),u=window.setInterval(()=>{let d="";const f=o.contentWindow;try{d=f?f.location.href:""}catch{}if(!d||d==="about:blank")return;let h="";f&&(s===Ai.QUERY?h=f.location.search:h=f.location.hash),window.clearTimeout(c),window.clearInterval(u),a(h)},t)}).finally(()=>{Ao(Kb,ae.RemoveHiddenIframe,r,n,i)(o)})}function Fb(o,e,t,n){return t.addQueueMeasurement(ae.SilentHandlerLoadFrame,n),new Promise((r,i)=>{const s=bg();window.setTimeout(()=>{if(!s){i("Unable to load iframe");return}s.src=o,r(s)},e)})}function Vb(o){const e=bg();return e.src=o,e}function bg(){const o=document.createElement("iframe");return o.className="msalSilentIframe",o.style.visibility="hidden",o.style.position="absolute",o.style.width=o.style.height="0",o.style.border="0",o.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(o),o}function Kb(o){document.body===o.parentNode&&document.body.removeChild(o)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Gb extends Mr{constructor(e,t,n,r,i,s,a,l,c,u,d){super(e,t,n,r,i,s,l,u,d),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(ae.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==mn.NONE&&t.prompt!==mn.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${mn.NONE}`),t.prompt=mn.NONE):t.prompt=mn.NONE;const n=await Te(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,ot.Silent);ug(n.authority);const r=this.initializeServerTelemetryManager(this.apiId);let i;try{return i=await Te(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),await Te(this.silentTokenHelper.bind(this),ae.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(i,n)}catch(s){if(s instanceof Xt&&(s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s)),!i||!(s instanceof Xt)||s.errorCode!==Yn.INVALID_GRANT_ERROR)throw s;this.performanceClient.addFields({retryError:s.errorCode},this.correlationId);const a=await Te(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,ot.Silent);return await Te(this.silentTokenHelper.bind(this),ae.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(i,a)}}logout(){return Promise.reject(je(Os))}async silentTokenHelper(e,t){const n=t.correlationId;this.performanceClient.addQueueMeasurement(ae.SilentIframeClientTokenHelper,n);const r=await Te(this.initializeAuthorizationCodeRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,n)(t),i=await Te(e.getAuthCodeUrl.bind(e),ae.GetAuthCodeUrl,this.logger,this.performanceClient,n)({...t,platformBroker:ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),s=new Al(e,this.browserStorage,r,this.logger,this.performanceClient),a=await Te(Bb,ae.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(i,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait),l=this.config.auth.OIDCOptions.serverResponseType,c=await Te(zb,ae.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,l),u=Ao(_g,ae.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(c,l,this.logger);if(u.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw je(Ri);const d=new mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,u.accountId,this.browserStorage,n),{userRequestState:f}=no.parseRequestState(this.browserCrypto,t.state);return Te(d.acquireToken.bind(d),ae.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,n)({...t,state:f,prompt:t.prompt||mn.NONE})}return Te(s.handleCodeResponse.bind(s),ae.HandleCodeResponse,this.logger,this.performanceClient,n)(u,t)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Wb extends Mr{async acquireToken(e){this.performanceClient.addQueueMeasurement(ae.SilentRefreshClientAcquireToken,e.correlationId);const t=await Te(Sl,ae.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),n={...e,...t};e.redirectUri&&(n.redirectUri=this.getRedirectUri(e.redirectUri));const r=this.initializeServerTelemetryManager(Yt.acquireTokenSilent_silentFlow),i=await this.createRefreshTokenClient({serverTelemetryManager:r,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return Te(i.acquireTokenByRefreshToken.bind(i),ae.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(n).catch(s=>{throw s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s),s})}logout(){return Promise.reject(je(Os))}async createRefreshTokenClient(e){const t=await Te(this.getClientConfiguration.bind(this),ae.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new h0(t,this.performanceClient)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Yb{constructor(e,t,n,r){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=n,this.cryptoObj=r}async loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw je(Ns);const r=e.correlationId||io(),i=t.id_token?Rr(t.id_token,Io):void 0,s={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new Mn(Mn.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,s,this.logger,e.correlationId||io()):void 0,l=await this.loadAccount(e,n.clientInfo||t.client_info||"",r,i,a),c=await this.loadIdToken(t,l.homeAccountId,l.environment,l.realm,r),u=await this.loadAccessToken(e,t,l.homeAccountId,l.environment,l.realm,n,r),d=await this.loadRefreshToken(t,l.homeAccountId,l.environment,r);return this.generateAuthenticationResult(e,{account:l,idToken:c,accessToken:u,refreshToken:d},i,a)}async loadAccount(e,t,n,r,i){if(this.logger.verbose("TokenCache - loading account"),e.account){const c=Dn.createFromAccountInfo(e.account);return await this.storage.setAccount(c,n),c}else if(!i||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),je(Vh);const s=Dn.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,r),a=r==null?void 0:r.tid,l=dl(this.storage,i,s,Io,r,t,i.hostnameAndPort,a,void 0,void 0,this.logger);return await this.storage.setAccount(l,n),l}async loadIdToken(e,t,n,r,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const s=Is(t,n,e.id_token,this.config.auth.clientId,r);return await this.storage.setIdTokenCredential(s,i),s}async loadAccessToken(e,t,n,r,i,s,a){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const l=t.scope?on.fromString(t.scope):new on(e.scopes),c=s.expiresOn||t.expires_in+new Date().getTime()/1e3,u=s.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+new Date().getTime()/1e3,d=Ts(n,r,t.access_token,this.config.auth.clientId,i,l.printScopes(),c,u,Io);return await this.storage.setAccessTokenCredential(d,a),d}async loadRefreshToken(e,t,n,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const i=Xf(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(i,r),i}generateAuthenticationResult(e,t,n,r){var u,d,f;let i="",s=[],a=null,l;t!=null&&t.accessToken&&(i=t.accessToken.secret,s=on.fromString(t.accessToken.target).asArray(),a=new Date(Number(t.accessToken.expiresOn)*1e3),l=new Date(Number(t.accessToken.extendedExpiresOn)*1e3));const c=t.account;return{authority:r?r.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:s,account:c.getAccountInfo(),idToken:((u=t.idToken)==null?void 0:u.secret)||"",idTokenClaims:n||{},accessToken:i,fromCache:!0,expiresOn:a,correlationId:e.correlationId||"",requestId:"",extExpiresOn:l,familyId:((d=t.refreshToken)==null?void 0:d.familyId)||"",tokenType:((f=t==null?void 0:t.accessToken)==null?void 0:f.tokenType)||"",state:e.state||"",cloudGraphHostName:c.cloudGraphHostName||"",msGraphHost:c.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class qb extends vh{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class jb extends Mr{constructor(e,t,n,r,i,s,a,l,c,u){super(e,t,n,r,i,s,l,c,u),this.apiId=a}async acquireToken(e){if(!e.code)throw je(Kh);const t=await Te(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,ot.Silent),n=this.initializeServerTelemetryManager(this.apiId);try{const r={...t,code:e.code},i=await Te(this.getClientConfiguration.bind(this),ae.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new qb(i);this.logger.verbose("Auth code client created");const a=new Al(s,this.browserStorage,r,this.logger,this.performanceClient);return await Te(a.handleCodeResponseFromServer.bind(a),ae.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(r){throw r instanceof Xt&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),r}}logout(){return Promise.reject(je(Os))}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function ao(o){const e=o==null?void 0:o.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function ji(o,e){try{Il(o)}catch(t){throw e.end({success:!1},t),t}}class Ls{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new vr(this.logger,this.performanceClient):os,this.eventHandler=new wb(this.logger),this.browserStorage=this.isBrowserEnvironment?new Ra(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,o0(this.config.auth)):db(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:Tn.MemoryStorage,temporaryCacheLocation:Tn.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Ra(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new Yb(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const n=new Ls(e);return await n.initialize(t),n}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(st.INITIALIZE_END);return}const t=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),n=this.config.system.allowPlatformBroker,r=this.performanceClient.startMeasurement(ae.InitializeClientApplication,t);if(this.eventHandler.emitEvent(st.INITIALIZE_START),await Te(this.browserStorage.initialize.bind(this.browserStorage),ae.InitializeCache,this.logger,this.performanceClient,t)(t),n)try{this.nativeExtensionProvider=await ho.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(i){this.logger.verbose(i)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await Te(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),ae.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t),this.initialized=!0,this.eventHandler.emitEvent(st.INITIALIZE_END),r.end({allowPlatformBroker:n,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),cg(this.initialized),this.isBrowserEnvironment){const t=e||"";let n=this.redirectResponse.get(t);return typeof n>"u"?(n=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,n),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),n=this.browserStorage.getCachedNativeRequest(),r=n&&ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,i=r?n==null?void 0:n.correlationId:this.browserStorage.getTemporaryCache(Pt.CORRELATION_ID,!0)||"",s=this.performanceClient.startMeasurement(ae.AcquireTokenRedirect,i);this.eventHandler.emitEvent(st.HANDLE_REDIRECT_START,ot.Redirect);let a;if(r&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const l=new mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Yt.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,n.accountId,this.nativeInternalStorage,n.correlationId);a=Te(l.handleRedirectPromise.bind(l),ae.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(this.performanceClient,s.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const l=this.createRedirectClient(i);a=Te(l.handleRedirectPromise.bind(l),ae.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(e,s)}return a.then(l=>(l?(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(st.LOGIN_SUCCESS,ot.Redirect,l),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_SUCCESS,ot.Redirect,l),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),s.end({success:!0,accountType:ao(l.account)})):s.event.errorCode?s.end({success:!1}):s.discard(),this.eventHandler.emitEvent(st.HANDLE_REDIRECT_END,ot.Redirect),l)).catch(l=>{const c=l;throw t.length>0?this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_FAILURE,ot.Redirect,null,c):this.eventHandler.emitEvent(st.LOGIN_FAILURE,ot.Redirect,null,c),this.eventHandler.emitEvent(st.HANDLE_REDIRECT_END,ot.Redirect),s.end({success:!1},c),l})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const n=this.performanceClient.startMeasurement(ae.AcquireTokenPreRedirect,t);n.add({accountType:ao(e.account),scenarioId:e.scenarioId});const r=e.onRedirectNavigate;if(r)e.onRedirectNavigate=s=>{const a=typeof r=="function"?r(s):void 0;return a!==!1?n.end({success:!0}):n.discard(),a};else{const s=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=a=>{const l=typeof s=="function"?s(a):void 0;return l!==!1?n.end({success:!0}):n.discard(),l}}const i=this.getAllAccounts().length>0;try{Ac(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),i?this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_START,ot.Redirect,e):this.eventHandler.emitEvent(st.LOGIN_START,ot.Redirect,e);let s;return this.nativeExtensionProvider&&this.canUsePlatformBroker(e)?s=new mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Yt.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,n).catch(l=>{if(l instanceof fo&&lr(l))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(l instanceof ro)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),l}):s=this.createRedirectClient(t).acquireToken(e),await s}catch(s){throw n.end({success:!1},s),i?this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_FAILURE,ot.Redirect,null,s):this.eventHandler.emitEvent(st.LOGIN_FAILURE,ot.Redirect,null,s),s}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(ae.AcquireTokenPopup,t);n.add({scenarioId:e.scenarioId,accountType:ao(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),ji(this.initialized,n),this.browserStorage.setInteractionInProgress(!0)}catch(a){return Promise.reject(a)}const r=this.getAllAccounts();r.length>0?this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_START,ot.Popup,e):this.eventHandler.emitEvent(st.LOGIN_START,ot.Popup,e);let i;const s=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?i=this.acquireTokenNative({...e,correlationId:t},Yt.acquireTokenPopup).then(a=>(this.browserStorage.setInteractionInProgress(!1),n.end({success:!0,isNativeBroker:!0,accountType:ao(a.account)}),a)).catch(a=>{if(a instanceof fo&&lr(a))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e,s);if(a instanceof ro)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e,s);throw this.browserStorage.setInteractionInProgress(!1),a}):i=this.createPopupClient(t).acquireToken(e,s),i.then(a=>(r.length<this.getAllAccounts().length?this.eventHandler.emitEvent(st.LOGIN_SUCCESS,ot.Popup,a):this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_SUCCESS,ot.Popup,a),n.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:ao(a.account)}),a)).catch(a=>(r.length>0?this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_FAILURE,ot.Popup,null,a):this.eventHandler.emitEvent(st.LOGIN_FAILURE,ot.Popup,null,a),n.end({success:!1},a),Promise.reject(a))).finally(()=>this.config.system.asyncPopups&&this.preGeneratePkceCodes(t))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var i,s;const t=this.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(ae.SsoSilent,t),(i=this.ssoSilentMeasurement)==null||i.add({scenarioId:e.scenarioId,accountType:ao(e.account)}),ji(this.initialized,this.ssoSilentMeasurement),(s=this.ssoSilentMeasurement)==null||s.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(st.SSO_SILENT_START,ot.Silent,n);let r;return this.canUsePlatformBroker(n)?r=this.acquireTokenNative(n,Yt.ssoSilent).catch(a=>{if(a instanceof fo&&lr(a))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(n.correlationId).acquireToken(n);throw a}):r=this.createSilentIframeClient(n.correlationId).acquireToken(n),r.then(a=>{var l;return this.eventHandler.emitEvent(st.SSO_SILENT_SUCCESS,ot.Silent,a),(l=this.ssoSilentMeasurement)==null||l.end({success:!0,isNativeBroker:a.fromNativeBroker,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:ao(a.account)}),a}).catch(a=>{var l;throw this.eventHandler.emitEvent(st.SSO_SILENT_FAILURE,ot.Silent,null,a),(l=this.ssoSilentMeasurement)==null||l.end({success:!1},a),a}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const n=this.performanceClient.startMeasurement(ae.AcquireTokenByCode,t);ji(this.initialized,n),this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_BY_CODE_START,ot.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw je(Wh);if(e.code){const r=e.code;let i=this.hybridAuthCodeResponses.get(r);return i?(this.logger.verbose("Existing acquireTokenByCode request found",t),n.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(s=>(this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_BY_CODE_SUCCESS,ot.Silent,s),this.hybridAuthCodeResponses.delete(r),n.end({success:!0,isNativeBroker:s.fromNativeBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:ao(s.account)}),s)).catch(s=>{throw this.hybridAuthCodeResponses.delete(r),this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_BY_CODE_FAILURE,ot.Silent,null,s),n.end({success:!1},s),s}),this.hybridAuthCodeResponses.set(r,i)),await i}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){const r=await this.acquireTokenNative({...e,correlationId:t},Yt.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof fo&&lr(i)&&(this.nativeExtensionProvider=void 0),i});return n.end({accountType:ao(r.account),success:!0}),r}else throw je(Yh);else throw je(Gh)}catch(r){throw this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_BY_CODE_FAILURE,ot.Silent,null,r),n.end({success:!1},r),r}}async acquireTokenByCodeAsync(e){var r;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(ae.AcquireTokenByCodeAsync,e.correlationId),(r=this.acquireTokenByCodeAsyncMeasurement)==null||r.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(i=>{var s;return(s=this.acquireTokenByCodeAsyncMeasurement)==null||s.end({success:!0,fromCache:i.fromCache,isNativeBroker:i.fromNativeBroker}),i}).catch(i=>{var s;throw(s=this.acquireTokenByCodeAsyncMeasurement)==null||s.end({success:!1},i),i}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(ae.AcquireTokenFromCache,e.correlationId),t){case Kn.Default:case Kn.AccessToken:case Kn.AccessTokenAndRefreshToken:const n=this.createSilentCacheClient(e.correlationId);return Te(n.acquireToken.bind(n),ae.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ie(Do)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(ae.AcquireTokenByRefreshToken,e.correlationId),t){case Kn.Default:case Kn.AccessTokenAndRefreshToken:case Kn.RefreshToken:case Kn.RefreshTokenAndNetwork:const n=this.createSilentRefreshClient(e.correlationId);return Te(n.acquireToken.bind(n),ae.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ie(Do)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(ae.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return Te(t.acquireToken.bind(t),ae.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return Ac(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return Il(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return fb(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return hb(e,this.logger,this.browserStorage)}getAccountByUsername(e){return gb(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return mb(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return pb(e,this.logger,this.browserStorage)}setActiveAccount(e){_b(e,this.browserStorage)}getActiveAccount(){return bb(this.browserStorage)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=Dn.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(n,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,n){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw je(Ri);return new mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isPlatformBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case mn.NONE:case mn.CONSENT:case mn.LOGIN:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Hb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new Lb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Gb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Yt.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new pg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Wb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new jb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Yt.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return lg(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Tn.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Tn.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?io():pe.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||Ec})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Ec})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(ae.AcquireTokenSilent,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),ji(this.initialized,n),this.logger.verbose("acquireTokenSilent called",t);const r=e.account||this.getActiveAccount();if(!r)throw je(Uh);n.add({accountType:ao(r)});const i={clientId:this.config.auth.clientId,authority:e.authority||pe.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:r.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},s=JSON.stringify(i),a=this.activeSilentTokenRequests.get(s);if(typeof a>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const l=Te(this.acquireTokenSilentAsync.bind(this),ae.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},r).then(c=>(this.activeSilentTokenRequests.delete(s),n.end({success:!0,fromCache:c.fromCache,isNativeBroker:c.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length}),c)).catch(c=>{throw this.activeSilentTokenRequests.delete(s),n.end({success:!1},c),c});return this.activeSilentTokenRequests.set(s,l),{...await l,state:e.state}}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),n.discard(),{...await a,state:e.state}}async acquireTokenSilentAsync(e,t){const n=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(ae.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_START,ot.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);const r=await Te(Eb,ae.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),i=e.cacheLookupPolicy||Kn.Default;return this.acquireTokenSilentNoIframe(r,i).catch(async a=>{if(Qb(a,i))if(this.activeIframeRequest)if(i!==Kn.Skip){const[c,u]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${u}`,r.correlationId);const d=this.performanceClient.startMeasurement(ae.AwaitConcurrentIframe,r.correlationId);d.add({awaitIframeCorrelationId:u});const f=await c;if(d.end({success:f}),f)return this.logger.verbose(`Parallel iframe request with correlationId: ${u} succeeded. Retrying cache and/or RT redemption`,r.correlationId),this.acquireTokenSilentNoIframe(r,i);throw this.logger.info(`Iframe request with correlationId: ${u} failed. Interaction is required.`),a}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",r.correlationId),Te(this.acquireTokenBySilentIframe.bind(this),ae.AcquireTokenBySilentIframe,this.logger,this.performanceClient,r.correlationId)(r);else{let c;return this.activeIframeRequest=[new Promise(u=>{c=u}),r.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",r.correlationId),Te(this.acquireTokenBySilentIframe.bind(this),ae.AcquireTokenBySilentIframe,this.logger,this.performanceClient,r.correlationId)(r).then(u=>(c(!0),u)).catch(u=>{throw c(!1),u}).finally(()=>{this.activeIframeRequest=void 0})}else throw a}).then(a=>(this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_SUCCESS,ot.Silent,a),e.correlationId&&this.performanceClient.addFields({fromCache:a.fromCache,isNativeBroker:a.fromNativeBroker},e.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_FAILURE,ot.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",n)})}async acquireTokenSilentNoIframe(e,t){return ho.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,Yt.acquireTokenSilent_silentFlow).catch(async n=>{throw n instanceof fo&&lr(n)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,Ie(Do)):n})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),Te(this.acquireTokenFromCache.bind(this),ae.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(n=>{if(t===Kn.AccessToken)throw n;return this.eventHandler.emitEvent(st.ACQUIRE_TOKEN_NETWORK_START,ot.Silent,e),Te(this.acquireTokenByRefreshToken.bind(this),ae.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await Te(gg,ae.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}}function Qb(o,e){const t=!(o instanceof ro&&o.subError!==Ms),n=o.errorCode===Yn.INVALID_GRANT_ERROR||o.errorCode===Do,r=t&&n||o.errorCode===as||o.errorCode===ul,i=A0.includes(e);return r&&i}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function Xb(o,e){const t=new er(o);return await t.initialize(),Ls.createController(t,e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Rl{static async createPublicClientApplication(e){const t=await Xb(e);return new Rl(e,t)}constructor(e,t){this.controller=t||new Ls(new er(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}const jo=class jo{constructor(){Ko(this,"clientId","");Ko(this,"sharepointUrl","");Ko(this,"sharepointTenantId","");Ko(this,"msalInstance",null);Ko(this,"currentAuthorityType","personal")}static getInstance(){return jo.instance||(jo.instance=new jo),jo.instance}async initialize(e){e&&this.currentAuthorityType!==e&&(this.currentAuthorityType=e,this.msalInstance=null),await this.getCredentials()}async ensureInitialized(e){await this.initialize(e)}async getCredentials(){var a,l,c;const t=await fetch("/api/config",{headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw new Error("Failed to fetch OneDrive credentials");const n=await t.json(),r=(a=n.onedrive)==null?void 0:a.client_id,i=(l=n.onedrive)==null?void 0:l.sharepoint_url,s=(c=n.onedrive)==null?void 0:c.sharepoint_tenant_id;if(!r)throw new Error("OneDrive configuration is incomplete");this.clientId=r,this.sharepointUrl=i,this.sharepointTenantId=s}async getMsalInstance(e){if(await this.ensureInitialized(e),!this.msalInstance){const n={auth:{authority:`https://login.microsoftonline.com/${this.currentAuthorityType==="organizations"?this.sharepointTenantId||"common":"consumers"}`,clientId:this.clientId}};this.msalInstance=new Rl(n),this.msalInstance.initialize&&await this.msalInstance.initialize()}return this.msalInstance}getAuthorityType(){return this.currentAuthorityType}getSharepointUrl(){return this.sharepointUrl}getSharepointTenantId(){return this.sharepointTenantId}getBaseUrl(){if(this.currentAuthorityType==="organizations"){if(!this.sharepointUrl||this.sharepointUrl==="")throw new Error("Sharepoint URL not configured");let e=this.sharepointUrl.replace(/^https?:\/\//,"");return e=e.replace(/\/$/,""),`https://${e}`}else return"https://onedrive.live.com/picker"}};Ko(jo,"instance");let ki=jo;async function Pa(o,e){const t=ki.getInstance();await t.ensureInitialized(e);const i={scopes:t.getAuthorityType()==="organizations"?[`${o||t.getBaseUrl()}/.default`]:["OneDrive.ReadWrite"]};let s="";try{s=(await(await t.getMsalInstance(e)).acquireTokenSilent(i)).accessToken}catch{const l=await t.getMsalInstance(e);try{const c=await l.loginPopup(i);l.setActiveAccount(c.account),c.idToken&&(s=(await l.acquireTokenSilent(i)).accessToken)}catch(c){throw new Error("Failed to login: "+(c instanceof Error?c.message:String(c)))}}if(!s)throw new Error("Failed to acquire access token");return s}function Jb(){var n;const o=wo(),e=ki.getInstance(),t={sdk:"8.0",entry:{oneDrive:{}},authentication:{},messaging:{origin:((n=window==null?void 0:window.location)==null?void 0:n.origin)||"",channelId:o},typesAndSources:{mode:"files",pivots:{oneDrive:!0,recent:!0}}};return e.getAuthorityType()!=="organizations"&&(t.entry.oneDrive={files:{}}),t}async function Zb(o,e){const t=await Pa(void 0,e);if(!t)throw new Error("Unable to retrieve OneDrive access token.");const n=`${o["@sharePoint.endpoint"]}/drives/${o.parentReference.driveId}/items/${o.id}`,r=await fetch(n,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error(`Failed to fetch file information: ${r.status} ${r.statusText}`);const s=(await r.json())["@content.downloadUrl"];if(!s)throw new Error("Download URL not found in file data");const a=await fetch(s);if(!a.ok)throw new Error(`Failed to download file: ${a.status} ${a.statusText}`);return await a.blob()}async function xb(o){if(typeof window>"u")throw new Error("Not in browser environment");const e=ki.getInstance();return await e.initialize(o),new Promise((t,n)=>{let r=null,i=null;const s=Jb(),a=e.getBaseUrl(),l=f=>{var p;if(f.source!==r)return;const h=f.data;if((h==null?void 0:h.type)==="initialize"&&(h==null?void 0:h.channelId)===s.messaging.channelId){if(i=(p=f.ports)==null?void 0:p[0],!i)return;i.addEventListener("message",c),i.start(),i.postMessage({type:"activate"})}},c=async f=>{const h=f.data;switch(h.type){case"notification":break;case"command":{i==null||i.postMessage({type:"acknowledge",id:h.id});const p=h.data;switch(p.command){case"authenticate":{try{const b=e.getAuthorityType()==="organizations"?p.resource:void 0,w=await Pa(b,o);if(w)i==null||i.postMessage({type:"result",id:h.id,data:{result:"token",token:w}});else throw new Error("Could not retrieve auth token")}catch{i==null||i.postMessage({type:"result",id:h.id,data:{result:"error",error:{code:"tokenError",message:"Failed to get token"}}})}break}case"close":{u(),t(null);break}case"pick":{i==null||i.postMessage({type:"result",id:h.id,data:{result:"success"}}),u(),t(p);break}default:{i==null||i.postMessage({result:"error",error:{code:"unsupportedCommand",message:p.command},isExpected:!0});break}}break}}};function u(){window.removeEventListener("message",l),i&&i.removeEventListener("message",c),r&&(r.close(),r=null)}(async()=>{try{const f=await Pa(void 0,o);if(!f)return n(new Error("Failed to acquire access token"));if(r=window.open("","OneDrivePicker","width=800,height=600"),!r)return n(new Error("Failed to open OneDrive picker window"));const h=new URLSearchParams({filePicker:JSON.stringify(s)});let p="";e.getAuthorityType()==="organizations"?p=a+`/_layouts/15/FilePicker.aspx?${h}`:p=a+`?${h}`;const b=r.document.createElement("form");b.setAttribute("action",p),b.setAttribute("method","POST");const w=r.document.createElement("input");w.setAttribute("type","hidden"),w.setAttribute("name","access_token"),w.setAttribute("value",f),b.appendChild(w),r.document.body.appendChild(b),b.submit(),window.addEventListener("message",l)}catch(f){r&&r.close(),n(f)}})()})}async function $b(o){const e=await xb(o);if(!e||!e.items||e.items.length===0)return null;const t=e.items[0];return{blob:await Zb(t,o),name:t.name}}function Hc(o,e,t){const n=o.slice();return n[34]=e[t],n}function ey(o){let e;const t=o[20].default,n=pn(t,o,o[31],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i[1]&1)&&_n(n,t,r,r[31],e?yn(t,r[31],i,null):bn(r[31]),null)},i(r){e||(T(n,r),e=!0)},o(r){O(n,r),e=!1},d(r){n&&n.d(r)}}}function ty(o){let e,t;return e=new Ft({props:{content:o[12].t("More"),$$slots:{default:[ey]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&4096&&(i.content=n[12].t("More")),r[1]&1&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Uc(o){let e,t,n,r=Object.keys(o[9]).length>3,i,s,a,l=yt(Object.keys(o[9])),c=[];for(let f=0;f<l.length;f+=1)c[f]=Lc(Hc(o,l,f));const u=f=>O(c[f],1,1,()=>{c[f]=null});let d=r&&Bc(o);return{c(){e=U("div");for(let f=0;f<c.length;f+=1)c[f].c();n=ie(),d&&d.c(),i=ie(),s=U("hr"),this.h()},l(f){e=L(f,"DIV",{class:!0});var h=A(e);for(let p=0;p<c.length;p+=1)c[p].l(h);h.forEach(_),n=se(f),d&&d.l(f),i=se(f),s=L(f,"HR",{class:!0}),this.h()},h(){g(e,"class",t=(o[10]?"":"max-h-28")+" overflow-y-auto scrollbar-thin"),g(s,"class","border-black/5 dark:border-white/5 my-1")},m(f,h){z(f,e,h);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(e,null);z(f,n,h),d&&d.m(f,h),z(f,i,h),z(f,s,h),a=!0},p(f,h){if(h[0]&513){l=yt(Object.keys(f[9]));let p;for(p=0;p<l.length;p+=1){const b=Hc(f,l,p);c[p]?(c[p].p(b,h),T(c[p],1)):(c[p]=Lc(b),c[p].c(),T(c[p],1),c[p].m(e,null))}for(Re(),p=l.length;p<c.length;p+=1)u(p);Me()}(!a||h[0]&1024&&t!==(t=(f[10]?"":"max-h-28")+" overflow-y-auto scrollbar-thin"))&&g(e,"class",t),h[0]&512&&(r=Object.keys(f[9]).length>3),r?d?d.p(f,h):(d=Bc(f),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null)},i(f){if(!a){for(let h=0;h<l.length;h+=1)T(c[h]);a=!0}},o(f){c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)O(c[h]);a=!1},d(f){f&&(_(e),_(n),_(i),_(s)),Hn(c,f),d&&d.d(f)}}}function ny(o){let e,t,n,r,i=o[9][o[34]].name+"",s,a;return t=new rp({}),{c(){e=U("div"),$(t.$$.fragment),n=ie(),r=U("div"),s=Oe(i),this.h()},l(l){e=L(l,"DIV",{class:!0});var c=A(e);oe(t.$$.fragment,c),c.forEach(_),n=se(l),r=L(l,"DIV",{class:!0});var u=A(r);s=Ne(u,i),u.forEach(_),this.h()},h(){g(e,"class","shrink-0"),g(r,"class","truncate")},m(l,c){z(l,e,c),ee(t,e,null),z(l,n,c),z(l,r,c),S(r,s),a=!0},p(l,c){(!a||c[0]&512)&&i!==(i=l[9][l[34]].name+"")&&Be(s,i)},i(l){a||(T(t.$$.fragment,l),a=!0)},o(l){O(t.$$.fragment,l),a=!1},d(l){l&&(_(e),_(n),_(r)),te(t)}}}function Lc(o){var h;let e,t,n,r,i,s,a,l,c,u;n=new Ft({props:{content:((h=o[9][o[34]])==null?void 0:h.description)??"",placement:"top-start",className:"flex flex-1 gap-2 items-center",$$slots:{default:[ny]},$$scope:{ctx:o}}});function d(...p){return o[21](o[34],...p)}s=new op({props:{state:o[9][o[34]].enabled}}),s.$on("change",d);function f(){return o[22](o[34])}return{c(){e=U("button"),t=U("div"),$(n.$$.fragment),r=ie(),i=U("div"),$(s.$$.fragment),a=ie(),this.h()},l(p){e=L(p,"BUTTON",{class:!0});var b=A(e);t=L(b,"DIV",{class:!0});var w=A(t);oe(n.$$.fragment,w),w.forEach(_),r=se(b),i=L(b,"DIV",{class:!0});var m=A(i);oe(s.$$.fragment,m),m.forEach(_),a=se(b),b.forEach(_),this.h()},h(){g(t,"class","flex-1 truncate"),g(i,"class","shrink-0"),g(e,"class","flex w-full justify-between gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl")},m(p,b){z(p,e,b),S(e,t),ee(n,t,null),S(e,r),S(e,i),ee(s,i,null),S(e,a),l=!0,c||(u=Ae(e,"click",f),c=!0)},p(p,b){var v;o=p;const w={};b[0]&512&&(w.content=((v=o[9][o[34]])==null?void 0:v.description)??""),b[0]&512|b[1]&1&&(w.$$scope={dirty:b,ctx:o}),n.$set(w);const m={};b[0]&512&&(m.state=o[9][o[34]].enabled),s.$set(m)},i(p){l||(T(n.$$.fragment,p),T(s.$$.fragment,p),l=!0)},o(p){O(n.$$.fragment,p),O(s.$$.fragment,p),l=!1},d(p){p&&_(e),te(n),te(s),c=!1,u()}}}function Bc(o){let e,t,n,r,i,s,a;return{c(){e=U("button"),t=Ce("svg"),n=Ce("path"),this.h()},l(l){e=L(l,"BUTTON",{class:!0,title:!0});var c=A(e);t=Ee(c,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var u=A(t);n=Ee(u,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(n).forEach(_),u.forEach(_),c.forEach(_),this.h()},h(){g(n,"stroke-linecap","round"),g(n,"stroke-linejoin","round"),g(n,"d","m19.5 8.25-7.5 7.5-7.5-7.5"),g(t,"xmlns","http://www.w3.org/2000/svg"),g(t,"fill","none"),g(t,"viewBox","0 0 24 24"),g(t,"stroke-width","2.5"),g(t,"stroke","currentColor"),g(t,"class",r="size-3 transition-transform duration-200 "+(o[10]?"rotate-180":"")+" text-gray-300 dark:text-gray-600"),g(e,"class","flex w-full justify-center items-center text-sm font-medium cursor-pointer rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800"),g(e,"title",i=o[10]?o[12].t("Show Less"):o[12].t("Show All"))},m(l,c){z(l,e,c),S(e,t),S(t,n),s||(a=Ae(e,"click",o[23]),s=!0)},p(l,c){c[0]&1024&&r!==(r="size-3 transition-transform duration-200 "+(l[10]?"rotate-180":"")+" text-gray-300 dark:text-gray-600")&&g(t,"class",r),c[0]&5120&&i!==(i=l[10]?l[12].t("Show Less"):l[12].t("Show All"))&&g(e,"title",i)},d(l){l&&_(e),s=!1,a()}}}function oy(o){let e,t,n,r=o[12].t("Capture")+"",i,s;return e=new pm({}),{c(){$(e.$$.fragment),t=ie(),n=U("div"),i=Oe(r),this.h()},l(a){oe(e.$$.fragment,a),t=se(a),n=L(a,"DIV",{class:!0});var l=A(n);i=Ne(l,r),l.forEach(_),this.h()},h(){g(n,"class","line-clamp-1")},m(a,l){ee(e,a,l),z(a,t,l),z(a,n,l),S(n,i),s=!0},p(a,l){(!s||l[0]&4096)&&r!==(r=a[12].t("Capture")+"")&&Be(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){O(e.$$.fragment,a),s=!1},d(a){a&&(_(t),_(n)),te(e,a)}}}function ry(o){let e,t;return e=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl "+(o[11]?"":"opacity-50"),$$slots:{default:[oy]},$$scope:{ctx:o}}}),e.$on("click",o[24]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&2048&&(i.class="flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl "+(n[11]?"":"opacity-50")),r[0]&4096|r[1]&1&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function iy(o){let e,t,n,r=o[12].t("Upload Files")+"",i,s;return e=new _m({}),{c(){$(e.$$.fragment),t=ie(),n=U("div"),i=Oe(r),this.h()},l(a){oe(e.$$.fragment,a),t=se(a),n=L(a,"DIV",{class:!0});var l=A(n);i=Ne(l,r),l.forEach(_),this.h()},h(){g(n,"class","line-clamp-1")},m(a,l){ee(e,a,l),z(a,t,l),z(a,n,l),S(n,i),s=!0},p(a,l){(!s||l[0]&4096)&&r!==(r=a[12].t("Upload Files")+"")&&Be(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){O(e.$$.fragment,a),s=!1},d(a){a&&(_(t),_(n)),te(e,a)}}}function sy(o){let e,t;return e=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl "+(o[11]?"":"opacity-50"),$$slots:{default:[iy]},$$scope:{ctx:o}}}),e.$on("click",o[25]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&2048&&(i.class="flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl "+(n[11]?"":"opacity-50")),r[0]&4096|r[1]&1&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function zc(o){var s,a,l,c;let e,t,n,r=((a=(s=o[13])==null?void 0:s.features)==null?void 0:a.enable_google_drive_integration)&&Fc(o),i=((c=(l=o[13])==null?void 0:l.features)==null?void 0:c.enable_onedrive_integration)&&Vc(o);return{c(){r&&r.c(),e=ie(),i&&i.c(),t=Ve()},l(u){r&&r.l(u),e=se(u),i&&i.l(u),t=Ve()},m(u,d){r&&r.m(u,d),z(u,e,d),i&&i.m(u,d),z(u,t,d),n=!0},p(u,d){var f,h,p,b;(h=(f=u[13])==null?void 0:f.features)!=null&&h.enable_google_drive_integration?r?(r.p(u,d),d[0]&8192&&T(r,1)):(r=Fc(u),r.c(),T(r,1),r.m(e.parentNode,e)):r&&(Re(),O(r,1,1,()=>{r=null}),Me()),(b=(p=u[13])==null?void 0:p.features)!=null&&b.enable_onedrive_integration?i?(i.p(u,d),d[0]&8192&&T(i,1)):(i=Vc(u),i.c(),T(i,1),i.m(t.parentNode,t)):i&&(Re(),O(i,1,1,()=>{i=null}),Me())},i(u){n||(T(r),T(i),n=!0)},o(u){O(r),O(i),n=!1},d(u){u&&(_(e),_(t)),r&&r.d(u),i&&i.d(u)}}}function Fc(o){let e,t;return e=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$slots:{default:[ay]},$$scope:{ctx:o}}}),e.$on("click",o[26]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&4096|r[1]&1&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function ay(o){let e,t,n,r,i,s,a,l,c,u=o[12].t("Google Drive")+"",d;return{c(){e=Ce("svg"),t=Ce("path"),n=Ce("path"),r=Ce("path"),i=Ce("path"),s=Ce("path"),a=Ce("path"),l=ie(),c=U("div"),d=Oe(u),this.h()},l(f){e=Ee(f,"svg",{xmlns:!0,viewBox:!0,class:!0});var h=A(e);t=Ee(h,"path",{d:!0,fill:!0}),A(t).forEach(_),n=Ee(h,"path",{d:!0,fill:!0}),A(n).forEach(_),r=Ee(h,"path",{d:!0,fill:!0}),A(r).forEach(_),i=Ee(h,"path",{d:!0,fill:!0}),A(i).forEach(_),s=Ee(h,"path",{d:!0,fill:!0}),A(s).forEach(_),a=Ee(h,"path",{d:!0,fill:!0}),A(a).forEach(_),h.forEach(_),l=se(f),c=L(f,"DIV",{class:!0});var p=A(c);d=Ne(p,u),p.forEach(_),this.h()},h(){g(t,"d","m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z"),g(t,"fill","#0066da"),g(n,"d","m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z"),g(n,"fill","#00ac47"),g(r,"d","m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z"),g(r,"fill","#ea4335"),g(i,"d","m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z"),g(i,"fill","#00832d"),g(s,"d","m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z"),g(s,"fill","#2684fc"),g(a,"d","m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z"),g(a,"fill","#ffba00"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 87.3 78"),g(e,"class","w-5 h-5"),g(c,"class","line-clamp-1")},m(f,h){z(f,e,h),S(e,t),S(e,n),S(e,r),S(e,i),S(e,s),S(e,a),z(f,l,h),z(f,c,h),S(c,d)},p(f,h){h[0]&4096&&u!==(u=f[12].t("Google Drive")+"")&&Be(d,u)},d(f){f&&(_(e),_(l),_(c))}}}function Vc(o){let e,t;return e=new yf({props:{$$slots:{default:[fy]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&20544|r[1]&1&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function ly(o){let e,t,n,r,i,s,a,l,c,u,d,f,h,p,b,w,m,v,y,I,P,R,k,N=o[12].t("Microsoft OneDrive")+"",M;return{c(){e=Ce("svg"),t=Ce("mask"),n=Ce("path"),r=Ce("g"),i=Ce("path"),s=Ce("path"),a=Ce("path"),l=Ce("path"),c=Ce("defs"),u=Ce("linearGradient"),d=Ce("stop"),f=Ce("stop"),h=Ce("linearGradient"),p=Ce("stop"),b=Ce("stop"),w=Ce("linearGradient"),m=Ce("stop"),v=Ce("stop"),y=Ce("linearGradient"),I=Ce("stop"),P=Ce("stop"),R=ie(),k=U("div"),M=Oe(N),this.h()},l(H){e=Ee(H,"svg",{xmlns:!0,viewBox:!0,class:!0,fill:!0});var V=A(e);t=Ee(V,"mask",{id:!0,style:!0,maskUnits:!0,x:!0,y:!0,width:!0,height:!0});var Q=A(t);n=Ee(Q,"path",{d:!0,fill:!0}),A(n).forEach(_),Q.forEach(_),r=Ee(V,"g",{mask:!0});var J=A(r);i=Ee(J,"path",{d:!0,fill:!0}),A(i).forEach(_),s=Ee(J,"path",{d:!0,fill:!0}),A(s).forEach(_),a=Ee(J,"path",{d:!0,fill:!0}),A(a).forEach(_),l=Ee(J,"path",{d:!0,fill:!0}),A(l).forEach(_),J.forEach(_),c=Ee(V,"defs",{});var E=A(c);u=Ee(E,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var Y=A(u);d=Ee(Y,"stop",{"stop-color":!0}),A(d).forEach(_),f=Ee(Y,"stop",{offset:!0,"stop-color":!0}),A(f).forEach(_),Y.forEach(_),h=Ee(E,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var D=A(h);p=Ee(D,"stop",{"stop-color":!0}),A(p).forEach(_),b=Ee(D,"stop",{offset:!0,"stop-color":!0}),A(b).forEach(_),D.forEach(_),w=Ee(E,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var W=A(w);m=Ee(W,"stop",{"stop-color":!0}),A(m).forEach(_),v=Ee(W,"stop",{offset:!0,"stop-color":!0}),A(v).forEach(_),W.forEach(_),y=Ee(E,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var F=A(y);I=Ee(F,"stop",{"stop-color":!0}),A(I).forEach(_),P=Ee(F,"stop",{offset:!0,"stop-color":!0}),A(P).forEach(_),F.forEach(_),E.forEach(_),V.forEach(_),R=se(H),k=L(H,"DIV",{class:!0});var G=A(k);M=Ne(G,N),G.forEach(_),this.h()},h(){g(n,"d","M7.82979 26C3.50549 26 0 22.5675 0 18.3333C0 14.1921 3.35322 10.8179 7.54613 10.6716C9.27535 7.87166 12.4144 6 16 6C20.6308 6 24.5169 9.12183 25.5829 13.3335C29.1316 13.3603 32 16.1855 32 19.6667C32 23.0527 29 26 25.8723 25.9914L7.82979 26Z"),g(n,"fill","#C4C4C4"),g(t,"id","mask0_87_7796"),tt(t,"mask-type","alpha"),g(t,"maskUnits","userSpaceOnUse"),g(t,"x","0"),g(t,"y","6"),g(t,"width","32"),g(t,"height","20"),g(i,"d","M7.83017 26.0001C5.37824 26.0001 3.18957 24.8966 1.75391 23.1691L18.0429 16.3335L30.7089 23.4647C29.5926 24.9211 27.9066 26.0001 26.0004 25.9915C23.1254 26.0001 12.0629 26.0001 7.83017 26.0001Z"),g(i,"fill","url(#paint0_linear_87_7796)"),g(s,"d","M25.5785 13.3149L18.043 16.3334L30.709 23.4647C31.5199 22.4065 32.0004 21.0916 32.0004 19.6669C32.0004 16.1857 29.1321 13.3605 25.5833 13.3337C25.5817 13.3274 25.5801 13.3212 25.5785 13.3149Z"),g(s,"fill","url(#paint1_linear_87_7796)"),g(a,"d","M7.06445 10.7028L18.0423 16.3333L25.5779 13.3148C24.5051 9.11261 20.6237 6 15.9997 6C12.4141 6 9.27508 7.87166 7.54586 10.6716C7.3841 10.6773 7.22358 10.6877 7.06445 10.7028Z"),g(a,"fill","url(#paint2_linear_87_7796)"),g(l,"d","M1.7535 23.1687L18.0425 16.3331L7.06471 10.7026C3.09947 11.0792 0 14.3517 0 18.3331C0 20.1665 0.657197 21.8495 1.7535 23.1687Z"),g(l,"fill","url(#paint3_linear_87_7796)"),g(r,"mask","url(#mask0_87_7796)"),g(d,"stop-color","#2086B8"),g(f,"offset","1"),g(f,"stop-color","#46D3F6"),g(u,"id","paint0_linear_87_7796"),g(u,"x1","4.42591"),g(u,"y1","24.6668"),g(u,"x2","27.2309"),g(u,"y2","23.2764"),g(u,"gradientUnits","userSpaceOnUse"),g(p,"stop-color","#1694DB"),g(b,"offset","1"),g(b,"stop-color","#62C3FE"),g(h,"id","paint1_linear_87_7796"),g(h,"x1","23.8302"),g(h,"y1","19.6668"),g(h,"x2","30.2108"),g(h,"y2","15.2082"),g(h,"gradientUnits","userSpaceOnUse"),g(m,"stop-color","#0D3D78"),g(v,"offset","1"),g(v,"stop-color","#063B83"),g(w,"id","paint2_linear_87_7796"),g(w,"x1","8.51037"),g(w,"y1","7.33333"),g(w,"x2","23.3335"),g(w,"y2","15.9348"),g(w,"gradientUnits","userSpaceOnUse"),g(I,"stop-color","#16589B"),g(P,"offset","1"),g(P,"stop-color","#1464B7"),g(y,"id","paint3_linear_87_7796"),g(y,"x1","-0.340429"),g(y,"y1","19.9998"),g(y,"x2","14.5634"),g(y,"y2","14.4649"),g(y,"gradientUnits","userSpaceOnUse"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 32"),g(e,"class","w-5 h-5"),g(e,"fill","none"),g(k,"class","line-clamp-1")},m(H,V){z(H,e,V),S(e,t),S(t,n),S(e,r),S(r,i),S(r,s),S(r,a),S(r,l),S(e,c),S(c,u),S(u,d),S(u,f),S(c,h),S(h,p),S(h,b),S(c,w),S(w,m),S(w,v),S(c,y),S(y,I),S(y,P),z(H,R,V),z(H,k,V),S(k,M)},p(H,V){V[0]&4096&&N!==(N=H[12].t("Microsoft OneDrive")+"")&&Be(M,N)},d(H){H&&(_(e),_(R),_(k))}}}function cy(o){let e,t=o[12].t("Microsoft OneDrive (personal)")+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","line-clamp-1")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i[0]&4096&&t!==(t=r[12].t("Microsoft OneDrive (personal)")+"")&&Be(n,t)},d(r){r&&_(e)}}}function uy(o){let e,t,n=o[12].t("Microsoft OneDrive (work/school)")+"",r,i,s,a="Includes SharePoint";return{c(){e=U("div"),t=U("div"),r=Oe(n),i=ie(),s=U("div"),s.textContent=a,this.h()},l(l){e=L(l,"DIV",{class:!0});var c=A(e);t=L(c,"DIV",{class:!0});var u=A(t);r=Ne(u,n),u.forEach(_),i=se(c),s=L(c,"DIV",{class:!0,"data-svelte-h":!0}),dn(s)!=="svelte-1rwtj43"&&(s.textContent=a),c.forEach(_),this.h()},h(){g(t,"class","line-clamp-1"),g(s,"class","text-xs text-gray-500"),g(e,"class","flex flex-col")},m(l,c){z(l,e,c),S(e,t),S(t,r),S(e,i),S(e,s)},p(l,c){c[0]&4096&&n!==(n=l[12].t("Microsoft OneDrive (work/school)")+"")&&Be(r,n)},d(l){l&&_(e)}}}function dy(o){let e,t,n,r;return e=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$slots:{default:[cy]},$$scope:{ctx:o}}}),e.$on("click",o[27]),n=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$slots:{default:[uy]},$$scope:{ctx:o}}}),n.$on("click",o[28]),{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment)},l(i){oe(e.$$.fragment,i),t=se(i),oe(n.$$.fragment,i)},m(i,s){ee(e,i,s),z(i,t,s),ee(n,i,s),r=!0},p(i,s){const a={};s[0]&4096|s[1]&1&&(a.$$scope={dirty:s,ctx:i}),e.$set(a);const l={};s[0]&4096|s[1]&1&&(l.$$scope={dirty:s,ctx:i}),n.$set(l)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),O(n.$$.fragment,i),r=!1},d(i){i&&_(t),te(e,i),te(n,i)}}}function fy(o){let e,t,n,r;return e=new wf({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl w-full",$$slots:{default:[ly]},$$scope:{ctx:o}}}),n=new vf({props:{class:"w-[calc(100vw-2rem)] max-w-[280px] rounded-xl px-1 py-1 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-sm",side:o[14]?"bottom":"right",sideOffset:o[14]?5:0,alignOffset:o[14]?0:-8,$$slots:{default:[dy]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment)},l(i){oe(e.$$.fragment,i),t=se(i),oe(n.$$.fragment,i)},m(i,s){ee(e,i,s),z(i,t,s),ee(n,i,s),r=!0},p(i,s){const a={};s[0]&4096|s[1]&1&&(a.$$scope={dirty:s,ctx:i}),e.$set(a);const l={};s[0]&16384&&(l.side=i[14]?"bottom":"right"),s[0]&16384&&(l.sideOffset=i[14]?5:0),s[0]&16384&&(l.alignOffset=i[14]?0:-8),s[0]&4160|s[1]&1&&(l.$$scope={dirty:s,ctx:i}),n.$set(l)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),O(n.$$.fragment,i),r=!1},d(i){i&&_(t),te(e,i),te(n,i)}}}function hy(o){let e=Object.keys(o[9]).length>0,t,n,r,i,s,a,l,c=e&&Uc(o);n=new Ft({props:{content:o[2].length!==o[1].length?o[12].t("Model(s) do not support file upload"):o[11]?"":o[12].t("You do not have permission to upload files."),className:"w-full",$$slots:{default:[ry]},$$scope:{ctx:o}}}),i=new Ft({props:{content:o[2].length!==o[1].length?o[12].t("Model(s) do not support file upload"):o[11]?"":o[12].t("You do not have permission to upload files."),className:"w-full",$$slots:{default:[sy]},$$scope:{ctx:o}}});let u=o[11]&&zc(o);return{c(){c&&c.c(),t=ie(),$(n.$$.fragment),r=ie(),$(i.$$.fragment),s=ie(),u&&u.c(),a=Ve()},l(d){c&&c.l(d),t=se(d),oe(n.$$.fragment,d),r=se(d),oe(i.$$.fragment,d),s=se(d),u&&u.l(d),a=Ve()},m(d,f){c&&c.m(d,f),z(d,t,f),ee(n,d,f),z(d,r,f),ee(i,d,f),z(d,s,f),u&&u.m(d,f),z(d,a,f),l=!0},p(d,f){f[0]&512&&(e=Object.keys(d[9]).length>0),e?c?(c.p(d,f),f[0]&512&&T(c,1)):(c=Uc(d),c.c(),T(c,1),c.m(t.parentNode,t)):c&&(Re(),O(c,1,1,()=>{c=null}),Me());const h={};f[0]&6150&&(h.content=d[2].length!==d[1].length?d[12].t("Model(s) do not support file upload"):d[11]?"":d[12].t("You do not have permission to upload files.")),f[0]&6152|f[1]&1&&(h.$$scope={dirty:f,ctx:d}),n.$set(h);const p={};f[0]&6150&&(p.content=d[2].length!==d[1].length?d[12].t("Model(s) do not support file upload"):d[11]?"":d[12].t("You do not have permission to upload files.")),f[0]&6160|f[1]&1&&(p.$$scope={dirty:f,ctx:d}),i.$set(p),d[11]?u?(u.p(d,f),f[0]&2048&&T(u,1)):(u=zc(d),u.c(),T(u,1),u.m(a.parentNode,a)):u&&(Re(),O(u,1,1,()=>{u=null}),Me())},i(d){l||(T(c),T(n.$$.fragment,d),T(i.$$.fragment,d),T(u),l=!0)},o(d){O(c),O(n.$$.fragment,d),O(i.$$.fragment,d),O(u),l=!1},d(d){d&&(_(t),_(r),_(s),_(a)),c&&c.d(d),te(n,d),te(i,d),u&&u.d(d)}}}function gy(o){let e,t,n;return t=new za({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-sm",sideOffset:10,alignOffset:-8,side:"top",align:"start",transition:ks,$$slots:{default:[hy]},$$scope:{ctx:o}}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{slot:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"slot","content")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i[0]&32383|i[1]&1&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function my(o){let e,t,n,r,i,s,a;function l(u){o[29](u)}let c={$$slots:{content:[gy],default:[ty]},$$scope:{ctx:o}};return o[8]!==void 0&&(c.show=o[8]),n=new Fa({props:c}),ze.push(()=>Ze(n,"show",l)),n.$on("change",o[30]),{c(){e=U("input"),t=ie(),$(n.$$.fragment),this.h()},l(u){e=L(u,"INPUT",{id:!0,type:!0,accept:!0,capture:!0,style:!0}),t=se(u),oe(n.$$.fragment,u),this.h()},h(){g(e,"id","camera-input"),g(e,"type","file"),g(e,"accept","image/*"),g(e,"capture","environment"),tt(e,"display","none")},m(u,d){z(u,e,d),z(u,t,d),ee(n,u,d),i=!0,s||(a=Ae(e,"change",o[17]),s=!0)},p(u,d){const f={};d[0]&32383|d[1]&1&&(f.$$scope={dirty:d,ctx:u}),!r&&d[0]&256&&(r=!0,f.show=u[8],Je(()=>r=!1)),n.$set(f)},i(u){i||(T(n.$$.fragment,u),i=!0)},o(u){O(n.$$.fragment,u),i=!1},d(u){u&&(_(e),_(t)),te(n,u),s=!1,a()}}}function py(o,e,t){let n,r,i,s,a;de(o,Xo,j=>t(32,n=j)),de(o,bo,j=>t(19,r=j)),de(o,Ar,j=>t(13,s=j)),de(o,Ti,j=>t(14,a=j));let{$$slots:l={},$$scope:c}=e;const u=rn("i18n");de(o,u,j=>t(12,i=j));let{selectedToolIds:d=[]}=e,{selectedModels:f=[]}=e,{fileUploadCapableModels:h=[]}=e,{screenCaptureHandler:p}=e,{uploadFilesHandler:b}=e,{inputFilesHandler:w}=e,{uploadGoogleDriveHandler:m}=e,{uploadOneDriveHandler:v}=e,{onClose:y}=e,I={},P=!1,R=!1,k=!0;const N=async()=>{n===null&&await Xo.set(await Ba(localStorage.token)),t(9,I=n.reduce((j,re,ue,X)=>(j[re.id]={name:re.name,description:re.meta.description,enabled:d.includes(re.id)},j),{}))},M=()=>{const j=navigator.userAgent||navigator.vendor||window.opera;return/android|iphone|ipad|ipod|windows phone/i.test(j)};function H(j){var ue;const re=Array.from((ue=j.target)==null?void 0:ue.files);re&&re.length>0&&w(re)}const V=async(j,re)=>{const ue=re.detail;await $e(),ue?t(0,d=[...d,j]):t(0,d=d.filter(X=>X!==j))},Q=j=>{t(9,I[j].enabled=!I[j].enabled,I)},J=()=>{t(10,R=!R)},E=()=>{if(k)if(!M())p();else{const j=document.getElementById("camera-input");j&&j.click()}},Y=()=>{k&&b()},D=()=>{m()},W=()=>{v("personal")},F=()=>{v("organizations")};function G(j){P=j,t(8,P)}const K=j=>{j.detail===!1&&y()};return o.$$set=j=>{"selectedToolIds"in j&&t(0,d=j.selectedToolIds),"selectedModels"in j&&t(1,f=j.selectedModels),"fileUploadCapableModels"in j&&t(2,h=j.fileUploadCapableModels),"screenCaptureHandler"in j&&t(3,p=j.screenCaptureHandler),"uploadFilesHandler"in j&&t(4,b=j.uploadFilesHandler),"inputFilesHandler"in j&&t(18,w=j.inputFilesHandler),"uploadGoogleDriveHandler"in j&&t(5,m=j.uploadGoogleDriveHandler),"uploadOneDriveHandler"in j&&t(6,v=j.uploadOneDriveHandler),"onClose"in j&&t(7,y=j.onClose),"$$scope"in j&&t(31,c=j.$$scope)},o.$$.update=()=>{var j,re;o.$$.dirty[0]&256&&P&&N(),o.$$.dirty[0]&524294&&t(11,k=h.length===f.length&&((r==null?void 0:r.role)==="admin"||((re=(j=r==null?void 0:r.permissions)==null?void 0:j.chat)==null?void 0:re.file_upload)))},[d,f,h,p,b,m,v,y,P,I,R,k,i,s,a,u,M,H,w,r,l,V,Q,J,E,Y,D,W,F,G,K,c]}class _y extends We{constructor(e){super(),Ye(this,e,py,my,Qe,{selectedToolIds:0,selectedModels:1,fileUploadCapableModels:2,screenCaptureHandler:3,uploadFilesHandler:4,inputFilesHandler:18,uploadGoogleDriveHandler:5,uploadOneDriveHandler:6,onClose:7},null,[-1,-1])}}function Kc(o,e,t){const n=o.slice();return n[0]=e[t],n[16]=t,n}function Gc(o){let e,t,n,r,i,s,a,l='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>',c,u,d=o[3].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"",f,h=yt(o[2]),p=[];for(let b=0;b<h.length;b+=1)p[b]=Wc(Kc(o,h,b));return{c(){e=U("div"),t=U("div"),n=U("div"),r=U("div");for(let b=0;b<p.length;b+=1)p[b].c();i=ie(),s=U("div"),a=U("div"),a.innerHTML=l,c=ie(),u=U("div"),f=Oe(d),this.h()},l(b){e=L(b,"DIV",{id:!0,class:!0});var w=A(e);t=L(w,"DIV",{class:!0});var m=A(t);n=L(m,"DIV",{class:!0});var v=A(n);r=L(v,"DIV",{class:!0,id:!0});var y=A(r);for(let R=0;R<p.length;R+=1)p[R].l(y);y.forEach(_),i=se(v),s=L(v,"DIV",{class:!0});var I=A(s);a=L(I,"DIV",{"data-svelte-h":!0}),dn(a)!=="svelte-cdi12d"&&(a.innerHTML=l),c=se(I),u=L(I,"DIV",{class:!0});var P=A(u);f=Ne(P,d),P.forEach(_),I.forEach(_),v.forEach(_),m.forEach(_),w.forEach(_),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 space-y-0.5 scrollbar-hidden max-h-60"),g(r,"id","command-options-container"),g(u,"class","line-clamp-1"),g(s,"class","px-2 pt-0.5 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-b-xl flex items-center space-x-1"),g(n,"class","flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(b,w){z(b,e,w),S(e,t),S(t,n),S(n,r);for(let m=0;m<p.length;m+=1)p[m]&&p[m].m(r,null);S(n,i),S(n,s),S(s,a),S(s,c),S(s,u),S(u,f)},p(b,w){if(w&38){h=yt(b[2]);let m;for(m=0;m<h.length;m+=1){const v=Kc(b,h,m);p[m]?p[m].p(v,w):(p[m]=Wc(v),p[m].c(),p[m].m(r,null))}for(;m<p.length;m+=1)p[m].d(1);p.length=h.length}w&8&&d!==(d=b[3].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"")&&Be(f,d)},d(b){b&&_(e),Hn(p,b)}}}function Wc(o){let e,t,n=o[0].command+"",r,i,s,a=o[0].title+"",l,c,u,d,f;function h(){return o[11](o[0])}function p(){return o[12](o[16])}return{c(){e=U("button"),t=U("div"),r=Oe(n),i=ie(),s=U("div"),l=Oe(a),c=ie(),this.h()},l(b){e=L(b,"BUTTON",{class:!0,type:!0});var w=A(e);t=L(w,"DIV",{class:!0});var m=A(t);r=Ne(m,n),m.forEach(_),i=se(w),s=L(w,"DIV",{class:!0});var v=A(s);l=Ne(v,a),v.forEach(_),c=se(w),w.forEach(_),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100"),g(s,"class","text-xs text-gray-600 dark:text-gray-100"),g(e,"class",u="px-3 py-1.5 rounded-xl w-full text-left "+(o[16]===o[1]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":"")),g(e,"type","button")},m(b,w){z(b,e,w),S(e,t),S(t,r),S(e,i),S(e,s),S(s,l),S(e,c),d||(f=[Ae(e,"click",h),Ae(e,"mousemove",p),Ae(e,"focus",yy)],d=!0)},p(b,w){o=b,w&4&&n!==(n=o[0].command+"")&&Be(r,n),w&4&&a!==(a=o[0].title+"")&&Be(l,a),w&2&&u!==(u="px-3 py-1.5 rounded-xl w-full text-left "+(o[16]===o[1]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":""))&&g(e,"class",u)},d(b){b&&_(e),d=!1,wn(f)}}}function by(o){let e,t=o[2].length>0&&Gc(o);return{c(){t&&t.c(),e=Ve()},l(n){t&&t.l(n),e=Ve()},m(n,r){t&&t.m(n,r),z(n,e,r)},p(n,[r]){n[2].length>0?t?t.p(n,r):(t=Gc(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ue,o:Ue,d(n){n&&_(e),t&&t.d(n)}}}const yy=()=>{};function wy(o,e,t){let n,r,i,s;de(o,qn,v=>t(13,n=v)),de(o,bo,v=>t(14,r=v)),de(o,gf,v=>t(10,s=v));const a=rn("i18n");de(o,a,v=>t(3,i=v));let{files:l}=e,{prompt:c=""}=e,{command:u=""}=e,d=0,f=[];const h=()=>{t(1,d=Math.max(0,d-1))},p=()=>{t(1,d=Math.min(d+1,f.length-1))},b=async v=>{let y=v.content;if(v.content.includes("{{CLIPBOARD}}")){const M=await navigator.clipboard.readText().catch(Q=>(rt.error(i.t("Failed to read clipboard contents")),"{{CLIPBOARD}}")),H=await navigator.clipboard.read();let V=null;for(const Q of H)for(const J of Q.types)if(J.startsWith("image/")){const E=await Q.getType(J);V=URL.createObjectURL(E)}V&&t(6,l=[...l,{type:"image",url:V}]),y=y.replaceAll("{{CLIPBOARD}}",M)}if(v.content.includes("{{USER_LOCATION}}")){let M;try{M=await Sm()}catch{rt.error(i.t("Location access not allowed")),M="LOCATION_UNKNOWN"}y=y.replaceAll("{{USER_LOCATION}}",String(M))}if(v.content.includes("{{USER_NAME}}")){const M=(r==null?void 0:r.name)||"User";y=y.replaceAll("{{USER_NAME}}",M)}if(v.content.includes("{{USER_LANGUAGE}}")){const M=localStorage.getItem("locale")||"en-US";y=y.replaceAll("{{USER_LANGUAGE}}",M)}if(v.content.includes("{{CURRENT_DATE}}")){const M=Am();y=y.replaceAll("{{CURRENT_DATE}}",M)}if(v.content.includes("{{CURRENT_TIME}}")){const M=Rm();y=y.replaceAll("{{CURRENT_TIME}}",M)}if(v.content.includes("{{CURRENT_DATETIME}}")){const M=Mm();y=y.replaceAll("{{CURRENT_DATETIME}}",M)}if(v.content.includes("{{CURRENT_TIMEZONE}}")){const M=Pm();y=y.replaceAll("{{CURRENT_TIMEZONE}}",M)}if(v.content.includes("{{CURRENT_WEEKDAY}}")){const M=Om();y=y.replaceAll("{{CURRENT_WEEKDAY}}",M)}const I=c.split(`
`),R=I.pop().split(" ");R.pop(),(n==null?void 0:n.richTextInput)??!0?(R.push(`${y.replace(/</g,"&lt;").replace(/>/g,"&gt;").replaceAll(`
`,"<br/>")}`),I.push(R.join(" ")),t(0,c=I.join("<br/>"))):(R.push(y),I.push(R.join(" ")),t(0,c=I.join(`
`)));const k=document.getElementById("chat-input-container"),N=document.getElementById("chat-input");if(await $e(),k&&(k.scrollTop=k.scrollHeight),await $e(),N){N.focus(),N.dispatchEvent(new Event("input"));const M=bf(c);if(M.length>0){const H=M.at(0),V=c;t(0,c=c.substring(0,(H==null?void 0:H.endIndex)+1)),await $e(),N.scrollTop=N.scrollHeight,t(0,c=V),await $e(),N.setSelectionRange(H==null?void 0:H.startIndex,H.endIndex+1)}else N.scrollTop=N.scrollHeight}},w=v=>{b(v)},m=v=>{t(1,d=v)};return o.$$set=v=>{"files"in v&&t(6,l=v.files),"prompt"in v&&t(0,c=v.prompt),"command"in v&&t(7,u=v.command)},o.$$.update=()=>{o.$$.dirty&1152&&t(2,f=s.filter(v=>v.command.toLowerCase().includes(u.toLowerCase())).sort((v,y)=>v.title.localeCompare(y.title))),o.$$.dirty&128&&u&&t(1,d=0)},[c,d,f,i,a,b,l,u,h,p,s,w,m]}class vy extends We{constructor(e){super(),Ye(this,e,wy,by,Qe,{files:6,prompt:0,command:7,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function Yc(o,e,t){const n=o.slice();return n[20]=e[t],n[22]=t,n}function qc(o){let e,t,n,r,i,s,a,l=yt(o[2]),c=[];for(let h=0;h<l.length;h+=1)c[h]=jc(Yc(o,l,h));function u(h,p){var b,w;if(p&1&&(s=null),p&1&&(a=null),s==null&&(s=!!h[0].split(" ").some(Ry)),s)return Sy;if(a==null&&(a=!!((w=(b=h[0].split(" "))==null?void 0:b.at(0))!=null&&w.substring(1).startsWith("http"))),a)return Ty}let d=u(o,-1),f=d&&d(o);return{c(){e=U("div"),t=U("div"),n=U("div"),r=U("div");for(let h=0;h<c.length;h+=1)c[h].c();i=ie(),f&&f.c(),this.h()},l(h){e=L(h,"DIV",{id:!0,class:!0});var p=A(e);t=L(p,"DIV",{class:!0});var b=A(t);n=L(b,"DIV",{class:!0});var w=A(n);r=L(w,"DIV",{class:!0,id:!0});var m=A(r);for(let v=0;v<c.length;v+=1)c[v].l(m);i=se(m),f&&f.l(m),m.forEach(_),w.forEach(_),b.forEach(_),p.forEach(_),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden max-h-60"),g(r,"id","command-options-container"),g(n,"class","flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(h,p){z(h,e,p),S(e,t),S(t,n),S(n,r);for(let b=0;b<c.length;b+=1)c[b]&&c[b].m(r,null);S(r,i),f&&f.m(r,null)},p(h,p){if(p&294){l=yt(h[2]);let b;for(b=0;b<l.length;b+=1){const w=Yc(h,l,b);c[b]?c[b].p(w,p):(c[b]=jc(w),c[b].c(),c[b].m(r,i))}for(;b<c.length;b+=1)c[b].d(1);c.length=l.length}d===(d=u(h,p))&&f?f.p(h,p):(f&&f.d(1),f=d&&d(h),f&&(f.c(),f.m(r,null)))},d(h){h&&_(e),Hn(c,h),f&&f.d()}}}function ky(o){let e,t="Collection";return{c(){e=U("div"),e.textContent=t,this.h()},l(n){e=L(n,"DIV",{class:!0,"data-svelte-h":!0}),dn(e)!=="svelte-1j93cxc"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-green-500/20 text-green-700 dark:text-green-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){z(n,e,r)},d(n){n&&_(e)}}}function Cy(o){let e,t="File";return{c(){e=U("div"),e.textContent=t,this.h()},l(n){e=L(n,"DIV",{class:!0,"data-svelte-h":!0}),dn(e)!=="svelte-dn3g9i"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){z(n,e,r)},d(n){n&&_(e)}}}function Ey(o){let e,t="Document";return{c(){e=U("div"),e.textContent=t,this.h()},l(n){e=L(n,"DIV",{class:!0,"data-svelte-h":!0}),dn(e)!=="svelte-2kpkct"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){z(n,e,r)},d(n){n&&_(e)}}}function Iy(o){let e,t="Legacy";return{c(){e=U("div"),e.textContent=t,this.h()},l(n){e=L(n,"DIV",{class:!0,"data-svelte-h":!0}),dn(e)!=="svelte-8uyvzr"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){z(n,e,r)},d(n){n&&_(e)}}}function jc(o){var I,P;let e,t,n,r,i,s=o[8]((I=o[20])==null?void 0:I.name)+"",a,l,c,u=((P=o[20])==null?void 0:P.description)+"",d,f,h,p;function b(R,k){var N,M,H;return R[20].legacy?Iy:(M=(N=R[20])==null?void 0:N.meta)!=null&&M.document?Ey:((H=R[20])==null?void 0:H.type)==="file"?Cy:ky}let w=b(o),m=w(o);function v(){return o[14](o[20])}function y(){return o[15](o[22])}return{c(){e=U("button"),t=U("div"),n=U("div"),m.c(),r=ie(),i=U("div"),a=Oe(s),l=ie(),c=U("div"),d=Oe(u),this.h()},l(R){e=L(R,"BUTTON",{class:!0,type:!0});var k=A(e);t=L(k,"DIV",{});var N=A(t);n=L(N,"DIV",{class:!0});var M=A(n);m.l(M),r=se(M),i=L(M,"DIV",{class:!0});var H=A(i);a=Ne(H,s),H.forEach(_),M.forEach(_),l=se(N),c=L(N,"DIV",{class:!0});var V=A(c);d=Ne(V,u),V.forEach(_),N.forEach(_),k.forEach(_),this.h()},h(){g(i,"class","line-clamp-1"),g(n,"class","font-medium text-black dark:text-gray-100 flex items-center gap-1"),g(c,"class","text-xs text-gray-600 dark:text-gray-100 line-clamp-1"),g(e,"class",f="px-3 py-1.5 rounded-xl w-full text-left flex justify-between items-center "+(o[22]===o[1]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":"")),g(e,"type","button")},m(R,k){z(R,e,k),S(e,t),S(t,n),m.m(n,null),S(n,r),S(n,i),S(i,a),S(t,l),S(t,c),S(c,d),h||(p=[Ae(e,"click",v),Ae(e,"mousemove",y)],h=!0)},p(R,k){var N,M;o=R,w!==(w=b(o))&&(m.d(1),m=w(o),m&&(m.c(),m.m(n,r))),k&4&&s!==(s=o[8]((N=o[20])==null?void 0:N.name)+"")&&Be(a,s),k&4&&u!==(u=((M=o[20])==null?void 0:M.description)+"")&&Be(d,u),k&2&&f!==(f="px-3 py-1.5 rounded-xl w-full text-left flex justify-between items-center "+(o[22]===o[1]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":""))&&g(e,"class",f)},d(R){R&&_(e),m.d(),h=!1,wn(p)}}}function Ty(o){var d,f;let e,t,n=((f=(d=o[0].split(" "))==null?void 0:d.at(0))==null?void 0:f.substring(1))+"",r,i,s,a=o[3].t("Web")+"",l,c,u;return{c(){e=U("button"),t=U("div"),r=Oe(n),i=ie(),s=U("div"),l=Oe(a),this.h()},l(h){e=L(h,"BUTTON",{class:!0,type:!0});var p=A(e);t=L(p,"DIV",{class:!0});var b=A(t);r=Ne(b,n),b.forEach(_),i=se(p),s=L(p,"DIV",{class:!0});var w=A(s);l=Ne(w,a),w.forEach(_),p.forEach(_),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),g(s,"class","text-xs text-gray-600 line-clamp-1"),g(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button"),g(e,"type","button")},m(h,p){z(h,e,p),S(e,t),S(t,r),S(e,i),S(e,s),S(s,l),c||(u=Ae(e,"click",o[17]),c=!0)},p(h,p){var b,w;p&1&&n!==(n=((w=(b=h[0].split(" "))==null?void 0:b.at(0))==null?void 0:w.substring(1))+"")&&Be(r,n),p&8&&a!==(a=h[3].t("Web")+"")&&Be(l,a)},d(h){h&&_(e),c=!1,u()}}}function Sy(o){var d,f;let e,t,n=((f=(d=o[0].split(" "))==null?void 0:d.at(0))==null?void 0:f.substring(1))+"",r,i,s,a=o[3].t("Youtube")+"",l,c,u;return{c(){e=U("button"),t=U("div"),r=Oe(n),i=ie(),s=U("div"),l=Oe(a),this.h()},l(h){e=L(h,"BUTTON",{class:!0,type:!0});var p=A(e);t=L(p,"DIV",{class:!0});var b=A(t);r=Ne(b,n),b.forEach(_),i=se(p),s=L(p,"DIV",{class:!0});var w=A(s);l=Ne(w,a),w.forEach(_),p.forEach(_),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),g(s,"class","text-xs text-gray-600 line-clamp-1"),g(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button"),g(e,"type","button")},m(h,p){z(h,e,p),S(e,t),S(t,r),S(e,i),S(e,s),S(s,l),c||(u=Ae(e,"click",o[16]),c=!0)},p(h,p){var b,w;p&1&&n!==(n=((w=(b=h[0].split(" "))==null?void 0:b.at(0))==null?void 0:w.substring(1))+"")&&Be(r,n),p&8&&a!==(a=h[3].t("Youtube")+"")&&Be(l,a)},d(h){h&&_(e),c=!1,u()}}}function Ay(o){var r,i;let e=o[2].length>0||((i=(r=o[0].split(" "))==null?void 0:r.at(0))==null?void 0:i.substring(1).startsWith("http")),t,n=e&&qc(o);return{c(){n&&n.c(),t=Ve()},l(s){n&&n.l(s),t=Ve()},m(s,a){n&&n.m(s,a),z(s,t,a)},p(s,[a]){var l,c;a&5&&(e=s[2].length>0||((c=(l=s[0].split(" "))==null?void 0:l.at(0))==null?void 0:c.substring(1).startsWith("http"))),e?n?n.p(s,a):(n=qc(s),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:Ue,o:Ue,d(s){s&&_(t),n&&n.d(s)}}}const Ry=o=>o.substring(1).startsWith("https://www.youtube.com")||o.substring(1).startsWith("https://youtu.be");function My(o,e,t){let n,r;de(o,mf,k=>t(18,n=k)),up.extend(dp);const i=rn("i18n");de(o,i,k=>t(3,r=k));let{prompt:s=""}=e,{command:a=""}=e;const l=On();let c=0,u=[],d=null,f=[];const h=()=>{t(1,c=Math.max(0,c-1))},p=()=>{t(1,c=Math.min(c+1,f.length-1))},b=async k=>{l("select",k),t(0,s=Ji(s,a));const N=document.getElementById("chat-input");await $e(),N==null||N.focus(),await $e()},w=async k=>{l("url",k),t(0,s=Ji(s,a));const N=document.getElementById("chat-input");await $e(),N==null||N.focus(),await $e()},m=async k=>{l("youtube",k),t(0,s=Ji(s,a));const N=document.getElementById("chat-input");await $e(),N==null||N.focus(),await $e()};Qn(()=>{let k=n.filter(V=>{var Q;return(Q=V==null?void 0:V.meta)==null?void 0:Q.document}).map(V=>({...V,type:"file"})),N=k.length>0?[{name:"All Documents",legacy:!0,type:"collection",description:"Deprecated (legacy collection), please create a new knowledge base.",title:r.t("All Documents"),collection_names:k.map(V=>V.id)},...k.reduce((V,Q)=>{var J;return[...new Set([...V,...(((J=Q==null?void 0:Q.meta)==null?void 0:J.tags)??[]).map(E=>E.name)])]},[]).map(V=>({name:V,legacy:!0,type:"collection",description:"Deprecated (legacy collection), please create a new knowledge base.",collection_names:k.filter(Q=>{var J;return(((J=Q==null?void 0:Q.meta)==null?void 0:J.tags)??[]).map(E=>E.name).includes(V)}).map(Q=>Q.id)}))]:[],M=n.filter(V=>{var Q;return!((Q=V==null?void 0:V.meta)!=null&&Q.document)}).map(V=>({...V,type:"collection"})),H=n.length>0?[...n.reduce((V,Q)=>[...new Set([...V,...((Q==null?void 0:Q.files)??[]).map(J=>({...J,collection:{name:Q.name,description:Q.description}}))])],[]).map(V=>{var Q,J,E;return{...V,name:(Q=V==null?void 0:V.meta)==null?void 0:Q.name,description:`${(J=V==null?void 0:V.collection)==null?void 0:J.name} - ${(E=V==null?void 0:V.collection)==null?void 0:E.description}`,type:"file"}})]:[];t(12,u=[...M,...H,...N,...k].map(V=>{var Q,J;return{...V,...V!=null&&V.legacy||(Q=V==null?void 0:V.meta)!=null&&Q.legacy||(J=V==null?void 0:V.meta)!=null&&J.document?{legacy:!0}:{}}})),t(13,d=new kf(u,{keys:["name","description"]}))});const v=k=>{try{return decodeURIComponent(k)}catch{return k}},y=k=>{b(k)},I=k=>{t(1,c=k)},P=()=>{var N,M;const k=(M=(N=s.split(" "))==null?void 0:N.at(0))==null?void 0:M.substring(1);ql(k)?m(k):rt.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))},R=()=>{var N,M;const k=(M=(N=s.split(" "))==null?void 0:N.at(0))==null?void 0:M.substring(1);ql(k)?w(k):rt.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))};return o.$$set=k=>{"prompt"in k&&t(0,s=k.prompt),"command"in k&&t(9,a=k.command)},o.$$.update=()=>{o.$$.dirty&12800&&d&&t(2,f=a.slice(1)?d.search(a).map(k=>k.item):u),o.$$.dirty&512&&a&&t(1,c=0)},[s,c,f,r,i,b,w,m,v,a,h,p,u,d,y,I,P,R]}class Py extends We{constructor(e){super(),Ye(this,e,My,Ay,Qe,{prompt:0,command:9,selectUp:10,selectDown:11})}get selectUp(){return this.$$.ctx[10]}get selectDown(){return this.$$.ctx[11]}}function Qc(o,e,t){const n=o.slice();return n[12]=e[t],n[14]=t,n}function Xc(o){let e,t,n,r,i=yt(o[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Jc(Qc(o,i,a));return{c(){e=U("div"),t=U("div"),n=U("div"),r=U("div");for(let a=0;a<s.length;a+=1)s[a].c();this.h()},l(a){e=L(a,"DIV",{id:!0,class:!0});var l=A(e);t=L(l,"DIV",{class:!0});var c=A(t);n=L(c,"DIV",{class:!0});var u=A(n);r=L(u,"DIV",{class:!0,id:!0});var d=A(r);for(let f=0;f<s.length;f+=1)s[f].l(d);d.forEach(_),u.forEach(_),c.forEach(_),l.forEach(_),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden max-h-60"),g(r,"id","command-options-container"),g(n,"class","flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(a,l){z(a,e,l),S(e,t),S(t,n),S(n,r);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(r,null)},p(a,l){if(l&7){i=yt(a[1]);let c;for(c=0;c<i.length;c+=1){const u=Qc(a,i,c);s[c]?s[c].p(u,l):(s[c]=Jc(u),s[c].c(),s[c].m(r,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=i.length}},d(a){a&&_(e),Hn(s,a)}}}function Jc(o){let e,t,n,r,i,s,a=o[12].name+"",l,c,u,d,f;function h(){return o[7](o[12])}function p(){return o[8](o[14])}return{c(){e=U("button"),t=U("div"),n=U("img"),s=ie(),l=Oe(a),c=ie(),this.h()},l(b){e=L(b,"BUTTON",{class:!0,type:!0});var w=A(e);t=L(w,"DIV",{class:!0});var m=A(t);n=L(m,"IMG",{src:!0,alt:!0,class:!0}),s=se(m),l=Ne(m,a),m.forEach(_),c=se(w),w.forEach(_),this.h()},h(){var b,w,m,v;oo(n.src,r=((m=(w=(b=o[12])==null?void 0:b.info)==null?void 0:w.meta)==null?void 0:m.profile_image_url)??"/static/favicon.png")||g(n,"src",r),g(n,"alt",i=((v=o[12])==null?void 0:v.name)??o[12].id),g(n,"class","rounded-full size-6 items-center mr-2"),g(t,"class","flex font-medium text-black dark:text-gray-100 line-clamp-1"),g(e,"class",u="px-3 py-1.5 rounded-xl w-full text-left "+(o[14]===o[0]?"bg-gray-50 dark:bg-gray-850 selected-command-option-button":"")),g(e,"type","button")},m(b,w){z(b,e,w),S(e,t),S(t,n),S(t,s),S(t,l),S(e,c),d||(f=[Ae(e,"click",h),Ae(e,"mousemove",p),Ae(e,"focus",Ny)],d=!0)},p(b,w){var m,v,y,I;o=b,w&2&&!oo(n.src,r=((y=(v=(m=o[12])==null?void 0:m.info)==null?void 0:v.meta)==null?void 0:y.profile_image_url)??"/static/favicon.png")&&g(n,"src",r),w&2&&i!==(i=((I=o[12])==null?void 0:I.name)??o[12].id)&&g(n,"alt",i),w&2&&a!==(a=o[12].name+"")&&Be(l,a),w&1&&u!==(u="px-3 py-1.5 rounded-xl w-full text-left "+(o[14]===o[0]?"bg-gray-50 dark:bg-gray-850 selected-command-option-button":""))&&g(e,"class",u)},d(b){b&&_(e),d=!1,wn(f)}}}function Oy(o){let e,t=o[1].length>0&&Xc(o);return{c(){t&&t.c(),e=Ve()},l(n){t&&t.l(n),e=Ve()},m(n,r){t&&t.m(n,r),z(n,e,r)},p(n,[r]){n[1].length>0?t?t.p(n,r):(t=Xc(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ue,o:Ue,d(n){n&&_(e),t&&t.d(n)}}}const Ny=()=>{};function Dy(o,e,t){let n;de(o,nr,p=>t(6,n=p)),rn("i18n");const r=On();let{command:i=""}=e,s=0,a=[],l=new kf(n.filter(p=>{var b,w;return!((w=(b=p==null?void 0:p.info)==null?void 0:b.meta)!=null&&w.hidden)}).map(p=>{var w,m,v,y,I;return{...p,modelName:p==null?void 0:p.name,tags:(v=(m=(w=p==null?void 0:p.info)==null?void 0:w.meta)==null?void 0:m.tags)==null?void 0:v.map(P=>P.name).join(" "),desc:(I=(y=p==null?void 0:p.info)==null?void 0:y.meta)==null?void 0:I.description}}),{keys:["value","tags","modelName"],threshold:.3});const c=()=>{t(0,s=Math.max(0,s-1))},u=()=>{t(0,s=Math.min(s+1,a.length-1))},d=async p=>{t(3,i=""),r("select",p)};Qn(async()=>{await $e();const p=document.getElementById("chat-input");await $e(),p==null||p.focus(),await $e()});const f=p=>{d(p)},h=p=>{t(0,s=p)};return o.$$set=p=>{"command"in p&&t(3,i=p.command)},o.$$.update=()=>{o.$$.dirty&72&&t(1,a=i.slice(1)?l.search(i).map(p=>p.item):n.filter(p=>{var b,w;return!((w=(b=p==null?void 0:p.info)==null?void 0:b.meta)!=null&&w.hidden)})),o.$$.dirty&8&&i&&t(0,s=0)},[s,a,d,i,c,u,n,f,h]}class Hy extends We{constructor(e){super(),Ye(this,e,Dy,Oy,Qe,{command:3,selectUp:4,selectDown:5})}get selectUp(){return this.$$.ctx[4]}get selectDown(){return this.$$.ctx[5]}}function Zc(o){let e,t,n,r;const i=[Ly,Uy],s=[];function a(l,c){return l[4]?1:0}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=Ve()},l(l){t.l(l),n=Ve()},m(l,c){s[e].m(l,c),z(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?s[e].p(l,c):(Re(),O(s[u],1,1,()=>{s[u]=null}),Me(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){O(t),r=!1},d(l){l&&_(n),s[e].d(l)}}}function Uy(o){let e,t,n,r,i;return r=new Cs({}),{c(){e=U("div"),t=U("div"),n=U("div"),$(r.$$.fragment),this.h()},l(s){e=L(s,"DIV",{id:!0,class:!0});var a=A(e);t=L(a,"DIV",{class:!0});var l=A(t);n=L(l,"DIV",{class:!0});var c=A(n);oe(r.$$.fragment,c),c.forEach(_),l.forEach(_),a.forEach(_),this.h()},h(){g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(s,a){z(s,e,a),S(e,t),S(t,n),ee(r,n,null),i=!0},p:Ue,i(s){i||(T(r.$$.fragment,s),i=!0)},o(s){O(r.$$.fragment,s),i=!1},d(s){s&&_(e),te(r)}}}function Ly(o){let e,t,n,r,i,s,a;const l=[Fy,zy,By],c=[];function u(d,f){var h,p,b;return f&4&&(e=null),f&4&&(t=null),f&4&&(n=null),e==null&&(e=((h=d[2])==null?void 0:h.charAt(0))==="/"),e?0:(t==null&&(t=!!(((p=d[2])==null?void 0:p.charAt(0))==="#"&&d[2].startsWith("#")&&!d[2].includes("# ")||d[2].slice(0,2)==="\\#"&&d[2].startsWith("#")&&!d[2].includes("# "))),t?1:(n==null&&(n=((b=d[2])==null?void 0:b.charAt(0))==="@"),n?2:-1))}return~(r=u(o,-1))&&(i=c[r]=l[r](o)),{c(){i&&i.c(),s=Ve()},l(d){i&&i.l(d),s=Ve()},m(d,f){~r&&c[r].m(d,f),z(d,s,f),a=!0},p(d,f){let h=r;r=u(d,f),r===h?~r&&c[r].p(d,f):(i&&(Re(),O(c[h],1,1,()=>{c[h]=null}),Me()),~r?(i=c[r],i?i.p(d,f):(i=c[r]=l[r](d),i.c()),T(i,1),i.m(s.parentNode,s)):i=null)},i(d){a||(T(i),a=!0)},o(d){O(i),a=!1},d(d){d&&_(s),~r&&c[r].d(d)}}}function By(o){let e,t,n={command:o[2]};return e=new Hy({props:n}),o[17](e),e.$on("select",o[18]),{c(){$(e.$$.fragment)},l(r){oe(e.$$.fragment,r)},m(r,i){ee(e,r,i),t=!0},p(r,i){const s={};i&4&&(s.command=r[2]),e.$set(s)},i(r){t||(T(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){o[17](null),te(e,r)}}}function zy(o){let e,t,n;function r(s){o[13](s)}let i={command:o[2].includes("\\#")?o[2].slice(2):o[2]};return o[0]!==void 0&&(i.prompt=o[0]),e=new Py({props:i}),o[12](e),ze.push(()=>Ze(e,"prompt",r)),e.$on("youtube",o[14]),e.$on("url",o[15]),e.$on("select",o[16]),{c(){$(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,a){ee(e,s,a),n=!0},p(s,a){const l={};a&4&&(l.command=s[2].includes("\\#")?s[2].slice(2):s[2]),!t&&a&1&&(t=!0,l.prompt=s[0],Je(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){o[12](null),te(e,s)}}}function Fy(o){let e,t,n,r;function i(l){o[10](l)}function s(l){o[11](l)}let a={command:o[2]};return o[0]!==void 0&&(a.prompt=o[0]),o[1]!==void 0&&(a.files=o[1]),e=new vy({props:a}),o[9](e),ze.push(()=>Ze(e,"prompt",i)),ze.push(()=>Ze(e,"files",s)),{c(){$(e.$$.fragment)},l(l){oe(e.$$.fragment,l)},m(l,c){ee(e,l,c),r=!0},p(l,c){const u={};c&4&&(u.command=l[2]),!t&&c&1&&(t=!0,u.prompt=l[0],Je(()=>t=!1)),!n&&c&2&&(n=!0,u.files=l[1],Je(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){O(e.$$.fragment,l),r=!1},d(l){o[9](null),te(e,l)}}}function Vy(o){let e,t,n=o[3]&&Zc(o);return{c(){n&&n.c(),e=Ve()},l(r){n&&n.l(r),e=Ve()},m(r,i){n&&n.m(r,i),z(r,e,i),t=!0},p(r,[i]){r[3]?n?(n.p(r,i),i&8&&T(n,1)):(n=Zc(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Re(),O(n,1,1,()=>{n=null}),Me())},i(r){t||(T(n),t=!0)},o(r){O(n),t=!1},d(r){r&&_(e),n&&n.d(r)}}}function Ky(o,e,t){const n=On();let{prompt:r=""}=e,{files:i=[]}=e,s=!1,a=null;const l=()=>{a==null||a.selectUp()},c=()=>{a==null||a.selectDown()};let u="",d=!1;const f=async()=>{t(4,s=!0),await Promise.all([(async()=>{gf.set(await lp(localStorage.token))})(),(async()=>{mf.set(await cp(localStorage.token))})()]),t(4,s=!1)};function h(k){ze[k?"unshift":"push"](()=>{a=k,t(5,a)})}function p(k){r=k,t(0,r)}function b(k){i=k,t(1,i)}function w(k){ze[k?"unshift":"push"](()=>{a=k,t(5,a)})}function m(k){r=k,t(0,r)}const v=k=>{n("upload",{type:"youtube",data:k.detail})},y=k=>{n("upload",{type:"web",data:k.detail})},I=k=>{i.find(N=>N.id===k.detail.id)||(t(1,i=[...i,{...k.detail,status:"processed"}]),n("select"))};function P(k){ze[k?"unshift":"push"](()=>{a=k,t(5,a)})}const R=k=>{t(0,r=Ji(r,u)),n("select",{type:"model",data:k.detail})};return o.$$set=k=>{"prompt"in k&&t(0,r=k.prompt),"files"in k&&t(1,i=k.files)},o.$$.update=()=>{var k,N;o.$$.dirty&1&&t(2,u=((N=(k=r==null?void 0:r.split(`
`).pop())==null?void 0:k.split(" "))==null?void 0:N.pop())??""),o.$$.dirty&4&&t(3,d=["/","#","@"].includes(u==null?void 0:u.charAt(0))||u.slice(0,2)==="\\#"),o.$$.dirty&8&&d&&f()},[r,i,u,d,s,a,n,l,c,h,p,b,w,m,v,y,I,P,R]}class Gy extends We{constructor(e){super(),Ye(this,e,Ky,Vy,Qe,{prompt:0,files:1,selectUp:7,selectDown:8})}get selectUp(){return this.$$.ctx[7]}get selectDown(){return this.$$.ctx[8]}}function xc(o,e,t){const n=o.slice();return n[9]=e[t],n}function $c(o,e,t){const n=o.slice();return n[12]=e[t],n}function eu(o,e,t){const n=o.slice();return n[15]=e[t],n}function tu(o){let e,t,n,r,i=o[3].length>0&&nu(o),s=yt(o[1]),a=[];for(let c=0;c<s.length;c+=1)a[c]=ru(eu(o,s,c));const l=c=>O(a[c],1,1,()=>{a[c]=null});return{c(){i&&i.c(),e=ie(),t=U("div"),n=U("div");for(let c=0;c<a.length;c+=1)a[c].c();this.h()},l(c){i&&i.l(c),e=se(c),t=L(c,"DIV",{class:!0});var u=A(t);n=L(u,"DIV",{class:!0});var d=A(n);for(let f=0;f<a.length;f+=1)a[f].l(d);d.forEach(_),u.forEach(_),this.h()},h(){g(n,"class","text-sm dark:text-gray-300 mb-1"),g(t,"class","px-5 pb-3 w-full flex flex-col justify-center")},m(c,u){i&&i.m(c,u),z(c,e,u),z(c,t,u),S(t,n);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(n,null);r=!0},p(c,u){if(c[3].length>0?i?i.p(c,u):(i=nu(c),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),u&2){s=yt(c[1]);let d;for(d=0;d<s.length;d+=1){const f=eu(c,s,d);a[d]?(a[d].p(f,u),T(a[d],1)):(a[d]=ru(f),a[d].c(),T(a[d],1),a[d].m(n,null))}for(Re(),d=s.length;d<a.length;d+=1)l(d);Me()}},i(c){if(!r){for(let u=0;u<s.length;u+=1)T(a[u]);r=!0}},o(c){a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)O(a[u]);r=!1},d(c){c&&(_(e),_(t)),i&&i.d(c),Hn(a,c)}}}function nu(o){let e,t,n=o[2].t("Tools")+"",r;return{c(){e=U("div"),t=U("div"),r=Oe(n),this.h()},l(i){e=L(i,"DIV",{class:!0});var s=A(e);t=L(s,"DIV",{class:!0});var a=A(t);r=Ne(a,n),a.forEach(_),s.forEach(_),this.h()},h(){g(t,"class","text-base font-medium self-center"),g(e,"class","flex justify-between dark:text-gray-300 px-5 pb-1")},m(i,s){z(i,e,s),S(e,t),S(t,r)},p(i,s){s&4&&n!==(n=i[2].t("Tools")+"")&&Be(r,n)},d(i){i&&_(e)}}}function ou(o){var r,i;let e,t=((i=(r=o[15])==null?void 0:r.meta)==null?void 0:i.description)+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(s){e=L(s,"DIV",{class:!0});var a=A(e);n=Ne(a,t),a.forEach(_),this.h()},h(){g(e,"class","text-xs text-gray-500")},m(s,a){z(s,e,a),S(e,n)},p(s,a){var l,c;a&2&&t!==(t=((c=(l=s[15])==null?void 0:l.meta)==null?void 0:c.description)+"")&&Be(n,t)},d(s){s&&_(e)}}}function Wy(o){var l,c,u;let e,t,n=((l=o[15])==null?void 0:l.name)+"",r,i,s,a=((u=(c=o[15])==null?void 0:c.meta)==null?void 0:u.description)&&ou(o);return{c(){e=U("div"),t=U("div"),r=Oe(n),i=ie(),a&&a.c(),s=ie(),this.h()},l(d){e=L(d,"DIV",{});var f=A(e);t=L(f,"DIV",{class:!0});var h=A(t);r=Ne(h,n),h.forEach(_),i=se(f),a&&a.l(f),f.forEach(_),s=se(d),this.h()},h(){g(t,"class","text-sm font-medium dark:text-gray-100 text-gray-800")},m(d,f){z(d,e,f),S(e,t),S(t,r),S(e,i),a&&a.m(e,null),z(d,s,f)},p(d,f){var h,p,b;f&2&&n!==(n=((h=d[15])==null?void 0:h.name)+"")&&Be(r,n),(b=(p=d[15])==null?void 0:p.meta)!=null&&b.description?a?a.p(d,f):(a=ou(d),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(d){d&&(_(e),_(s)),a&&a.d()}}}function ru(o){let e,t;return e=new Sr({props:{buttonClassName:"w-full mb-0.5",$$slots:{default:[Wy]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&262146&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function iu(o){let e,t,n=o[2].t("Tool Servers")+"",r,i,s,a,l=o[2].t("Open WebUI can use tools provided by any OpenAPI server.")+"",c,u,d,f,h=o[2].t("Learn more about OpenAPI tool servers.")+"",p,b,w,m,v=yt(o[3]),y=[];for(let P=0;P<v.length;P+=1)y[P]=au(xc(o,v,P));const I=P=>O(y[P],1,1,()=>{y[P]=null});return{c(){e=U("div"),t=U("div"),r=Oe(n),i=ie(),s=U("div"),a=U("div"),c=Oe(l),u=ie(),d=U("br"),f=U("a"),p=Oe(h),b=ie(),w=U("div");for(let P=0;P<y.length;P+=1)y[P].c();this.h()},l(P){e=L(P,"DIV",{class:!0});var R=A(e);t=L(R,"DIV",{class:!0});var k=A(t);r=Ne(k,n),k.forEach(_),R.forEach(_),i=se(P),s=L(P,"DIV",{class:!0});var N=A(s);a=L(N,"DIV",{class:!0});var M=A(a);c=Ne(M,l),u=se(M),d=L(M,"BR",{}),f=L(M,"A",{class:!0,href:!0,target:!0});var H=A(f);p=Ne(H,h),H.forEach(_),M.forEach(_),b=se(N),w=L(N,"DIV",{class:!0});var V=A(w);for(let Q=0;Q<y.length;Q+=1)y[Q].l(V);V.forEach(_),N.forEach(_),this.h()},h(){g(t,"class","text-base font-medium self-center"),g(e,"class","flex justify-between dark:text-gray-300 px-5 pb-0.5"),g(f,"class","underline"),g(f,"href","https://github.com/open-webui/openapi-servers"),g(f,"target","_blank"),g(a,"class","text-xs text-gray-600 dark:text-gray-300 mb-2"),g(w,"class","text-sm dark:text-gray-300 mb-1"),g(s,"class","px-5 pb-5 w-full flex flex-col justify-center")},m(P,R){z(P,e,R),S(e,t),S(t,r),z(P,i,R),z(P,s,R),S(s,a),S(a,c),S(a,u),S(a,d),S(a,f),S(f,p),S(s,b),S(s,w);for(let k=0;k<y.length;k+=1)y[k]&&y[k].m(w,null);m=!0},p(P,R){if((!m||R&4)&&n!==(n=P[2].t("Tool Servers")+"")&&Be(r,n),(!m||R&4)&&l!==(l=P[2].t("Open WebUI can use tools provided by any OpenAPI server.")+"")&&Be(c,l),(!m||R&4)&&h!==(h=P[2].t("Learn more about OpenAPI tool servers.")+"")&&Be(p,h),R&8){v=yt(P[3]);let k;for(k=0;k<v.length;k+=1){const N=xc(P,v,k);y[k]?(y[k].p(N,R),T(y[k],1)):(y[k]=au(N),y[k].c(),T(y[k],1),y[k].m(w,null))}for(Re(),k=v.length;k<y.length;k+=1)I(k);Me()}},i(P){if(!m){for(let R=0;R<v.length;R+=1)T(y[R]);m=!0}},o(P){y=y.filter(Boolean);for(let R=0;R<y.length;R+=1)O(y[R]);m=!1},d(P){P&&(_(e),_(i),_(s)),Hn(y,P)}}}function Yy(o){var m,v,y,I,P,R,k,N,M,H;let e,t,n=((y=(v=(m=o[9])==null?void 0:m.openapi)==null?void 0:v.info)==null?void 0:y.title)+"",r,i,s=((R=(P=(I=o[9])==null?void 0:I.openapi)==null?void 0:P.info)==null?void 0:R.version)+"",a,l,c,u=((M=(N=(k=o[9])==null?void 0:k.openapi)==null?void 0:N.info)==null?void 0:M.description)+"",d,f,h,p=((H=o[9])==null?void 0:H.url)+"",b,w;return{c(){e=U("div"),t=U("div"),r=Oe(n),i=Oe(" - v"),a=Oe(s),l=ie(),c=U("div"),d=Oe(u),f=ie(),h=U("div"),b=Oe(p),w=ie(),this.h()},l(V){e=L(V,"DIV",{});var Q=A(e);t=L(Q,"DIV",{class:!0});var J=A(t);r=Ne(J,n),i=Ne(J," - v"),a=Ne(J,s),J.forEach(_),l=se(Q),c=L(Q,"DIV",{class:!0});var E=A(c);d=Ne(E,u),E.forEach(_),f=se(Q),h=L(Q,"DIV",{class:!0});var Y=A(h);b=Ne(Y,p),Y.forEach(_),Q.forEach(_),w=se(V),this.h()},h(){g(t,"class","text-sm font-medium dark:text-gray-100 text-gray-800"),g(c,"class","text-xs text-gray-500"),g(h,"class","text-xs text-gray-500")},m(V,Q){z(V,e,Q),S(e,t),S(t,r),S(t,i),S(t,a),S(e,l),S(e,c),S(c,d),S(e,f),S(e,h),S(h,b),z(V,w,Q)},p(V,Q){var J,E,Y,D,W,F,G,K,j,re;Q&8&&n!==(n=((Y=(E=(J=V[9])==null?void 0:J.openapi)==null?void 0:E.info)==null?void 0:Y.title)+"")&&Be(r,n),Q&8&&s!==(s=((F=(W=(D=V[9])==null?void 0:D.openapi)==null?void 0:W.info)==null?void 0:F.version)+"")&&Be(a,s),Q&8&&u!==(u=((j=(K=(G=V[9])==null?void 0:G.openapi)==null?void 0:K.info)==null?void 0:j.description)+"")&&Be(d,u),Q&8&&p!==(p=((re=V[9])==null?void 0:re.url)+"")&&Be(b,p)},d(V){V&&(_(e),_(w))}}}function su(o){var c,u;let e,t,n=((c=o[12])==null?void 0:c.name)+"",r,i,s,a=((u=o[12])==null?void 0:u.description)+"",l;return{c(){e=U("div"),t=U("div"),r=Oe(n),i=ie(),s=U("div"),l=Oe(a),this.h()},l(d){e=L(d,"DIV",{class:!0});var f=A(e);t=L(f,"DIV",{class:!0});var h=A(t);r=Ne(h,n),h.forEach(_),i=se(f),s=L(f,"DIV",{});var p=A(s);l=Ne(p,a),p.forEach(_),f.forEach(_),this.h()},h(){g(t,"class","font-medium text-gray-800 dark:text-gray-100"),g(e,"class","my-1")},m(d,f){z(d,e,f),S(e,t),S(t,r),S(e,i),S(e,s),S(s,l)},p(d,f){var h,p;f&8&&n!==(n=((h=d[12])==null?void 0:h.name)+"")&&Be(r,n),f&8&&a!==(a=((p=d[12])==null?void 0:p.description)+"")&&Be(l,a)},d(d){d&&_(e)}}}function qy(o){var i;let e,t,n=yt(((i=o[9])==null?void 0:i.specs)??[]),r=[];for(let s=0;s<n.length;s+=1)r[s]=su($c(o,n,s));return{c(){e=U("div");for(let s=0;s<r.length;s+=1)r[s].c();t=ie(),this.h()},l(s){e=L(s,"DIV",{slot:!0});var a=A(e);for(let l=0;l<r.length;l+=1)r[l].l(a);t=se(a),a.forEach(_),this.h()},h(){g(e,"slot","content")},m(s,a){z(s,e,a);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(e,null);S(e,t)},p(s,a){var l;if(a&8){n=yt(((l=s[9])==null?void 0:l.specs)??[]);let c;for(c=0;c<n.length;c+=1){const u=$c(s,n,c);r[c]?r[c].p(u,a):(r[c]=su(u),r[c].c(),r[c].m(e,t))}for(;c<r.length;c+=1)r[c].d(1);r.length=n.length}},d(s){s&&_(e),Hn(r,s)}}}function au(o){let e,t;return e=new Sr({props:{buttonClassName:"w-full",chevron:!0,$$slots:{content:[qy],default:[Yy]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&262152&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function jy(o){let e,t,n,r=o[2].t("Available Tools")+"",i,s,a,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',c,u,d,f,h,p=o[1].length>0&&tu(o),b=o[3].length>0&&iu(o);return{c(){e=U("div"),t=U("div"),n=U("div"),i=Oe(r),s=ie(),a=U("button"),a.innerHTML=l,c=ie(),p&&p.c(),u=ie(),b&&b.c(),this.h()},l(w){e=L(w,"DIV",{});var m=A(e);t=L(m,"DIV",{class:!0});var v=A(t);n=L(v,"DIV",{class:!0});var y=A(n);i=Ne(y,r),y.forEach(_),s=se(v),a=L(v,"BUTTON",{class:!0,"data-svelte-h":!0}),dn(a)!=="svelte-745w2y"&&(a.innerHTML=l),v.forEach(_),c=se(m),p&&p.l(m),u=se(m),b&&b.l(m),m.forEach(_),this.h()},h(){g(n,"class","text-lg font-medium self-center"),g(a,"class","self-center"),g(t,"class","flex justify-between dark:text-gray-300 px-5 pt-4 pb-0.5")},m(w,m){z(w,e,m),S(e,t),S(t,n),S(n,i),S(t,s),S(t,a),S(e,c),p&&p.m(e,null),S(e,u),b&&b.m(e,null),d=!0,f||(h=Ae(a,"click",o[7]),f=!0)},p(w,m){(!d||m&4)&&r!==(r=w[2].t("Available Tools")+"")&&Be(i,r),w[1].length>0?p?(p.p(w,m),m&2&&T(p,1)):(p=tu(w),p.c(),T(p,1),p.m(e,u)):p&&(Re(),O(p,1,1,()=>{p=null}),Me()),w[3].length>0?b?(b.p(w,m),m&8&&T(b,1)):(b=iu(w),b.c(),T(b,1),b.m(e,null)):b&&(Re(),O(b,1,1,()=>{b=null}),Me())},i(w){d||(T(p),T(b),d=!0)},o(w){O(p),O(b),d=!1},d(w){w&&_(e),p&&p.d(),b&&b.d(),f=!1,h()}}}function Qy(o){let e,t,n;function r(s){o[8](s)}let i={size:"md",$$slots:{default:[jy]},$$scope:{ctx:o}};return o[0]!==void 0&&(i.show=o[0]),e=new fp({props:i}),ze.push(()=>Ze(e,"show",r)),{c(){$(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,a){ee(e,s,a),n=!0},p(s,[a]){const l={};a&262159&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.show=s[0],Je(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function Xy(o,e,t){let n,r,i;de(o,Xo,f=>t(6,n=f)),de(o,pf,f=>t(3,i=f));let{show:s=!1}=e,{selectedToolIds:a=[]}=e,l=[];const c=rn("i18n");de(o,c,f=>t(2,r=f));const u=()=>{t(0,s=!1)};function d(f){s=f,t(0,s)}return o.$$set=f=>{"show"in f&&t(0,s=f.show),"selectedToolIds"in f&&t(5,a=f.selectedToolIds)},o.$$.update=()=>{o.$$.dirty&96&&t(1,l=(n??[]).filter(f=>a.includes(f.id)))},[s,l,r,i,c,a,n,u,d]}class Jy extends We{constructor(e){super(),Ye(this,e,Xy,Qy,Qe,{show:0,selectedToolIds:5})}}function Zy(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=A(e);t=Ee(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z"),g(t,"clip-rule","evenodd"),g(e,"aria-hidden","true"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","currentColor"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){z(n,e,r),S(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Ue,o:Ue,d(n){n&&_(e)}}}function xy(o,e,t){let{className:n="w-4 h-4"}=e,{strokeWidth:r="0"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class $y extends We{constructor(e){super(),Ye(this,e,xy,Zy,Qe,{className:0,strokeWidth:1})}}function ew(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{class:!0,"stroke-width":!0,"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0});var r=A(e);t=Ee(r,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"stroke","currentColor"),g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"stroke-width","2"),g(t,"d","m3 16 5-7 6 6.5m6.5 2.5L16 13l-4.286 6M14 10h.01M4 19h16a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Z"),g(e,"class",o[0]),g(e,"stroke-width",o[1]),g(e,"aria-hidden","true"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24")},m(n,r){z(n,e,r),S(e,t)},p(n,[r]){r&1&&g(e,"class",n[0]),r&2&&g(e,"stroke-width",n[1])},i:Ue,o:Ue,d(n){n&&_(e)}}}function tw(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class nw extends We{constructor(e){super(),Ye(this,e,tw,ew,Qe,{className:0,strokeWidth:1})}}function ow(o){let e,t,n;return{c(){e=Ce("svg"),t=Ce("path"),n=Ce("path"),this.h()},l(r){e=Ee(r,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var i=A(e);t=Ee(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(_),n=Ee(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(n).forEach(_),i.forEach(_),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M21.75 6.75a4.5 4.5 0 0 1-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 1 1-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 0 1 6.336-4.486l-3.276 3.276a3.004 3.004 0 0 0 2.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852Z"),g(n,"stroke-linecap","round"),g(n,"stroke-linejoin","round"),g(n,"d","M4.867 19.125h.008v.008h-.008v-.008Z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(r,i){z(r,e,i),S(e,t),S(e,n)},p(r,[i]){i&2&&g(e,"stroke-width",r[1]),i&1&&g(e,"class",r[0])},i:Ue,o:Ue,d(r){r&&_(e)}}}function rw(o,e,t){let{className:n="w-4 h-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class iw extends We{constructor(e){super(),Ye(this,e,rw,ow,Qe,{className:0,strokeWidth:1})}}function lu(o,e,t){const n=o.slice();return n[108]=e[t],n[110]=t,n}function cu(o,e,t){const n=o.slice();return n[111]=e[t],n[113]=t,n}function uu(o){var W;let e,t,n,r,i,s,a,l,c,u,d,f,h,p,b,w,m,v,y,I,P,R,k,N,M=o[8]===!1&&((W=o[13])==null?void 0:W.currentId)&&du(o),H=o[0]!==void 0&&fu(o);function V(F){o[57](F)}function Q(F){o[58](F)}let J={};o[1]!==void 0&&(J.prompt=o[1]),o[2]!==void 0&&(J.files=o[2]),l=new Gy({props:J}),o[56](l),ze.push(()=>Ze(l,"prompt",V)),ze.push(()=>Ze(l,"files",Q)),l.$on("upload",o[59]),l.$on("select",o[60]);const E=[aw,sw],Y=[];function D(F,G){return F[23]?0:1}return v=D(o),y=Y[v]=E[v](o),{c(){e=U("div"),t=U("div"),n=U("div"),r=U("div"),M&&M.c(),i=ie(),s=U("div"),H&&H.c(),a=ie(),$(l.$$.fragment),f=ie(),h=U("div"),p=U("div"),b=U("div"),w=U("input"),m=ie(),y.c(),this.h()},l(F){e=L(F,"DIV",{class:!0});var G=A(e);t=L(G,"DIV",{class:!0});var K=A(t);n=L(K,"DIV",{class:!0});var j=A(n);r=L(j,"DIV",{class:!0});var re=A(r);M&&M.l(re),re.forEach(_),i=se(j),s=L(j,"DIV",{class:!0});var ue=A(s);H&&H.l(ue),a=se(ue),oe(l.$$.fragment,ue),ue.forEach(_),j.forEach(_),K.forEach(_),f=se(G),h=L(G,"DIV",{class:!0});var X=A(h);p=L(X,"DIV",{class:!0});var me=A(p);b=L(me,"DIV",{class:!0});var ne=A(b);w=L(ne,"INPUT",{type:!0}),m=se(ne),y.l(ne),ne.forEach(_),me.forEach(_),X.forEach(_),G.forEach(_),this.h()},h(){var F,G;g(r,"class","relative"),g(s,"class","w-full relative"),g(n,"class",d="flex flex-col px-3 "+(((F=o[38])==null?void 0:F.widescreenMode)??null?"max-w-full":"max-w-6xl")+" w-full"),g(t,"class","mx-auto inset-x-0 bg-transparent flex justify-center"),g(w,"type","file"),w.hidden=!0,w.multiple=!0,g(b,"class",""),g(p,"class",I=(((G=o[38])==null?void 0:G.widescreenMode)??null?"max-w-full":"max-w-6xl")+" px-2.5 mx-auto inset-x-0"),g(h,"class",P=o[9]?"bg-transparent":"bg-white dark:bg-gray-900"),g(e,"class","w-full font-primary")},m(F,G){z(F,e,G),S(e,t),S(t,n),S(n,r),M&&M.m(r,null),S(n,i),S(n,s),H&&H.m(s,null),S(s,a),ee(l,s,null),S(e,f),S(e,h),S(h,p),S(p,b),S(b,w),o[61](w),S(b,m),Y[v].m(b,null),R=!0,k||(N=[Ae(w,"change",o[62]),Ae(w,"change",o[63])],k=!0)},p(F,G){var re,ue,X;F[8]===!1&&((re=F[13])!=null&&re.currentId)?M?M.p(F,G):(M=du(F),M.c(),M.m(r,null)):M&&(M.d(1),M=null),F[0]!==void 0?H?(H.p(F,G),G[0]&1&&T(H,1)):(H=fu(F),H.c(),T(H,1),H.m(s,a)):H&&(Re(),O(H,1,1,()=>{H=null}),Me());const K={};!c&&G[0]&2&&(c=!0,K.prompt=F[1],Je(()=>c=!1)),!u&&G[0]&4&&(u=!0,K.files=F[2],Je(()=>u=!1)),l.$set(K),(!R||G[1]&128&&d!==(d="flex flex-col px-3 "+(((ue=F[38])==null?void 0:ue.widescreenMode)??null?"max-w-full":"max-w-6xl")+" w-full"))&&g(n,"class",d);let j=v;v=D(F),v===j?Y[v].p(F,G):(Re(),O(Y[j],1,1,()=>{Y[j]=null}),Me(),y=Y[v],y?y.p(F,G):(y=Y[v]=E[v](F),y.c()),T(y,1),y.m(b,null)),(!R||G[1]&128&&I!==(I=(((X=F[38])==null?void 0:X.widescreenMode)??null?"max-w-full":"max-w-6xl")+" px-2.5 mx-auto inset-x-0"))&&g(p,"class",I),(!R||G[0]&512&&P!==(P=F[9]?"bg-transparent":"bg-white dark:bg-gray-900"))&&g(h,"class",P)},i(F){R||(T(H),T(l.$$.fragment,F),T(y),R=!0)},o(F){O(H),O(l.$$.fragment,F),O(y),R=!1},d(F){F&&_(e),M&&M.d(),H&&H.d(),o[56](null),te(l),o[61](null),Y[v].d(),k=!1,wn(N)}}}function du(o){let e,t,n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg>',r,i;return{c(){e=U("div"),t=U("button"),t.innerHTML=n,this.h()},l(s){e=L(s,"DIV",{class:!0});var a=A(e);t=L(a,"BUTTON",{class:!0,"data-svelte-h":!0}),dn(t)!=="svelte-h8r9o0"&&(t.innerHTML=n),a.forEach(_),this.h()},h(){g(t,"class","bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto"),g(e,"class","absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none")},m(s,a){z(s,e,a),S(e,t),r||(i=Ae(t,"click",o[53]),r=!0)},p:Ue,d(s){s&&_(e),r=!1,i()}}}function fu(o){let e,t,n,r,i,s,a,l,c,u=o[0].name+"",d,f,h,p,b,w,m,v;return b=new Es({}),{c(){e=U("div"),t=U("div"),n=U("div"),r=U("img"),s=ie(),a=U("div"),l=Oe("Talking to "),c=U("span"),d=Oe(u),f=ie(),h=U("div"),p=U("button"),$(b.$$.fragment),this.h()},l(y){e=L(y,"DIV",{class:!0});var I=A(e);t=L(I,"DIV",{class:!0});var P=A(t);n=L(P,"DIV",{class:!0});var R=A(n);r=L(R,"IMG",{crossorigin:!0,alt:!0,class:!0,src:!0}),s=se(R),a=L(R,"DIV",{class:!0});var k=A(a);l=Ne(k,"Talking to "),c=L(k,"SPAN",{class:!0});var N=A(c);d=Ne(N,u),N.forEach(_),k.forEach(_),R.forEach(_),f=se(P),h=L(P,"DIV",{});var M=A(h);p=L(M,"BUTTON",{class:!0});var H=A(p);oe(b.$$.fragment,H),H.forEach(_),M.forEach(_),P.forEach(_),I.forEach(_),this.h()},h(){var y,I,P;g(r,"crossorigin","anonymous"),g(r,"alt","model profile"),g(r,"class","size-3.5 max-w-[28px] object-cover rounded-full"),oo(r.src,i=((P=(I=(y=o[19].find(o[54]))==null?void 0:y.info)==null?void 0:I.meta)==null?void 0:P.profile_image_url)??(o[39].language==="dg-DG"?"/doge.png":`${gi}/static/favicon.png`))||g(r,"src",i),g(c,"class","font-medium"),g(a,"class","translate-y-[0.5px]"),g(n,"class","pl-[1px] flex items-center gap-2 text-sm dark:text-gray-500"),g(p,"class","flex items-center dark:text-gray-500"),g(t,"class","flex items-center justify-between w-full"),g(e,"class","px-3 pb-0.5 pt-1.5 text-left w-full flex flex-col absolute bottom-0 left-0 right-0 bg-linear-to-t from-white dark:from-gray-900 z-10")},m(y,I){z(y,e,I),S(e,t),S(t,n),S(n,r),S(n,s),S(n,a),S(a,l),S(a,c),S(c,d),S(t,f),S(t,h),S(h,p),ee(b,p,null),w=!0,m||(v=Ae(p,"click",o[55]),m=!0)},p(y,I){var P,R,k;(!w||I[0]&524289|I[1]&256&&!oo(r.src,i=((k=(R=(P=y[19].find(y[54]))==null?void 0:P.info)==null?void 0:R.meta)==null?void 0:k.profile_image_url)??(y[39].language==="dg-DG"?"/doge.png":`${gi}/static/favicon.png`)))&&g(r,"src",i),(!w||I[0]&1)&&u!==(u=y[0].name+"")&&Be(d,u)},i(y){w||(T(b.$$.fragment,y),w=!0)},o(y){O(b.$$.fragment,y),w=!1},d(y){y&&_(e),te(b),m=!1,v()}}}function sw(o){var j,re,ue,X,me,ne;let e,t,n,r,i,s,a,l,c,u,d,f,h,p,b,w,m,v,y,I,P,R,k=o[2].length>0&&hu(o);const N=[fw,dw],M=[];function H(q,he){var Z;return((Z=q[38])==null?void 0:Z.richTextInput)??!0?0:1}i=H(o),s=M[i]=N[i](o);function V(q){o[90](q)}let Q={selectedModels:o[0]?[o[0].id]:o[12],fileUploadCapableModels:o[32],screenCaptureHandler:o[45],inputFilesHandler:o[47],uploadFilesHandler:o[86],uploadGoogleDriveHandler:o[87],uploadOneDriveHandler:o[88],onClose:o[89],$$slots:{default:[hw]},$$scope:{ctx:o}};o[3]!==void 0&&(Q.selectedToolIds=o[3]),u=new _y({props:Q}),ze.push(()=>Ze(u,"selectedToolIds",V));let J=o[18]&&(o[34]||o[33]&&o[33].length>0||o[35]||o[36]||o[37])&&pu(o),E=(!((j=o[13])!=null&&j.currentId)||((re=o[13].messages[o[13].currentId])==null?void 0:re.done)==!0)&&(((ue=o[18])==null?void 0:ue.role)==="admin"||(((ne=(me=(X=o[18])==null?void 0:X.permissions)==null?void 0:me.chat)==null?void 0:ne.stt)??!0))&&ku(o);const Y=[Ew,Cw,kw],D=[];function W(q,he){var Z,x,_e,Pe,De;return q[14]&&q[14].length>0||q[13].currentId&&((Z=q[13].messages[q[13].currentId])==null?void 0:Z.done)!=!0?0:q[1]===""&&q[2].length===0&&(((x=q[18])==null?void 0:x.role)==="admin"||(((De=(Pe=(_e=q[18])==null?void 0:_e.permissions)==null?void 0:Pe.chat)==null?void 0:De.call)??!0))?1:2}w=W(o),m=D[w]=Y[w](o);function F(q,he){var Z,x;return(x=(Z=q[17])==null?void 0:Z.license_metadata)!=null&&x.input_footer?Rw:Aw}let G=F(o),K=G(o);return{c(){e=U("form"),t=U("div"),k&&k.c(),n=ie(),r=U("div"),s.c(),a=ie(),l=U("div"),c=U("div"),$(u.$$.fragment),f=ie(),J&&J.c(),h=ie(),p=U("div"),E&&E.c(),b=ie(),m.c(),y=ie(),K.c(),this.h()},l(q){e=L(q,"FORM",{class:!0});var he=A(e);t=L(he,"DIV",{class:!0,dir:!0});var Z=A(t);k&&k.l(Z),n=se(Z),r=L(Z,"DIV",{class:!0});var x=A(r);s.l(x),x.forEach(_),a=se(Z),l=L(Z,"DIV",{class:!0,dir:!0});var _e=A(l);c=L(_e,"DIV",{class:!0});var Pe=A(c);oe(u.$$.fragment,Pe),f=se(Pe),J&&J.l(Pe),Pe.forEach(_),h=se(_e),p=L(_e,"DIV",{class:!0});var De=A(p);E&&E.l(De),b=se(De),m.l(De),De.forEach(_),_e.forEach(_),Z.forEach(_),y=se(he),K.l(he),he.forEach(_),this.h()},h(){var q;g(r,"class","px-2.5"),g(c,"class","ml-1 self-end flex items-center flex-1 max-w-[80%]"),g(p,"class","self-end flex space-x-1 mr-1 shrink-0"),g(l,"class","flex justify-between mt-0.5 mb-2.5 mx-0.5 max-w-full"),g(l,"dir","ltr"),g(t,"class","flex-1 flex flex-col relative w-full shadow-lg rounded-3xl border border-gray-50 dark:border-gray-850 hover:border-gray-100 focus-within:border-gray-100 hover:dark:border-gray-800 focus-within:dark:border-gray-800 transition px-1 bg-white/90 dark:bg-gray-400/5 dark:text-gray-100"),g(t,"dir",v=((q=o[38])==null?void 0:q.chatDirection)??"auto"),g(e,"class","w-full flex flex-col gap-1.5")},m(q,he){z(q,e,he),S(e,t),k&&k.m(t,null),S(t,n),S(t,r),M[i].m(r,null),S(t,a),S(t,l),S(l,c),ee(u,c,null),S(c,f),J&&J.m(c,null),S(l,h),S(l,p),E&&E.m(p,null),S(p,b),D[w].m(p,null),S(e,y),K.m(e,null),I=!0,P||(R=Ae(e,"submit",Tr(o[99])),P=!0)},p(q,he){var Pe,De,ge,ct,at,kt,_t;q[2].length>0?k?(k.p(q,he),he[0]&4&&T(k,1)):(k=hu(q),k.c(),T(k,1),k.m(t,n)):k&&(Re(),O(k,1,1,()=>{k=null}),Me());let Z=i;i=H(q),i===Z?M[i].p(q,he):(Re(),O(M[Z],1,1,()=>{M[Z]=null}),Me(),s=M[i],s?s.p(q,he):(s=M[i]=N[i](q),s.c()),T(s,1),s.m(r,null));const x={};he[0]&4097&&(x.selectedModels=q[0]?[q[0].id]:q[12]),he[1]&2&&(x.fileUploadCapableModels=q[32]),he[0]&67108864&&(x.uploadFilesHandler=q[86]),he[1]&256&&(x.uploadGoogleDriveHandler=q[87]),he[3]&2097152&&(x.$$scope={dirty:he,ctx:q}),!d&&he[0]&8&&(d=!0,x.selectedToolIds=q[3],Je(()=>d=!1)),u.$set(x),q[18]&&(q[34]||q[33]&&q[33].length>0||q[35]||q[36]||q[37])?J?(J.p(q,he),he[0]&262144|he[1]&124&&T(J,1)):(J=pu(q),J.c(),T(J,1),J.m(c,null)):J&&(Re(),O(J,1,1,()=>{J=null}),Me()),(!((Pe=q[13])!=null&&Pe.currentId)||((De=q[13].messages[q[13].currentId])==null?void 0:De.done)==!0)&&(((ge=q[18])==null?void 0:ge.role)==="admin"||(((kt=(at=(ct=q[18])==null?void 0:ct.permissions)==null?void 0:at.chat)==null?void 0:kt.stt)??!0))?E?(E.p(q,he),he[0]&270336&&T(E,1)):(E=ku(q),E.c(),T(E,1),E.m(p,b)):E&&(Re(),O(E,1,1,()=>{E=null}),Me());let _e=w;w=W(q),w===_e?D[w].p(q,he):(Re(),O(D[_e],1,1,()=>{D[_e]=null}),Me(),m=D[w],m?m.p(q,he):(m=D[w]=Y[w](q),m.c()),T(m,1),m.m(p,null)),(!I||he[1]&128&&v!==(v=((_t=q[38])==null?void 0:_t.chatDirection)??"auto"))&&g(t,"dir",v),G===(G=F(q))&&K?K.p(q,he):(K.d(1),K=G(q),K&&(K.c(),K.m(e,null)))},i(q){I||(T(k),T(s),T(u.$$.fragment,q),T(J),T(E),T(m),I=!0)},o(q){O(k),O(s),O(u.$$.fragment,q),O(J),O(E),O(m),I=!1},d(q){q&&_(e),k&&k.d(),M[i].d(),te(u),J&&J.d(),E&&E.d(),D[w].d(),K.d(),P=!1,R()}}}function aw(o){let e,t,n;function r(s){o[66](s)}let i={onCancel:o[64],onConfirm:o[65]};return o[23]!==void 0&&(i.recording=o[23]),e=new ip({props:i}),ze.push(()=>Ze(e,"recording",r)),{c(){$(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,a){ee(e,s,a),n=!0},p(s,a){const l={};a[0]&8388608&&(l.onCancel=s[64]),a[0]&8388610|a[1]&128&&(l.onConfirm=s[65]),!t&&a[0]&8388608&&(t=!0,l.recording=s[23],Je(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function hu(o){let e,t,n=yt(o[2]),r=[];for(let s=0;s<n.length;s+=1)r[s]=mu(cu(o,n,s));const i=s=>O(r[s],1,1,()=>{r[s]=null});return{c(){e=U("div");for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=L(s,"DIV",{class:!0});var a=A(e);for(let l=0;l<r.length;l+=1)r[l].l(a);a.forEach(_),this.h()},h(){g(e,"class","mx-2 mt-2.5 -mb-1 flex items-center flex-wrap gap-2")},m(s,a){z(s,e,a);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(e,null);t=!0},p(s,a){if(a[0]&4101|a[1]&257){n=yt(s[2]);let l;for(l=0;l<n.length;l+=1){const c=cu(s,n,l);r[l]?(r[l].p(c,a),T(r[l],1)):(r[l]=mu(c),r[l].c(),T(r[l],1),r[l].m(e,null))}for(Re(),l=n.length;l<r.length;l+=1)i(l);Me()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(r[a]);t=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)O(r[a]);t=!1},d(s){s&&_(e),Hn(r,s)}}}function lw(o){var i;let e,t;function n(){return o[69](o[111],o[113])}function r(){return o[70](o[111])}return e=new Cf({props:{item:o[111],name:o[111].name,type:o[111].type,size:(i=o[111])==null?void 0:i.size,loading:o[111].status==="uploading",dismissible:!0,edit:!0}}),e.$on("dismiss",n),e.$on("click",r),{c(){$(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,a){ee(e,s,a),t=!0},p(s,a){var c;o=s;const l={};a[0]&4&&(l.item=o[111]),a[0]&4&&(l.name=o[111].name),a[0]&4&&(l.type=o[111].type),a[0]&4&&(l.size=(c=o[111])==null?void 0:c.size),a[0]&4&&(l.loading=o[111].status==="uploading"),e.$set(l)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){O(e.$$.fragment,s),t=!1},d(s){te(e,s)}}}function cw(o){let e,t,n,r,i,s,a,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',c,u,d,f;n=new hp({props:{src:o[111].url,alt:"input",imageClassName:" size-14 rounded-xl object-cover"}});let h=(o[0]?o[31].length===0:o[12].length!==o[31].length)&&gu(o);function p(){return o[68](o[113])}return{c(){e=U("div"),t=U("div"),$(n.$$.fragment),r=ie(),h&&h.c(),i=ie(),s=U("div"),a=U("button"),a.innerHTML=l,c=ie(),this.h()},l(b){e=L(b,"DIV",{class:!0});var w=A(e);t=L(w,"DIV",{class:!0});var m=A(t);oe(n.$$.fragment,m),r=se(m),h&&h.l(m),m.forEach(_),i=se(w),s=L(w,"DIV",{class:!0});var v=A(s);a=L(v,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),dn(a)!=="svelte-4ewxlv"&&(a.innerHTML=l),v.forEach(_),c=se(w),w.forEach(_),this.h()},h(){g(t,"class","relative flex items-center"),g(a,"class","bg-white text-black border border-white rounded-full group-hover:visible invisible transition"),g(a,"type","button"),g(s,"class","absolute -top-1 -right-1"),g(e,"class","relative group")},m(b,w){z(b,e,w),S(e,t),ee(n,t,null),S(t,r),h&&h.m(t,null),S(e,i),S(e,s),S(s,a),S(e,c),u=!0,d||(f=Ae(a,"click",p),d=!0)},p(b,w){o=b;const m={};w[0]&4&&(m.src=o[111].url),n.$set(m),(o[0]?o[31].length===0:o[12].length!==o[31].length)?h?(h.p(o,w),w[0]&4097|w[1]&1&&T(h,1)):(h=gu(o),h.c(),T(h,1),h.m(t,null)):h&&(Re(),O(h,1,1,()=>{h=null}),Me())},i(b){u||(T(n.$$.fragment,b),T(h),u=!0)},o(b){O(n.$$.fragment,b),O(h),u=!1},d(b){b&&_(e),te(n),h&&h.d(),d=!1,f()}}}function gu(o){let e,t;return e=new Ft({props:{className:" absolute top-1 left-1",content:o[39].t("{{ models }}",{models:[...o[0]?[o[0]]:o[12]].filter(o[67]).join(", ")}),$$slots:{default:[uw]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&4097|r[1]&257&&(i.content=n[39].t("{{ models }}",{models:[...n[0]?[n[0]]:n[12]].filter(n[67]).join(", ")})),r[3]&2097152&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function uw(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var r=A(e);t=Ee(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"),g(t,"clip-rule","evenodd"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"class","size-4 fill-yellow-300")},m(n,r){z(n,e,r),S(e,t)},p:Ue,d(n){n&&_(e)}}}function mu(o){let e,t,n,r;const i=[cw,lw],s=[];function a(l,c){return l[111].type==="image"?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=Ve()},l(l){t.l(l),n=Ve()},m(l,c){s[e].m(l,c),z(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?s[e].p(l,c):(Re(),O(s[u],1,1,()=>{s[u]=null}),Me(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){O(t),r=!1},d(l){l&&_(n),s[e].d(l)}}}function dw(o){let e,t,n,r,i;return{c(){e=U("textarea"),this.h()},l(s){e=L(s,"TEXTAREA",{id:!0,dir:!0,class:!0,placeholder:!0,rows:!0}),A(e).forEach(_),this.h()},h(){var s;g(e,"id","chat-input"),g(e,"dir",t=((s=o[38])==null?void 0:s.chatDirection)??"auto"),g(e,"class","scrollbar-hidden bg-transparent dark:text-gray-200 outline-hidden w-full pt-3 px-1 resize-none"),g(e,"placeholder",n=o[16]?o[16]:o[39].t("Send a Message")),g(e,"rows","1")},m(s,a){z(s,e,a),o[78](e),Xn(e,o[1]),r||(i=[Ae(e,"input",o[79]),Ae(e,"compositionstart",o[80]),Ae(e,"compositionend",o[81]),Ae(e,"keydown",o[82]),Ae(e,"input",o[83]),Ae(e,"focus",o[84]),Ae(e,"paste",o[85])],r=!0)},p(s,a){var l;a[1]&128&&t!==(t=((l=s[38])==null?void 0:l.chatDirection)??"auto")&&g(e,"dir",t),a[0]&65536|a[1]&256&&n!==(n=s[16]?s[16]:s[39].t("Send a Message"))&&g(e,"placeholder",n),a[0]&2&&Xn(e,s[1])},i:Ue,o:Ue,d(s){s&&_(e),o[78](null),r=!1,wn(i)}}}function fw(o){var a,l,c,u,d;let e,t,n,r;function i(f){o[75](f)}let s={id:"chat-input",messageInput:!0,shiftEnter:!(((a=o[38])==null?void 0:a.ctrlEnterToSend)??!1)&&(!o[40]||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)),placeholder:o[16]?o[16]:o[39].t("Send a Message"),largeTextAsFile:(((l=o[38])==null?void 0:l.largeTextAsFile)??!1)&&!o[30],autocomplete:((u=(c=o[17])==null?void 0:c.features)==null?void 0:u.enable_autocomplete_generation)&&(((d=o[38])==null?void 0:d.promptAutocomplete)??!1),generateAutoCompletion:o[71],oncompositionstart:o[72],oncompositionend:o[73]};return o[1]!==void 0&&(s.value=o[1]),t=new sp({props:s}),o[74](t),ze.push(()=>Ze(t,"value",i)),t.$on("keydown",o[76]),t.$on("paste",o[77]),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(f){e=L(f,"DIV",{class:!0,id:!0});var h=A(e);oe(t.$$.fragment,h),h.forEach(_),this.h()},h(){g(e,"class","scrollbar-hidden rtl:text-right ltr:text-left bg-transparent dark:text-gray-100 outline-hidden w-full pt-2.5 pb-[5px] px-1 resize-none h-fit max-h-80 overflow-auto"),g(e,"id","chat-input-container")},m(f,h){z(f,e,h),ee(t,e,null),r=!0},p(f,h){var b,w,m,v,y;const p={};h[1]&640&&(p.shiftEnter=!(((b=f[38])==null?void 0:b.ctrlEnterToSend)??!1)&&(!f[40]||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))),h[0]&65536|h[1]&256&&(p.placeholder=f[16]?f[16]:f[39].t("Send a Message")),h[0]&1073741824|h[1]&128&&(p.largeTextAsFile=(((w=f[38])==null?void 0:w.largeTextAsFile)??!1)&&!f[30]),h[0]&131072|h[1]&128&&(p.autocomplete=((v=(m=f[17])==null?void 0:m.features)==null?void 0:v.enable_autocomplete_generation)&&(((y=f[38])==null?void 0:y.promptAutocomplete)??!1)),h[0]&1056768|h[1]&256&&(p.generateAutoCompletion=f[71]),h[0]&16777216&&(p.oncompositionstart=f[72]),h[0]&16777216&&(p.oncompositionend=f[73]),!n&&h[0]&2&&(n=!0,p.value=f[1],Je(()=>n=!1)),t.$set(p)},i(f){r||(T(t.$$.fragment,f),r=!0)},o(f){O(t.$$.fragment,f),r=!1},d(f){f&&_(e),o[74](null),te(t)}}}function hw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"></path></svg>';return{c(){e=U("button"),e.innerHTML=t,this.h()},l(n){e=L(n,"BUTTON",{class:!0,type:!0,"aria-label":!0,"data-svelte-h":!0}),dn(e)!=="svelte-ys0us"&&(e.innerHTML=t),this.h()},h(){g(e,"class","bg-transparent hover:bg-gray-100 text-gray-800 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5 outline-hidden focus:outline-hidden"),g(e,"type","button"),g(e,"aria-label","More")},m(n,r){z(n,e,r)},p:Ue,d(n){n&&_(e)}}}function pu(o){let e,t,n,r,i=[],s=new Map,a,l,c,u,d=o[34]&&_u(o),f=yt(o[33]);const h=m=>m[108].id;for(let m=0;m<f.length;m+=1){let v=lu(o,f,m),y=h(v);s.set(y,i[m]=bu(y,v))}let p=o[35]&&yu(o),b=o[36]&&wu(o),w=o[37]&&vu(o);return{c(){e=U("div"),t=ie(),n=U("div"),d&&d.c(),r=ie();for(let m=0;m<i.length;m+=1)i[m].c();a=ie(),p&&p.c(),l=ie(),b&&b.c(),c=ie(),w&&w.c(),this.h()},l(m){e=L(m,"DIV",{class:!0}),A(e).forEach(_),t=se(m),n=L(m,"DIV",{class:!0});var v=A(n);d&&d.l(v),r=se(v);for(let y=0;y<i.length;y+=1)i[y].l(v);a=se(v),p&&p.l(v),l=se(v),b&&b.l(v),c=se(v),w&&w.l(v),v.forEach(_),this.h()},h(){g(e,"class","flex self-center w-[1px] h-4 mx-1.5 bg-gray-50 dark:bg-gray-800"),g(n,"class","flex gap-1 items-center overflow-x-auto scrollbar-none flex-1")},m(m,v){z(m,e,v),z(m,t,v),z(m,n,v),d&&d.m(n,null),S(n,r);for(let y=0;y<i.length;y+=1)i[y]&&i[y].m(n,null);S(n,a),p&&p.m(n,null),S(n,l),b&&b.m(n,null),S(n,c),w&&w.m(n,null),u=!0},p(m,v){m[34]?d?(d.p(m,v),v[1]&8&&T(d,1)):(d=_u(m),d.c(),T(d,1),d.m(n,r)):d&&(Re(),O(d,1,1,()=>{d=null}),Me()),v[0]&16|v[1]&4&&(f=yt(m[33]),Re(),i=ws(i,v,h,1,m,f,s,n,vs,bu,a,lu),Me()),m[35]?p?(p.p(m,v),v[1]&16&&T(p,1)):(p=yu(m),p.c(),T(p,1),p.m(n,l)):p&&(Re(),O(p,1,1,()=>{p=null}),Me()),m[36]?b?(b.p(m,v),v[1]&32&&T(b,1)):(b=wu(m),b.c(),T(b,1),b.m(n,c)):b&&(Re(),O(b,1,1,()=>{b=null}),Me()),m[37]?w?(w.p(m,v),v[1]&64&&T(w,1)):(w=vu(m),w.c(),T(w,1),w.m(n,null)):w&&(Re(),O(w,1,1,()=>{w=null}),Me())},i(m){if(!u){T(d);for(let v=0;v<f.length;v+=1)T(i[v]);T(p),T(b),T(w),u=!0}},o(m){O(d);for(let v=0;v<i.length;v+=1)O(i[v]);O(p),O(b),O(w),u=!1},d(m){m&&(_(e),_(t),_(n)),d&&d.d();for(let v=0;v<i.length;v+=1)i[v].d();p&&p.d(),b&&b.d(),w&&w.d()}}}function _u(o){let e,t;return e=new Ft({props:{content:o[39].t("{{COUNT}} Available Tools",{COUNT:o[15].length+o[3].length}),$$slots:{default:[gw]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&32776|r[1]&256&&(i.content=n[39].t("{{COUNT}} Available Tools",{COUNT:n[15].length+n[3].length})),r[0]&2129928|r[3]&2097152&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function gw(o){let e,t,n,r,i=o[15].length+o[3].length+"",s,a,l,c;return t=new iw({props:{className:"size-4",strokeWidth:"1.75"}}),{c(){e=U("button"),$(t.$$.fragment),n=ie(),r=U("span"),s=Oe(i),this.h()},l(u){e=L(u,"BUTTON",{class:!0,"aria-label":!0,type:!0});var d=A(e);oe(t.$$.fragment,d),n=se(d),r=L(d,"SPAN",{class:!0});var f=A(r);s=Ne(f,i),f.forEach(_),d.forEach(_),this.h()},h(){g(r,"class","text-sm font-medium text-gray-600 dark:text-gray-300"),g(e,"class","translate-y-[0.5px] flex gap-1 items-center text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 rounded-lg p-1 self-center transition"),g(e,"aria-label","Available Tools"),g(e,"type","button")},m(u,d){z(u,e,d),ee(t,e,null),S(e,n),S(e,r),S(r,s),a=!0,l||(c=Ae(e,"click",o[91]),l=!0)},p(u,d){(!a||d[0]&32776)&&i!==(i=u[15].length+u[3].length+"")&&Be(s,i)},i(u){a||(T(t.$$.fragment,u),a=!0)},o(u){O(t.$$.fragment,u),a=!1},d(u){u&&_(e),te(t),l=!1,c()}}}function mw(o){let e,t;return e=new mp({props:{className:"size-4",strokeWidth:"1.75"}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p:Ue,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function pw(o){let e,t,n,r,i;return{c(){e=U("div"),t=U("img"),this.h()},l(s){e=L(s,"DIV",{class:!0});var a=A(e);t=L(a,"IMG",{src:!0,class:!0,style:!0,alt:!0}),a.forEach(_),this.h()},h(){oo(t.src,n=o[108].icon)||g(t,"src",n),g(t,"class",r="size-3.5 "+(o[108].icon.includes("svg")?"dark:invert-[80%]":"")),tt(t,"fill","currentColor"),g(t,"alt",i=o[108].name),g(e,"class","size-4 items-center flex justify-center")},m(s,a){z(s,e,a),S(e,t)},p(s,a){a[1]&4&&!oo(t.src,n=s[108].icon)&&g(t,"src",n),a[1]&4&&r!==(r="size-3.5 "+(s[108].icon.includes("svg")?"dark:invert-[80%]":""))&&g(t,"class",r),a[1]&4&&i!==(i=s[108].name)&&g(t,"alt",i)},i:Ue,o:Ue,d(s){s&&_(e)}}}function _w(o){var w;let e,t,n,r,i,s=((w=o[108])==null?void 0:w.name)+"",a,l,c,u,d;const f=[pw,mw],h=[];function p(m,v){var y;return(y=m[108])!=null&&y.icon?0:1}t=p(o),n=h[t]=f[t](o);function b(){return o[92](o[108])}return{c(){e=U("button"),n.c(),r=ie(),i=U("span"),a=Oe(s),this.h()},l(m){e=L(m,"BUTTON",{type:!0,class:!0});var v=A(e);n.l(v),r=se(v),i=L(v,"SPAN",{class:!0});var y=A(i);a=Ne(y,s),y.forEach(_),v.forEach(_),this.h()},h(){g(i,"class","hidden @xl:block whitespace-nowrap overflow-hidden text-ellipsis leading-none pr-0.5"),g(e,"type","button"),g(e,"class",l="px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 "+(o[4].includes(o[108].id)?"text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5":"bg-transparent text-gray-600 dark:text-gray-300  ")+" capitalize")},m(m,v){z(m,e,v),h[t].m(e,null),S(e,r),S(e,i),S(i,a),c=!0,u||(d=Ae(e,"click",Tr(b)),u=!0)},p(m,v){var I;o=m;let y=t;t=p(o),t===y?h[t].p(o,v):(Re(),O(h[y],1,1,()=>{h[y]=null}),Me(),n=h[t],n?n.p(o,v):(n=h[t]=f[t](o),n.c()),T(n,1),n.m(e,r)),(!c||v[1]&4)&&s!==(s=((I=o[108])==null?void 0:I.name)+"")&&Be(a,s),(!c||v[0]&16|v[1]&4&&l!==(l="px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 "+(o[4].includes(o[108].id)?"text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5":"bg-transparent text-gray-600 dark:text-gray-300  ")+" capitalize"))&&g(e,"class",l)},i(m){c||(T(n),c=!0)},o(m){O(n),c=!1},d(m){m&&_(e),h[t].d(),u=!1,d()}}}function bu(o,e){var i;let t,n,r;return n=new Ft({props:{content:(i=e[108])==null?void 0:i.description,placement:"top",$$slots:{default:[_w]},$$scope:{ctx:e}}}),{key:o,first:null,c(){t=Ve(),$(n.$$.fragment),this.h()},l(s){t=Ve(),oe(n.$$.fragment,s),this.h()},h(){this.first=t},m(s,a){z(s,t,a),ee(n,s,a),r=!0},p(s,a){var c;e=s;const l={};a[1]&4&&(l.content=(c=e[108])==null?void 0:c.description),a[0]&16|a[1]&4|a[3]&2097152&&(l.$$scope={dirty:a,ctx:e}),n.$set(l)},i(s){r||(T(n.$$.fragment,s),r=!0)},o(s){O(n.$$.fragment,s),r=!1},d(s){s&&_(t),te(n,s)}}}function yu(o){let e,t;return e=new Ft({props:{content:o[39].t("Search the internet"),placement:"top",$$slots:{default:[bw]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[1]&256&&(i.content=n[39].t("Search the internet")),r[0]&64|r[1]&384|r[3]&2097152&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function bw(o){let e,t,n,r,i=o[39].t("Web Search")+"",s,a,l,c,u;return t=new gp({props:{className:"size-4",strokeWidth:"1.75"}}),{c(){e=U("button"),$(t.$$.fragment),n=ie(),r=U("span"),s=Oe(i),this.h()},l(d){e=L(d,"BUTTON",{type:!0,class:!0});var f=A(e);oe(t.$$.fragment,f),n=se(f),r=L(f,"SPAN",{class:!0});var h=A(r);s=Ne(h,i),h.forEach(_),f.forEach(_),this.h()},h(){var d;g(r,"class","hidden @xl:block whitespace-nowrap overflow-hidden text-ellipsis leading-none pr-0.5"),g(e,"type","button"),g(e,"class",a="px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 "+(o[6]||(((d=o[38])==null?void 0:d.webSearch)??!1)==="always"?" text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5":"bg-transparent text-gray-600 dark:text-gray-300 "))},m(d,f){z(d,e,f),ee(t,e,null),S(e,n),S(e,r),S(r,s),l=!0,c||(u=Ae(e,"click",Tr(o[93])),c=!0)},p(d,f){var h;(!l||f[1]&256)&&i!==(i=d[39].t("Web Search")+"")&&Be(s,i),(!l||f[0]&64|f[1]&128&&a!==(a="px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 "+(d[6]||(((h=d[38])==null?void 0:h.webSearch)??!1)==="always"?" text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5":"bg-transparent text-gray-600 dark:text-gray-300 ")))&&g(e,"class",a)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){O(t.$$.fragment,d),l=!1},d(d){d&&_(e),te(t),c=!1,u()}}}function wu(o){let e,t;return e=new Ft({props:{content:o[39].t("Generate an image"),placement:"top",$$slots:{default:[yw]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[1]&256&&(i.content=n[39].t("Generate an image")),r[0]&32|r[1]&256|r[3]&2097152&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function yw(o){let e,t,n,r,i=o[39].t("Image")+"",s,a,l,c,u;return t=new nw({props:{className:"size-4",strokeWidth:"1.75"}}),{c(){e=U("button"),$(t.$$.fragment),n=ie(),r=U("span"),s=Oe(i),this.h()},l(d){e=L(d,"BUTTON",{type:!0,class:!0});var f=A(e);oe(t.$$.fragment,f),n=se(f),r=L(f,"SPAN",{class:!0});var h=A(r);s=Ne(h,i),h.forEach(_),f.forEach(_),this.h()},h(){g(r,"class","hidden @xl:block whitespace-nowrap overflow-hidden text-ellipsis leading-none pr-0.5"),g(e,"type","button"),g(e,"class",a="px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 "+(o[5]?" text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5":"bg-transparent text-gray-600 dark:text-gray-300 "))},m(d,f){z(d,e,f),ee(t,e,null),S(e,n),S(e,r),S(r,s),l=!0,c||(u=Ae(e,"click",Tr(o[94])),c=!0)},p(d,f){(!l||f[1]&256)&&i!==(i=d[39].t("Image")+"")&&Be(s,i),(!l||f[0]&32&&a!==(a="px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 "+(d[5]?" text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5":"bg-transparent text-gray-600 dark:text-gray-300 ")))&&g(e,"class",a)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){O(t.$$.fragment,d),l=!1},d(d){d&&_(e),te(t),c=!1,u()}}}function vu(o){let e,t;return e=new Ft({props:{content:o[39].t("Execute code for analysis"),placement:"top",$$slots:{default:[ww]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[1]&256&&(i.content=n[39].t("Execute code for analysis")),r[0]&128|r[1]&256|r[3]&2097152&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function ww(o){let e,t,n,r,i=o[39].t("Code Interpreter")+"",s,a,l,c,u;return t=new dm({props:{className:"size-4",strokeWidth:"1.75"}}),{c(){e=U("button"),$(t.$$.fragment),n=ie(),r=U("span"),s=Oe(i),this.h()},l(d){e=L(d,"BUTTON",{type:!0,class:!0});var f=A(e);oe(t.$$.fragment,f),n=se(f),r=L(f,"SPAN",{class:!0});var h=A(r);s=Ne(h,i),h.forEach(_),f.forEach(_),this.h()},h(){g(r,"class","hidden @xl:block whitespace-nowrap overflow-hidden text-ellipsis leading-none pr-0.5"),g(e,"type","button"),g(e,"class",a="px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 "+(o[7]?" text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5":"bg-transparent text-gray-600 dark:text-gray-300 "))},m(d,f){z(d,e,f),ee(t,e,null),S(e,n),S(e,r),S(r,s),l=!0,c||(u=Ae(e,"click",Tr(o[95])),c=!0)},p(d,f){(!l||f[1]&256)&&i!==(i=d[39].t("Code Interpreter")+"")&&Be(s,i),(!l||f[0]&128&&a!==(a="px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 "+(d[7]?" text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5":"bg-transparent text-gray-600 dark:text-gray-300 ")))&&g(e,"class",a)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){O(t.$$.fragment,d),l=!1},d(d){d&&_(e),te(t),c=!1,u()}}}function ku(o){let e,t;return e=new Ft({props:{content:o[39].t("Dictate"),$$slots:{default:[vw]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[1]&256&&(i.content=n[39].t("Dictate")),r[0]&8388608|r[1]&256|r[3]&2097152&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function vw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg>',n,r;return{c(){e=U("button"),e.innerHTML=t,this.h()},l(i){e=L(i,"BUTTON",{id:!0,class:!0,type:!0,"aria-label":!0,"data-svelte-h":!0}),dn(e)!=="svelte-4nqm9k"&&(e.innerHTML=t),this.h()},h(){g(e,"id","voice-input-button"),g(e,"class","text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 mr-0.5 self-center"),g(e,"type","button"),g(e,"aria-label","Voice Input")},m(i,s){z(i,e,s),n||(r=Ae(e,"click",o[96]),n=!0)},p:Ue,d(i){i&&_(e),n=!1,r()}}}function kw(o){let e,t,n;return t=new Ft({props:{content:o[39].t("Send message"),$$slots:{default:[Iw]},$$scope:{ctx:o}}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"class","flex items-center")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i[1]&256&&(s.content=r[39].t("Send message")),i[0]&6|i[3]&2097152&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function Cw(o){let e,t,n;return t=new Ft({props:{content:o[39].t("Voice mode"),$$slots:{default:[Tw]},$$scope:{ctx:o}}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"class","flex items-center")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i[1]&256&&(s.content=r[39].t("Voice mode")),i[0]&135168|i[1]&1408|i[3]&2097152&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function Ew(o){let e,t,n;return t=new Ft({props:{content:o[39].t("Stop"),$$slots:{default:[Sw]},$$scope:{ctx:o}}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"class","flex items-center")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i[1]&256&&(s.content=r[39].t("Stop")),i[0]&2048|i[3]&2097152&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function Iw(o){let e,t,n,r,i;return{c(){e=U("button"),t=Ce("svg"),n=Ce("path"),this.h()},l(s){e=L(s,"BUTTON",{id:!0,class:!0,type:!0});var a=A(e);t=Ee(a,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var l=A(t);n=Ee(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),A(n).forEach(_),l.forEach(_),a.forEach(_),this.h()},h(){g(n,"fill-rule","evenodd"),g(n,"d","M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z"),g(n,"clip-rule","evenodd"),g(t,"xmlns","http://www.w3.org/2000/svg"),g(t,"viewBox","0 0 16 16"),g(t,"fill","currentColor"),g(t,"class","size-5"),g(e,"id","send-message-button"),g(e,"class",r=(o[1]===""&&o[2].length===0?"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ")+" transition rounded-full p-1.5 self-center"),g(e,"type","submit"),e.disabled=i=o[1]===""&&o[2].length===0},m(s,a){z(s,e,a),S(e,t),S(t,n)},p(s,a){a[0]&6&&r!==(r=(s[1]===""&&s[2].length===0?"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ")+" transition rounded-full p-1.5 self-center")&&g(e,"class",r),a[0]&6&&i!==(i=s[1]===""&&s[2].length===0)&&(e.disabled=i)},d(s){s&&_(e)}}}function Tw(o){let e,t,n,r,i;return t=new $y({props:{className:"size-5"}}),{c(){e=U("button"),$(t.$$.fragment),this.h()},l(s){e=L(s,"BUTTON",{class:!0,type:!0,"aria-label":!0});var a=A(e);oe(t.$$.fragment,a),a.forEach(_),this.h()},h(){g(e,"class","bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full p-1.5 self-center"),g(e,"type","button"),g(e,"aria-label","Call")},m(s,a){z(s,e,a),ee(t,e,null),n=!0,r||(i=Ae(e,"click",o[98]),r=!0)},p:Ue,i(s){n||(T(t.$$.fragment,s),n=!0)},o(s){O(t.$$.fragment,s),n=!1},d(s){s&&_(e),te(t),r=!1,i()}}}function Sw(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg>',n,r;return{c(){e=U("button"),e.innerHTML=t,this.h()},l(i){e=L(i,"BUTTON",{class:!0,"data-svelte-h":!0}),dn(e)!=="svelte-nqxd5x"&&(e.innerHTML=t),this.h()},h(){g(e,"class","bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5")},m(i,s){z(i,e,s),n||(r=Ae(e,"click",o[97]),n=!0)},p:Ue,d(i){i&&_(e),n=!1,r()}}}function Aw(o){let e;return{c(){e=U("div"),this.h()},l(t){e=L(t,"DIV",{class:!0}),A(e).forEach(_),this.h()},h(){g(e,"class","mb-1")},m(t,n){z(t,e,n)},p:Ue,d(t){t&&_(e)}}}function Rw(o){var r,i;let e,t,n=Jl.sanitize(br((i=(r=o[17])==null?void 0:r.license_metadata)==null?void 0:i.input_footer))+"";return{c(){e=U("div"),t=new lf(!1),this.h()},l(s){e=L(s,"DIV",{class:!0});var a=A(e);t=cf(a,!1),a.forEach(_),this.h()},h(){t.a=null,g(e,"class","text-xs text-gray-500 text-center line-clamp-1 marked")},m(s,a){z(s,e,a),t.m(n,e)},p(s,a){var l,c;a[0]&131072&&n!==(n=Jl.sanitize(br((c=(l=s[17])==null?void 0:l.license_metadata)==null?void 0:c.input_footer))+"")&&t.p(n)},d(s){s&&_(e)}}}function Mw(o){let e,t,n,r,i,s,a;e=new ap({props:{show:o[29]}});function l(d){o[52](d)}let c={selectedToolIds:o[3]};o[21]!==void 0&&(c.show=o[21]),n=new Jy({props:c}),ze.push(()=>Ze(n,"show",l));let u=o[22]&&uu(o);return{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment),i=ie(),u&&u.c(),s=Ve()},l(d){oe(e.$$.fragment,d),t=se(d),oe(n.$$.fragment,d),i=se(d),u&&u.l(d),s=Ve()},m(d,f){ee(e,d,f),z(d,t,f),ee(n,d,f),z(d,i,f),u&&u.m(d,f),z(d,s,f),a=!0},p(d,f){const h={};f[0]&536870912&&(h.show=d[29]),e.$set(h);const p={};f[0]&8&&(p.selectedToolIds=d[3]),!r&&f[0]&2097152&&(r=!0,p.show=d[21],Je(()=>r=!1)),n.$set(p),d[22]?u?(u.p(d,f),f[0]&4194304&&T(u,1)):(u=uu(d),u.c(),T(u,1),u.m(s.parentNode,s)):u&&(Re(),O(u,1,1,()=>{u=null}),Me())},i(d){a||(T(e.$$.fragment,d),T(n.$$.fragment,d),T(u),a=!0)},o(d){O(e.$$.fragment,d),O(n.$$.fragment,d),O(u),a=!1},d(d){d&&(_(t),_(i),_(s)),te(e,d),te(n,d),u&&u.d(d)}}}function Pw(o,e,t){let n,r,i,s,a,l,c;de(o,Ar,C=>t(17,n=C)),de(o,qn,C=>t(38,r=C)),de(o,bo,C=>t(18,s=C)),de(o,nr,C=>t(19,a=C)),de(o,Ti,C=>t(40,l=C)),de(o,la,C=>t(41,c=C));const u=On(),d=rn("i18n");de(o,d,C=>t(39,i=C));let{transparentBackground:f=!1}=e,{onChange:h=()=>{}}=e,{createMessagePair:p}=e,{stopResponse:b}=e,{autoScroll:w=!1}=e,{atSelectedModel:m=void 0}=e,{selectedModels:v}=e,y=[],{history:I}=e,{taskIds:P=null}=e,{prompt:R=""}=e,{files:k=[]}=e,{toolServers:N=[]}=e,{selectedToolIds:M=[]}=e,{selectedFilterIds:H=[]}=e,{imageGenerationEnabled:V=!1}=e,{webSearchEnabled:Q=!1}=e,{codeInterpreterEnabled:J=!1}=e,E=!1,Y=!1,D=!1,W=!1,F,G,K,j,re=!1,ue=!1,{placeholder:X=""}=e,me=[],ne=[],q=[],he=[],Z=[],x=[],_e=!1,Pe=!1,De=!1,ge=!1;const ct=()=>{const C=document.getElementById("messages-container");C.scrollTo({top:C.scrollHeight,behavior:"smooth"})},at=async()=>{try{const C=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"never"},audio:!1}),Fe=document.createElement("video");Fe.srcObject=C,await Fe.play();const xe=document.createElement("canvas");xe.width=Fe.videoWidth,xe.height=Fe.videoHeight,xe.getContext("2d").drawImage(Fe,0,0,xe.width,xe.height),C.getTracks().forEach(it=>it.stop()),window.focus();const He=xe.toDataURL("image/png");t(2,k=[...k,{type:"image",url:He}]),Fe.srcObject=null}catch(C){console.error("Error capturing screen:",C)}},kt=async(C,Fe=!1)=>{var He,it,Cn,An,Un,Gt,Bt,Ht;if((s==null?void 0:s.role)!=="admin"&&!(((it=(He=s==null?void 0:s.permissions)==null?void 0:He.chat)==null?void 0:it.file_upload)??!0))return rt.error(i.t("You do not have permission to upload files.")),null;const xe=wo(),ht={type:"file",file:"",id:null,url:"",name:C.name,collection_name:"",status:"uploading",size:C.size,error:"",itemId:xe,...Fe?{context:"full"}:{}};if(ht.size==0)return rt.error(i.t("You cannot upload an empty file.")),null;t(2,k=[...k,ht]);try{let zt=null;(C.type.startsWith("audio/")||C.type.startsWith("video/"))&&((An=(Cn=r==null?void 0:r.audio)==null?void 0:Cn.stt)!=null&&An.language)&&(zt={language:(Gt=(Un=r==null?void 0:r.audio)==null?void 0:Un.stt)==null?void 0:Gt.language});const B=await tp(localStorage.token,C,zt);B?(B.id,ht.name,(Bt=B==null?void 0:B.meta)==null||Bt.collection_name,B.error&&(console.warn("File upload warning:",B.error),rt.warning(B.error)),ht.status="uploaded",ht.file=B,ht.id=B.id,ht.collection_name=((Ht=B==null?void 0:B.meta)==null?void 0:Ht.collection_name)||(B==null?void 0:B.collection_name),ht.url=`${wm}/files/${B.id}`,t(2,k)):t(2,k=k.filter(ce=>(ce==null?void 0:ce.itemId)!==xe))}catch(zt){rt.error(`${zt}`),t(2,k=k.filter(B=>(B==null?void 0:B.itemId)!==xe))}},_t=async C=>{var Fe,xe,ht;if((((Fe=n==null?void 0:n.file)==null?void 0:Fe.max_count)??null)!==null&&k.length+C.length>((xe=n==null?void 0:n.file)==null?void 0:xe.max_count)){rt.error(i.t("You can only chat with a maximum of {{maxCount}} file(s) at a time.",{maxCount:(ht=n==null?void 0:n.file)==null?void 0:ht.max_count}));return}C.forEach(He=>{var it,Cn,An,Un;if(He.name,He.type,He.size,He.name.split(".").at(-1),(((it=n==null?void 0:n.file)==null?void 0:it.max_size)??null)!==null&&He.size>(((Cn=n==null?void 0:n.file)==null?void 0:Cn.max_size)??0)*1024*1024){He.size,(((An=n==null?void 0:n.file)==null?void 0:An.max_size)??0)*1024*1024,rt.error(i.t("File size should not exceed {{maxSize}} MB.",{maxSize:(Un=n==null?void 0:n.file)==null?void 0:Un.max_size}));return}if(["image/gif","image/webp","image/jpeg","image/png","image/avif"].includes(He.type)){if(me.length===0){rt.error(i.t("Selected model(s) do not support image inputs"));return}let Gt=new FileReader;Gt.onload=async Bt=>{var zt,B,ce,be,Le,ke,we,Se,Ge,lt,Ct,Tt,mt,St,Wt,Rn,cn,Jn;let Ht=Bt.target.result;if(((r==null?void 0:r.imageCompression)??!1)||(((B=(zt=n==null?void 0:n.file)==null?void 0:zt.image_compression)==null?void 0:B.width)??null)||(((be=(ce=n==null?void 0:n.file)==null?void 0:ce.image_compression)==null?void 0:be.height)??null)){let Fn=null,Ln=null;((r==null?void 0:r.imageCompression)??!1)&&(Fn=((Le=r==null?void 0:r.imageCompressionSize)==null?void 0:Le.width)??null,Ln=((ke=r==null?void 0:r.imageCompressionSize)==null?void 0:ke.height)??null),((((Se=(we=n==null?void 0:n.file)==null?void 0:we.image_compression)==null?void 0:Se.width)??null)||(((lt=(Ge=n==null?void 0:n.file)==null?void 0:Ge.image_compression)==null?void 0:lt.height)??null))&&(Fn>(((Tt=(Ct=n==null?void 0:n.file)==null?void 0:Ct.image_compression)==null?void 0:Tt.width)??null)&&(Fn=((St=(mt=n==null?void 0:n.file)==null?void 0:mt.image_compression)==null?void 0:St.width)??null),Ln>(((Rn=(Wt=n==null?void 0:n.file)==null?void 0:Wt.image_compression)==null?void 0:Rn.height)??null)&&(Ln=((Jn=(cn=n==null?void 0:n.file)==null?void 0:cn.image_compression)==null?void 0:Jn.height)??null)),(Fn||Ln)&&(Ht=await Nm(Ht,Fn,Ln))}t(2,k=[...k,{type:"image",url:`${Ht}`}])},Gt.readAsDataURL(He)}else kt(He)})},Dt=C=>{var Fe,xe;C.preventDefault(),(xe=(Fe=C.dataTransfer)==null?void 0:Fe.types)!=null&&xe.includes("Files")?t(29,re=!0):t(29,re=!1)},Ot=()=>{t(29,re=!1)},fn=async C=>{var Fe,xe;if(C.preventDefault(),(Fe=C.dataTransfer)!=null&&Fe.files){const ht=Array.from((xe=C.dataTransfer)==null?void 0:xe.files);ht&&ht.length>0&&_t(ht)}t(29,re=!1)},en=C=>{C.key==="Shift"&&t(30,ue=!0),C.key==="Escape"&&t(29,re=!1)},tn=C=>{C.key==="Shift"&&t(30,ue=!1)},nn=()=>{},ve=()=>{t(30,ue=!1)};Qn(async()=>{t(22,Y=!0),window.setTimeout(()=>{const Fe=document.getElementById("chat-input");Fe==null||Fe.focus()},0),window.addEventListener("keydown",en),window.addEventListener("keyup",tn),window.addEventListener("focus",nn),window.addEventListener("blur",ve),await $e();const C=document.getElementById("chat-container");C==null||C.addEventListener("dragover",Dt),C==null||C.addEventListener("drop",fn),C==null||C.addEventListener("dragleave",Ot)}),Bo(()=>{window.removeEventListener("keydown",en),window.removeEventListener("keyup",tn),window.removeEventListener("focus",nn),window.removeEventListener("blur",ve);const C=document.getElementById("chat-container");C&&(C==null||C.removeEventListener("dragover",Dt),C==null||C.removeEventListener("drop",fn),C==null||C.removeEventListener("dragleave",Ot))});function sn(C){E=C,t(21,E)}const Vt=()=>{t(8,w=!0),ct()},Jt=C=>C.id===m.id,le=()=>{t(0,m=void 0)};function Xe(C){ze[C?"unshift":"push"](()=>{K=C,t(27,K)})}function vt(C){R=C,t(1,R)}function fe(C){k=C,t(2,k)}const qe=C=>{u("upload",C.detail)},Ke=C=>{const Fe=C.detail;(Fe==null?void 0:Fe.type)==="model"&&t(0,m=Fe.data);const xe=document.getElementById("chat-input");xe==null||xe.focus()};function nt(C){ze[C?"unshift":"push"](()=>{G=C,t(26,G)})}function wt(){j=this.files,t(28,j)}const pt=async()=>{if(j&&j.length>0){const C=Array.from(j);_t(C)}else rt.error(i.t("File not found."));t(26,G.value="",G)},Mt=async()=>{var C;t(23,D=!1),await $e(),(C=document.getElementById("chat-input"))==null||C.focus()},Kt=async C=>{var ht;const{text:Fe,filename:xe}=C;t(1,R=`${R}${Fe} `),t(23,D=!1),await $e(),(ht=document.getElementById("chat-input"))==null||ht.focus(),((r==null?void 0:r.speechAutoSend)??!1)&&u("submit",R)};function an(C){D=C,t(23,D)}const jt=C=>!me.includes(C),ln=C=>{k.splice(C,1),t(2,k)},vn=async(C,Fe)=>{try{C.type!=="collection"&&!(C!=null&&C.collection)&&C.id&&await np(localStorage.token,C.id)}catch(xe){console.error("Error deleting file:",xe)}k.splice(Fe,1),t(2,k)},At=C=>{},hn=async C=>{(y.length===0||!y.at(0))&&rt.error(i.t("Please select a model first."));const Fe=await Ym(localStorage.token,y.at(0),C,I!=null&&I.currentId?Gn(I,I.currentId):null).catch(xe=>null);return Fe},kn=()=>t(24,W=!0),Sn=()=>t(24,W=!1);function Lt(C){ze[C?"unshift":"push"](()=>{F=C,t(25,F)})}function Ro(C){R=C,t(1,R)}const zo=async C=>{var ht;C=C.detail.event;const Fe=C.ctrlKey||C.metaKey,xe=document.getElementById("commands-container");if(C.key==="Escape"&&b(),Fe&&C.key==="Enter"&&C.shiftKey&&(C.preventDefault(),p(R)),R===""&&Fe&&C.key.toLowerCase()==="r"){C.preventDefault();const He=[...document.getElementsByClassName("regenerate-response-button")].at(-1);He==null||He.click()}if(R===""&&C.key=="ArrowUp"){C.preventDefault();const He=[...document.getElementsByClassName("user-message")].at(-1);if(He){He.scrollIntoView({block:"center"});const it=[...document.getElementsByClassName("edit-user-message-button")].at(-1);it==null||it.click()}}if(xe){if(xe&&C.key==="ArrowUp"&&(C.preventDefault(),K.selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),xe&&C.key==="ArrowDown"&&(C.preventDefault(),K.selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),xe&&C.key==="Tab"){C.preventDefault();const He=[...document.getElementsByClassName("selected-command-option-button")].at(-1);He==null||He.click()}if(xe&&C.key==="Enter"){C.preventDefault();const He=[...document.getElementsByClassName("selected-command-option-button")].at(-1);He?He==null||He.click():(ht=document.getElementById("send-message-button"))==null||ht.click()}}else if(!l||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){if(W)return;((r==null?void 0:r.ctrlEnterToSend)??!1?(C.key==="Enter"||C.keyCode===13)&&Fe:(C.key==="Enter"||C.keyCode===13)&&!C.shiftKey)&&(C.preventDefault(),(R!==""||k.length>0)&&u("submit",R))}C.key==="Escape"&&(t(0,m=void 0),t(3,M=[]),t(4,H=[]),t(6,Q=!1),t(5,V=!1),t(7,J=!1))},Or=async C=>{C=C.detail.event;const Fe=C.clipboardData||window.clipboardData;if(Fe&&Fe.items){for(const xe of Fe.items)if(xe.type.indexOf("image")!==-1){const ht=xe.getAsFile(),He=new FileReader;He.onload=function(it){t(2,k=[...k,{type:"image",url:`${it.target.result}`}])},He.readAsDataURL(ht)}else if(xe.type==="text/plain"&&((r==null?void 0:r.largeTextAsFile)??!1)&&!ue){const ht=Fe.getData("text/plain");if(ht.length>Wl){C.preventDefault();const He=new Blob([ht],{type:"text/plain"}),it=new File([He],`Pasted_Text_${Date.now()}.txt`,{type:"text/plain"});await kt(it,!0)}}}};function Nr(C){ze[C?"unshift":"push"](()=>{F=C,t(25,F)})}function Dr(){R=this.value,t(1,R)}const Hr=()=>t(24,W=!0),Ur=()=>t(24,W=!1),Lr=async C=>{var ht;const Fe=C.ctrlKey||C.metaKey,xe=document.getElementById("commands-container");if(C.key==="Escape"&&b(),Fe&&C.key==="Enter"&&C.shiftKey&&(C.preventDefault(),p(R)),R===""&&Fe&&C.key.toLowerCase()==="r"){C.preventDefault();const He=[...document.getElementsByClassName("regenerate-response-button")].at(-1);He==null||He.click()}if(R===""&&C.key=="ArrowUp"){C.preventDefault();const He=[...document.getElementsByClassName("user-message")].at(-1),it=[...document.getElementsByClassName("edit-user-message-button")].at(-1);He==null||He.scrollIntoView({block:"center"}),it==null||it.click()}if(xe){if(xe&&C.key==="ArrowUp"){C.preventDefault(),K.selectUp();const He=document.getElementById("command-options-container"),it=[...document.getElementsByClassName("selected-command-option-button")].at(-1);if(it&&He){const Cn=it.offsetTop,An=it.offsetHeight,Un=He.clientHeight;He.scrollTop=Cn-Un/2+An/2}}if(xe&&C.key==="ArrowDown"){C.preventDefault(),K.selectDown();const He=document.getElementById("command-options-container"),it=[...document.getElementsByClassName("selected-command-option-button")].at(-1);if(it&&He){const Cn=it.offsetTop,An=it.offsetHeight,Un=He.clientHeight;He.scrollTop=Cn-Un/2+An/2}}if(xe&&C.key==="Enter"){C.preventDefault();const He=[...document.getElementsByClassName("selected-command-option-button")].at(-1);C.shiftKey?t(1,R=`${R}
`):He?He==null||He.click():(ht=document.getElementById("send-message-button"))==null||ht.click()}if(xe&&C.key==="Tab"){C.preventDefault();const He=[...document.getElementsByClassName("selected-command-option-button")].at(-1);He==null||He.click()}}else if(!l||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){if(W)return;const He=C.ctrlKey||C.metaKey,it=(r==null?void 0:r.ctrlEnterToSend)??!1?(C.key==="Enter"||C.keyCode===13)&&He:(C.key==="Enter"||C.keyCode===13)&&!C.shiftKey;it&&C.preventDefault(),(R!==""||k.length>0)&&it&&u("submit",R)}if(C.key==="Tab"){const He=bf(R);if(He.length>0){const it=He.at(0),Cn=R;t(1,R=R.substring(0,(it==null?void 0:it.endIndex)+1)),await $e(),C.target.scrollTop=C.target.scrollHeight,t(1,R=Cn),await $e(),C.preventDefault(),C.target.setSelectionRange(it==null?void 0:it.startIndex,it.endIndex+1)}C.target.style.height="",C.target.style.height=Math.min(C.target.scrollHeight,320)+"px"}C.key==="Escape"&&(t(0,m=void 0),t(3,M=[]),t(4,H=[]),t(6,Q=!1),t(5,V=!1),t(7,J=!1))},Br=async C=>{C.target.style.height="",C.target.style.height=Math.min(C.target.scrollHeight,320)+"px"},zr=async C=>{C.target.style.height="",C.target.style.height=Math.min(C.target.scrollHeight,320)+"px"},Fr=async C=>{const Fe=C.clipboardData||window.clipboardData;if(Fe&&Fe.items){for(const xe of Fe.items)if(xe.type.indexOf("image")!==-1){const ht=xe.getAsFile(),He=new FileReader;He.onload=function(it){t(2,k=[...k,{type:"image",url:`${it.target.result}`}])},He.readAsDataURL(ht)}else if(xe.type==="text/plain"&&((r==null?void 0:r.largeTextAsFile)??!1)&&!ue){const ht=Fe.getData("text/plain");if(ht.length>Wl){C.preventDefault();const He=new Blob([ht],{type:"text/plain"}),it=new File([He],`Pasted_Text_${Date.now()}.txt`,{type:"text/plain"});await kt(it,!0)}}}},Vr=()=>{G.click()},Kr=async()=>{try{const C=await w_();if(C){const Fe=new File([C.blob],C.name,{type:C.blob.type});await kt(Fe)}}catch(C){console.error("Google Drive Error:",C),rt.error(i.t("Error accessing Google Drive: {{error}}",{error:C.message}))}},Gr=async C=>{try{const Fe=await $b(C);if(Fe){const xe=new File([Fe.blob],Fe.name,{type:Fe.blob.type||"application/octet-stream"});await kt(xe)}}catch(Fe){console.error("OneDrive Error:",Fe)}},Wr=async()=>{await $e();const C=document.getElementById("chat-input");C==null||C.focus()};function Yr(C){M=C,t(3,M)}const qr=()=>{t(21,E=!E)},jr=C=>{H.includes(C.id)?t(4,H=H.filter(Fe=>Fe!==C.id)):t(4,H=[...H,C.id])},Qr=()=>t(6,Q=!Q),Xr=()=>t(5,V=!V),Jr=()=>t(7,J=!J),Zr=async()=>{try{let C=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(Fe){return rt.error(i.t("Permission denied when accessing microphone: {{error}}",{error:Fe})),null});C&&(t(23,D=!0),C.getTracks().forEach(xe=>xe.stop())),C=null}catch{rt.error(i.t("Permission denied when accessing microphone"))}},xr=()=>{b()},$r=async()=>{var C,Fe,xe,ht,He;if(v.length>1){rt.error(i.t("Select only one model to call"));return}if(n.audio.stt.engine==="web"){rt.error(i.t("Call feature is not supported when using Web STT engine"));return}try{let it=await navigator.mediaDevices.getUserMedia({audio:!0});it&&it.getTracks().forEach(An=>An.stop()),it=null,((Fe=(C=r.audio)==null?void 0:C.tts)==null?void 0:Fe.engine)==="browser-kokoro"&&(c||(await la.set(new pp({dtype:((He=(ht=(xe=r.audio)==null?void 0:xe.tts)==null?void 0:ht.engineConfig)==null?void 0:He.dtype)??"fp32"})),await c.init())),Wn.set(!0),Zt.set(!0)}catch{rt.error(i.t("Permission denied when accessing media devices"))}},ei=()=>{u("submit",R)};return o.$$set=C=>{"transparentBackground"in C&&t(9,f=C.transparentBackground),"onChange"in C&&t(48,h=C.onChange),"createMessagePair"in C&&t(10,p=C.createMessagePair),"stopResponse"in C&&t(11,b=C.stopResponse),"autoScroll"in C&&t(8,w=C.autoScroll),"atSelectedModel"in C&&t(0,m=C.atSelectedModel),"selectedModels"in C&&t(12,v=C.selectedModels),"history"in C&&t(13,I=C.history),"taskIds"in C&&t(14,P=C.taskIds),"prompt"in C&&t(1,R=C.prompt),"files"in C&&t(2,k=C.files),"toolServers"in C&&t(15,N=C.toolServers),"selectedToolIds"in C&&t(3,M=C.selectedToolIds),"selectedFilterIds"in C&&t(4,H=C.selectedFilterIds),"imageGenerationEnabled"in C&&t(5,V=C.imageGenerationEnabled),"webSearchEnabled"in C&&t(6,Q=C.webSearchEnabled),"codeInterpreterEnabled"in C&&t(7,J=C.codeInterpreterEnabled),"placeholder"in C&&t(16,X=C.placeholder)},o.$$.update=()=>{var C,Fe,xe,ht,He,it,Cn,An,Un;o.$$.dirty[0]&4097&&t(20,y=m!==void 0?[m.id]:v),o.$$.dirty[0]&254|o.$$.dirty[1]&131072&&h({prompt:R,files:k.filter(Gt=>Gt.type!=="image").map(Gt=>({...Gt,user:void 0,access_control:void 0})),selectedToolIds:M,selectedFilterIds:H,imageGenerationEnabled:V,webSearchEnabled:Q,codeInterpreterEnabled:J}),o.$$.dirty[0]&528385&&t(31,me=(m!=null&&m.id?[m.id]:v).filter(Gt=>{var Bt,Ht,zt,B;return((B=(zt=(Ht=(Bt=a.find(ce=>ce.id===Gt))==null?void 0:Bt.info)==null?void 0:Ht.meta)==null?void 0:zt.capabilities)==null?void 0:B.vision)??!0})),o.$$.dirty[0]&528385&&t(32,ne=(m!=null&&m.id?[m.id]:v).filter(Gt=>{var Bt,Ht,zt,B;return((B=(zt=(Ht=(Bt=a.find(ce=>ce.id===Gt))==null?void 0:Bt.info)==null?void 0:Ht.meta)==null?void 0:zt.capabilities)==null?void 0:B.file_upload)??!0})),o.$$.dirty[0]&528385&&t(49,q=(m!=null&&m.id?[m.id]:v).filter(Gt=>{var Bt,Ht,zt,B;return((B=(zt=(Ht=(Bt=a.find(ce=>ce.id===Gt))==null?void 0:Bt.info)==null?void 0:Ht.meta)==null?void 0:zt.capabilities)==null?void 0:B.web_search)??!0})),o.$$.dirty[0]&528385&&t(50,he=(m!=null&&m.id?[m.id]:v).filter(Gt=>{var Bt,Ht,zt,B;return((B=(zt=(Ht=(Bt=a.find(ce=>ce.id===Gt))==null?void 0:Bt.info)==null?void 0:Ht.meta)==null?void 0:zt.capabilities)==null?void 0:B.image_generation)??!0})),o.$$.dirty[0]&528385&&t(51,Z=(m!=null&&m.id?[m.id]:v).filter(Gt=>{var Bt,Ht,zt,B;return((B=(zt=(Ht=(Bt=a.find(ce=>ce.id===Gt))==null?void 0:Bt.info)==null?void 0:Ht.meta)==null?void 0:zt.capabilities)==null?void 0:B.code_interpreter)??!0})),o.$$.dirty[0]&528385&&t(33,x=(m!=null&&m.id?[m.id]:v).map(Gt=>{var Bt;return((Bt=a.find(Ht=>Ht.id===Gt)||{})==null?void 0:Bt.filters)??[]}).reduce((Gt,Bt)=>Gt.filter(Ht=>Bt.some(zt=>zt.id===Ht.id)))),o.$$.dirty[0]&32776&&t(34,_e=N.length+M.length>0),o.$$.dirty[0]&397313|o.$$.dirty[1]&262144&&t(35,Pe=(m!=null&&m.id?[m.id]:v).length===q.length&&((C=n==null?void 0:n.features)==null?void 0:C.enable_web_search)&&(s.role==="admin"||((xe=(Fe=s==null?void 0:s.permissions)==null?void 0:Fe.features)==null?void 0:xe.web_search))),o.$$.dirty[0]&397313|o.$$.dirty[1]&524288&&t(36,De=(m!=null&&m.id?[m.id]:v).length===he.length&&((ht=n==null?void 0:n.features)==null?void 0:ht.enable_image_generation)&&(s.role==="admin"||((it=(He=s==null?void 0:s.permissions)==null?void 0:He.features)==null?void 0:it.image_generation))),o.$$.dirty[0]&397313|o.$$.dirty[1]&1048576&&t(37,ge=(m!=null&&m.id?[m.id]:v).length===Z.length&&((Cn=n==null?void 0:n.features)==null?void 0:Cn.enable_code_interpreter)&&(s.role==="admin"||((Un=(An=s==null?void 0:s.permissions)==null?void 0:An.features)==null?void 0:Un.code_interpreter)))},[m,R,k,M,H,V,Q,J,w,f,p,b,v,I,P,N,X,n,s,a,y,E,Y,D,W,F,G,K,j,re,ue,me,ne,x,_e,Pe,De,ge,r,i,l,c,u,d,ct,at,kt,_t,h,q,he,Z,sn,Vt,Jt,le,Xe,vt,fe,qe,Ke,nt,wt,pt,Mt,Kt,an,jt,ln,vn,At,hn,kn,Sn,Lt,Ro,zo,Or,Nr,Dr,Hr,Ur,Lr,Br,zr,Fr,Vr,Kr,Gr,Wr,Yr,qr,jr,Qr,Xr,Jr,Zr,xr,$r,ei]}class yg extends We{constructor(e){super(),Ye(this,e,Pw,Mw,Qe,{transparentBackground:9,onChange:48,createMessagePair:10,stopResponse:11,autoScroll:8,atSelectedModel:0,selectedModels:12,history:13,taskIds:14,prompt:1,files:2,toolServers:15,selectedToolIds:3,selectedFilterIds:4,imageGenerationEnabled:5,webSearchEnabled:6,codeInterpreterEnabled:7,placeholder:16},null,[-1,-1,-1,-1])}}function Cu(o,e,t){const n=o.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function Eu(o){let e,t,n,r;const i=[Nw,Ow],s=[];function a(l,c){return l[15]===0?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=Ve()},l(l){t.l(l),n=Ve()},m(l,c){s[e].m(l,c),z(l,n,c),r=!0},p(l,c){t.p(l,c)},i(l){r||(T(t),r=!0)},o(l){O(t),r=!1},d(l){l&&_(n),s[e].d(l)}}}function Ow(o){let e,t,n;return t=new Ft({props:{content:o[4].t("Remove Model"),$$slots:{default:[Dw]},$$scope:{ctx:o}}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"class","self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i&16&&(s.content=r[4].t("Remove Model")),i&65539&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function Nw(o){let e,t,n;return t=new Ft({props:{content:o[4].t("Add Model"),$$slots:{default:[Hw]},$$scope:{ctx:o}}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"class","self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i&16&&(s.content=r[4].t("Add Model")),i&65539&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function Dw(o){let e,t,n,r,i;function s(){return o[11](o[15])}return{c(){e=U("button"),t=Ce("svg"),n=Ce("path"),this.h()},l(a){e=L(a,"BUTTON",{"aria-label":!0});var l=A(e);t=Ee(l,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var c=A(t);n=Ee(c,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(n).forEach(_),c.forEach(_),l.forEach(_),this.h()},h(){g(n,"stroke-linecap","round"),g(n,"stroke-linejoin","round"),g(n,"d","M19.5 12h-15"),g(t,"xmlns","http://www.w3.org/2000/svg"),g(t,"fill","none"),g(t,"viewBox","0 0 24 24"),g(t,"stroke-width","2"),g(t,"stroke","currentColor"),g(t,"class","size-3"),e.disabled=o[1],g(e,"aria-label","Remove Model")},m(a,l){z(a,e,l),S(e,t),S(t,n),r||(i=Ae(e,"click",s),r=!0)},p(a,l){o=a,l&2&&(e.disabled=o[1])},d(a){a&&_(e),r=!1,i()}}}function Hw(o){let e,t,n,r,i;return{c(){e=U("button"),t=Ce("svg"),n=Ce("path"),this.h()},l(s){e=L(s,"BUTTON",{class:!0,"aria-label":!0});var a=A(e);t=Ee(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var l=A(t);n=Ee(l,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(n).forEach(_),l.forEach(_),a.forEach(_),this.h()},h(){g(n,"stroke-linecap","round"),g(n,"stroke-linejoin","round"),g(n,"d","M12 6v12m6-6H6"),g(t,"xmlns","http://www.w3.org/2000/svg"),g(t,"fill","none"),g(t,"viewBox","0 0 24 24"),g(t,"stroke-width","2"),g(t,"stroke","currentColor"),g(t,"class","size-3.5"),g(e,"class",""),e.disabled=o[1],g(e,"aria-label","Add Model")},m(s,a){z(s,e,a),S(e,t),S(t,n),r||(i=Ae(e,"click",o[10]),r=!0)},p(s,a){a&2&&(e.disabled=s[1])},d(s){s&&_(e),r=!1,i()}}}function Iu(o){var f,h,p,b,w,m,v,y,I,P,R;let e,t,n,r,i,s,a,l;function c(k){o[9](k,o[13],o[14],o[15])}let u={id:`${o[15]}`,placeholder:o[4].t("Select a model"),items:o[3].map(Su),showTemporaryChatControl:((f=o[5])==null?void 0:f.role)==="user"?(((b=(p=(h=o[5])==null?void 0:h.permissions)==null?void 0:p.chat)==null?void 0:b.temporary)??!0)&&!(((v=(m=(w=o[5])==null?void 0:w.permissions)==null?void 0:m.chat)==null?void 0:v.temporary_enforced)??!1):!0,pinModelHandler:o[8]};o[13]!==void 0&&(u.value=o[13]),r=new kp({props:u}),ze.push(()=>Ze(r,"value",c));let d=(((y=o[5])==null?void 0:y.role)==="admin"||(((R=(P=(I=o[5])==null?void 0:I.permissions)==null?void 0:P.chat)==null?void 0:R.multiple_models)??!0))&&Eu(o);return{c(){e=U("div"),t=U("div"),n=U("div"),$(r.$$.fragment),s=ie(),d&&d.c(),a=ie(),this.h()},l(k){e=L(k,"DIV",{class:!0});var N=A(e);t=L(N,"DIV",{class:!0});var M=A(t);n=L(M,"DIV",{class:!0});var H=A(n);oe(r.$$.fragment,H),H.forEach(_),M.forEach(_),s=se(N),d&&d.l(N),a=se(N),N.forEach(_),this.h()},h(){g(n,"class","mr-1 max-w-full"),g(t,"class","overflow-hidden w-full"),g(e,"class","flex w-full max-w-fit")},m(k,N){z(k,e,N),S(e,t),S(t,n),ee(r,n,null),S(e,s),d&&d.m(e,null),S(e,a),l=!0},p(k,N){var H,V,Q,J,E,Y,D,W,F,G,K;o=k;const M={};N&16&&(M.placeholder=o[4].t("Select a model")),N&8&&(M.items=o[3].map(Su)),N&32&&(M.showTemporaryChatControl=((H=o[5])==null?void 0:H.role)==="user"?(((J=(Q=(V=o[5])==null?void 0:V.permissions)==null?void 0:Q.chat)==null?void 0:J.temporary)??!0)&&!(((D=(Y=(E=o[5])==null?void 0:E.permissions)==null?void 0:Y.chat)==null?void 0:D.temporary_enforced)??!1):!0),!i&&N&1&&(i=!0,M.value=o[13],Je(()=>i=!1)),r.$set(M),((W=o[5])==null?void 0:W.role)==="admin"||(((K=(G=(F=o[5])==null?void 0:F.permissions)==null?void 0:G.chat)==null?void 0:K.multiple_models)??!0)?d?(d.p(o,N),N&32&&T(d,1)):(d=Eu(o),d.c(),T(d,1),d.m(e,a)):d&&(Re(),O(d,1,1,()=>{d=null}),Me())},i(k){l||(T(r.$$.fragment,k),T(d),l=!0)},o(k){O(r.$$.fragment,k),O(d),l=!1},d(k){k&&_(e),te(r),d&&d.d()}}}function Tu(o){let e,t,n=o[4].t("Set as default")+"",r,i,s;return{c(){e=U("div"),t=U("button"),r=Oe(n),this.h()},l(a){e=L(a,"DIV",{class:!0});var l=A(e);t=L(l,"BUTTON",{});var c=A(t);r=Ne(c,n),c.forEach(_),l.forEach(_),this.h()},h(){g(e,"class","absolute text-left mt-[1px] ml-1 text-[0.7rem] text-gray-600 dark:text-gray-400 font-primary")},m(a,l){z(a,e,l),S(e,t),S(t,r),i||(s=Ae(t,"click",o[7]),i=!0)},p(a,l){l&16&&n!==(n=a[4].t("Set as default")+"")&&Be(r,n)},d(a){a&&_(e),i=!1,s()}}}function Uw(o){let e,t,n,r,i=yt(o[0]),s=[];for(let c=0;c<i.length;c+=1)s[c]=Iu(Cu(o,i,c));const a=c=>O(s[c],1,1,()=>{s[c]=null});let l=o[2]&&Tu(o);return{c(){e=U("div");for(let c=0;c<s.length;c+=1)s[c].c();t=ie(),l&&l.c(),n=Ve(),this.h()},l(c){e=L(c,"DIV",{class:!0});var u=A(e);for(let d=0;d<s.length;d+=1)s[d].l(u);u.forEach(_),t=se(c),l&&l.l(c),n=Ve(),this.h()},h(){g(e,"class","flex flex-col w-full items-start")},m(c,u){z(c,e,u);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(e,null);z(c,t,u),l&&l.m(c,u),z(c,n,u),r=!0},p(c,[u]){if(u&315){i=yt(c[0]);let d;for(d=0;d<i.length;d+=1){const f=Cu(c,i,d);s[d]?(s[d].p(f,u),T(s[d],1)):(s[d]=Iu(f),s[d].c(),T(s[d],1),s[d].m(e,null))}for(Re(),d=i.length;d<s.length;d+=1)a(d);Me()}c[2]?l?l.p(c,u):(l=Tu(c),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null)},i(c){if(!r){for(let u=0;u<i.length;u+=1)T(s[u]);r=!0}},o(c){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)O(s[u]);r=!1},d(c){c&&(_(e),_(t),_(n)),Hn(s,c),l&&l.d(c)}}}const Su=o=>({value:o.id,label:o.name,model:o});function Lw(o,e,t){let n,r,i,s;de(o,nr,w=>t(3,n=w)),de(o,qn,w=>t(12,r=w)),de(o,bo,w=>t(5,s=w));const a=rn("i18n");de(o,a,w=>t(4,i=w));let{selectedModels:l=[""]}=e,{disabled:c=!1}=e,{showSetDefault:u=!0}=e;const d=async()=>{if(l.filter(m=>m==="").length){rt.error(i.t("Choose a model before saving..."));return}qn.set({...r,models:l}),await jl(localStorage.token,{ui:r}),rt.success(i.t("Default model updated"))},f=async w=>{let m=(r==null?void 0:r.pinnedModels)??[];m.includes(w)?m=m.filter(v=>v!==w):m=[...new Set([...m,w])],qn.set({...r,pinnedModels:m}),await jl(localStorage.token,{ui:r})};function h(w,m,v,y){v[y]=w,t(0,l),t(3,n)}const p=()=>{t(0,l=[...l,""])},b=w=>{l.splice(w,1),t(0,l),t(3,n)};return o.$$set=w=>{"selectedModels"in w&&t(0,l=w.selectedModels),"disabled"in w&&t(1,c=w.disabled),"showSetDefault"in w&&t(2,u=w.showSetDefault)},o.$$.update=()=>{o.$$.dirty&9&&l.length>0&&n.length>0&&t(0,l=l.map(w=>n.map(m=>m.id).includes(w)?w:""))},[l,c,u,n,i,s,a,d,f,h,p,b]}class Bw extends We{constructor(e){super(),Ye(this,e,Lw,Uw,Qe,{selectedModels:0,disabled:1,showSetDefault:2})}}function zw(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,viewBox:!0,stroke:!0,fill:!0,class:!0,"stroke-width":!0});var r=A(e);t=Ee(r,"path",{d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"d","M18.75 12.75h1.5a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM12 6a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 6ZM12 18a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 18ZM3.75 6.75h1.5a.75.75 0 1 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM5.25 18.75h-1.5a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 0 1.5ZM3 12a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 3 12ZM9 3.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5ZM12.75 12a2.25 2.25 0 1 1 4.5 0 2.25 2.25 0 0 1-4.5 0ZM9 15.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"stroke","currentColor"),g(e,"fill","currentColor"),g(e,"class",o[0]),g(e,"stroke-width",o[1])},m(n,r){z(n,e,r),S(e,t)},p(n,[r]){r&1&&g(e,"class",n[0]),r&2&&g(e,"stroke-width",n[1])},i:Ue,o:Ue,d(n){n&&_(e)}}}function Fw(o,e,t){let{className:n="w-4 h-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class wg extends We{constructor(e){super(),Ye(this,e,Fw,zw,Qe,{className:0,strokeWidth:1})}}function Vw(o){let e;const t=o[14].default,n=pn(t,o,o[24],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&16777216)&&_n(n,t,r,r[24],e?yn(t,r[24],i,null):bn(r[24]),null)},i(r){e||(T(n,r),e=!0)},o(r){O(n,r),e=!1},d(r){n&&n.d(r)}}}function Au(o){let e,t;return e=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",id:"chat-controls-button",$$slots:{default:[Kw]},$$scope:{ctx:o}}}),e.$on("click",o[15]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&16777248&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Kw(o){let e,t,n,r=o[5].t("Controls")+"",i,s;return e=new wg({props:{className:" size-4",strokeWidth:"0.5"}}),{c(){$(e.$$.fragment),t=ie(),n=U("div"),i=Oe(r),this.h()},l(a){oe(e.$$.fragment,a),t=se(a),n=L(a,"DIV",{class:!0});var l=A(n);i=Ne(l,r),l.forEach(_),this.h()},h(){g(n,"class","flex items-center")},m(a,l){ee(e,a,l),z(a,t,l),z(a,n,l),S(n,i),s=!0},p(a,l){(!s||l&32)&&r!==(r=a[5].t("Controls")+"")&&Be(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){O(e.$$.fragment,a),s=!1},d(a){a&&(_(t),_(n)),te(e,a)}}}function Ru(o){let e,t;return e=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",id:"chat-share-button",$$slots:{default:[Gw]},$$scope:{ctx:o}}}),e.$on("click",o[16]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&16777248&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Gw(o){let e,t,n,r,i=o[5].t("Share")+"",s;return{c(){e=Ce("svg"),t=Ce("path"),n=ie(),r=U("div"),s=Oe(i),this.h()},l(a){e=Ee(a,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var l=A(e);t=Ee(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),A(t).forEach(_),l.forEach(_),n=se(a),r=L(a,"DIV",{class:!0});var c=A(r);s=Ne(c,i),c.forEach(_),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z"),g(t,"clip-rule","evenodd"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"class","size-4"),g(r,"class","flex items-center")},m(a,l){z(a,e,l),S(e,t),z(a,n,l),z(a,r,l),S(r,s)},p(a,l){l&32&&i!==(i=a[5].t("Share")+"")&&Be(s,i)},d(a){a&&(_(e),_(n),_(r))}}}function Ww(o){let e,t,n,r=o[5].t("Overview")+"",i,s;return e=new Ip({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){$(e.$$.fragment),t=ie(),n=U("div"),i=Oe(r),this.h()},l(a){oe(e.$$.fragment,a),t=se(a),n=L(a,"DIV",{class:!0});var l=A(n);i=Ne(l,r),l.forEach(_),this.h()},h(){g(n,"class","flex items-center")},m(a,l){ee(e,a,l),z(a,t,l),z(a,n,l),S(n,i),s=!0},p(a,l){(!s||l&32)&&r!==(r=a[5].t("Overview")+"")&&Be(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){O(e.$$.fragment,a),s=!1},d(a){a&&(_(t),_(n)),te(e,a)}}}function Yw(o){let e,t,n,r=o[5].t("Artifacts")+"",i,s;return e=new fm({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){$(e.$$.fragment),t=ie(),n=U("div"),i=Oe(r),this.h()},l(a){oe(e.$$.fragment,a),t=se(a),n=L(a,"DIV",{class:!0});var l=A(n);i=Ne(l,r),l.forEach(_),this.h()},h(){g(n,"class","flex items-center")},m(a,l){ee(e,a,l),z(a,t,l),z(a,n,l),S(n,i),s=!0},p(a,l){(!s||l&32)&&r!==(r=a[5].t("Artifacts")+"")&&Be(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){O(e.$$.fragment,a),s=!1},d(a){a&&(_(t),_(n)),te(e,a)}}}function qw(o){let e,t,n,r,i=o[5].t("Download")+"",s;return{c(){e=Ce("svg"),t=Ce("path"),n=ie(),r=U("div"),s=Oe(i),this.h()},l(a){e=Ee(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var l=A(e);t=Ee(l,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(_),l.forEach(_),n=se(a),r=L(a,"DIV",{class:!0});var c=A(r);s=Ne(c,i),c.forEach(_),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width","1.5"),g(e,"stroke","currentColor"),g(e,"class","size-4"),g(r,"class","flex items-center")},m(a,l){z(a,e,l),S(e,t),z(a,n,l),z(a,r,l),S(r,s)},p(a,l){l&32&&i!==(i=a[5].t("Download")+"")&&Be(s,i)},d(a){a&&(_(e),_(n),_(r))}}}function Mu(o){let e,t;return e=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",$$slots:{default:[jw]},$$scope:{ctx:o}}}),e.$on("click",o[19]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&16777248&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function jw(o){let e,t=o[5].t("Export chat (.json)")+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i&32&&t!==(t=r[5].t("Export chat (.json)")+"")&&Be(n,t)},d(r){r&&_(e)}}}function Qw(o){let e,t=o[5].t("Plain text (.txt)")+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i&32&&t!==(t=r[5].t("Plain text (.txt)")+"")&&Be(n,t)},d(r){r&&_(e)}}}function Xw(o){let e,t=o[5].t("PDF document (.pdf)")+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i&32&&t!==(t=r[5].t("PDF document (.pdf)")+"")&&Be(n,t)},d(r){r&&_(e)}}}function Jw(o){var a,l,c;let e,t,n,r,i,s=(((a=o[6])==null?void 0:a.role)==="admin"||(((c=(l=o[6].permissions)==null?void 0:l.chat)==null?void 0:c.export)??!0))&&Mu(o);return t=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",$$slots:{default:[Qw]},$$scope:{ctx:o}}}),t.$on("click",o[20]),r=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",$$slots:{default:[Xw]},$$scope:{ctx:o}}}),r.$on("click",o[21]),{c(){s&&s.c(),e=ie(),$(t.$$.fragment),n=ie(),$(r.$$.fragment)},l(u){s&&s.l(u),e=se(u),oe(t.$$.fragment,u),n=se(u),oe(r.$$.fragment,u)},m(u,d){s&&s.m(u,d),z(u,e,d),ee(t,u,d),z(u,n,d),ee(r,u,d),i=!0},p(u,d){var p,b,w;((p=u[6])==null?void 0:p.role)==="admin"||(((w=(b=u[6].permissions)==null?void 0:b.chat)==null?void 0:w.export)??!0)?s?(s.p(u,d),d&64&&T(s,1)):(s=Mu(u),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(Re(),O(s,1,1,()=>{s=null}),Me());const f={};d&16777248&&(f.$$scope={dirty:d,ctx:u}),t.$set(f);const h={};d&16777248&&(h.$$scope={dirty:d,ctx:u}),r.$set(h)},i(u){i||(T(s),T(t.$$.fragment,u),T(r.$$.fragment,u),i=!0)},o(u){O(s),O(t.$$.fragment,u),O(r.$$.fragment,u),i=!1},d(u){u&&(_(e),_(n)),s&&s.d(u),te(t,u),te(r,u)}}}function Zw(o){let e,t,n,r;return e=new wf({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",$$slots:{default:[qw]},$$scope:{ctx:o}}}),n=new vf({props:{class:"w-full rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",transition:ks,sideOffset:8,$$slots:{default:[Jw]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment)},l(i){oe(e.$$.fragment,i),t=se(i),oe(n.$$.fragment,i)},m(i,s){ee(e,i,s),z(i,t,s),ee(n,i,s),r=!0},p(i,s){const a={};s&16777248&&(a.$$scope={dirty:s,ctx:i}),e.$set(a);const l={};s&16777312&&(l.$$scope={dirty:s,ctx:i}),n.$set(l)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),O(n.$$.fragment,i),r=!1},d(i){i&&_(t),te(e,i),te(n,i)}}}function xw(o){let e,t,n,r=o[5].t("Copy")+"",i,s;return e=new hm({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){$(e.$$.fragment),t=ie(),n=U("div"),i=Oe(r),this.h()},l(a){oe(e.$$.fragment,a),t=se(a),n=L(a,"DIV",{class:!0});var l=A(n);i=Ne(l,r),l.forEach(_),this.h()},h(){g(n,"class","flex items-center")},m(a,l){ee(e,a,l),z(a,t,l),z(a,n,l),S(n,i),s=!0},p(a,l){(!s||l&32)&&r!==(r=a[5].t("Copy")+"")&&Be(i,r)},i(a){s||(T(e.$$.fragment,a),s=!0)},o(a){O(e.$$.fragment,a),s=!1},d(a){a&&(_(t),_(n)),te(e,a)}}}function Pu(o){let e,t,n,r,i;return r=new yp({props:{chatId:o[1].id}}),{c(){e=U("hr"),t=ie(),n=U("div"),$(r.$$.fragment),this.h()},l(s){e=L(s,"HR",{class:!0}),t=se(s),n=L(s,"DIV",{class:!0});var a=A(n);oe(r.$$.fragment,a),a.forEach(_),this.h()},h(){g(e,"class","border-gray-100 dark:border-gray-850 my-0.5"),g(n,"class","flex p-1")},m(s,a){z(s,e,a),z(s,t,a),z(s,n,a),ee(r,n,null),i=!0},p(s,a){const l={};a&2&&(l.chatId=s[1].id),r.$set(l)},i(s){i||(T(r.$$.fragment,s),i=!0)},o(s){O(r.$$.fragment,s),i=!1},d(s){s&&(_(e),_(t),_(n)),te(r)}}}function $w(o){var w,m,v;let e,t,n,r,i,s,a,l,c,u,d,f,h=o[4]&&Au(o),p=!o[3]&&(((w=o[6])==null?void 0:w.role)==="admin"||(((v=(m=o[6].permissions)==null?void 0:m.chat)==null?void 0:v.share)??!0))&&Ru(o);n=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",id:"chat-overview-button",$$slots:{default:[Ww]},$$scope:{ctx:o}}}),n.$on("click",o[17]),i=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",id:"chat-overview-button",$$slots:{default:[Yw]},$$scope:{ctx:o}}}),i.$on("click",o[18]),a=new yf({props:{$$slots:{default:[Zw]},$$scope:{ctx:o}}}),c=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md select-none w-full",id:"chat-copy-button",$$slots:{default:[xw]},$$scope:{ctx:o}}}),c.$on("click",o[22]);let b=!o[3]&&Pu(o);return{c(){h&&h.c(),e=ie(),p&&p.c(),t=ie(),$(n.$$.fragment),r=ie(),$(i.$$.fragment),s=ie(),$(a.$$.fragment),l=ie(),$(c.$$.fragment),u=ie(),b&&b.c(),d=Ve()},l(y){h&&h.l(y),e=se(y),p&&p.l(y),t=se(y),oe(n.$$.fragment,y),r=se(y),oe(i.$$.fragment,y),s=se(y),oe(a.$$.fragment,y),l=se(y),oe(c.$$.fragment,y),u=se(y),b&&b.l(y),d=Ve()},m(y,I){h&&h.m(y,I),z(y,e,I),p&&p.m(y,I),z(y,t,I),ee(n,y,I),z(y,r,I),ee(i,y,I),z(y,s,I),ee(a,y,I),z(y,l,I),ee(c,y,I),z(y,u,I),b&&b.m(y,I),z(y,d,I),f=!0},p(y,I){var M,H,V;y[4]?h?(h.p(y,I),I&16&&T(h,1)):(h=Au(y),h.c(),T(h,1),h.m(e.parentNode,e)):h&&(Re(),O(h,1,1,()=>{h=null}),Me()),!y[3]&&(((M=y[6])==null?void 0:M.role)==="admin"||(((V=(H=y[6].permissions)==null?void 0:H.chat)==null?void 0:V.share)??!0))?p?(p.p(y,I),I&72&&T(p,1)):(p=Ru(y),p.c(),T(p,1),p.m(t.parentNode,t)):p&&(Re(),O(p,1,1,()=>{p=null}),Me());const P={};I&16777248&&(P.$$scope={dirty:I,ctx:y}),n.$set(P);const R={};I&16777248&&(R.$$scope={dirty:I,ctx:y}),i.$set(R);const k={};I&16777312&&(k.$$scope={dirty:I,ctx:y}),a.$set(k);const N={};I&16777248&&(N.$$scope={dirty:I,ctx:y}),c.$set(N),y[3]?b&&(Re(),O(b,1,1,()=>{b=null}),Me()):b?(b.p(y,I),I&8&&T(b,1)):(b=Pu(y),b.c(),T(b,1),b.m(d.parentNode,d))},i(y){f||(T(h),T(p),T(n.$$.fragment,y),T(i.$$.fragment,y),T(a.$$.fragment,y),T(c.$$.fragment,y),T(b),f=!0)},o(y){O(h),O(p),O(n.$$.fragment,y),O(i.$$.fragment,y),O(a.$$.fragment,y),O(c.$$.fragment,y),O(b),f=!1},d(y){y&&(_(e),_(t),_(r),_(s),_(l),_(u),_(d)),h&&h.d(y),p&&p.d(y),te(n,y),te(i,y),te(a,y),te(c,y),b&&b.d(y)}}}function ev(o){let e,t,n;return t=new za({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5  z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:8,side:"bottom",align:"end",transition:ks,$$slots:{default:[$w]},$$scope:{ctx:o}}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{slot:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"slot","content")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i&16777339&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function tv(o){let e,t;return e=new Fa({props:{$$slots:{content:[ev],default:[Vw]},$$scope:{ctx:o}}}),e.$on("change",o[23]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,[r]){const i={};r&16777339&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function nv(o,e,t){let n,r,i,s,a;de(o,mi,E=>t(3,n=E)),de(o,qn,E=>t(25,r=E)),de(o,Ti,E=>t(4,i=E)),de(o,bo,E=>t(6,a=E));let{$$slots:l={},$$scope:c}=e;const{saveAs:u}=Cp,d=rn("i18n");de(o,d,E=>t(5,s=E));let{shareEnabled:f=!1}=e,{shareHandler:h}=e,{downloadHandler:p}=e,{chat:b}=e,{onClose:w=()=>{}}=e;const m=async()=>{const E=b.chat.history;return Gn(E,E.currentId).reduce((W,F,G,K)=>`${W}### ${F.role.toUpperCase()}
${F.content}

`,"").trim()},v=async()=>{const E=await m();let Y=new Blob([E],{type:"text/plain"});u(Y,`chat-${b.chat.title}.txt`)},y=async()=>{if((r==null?void 0:r.stylizedPdfExport)??!0){const E=document.getElementById("messages-container");if(E)try{const Y=document.documentElement.classList.contains("dark"),D=800,W=1200,F=E.cloneNode(!0);F.classList.add("text-black"),F.classList.add("dark:text-white"),F.style.width=`${D}px`,F.style.position="absolute",F.style.left="-9999px",F.style.height="auto",document.body.appendChild(F);const G=F.scrollHeight;let K=0,j=0;const re=new Zl("p","mm","a4"),ue=210,X=297;for(;K<G;){F.scrollTop=K,F.style.maxHeight=`${W}px`;const me=await Ep(F,{backgroundColor:Y?"#000":"#fff",useCORS:!0,scale:2,width:D,height:Math.min(W,G-K),windowWidth:D}),ne=me.toDataURL("image/png"),q=me.height*ue/me.width,he=0;j>0&&re.addPage(),Y&&(re.setFillColor(0,0,0),re.rect(0,0,ue,X,"F")),re.addImage(ne,"PNG",0,he,ue,q),K+=W,j++}document.body.removeChild(F),re.save(`chat-${b.chat.title}.pdf`)}catch(Y){console.error("Error generating PDF",Y)}}else{const E=await m(),Y=new Zl,D=15,W=20,F=15,G=20,K=Y.internal.pageSize.getWidth(),j=Y.internal.pageSize.getHeight(),re=K-D-F,ue=8;Y.setFontSize(ue);const X=ue*1,me=E.split(`
`);let ne=W;for(let q of me){const he=Y.splitTextToSize(q,re);for(let Z of he)ne+X>j-G&&(Y.addPage(),ne=W),Y.text(Z,D,ne),ne+=X*.5;ne+=X*.1}Y.save(`chat-${b.chat.title}.pdf`)}},I=async()=>{if(b.id){let E=null;b.id==="local"||n?E=b:E=await ua(localStorage.token,b.id);let Y=new Blob([JSON.stringify([E])],{type:"application/json"});u(Y,`chat-export-${Date.now()}.json`)}},P=async()=>{await Zt.set(!0),await Co.set(!1),await go.set(!1)},R=()=>{h()},k=async()=>{await Zt.set(!0),await Co.set(!0),await go.set(!1)},N=async()=>{await Zt.set(!0),await go.set(!0),await Co.set(!1)},M=()=>{I()},H=()=>{v()},V=()=>{y()},Q=async()=>{await La(await m()).catch(Y=>{console.error(Y)})&&rt.success(s.t("Copied to clipboard"))},J=E=>{E.detail===!1&&w()};return o.$$set=E=>{"shareEnabled"in E&&t(12,f=E.shareEnabled),"shareHandler"in E&&t(0,h=E.shareHandler),"downloadHandler"in E&&t(13,p=E.downloadHandler),"chat"in E&&t(1,b=E.chat),"onClose"in E&&t(2,w=E.onClose),"$$scope"in E&&t(24,c=E.$$scope)},[h,b,w,n,i,s,a,d,m,v,y,I,f,p,l,P,R,k,N,M,H,V,Q,J,c]}class ov extends We{constructor(e){super(),Ye(this,e,nv,tv,Qe,{shareEnabled:12,shareHandler:0,downloadHandler:13,chat:1,onClose:2})}}function Ou(o,e,t){const n=o.slice();return n[31]=e[t],n}function Nu(o){let e,t;return e=new Ft({props:{content:o[11].t("New Chat"),$$slots:{default:[rv]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&2048&&(i.content=n[11].t("New Chat")),r[0]&514|r[1]&8&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function rv(o){let e,t,n,r,i,s,a;return n=new vp({props:{className:" size-5",strokeWidth:"2"}}),{c(){e=U("button"),t=U("div"),$(n.$$.fragment),this.h()},l(l){e=L(l,"BUTTON",{class:!0,"aria-label":!0});var c=A(e);t=L(c,"DIV",{class:!0});var u=A(t);oe(n.$$.fragment,u),u.forEach(_),c.forEach(_),this.h()},h(){g(t,"class","m-auto self-center"),g(e,"class",r="flex "+(o[9]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","New Chat")},m(l,c){z(l,e,c),S(e,t),ee(n,t,null),i=!0,s||(a=Ae(e,"click",o[22]),s=!0)},p(l,c){(!i||c[0]&512&&r!==(r="flex "+(l[9]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition"))&&g(e,"class",r)},i(l){i||(T(n.$$.fragment,l),i=!0)},o(l){O(n.$$.fragment,l),i=!1},d(l){l&&_(e),te(n),s=!1,a()}}}function Du(o){let e,t,n;function r(s){o[23](s)}let i={showSetDefault:!o[2]};return o[0]!==void 0&&(i.selectedModels=o[0]),e=new Bw({props:i}),ze.push(()=>Ze(e,"selectedModels",r)),{c(){$(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,a){ee(e,s,a),n=!0},p(s,a){const l={};a[0]&4&&(l.showSetDefault=!s[2]),!t&&a[0]&1&&(t=!0,l.selectedModels=s[0],Je(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function Hu(o){let e,t;return e=new ov({props:{chat:o[3],shareEnabled:o[2],shareHandler:o[24],downloadHandler:o[25],$$slots:{default:[iv]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&8&&(i.chat=n[3]),r[0]&4&&(i.shareEnabled=n[2]),r[0]&64&&(i.shareHandler=n[24]),r[0]&128&&(i.downloadHandler=n[25]),r[1]&8&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function iv(o){let e,t='<div class="m-auto self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"></path></svg></div>';return{c(){e=U("button"),e.innerHTML=t,this.h()},l(n){e=L(n,"BUTTON",{class:!0,id:!0,"data-svelte-h":!0}),dn(e)!=="svelte-1cq3yl7"&&(e.innerHTML=t),this.h()},h(){g(e,"class","flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"id","chat-context-menu-button")},m(n,r){z(n,e,r)},p:Ue,d(n){n&&_(e)}}}function sv(o){let e,t,n,r,i,s;return n=new wg({props:{className:" size-5",strokeWidth:"0.5"}}),{c(){e=U("button"),t=U("div"),$(n.$$.fragment),this.h()},l(a){e=L(a,"BUTTON",{class:!0,"aria-label":!0});var l=A(e);t=L(l,"DIV",{class:!0});var c=A(t);oe(n.$$.fragment,c),c.forEach(_),l.forEach(_),this.h()},h(){g(t,"class","m-auto self-center"),g(e,"class","flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","Controls")},m(a,l){z(a,e,l),S(e,t),ee(n,t,null),r=!0,i||(s=Ae(e,"click",o[26]),i=!0)},p:Ue,i(a){r||(T(n.$$.fragment,a),r=!0)},o(a){O(n.$$.fragment,a),r=!1},d(a){a&&_(e),te(n),i=!1,s()}}}function Uu(o){var n;let e,t;return e=new Tp({props:{className:"max-w-[240px]",role:(n=o[14])==null?void 0:n.role,help:!0,$$slots:{default:[av]},$$scope:{ctx:o}}}),e.$on("show",o[27]),{c(){$(e.$$.fragment)},l(r){oe(e.$$.fragment,r)},m(r,i){ee(e,r,i),t=!0},p(r,i){var a;const s={};i[0]&16384&&(s.role=(a=r[14])==null?void 0:a.role),i[0]&16384|i[1]&8&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(T(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){te(e,r)}}}function av(o){let e,t,n,r;return{c(){e=U("button"),t=U("div"),n=U("img"),this.h()},l(i){e=L(i,"BUTTON",{class:!0,"aria-label":!0});var s=A(e);t=L(s,"DIV",{class:!0});var a=A(t);n=L(a,"IMG",{src:!0,class:!0,alt:!0,draggable:!0}),a.forEach(_),s.forEach(_),this.h()},h(){var i;oo(n.src,r=(i=o[14])==null?void 0:i.profile_image_url)||g(n,"src",r),g(n,"class","size-6 object-cover rounded-full"),g(n,"alt","User profile"),g(n,"draggable","false"),g(t,"class","self-center"),g(e,"class","select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","User Menu")},m(i,s){z(i,e,s),S(e,t),S(t,n)},p(i,s){var a;s[0]&16384&&!oo(n.src,r=(a=i[14])==null?void 0:a.profile_image_url)&&g(n,"src",r)},d(i){i&&_(e)}}}function Lu(o){let e,t,n=o[11].t("Temporary Chat")+"",r;return{c(){e=U("div"),t=U("div"),r=Oe(n),this.h()},l(i){e=L(i,"DIV",{class:!0});var s=A(e);t=L(s,"DIV",{class:!0});var a=A(t);r=Ne(a,n),a.forEach(_),s.forEach(_),this.h()},h(){g(t,"class","text-xs text-gray-500"),g(e,"class","w-full z-30 text-center")},m(i,s){z(i,e,s),S(e,t),S(t,r)},p(i,s){s[0]&2048&&n!==(n=i[11].t("Temporary Chat")+"")&&Be(r,n)},d(i){i&&_(e)}}}function Bu(o){var d,f,h,p,b,w,m;let e,t,n,r,i,s=(((f=(d=o[16])==null?void 0:d.license_metadata)==null?void 0:f.type)??null)==="trial"&&zu(o),a=(((p=(h=o[16])==null?void 0:h.license_metadata)==null?void 0:p.seats)??null)!==null&&((b=o[16])==null?void 0:b.user_count)>((m=(w=o[16])==null?void 0:w.license_metadata)==null?void 0:m.seats)&&Fu(o),l=yt(o[15].filter(o[28])),c=[];for(let v=0;v<l.length;v+=1)c[v]=Vu(Ou(o,l,v));const u=v=>O(c[v],1,1,()=>{c[v]=null});return{c(){e=U("div"),t=U("div"),s&&s.c(),n=ie(),a&&a.c(),r=ie();for(let v=0;v<c.length;v+=1)c[v].c();this.h()},l(v){e=L(v,"DIV",{class:!0});var y=A(e);t=L(y,"DIV",{class:!0});var I=A(t);s&&s.l(I),n=se(I),a&&a.l(I),r=se(I);for(let P=0;P<c.length;P+=1)c[P].l(I);I.forEach(_),y.forEach(_),this.h()},h(){g(t,"class","flex flex-col gap-1 w-full"),g(e,"class","w-full z-30 mt-5")},m(v,y){z(v,e,y),S(e,t),s&&s.m(t,null),S(t,n),a&&a.m(t,null),S(t,r);for(let I=0;I<c.length;I+=1)c[I]&&c[I].m(t,null);i=!0},p(v,y){var I,P,R,k,N,M,H;if((((P=(I=v[16])==null?void 0:I.license_metadata)==null?void 0:P.type)??null)==="trial"?s?(s.p(v,y),y[0]&65536&&T(s,1)):(s=zu(v),s.c(),T(s,1),s.m(t,n)):s&&(Re(),O(s,1,1,()=>{s=null}),Me()),(((k=(R=v[16])==null?void 0:R.license_metadata)==null?void 0:k.seats)??null)!==null&&((N=v[16])==null?void 0:N.user_count)>((H=(M=v[16])==null?void 0:M.license_metadata)==null?void 0:H.seats)?a?(a.p(v,y),y[0]&65536&&T(a,1)):(a=Fu(v),a.c(),T(a,1),a.m(t,r)):a&&(Re(),O(a,1,1,()=>{a=null}),Me()),y[0]&32768){l=yt(v[15].filter(v[28]));let V;for(V=0;V<l.length;V+=1){const Q=Ou(v,l,V);c[V]?(c[V].p(Q,y),T(c[V],1)):(c[V]=Vu(Q),c[V].c(),T(c[V],1),c[V].m(t,null))}for(Re(),V=l.length;V<c.length;V+=1)u(V);Me()}},i(v){if(!i){T(s),T(a);for(let y=0;y<l.length;y+=1)T(c[y]);i=!0}},o(v){O(s),O(a),c=c.filter(Boolean);for(let y=0;y<c.length;y+=1)O(c[y]);i=!1},d(v){v&&_(e),s&&s.d(),a&&a.d(),Hn(c,v)}}}function zu(o){let e,t;return e=new Va({props:{banner:{type:"info",title:"Trial License",content:o[11].t("You are currently using a trial license. Please contact support to upgrade your license.")}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&2048&&(i.banner={type:"info",title:"Trial License",content:n[11].t("You are currently using a trial license. Please contact support to upgrade your license.")}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Fu(o){let e,t;return e=new Va({props:{banner:{type:"error",title:"License Error",content:o[11].t("Exceeded the number of seats in your license. Please contact support to increase the number of seats.")}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&2048&&(i.banner={type:"error",title:"License Error",content:n[11].t("Exceeded the number of seats in your license. Please contact support to increase the number of seats.")}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Vu(o){let e,t;return e=new Va({props:{banner:o[31]}}),e.$on("dismiss",o[29]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&32768&&(i.banner=n[31]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function lv(o){var ue,X,me,ne,q,he,Z;let e,t,n,r,i,s,a,l,c,u,d,f,h,p,b,w,m,v,y,I,P,R,k,N,M,H,V,Q,J,E;function Y(x){o[19](x)}let D={chatId:o[8]};o[6]!==void 0&&(D.show=o[6]),e=new wp({props:D}),ze.push(()=>Ze(e,"show",Y)),b=new Sp({});let W=!o[10]&&Nu(o),F=o[5]&&Du(o),G=o[2]&&o[3]&&(o[3].id||o[12])&&Hu(o);N=new Ft({props:{content:o[11].t("Controls"),$$slots:{default:[sv]},$$scope:{ctx:o}}});let K=o[14]!==void 0&&o[14]!==null&&Uu(o),j=o[12]&&o[8]==="local"&&Lu(o),re=!o[4].currentId&&!o[8]&&(o[15].length>0||(((X=(ue=o[16])==null?void 0:ue.license_metadata)==null?void 0:X.type)??null)==="trial"||(((ne=(me=o[16])==null?void 0:me.license_metadata)==null?void 0:ne.seats)??null)!==null&&((q=o[16])==null?void 0:q.user_count)>((Z=(he=o[16])==null?void 0:he.license_metadata)==null?void 0:Z.seats))&&Bu(o);return{c(){$(e.$$.fragment),n=ie(),r=U("button"),i=ie(),s=U("nav"),a=U("div"),l=U("div"),c=ie(),u=U("div"),d=U("div"),f=U("div"),h=U("button"),p=U("div"),$(b.$$.fragment),w=ie(),W&&W.c(),v=ie(),y=U("div"),F&&F.c(),P=ie(),R=U("div"),G&&G.c(),k=ie(),$(N.$$.fragment),M=ie(),K&&K.c(),H=ie(),j&&j.c(),V=ie(),re&&re.c(),this.h()},l(x){oe(e.$$.fragment,x),n=se(x),r=L(x,"BUTTON",{id:!0,class:!0,"aria-label":!0}),A(r).forEach(_),i=se(x),s=L(x,"NAV",{class:!0});var _e=A(s);a=L(_e,"DIV",{class:!0});var Pe=A(a);l=L(Pe,"DIV",{class:!0}),A(l).forEach(_),c=se(Pe),u=L(Pe,"DIV",{class:!0});var De=A(u);d=L(De,"DIV",{class:!0});var ge=A(d);f=L(ge,"DIV",{class:!0});var ct=A(f);h=L(ct,"BUTTON",{id:!0,class:!0,"aria-label":!0});var at=A(h);p=L(at,"DIV",{class:!0});var kt=A(p);oe(b.$$.fragment,kt),kt.forEach(_),at.forEach(_),w=se(ct),W&&W.l(ct),ct.forEach(_),v=se(ge),y=L(ge,"DIV",{class:!0});var _t=A(y);F&&F.l(_t),_t.forEach(_),P=se(ge),R=L(ge,"DIV",{class:!0});var Dt=A(R);G&&G.l(Dt),k=se(Dt),oe(N.$$.fragment,Dt),M=se(Dt),K&&K.l(Dt),Dt.forEach(_),ge.forEach(_),De.forEach(_),Pe.forEach(_),H=se(_e),j&&j.l(_e),V=se(_e),re&&re.l(_e),_e.forEach(_),this.h()},h(){g(r,"id","new-chat-button"),g(r,"class","hidden"),g(r,"aria-label","New Chat"),g(l,"class","bg-linear-to-b via-50% from-white via-white to-transparent dark:from-gray-900 dark:via-gray-900 dark:to-transparent pointer-events-none absolute inset-0 -bottom-7 z-[-1]"),g(p,"class","m-auto self-center"),g(h,"id","sidebar-toggle-button"),g(h,"class","cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(h,"aria-label","Toggle Sidebar"),g(f,"class",m=(o[9]?"md:hidden":"")+" mr-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),g(y,"class",I="flex-1 overflow-hidden max-w-full py-0.5 "+(o[9]?"ml-1":"")),g(R,"class","self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),g(d,"class","flex items-center w-full max-w-full"),g(u,"class","flex max-w-full w-full mx-auto px-1 pt-0.5 bg-transparent"),g(a,"class","flex items-center w-full pl-1.5 pr-1"),g(s,"class","sticky top-0 z-30 w-full py-1 -mb-8 flex flex-col items-center drag-region")},m(x,_e){ee(e,x,_e),z(x,n,_e),z(x,r,_e),z(x,i,_e),z(x,s,_e),S(s,a),S(a,l),S(a,c),S(a,u),S(u,d),S(d,f),S(f,h),S(h,p),ee(b,p,null),S(f,w),W&&W.m(f,null),S(d,v),S(d,y),F&&F.m(y,null),S(d,P),S(d,R),G&&G.m(R,null),S(R,k),ee(N,R,null),S(R,M),K&&K.m(R,null),S(s,H),j&&j.m(s,null),S(s,V),re&&re.m(s,null),Q=!0,J||(E=[Ae(r,"click",o[20]),Ae(h,"click",o[21])],J=!0)},p(x,_e){var ge,ct,at,kt,_t,Dt,Ot;const Pe={};_e[0]&256&&(Pe.chatId=x[8]),!t&&_e[0]&64&&(t=!0,Pe.show=x[6],Je(()=>t=!1)),e.$set(Pe),x[10]?W&&(Re(),O(W,1,1,()=>{W=null}),Me()):W?(W.p(x,_e),_e[0]&1024&&T(W,1)):(W=Nu(x),W.c(),T(W,1),W.m(f,null)),(!Q||_e[0]&512&&m!==(m=(x[9]?"md:hidden":"")+" mr-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"))&&g(f,"class",m),x[5]?F?(F.p(x,_e),_e[0]&32&&T(F,1)):(F=Du(x),F.c(),T(F,1),F.m(y,null)):F&&(Re(),O(F,1,1,()=>{F=null}),Me()),(!Q||_e[0]&512&&I!==(I="flex-1 overflow-hidden max-w-full py-0.5 "+(x[9]?"ml-1":"")))&&g(y,"class",I),x[2]&&x[3]&&(x[3].id||x[12])?G?(G.p(x,_e),_e[0]&4108&&T(G,1)):(G=Hu(x),G.c(),T(G,1),G.m(R,k)):G&&(Re(),O(G,1,1,()=>{G=null}),Me());const De={};_e[0]&2048&&(De.content=x[11].t("Controls")),_e[0]&8192|_e[1]&8&&(De.$$scope={dirty:_e,ctx:x}),N.$set(De),x[14]!==void 0&&x[14]!==null?K?(K.p(x,_e),_e[0]&16384&&T(K,1)):(K=Uu(x),K.c(),T(K,1),K.m(R,null)):K&&(Re(),O(K,1,1,()=>{K=null}),Me()),x[12]&&x[8]==="local"?j?j.p(x,_e):(j=Lu(x),j.c(),j.m(s,V)):j&&(j.d(1),j=null),!x[4].currentId&&!x[8]&&(x[15].length>0||(((ct=(ge=x[16])==null?void 0:ge.license_metadata)==null?void 0:ct.type)??null)==="trial"||(((kt=(at=x[16])==null?void 0:at.license_metadata)==null?void 0:kt.seats)??null)!==null&&((_t=x[16])==null?void 0:_t.user_count)>((Ot=(Dt=x[16])==null?void 0:Dt.license_metadata)==null?void 0:Ot.seats))?re?(re.p(x,_e),_e[0]&98576&&T(re,1)):(re=Bu(x),re.c(),T(re,1),re.m(s,null)):re&&(Re(),O(re,1,1,()=>{re=null}),Me())},i(x){Q||(T(e.$$.fragment,x),T(b.$$.fragment,x),T(W),T(F),T(G),T(N.$$.fragment,x),T(K),T(re),Q=!0)},o(x){O(e.$$.fragment,x),O(b.$$.fragment,x),O(W),O(F),O(G),O(N.$$.fragment,x),O(K),O(re),Q=!1},d(x){x&&(_(n),_(r),_(i),_(s)),te(e,x),te(b),W&&W.d(),F&&F.d(),G&&G.d(),te(N),K&&K.d(),j&&j.d(),re&&re.d(),J=!1,wn(E)}}}function cv(o,e,t){let n,r,i,s,a,l,c,u,d,f;de(o,_f,F=>t(30,n=F)),de(o,qo,F=>t(8,r=F)),de(o,ca,F=>t(9,i=F)),de(o,Ti,F=>t(10,s=F)),de(o,mi,F=>t(12,l=F)),de(o,Zt,F=>t(13,c=F)),de(o,bo,F=>t(14,u=F)),de(o,vm,F=>t(15,d=F)),de(o,Ar,F=>t(16,f=F));const h=rn("i18n");de(o,h,F=>t(11,a=F));let{initNewChat:p}=e,{title:b=n}=e,{shareEnabled:w=!1}=e,{chat:m}=e,{history:v}=e,{selectedModels:y}=e,{showModelSelector:I=!0}=e,P=!1,R=!1;function k(F){P=F,t(6,P)}const N=()=>{p()},M=()=>{ca.set(!i)},H=()=>{p()};function V(F){y=F,t(0,y)}const Q=()=>{t(6,P=!P)},J=()=>{t(7,R=!R)},E=async()=>{await Zt.set(!c)},Y=F=>{F.detail==="archived-chat"&&km.set(!0)},D=F=>F.dismissible?!JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]").includes(F.id):!0,W=F=>{const G=F.detail;localStorage.setItem("dismissedBannerIds",JSON.stringify([G,...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]")].filter(K=>d.find(j=>j.id===K))))};return o.$$set=F=>{"initNewChat"in F&&t(1,p=F.initNewChat),"title"in F&&t(18,b=F.title),"shareEnabled"in F&&t(2,w=F.shareEnabled),"chat"in F&&t(3,m=F.chat),"history"in F&&t(4,v=F.history),"selectedModels"in F&&t(0,y=F.selectedModels),"showModelSelector"in F&&t(5,I=F.showModelSelector)},[y,p,w,m,v,I,P,R,r,i,s,a,l,c,u,d,f,h,b,k,N,M,H,V,Q,J,E,Y,D,W]}class uv extends We{constructor(e){super(),Ye(this,e,cv,lv,Qe,{initNewChat:1,title:18,shareEnabled:2,chat:3,history:4,selectedModels:0,showModelSelector:5},null,[-1,-1])}}function qt(o){if(typeof o=="string"||typeof o=="number")return""+o;let e="";if(Array.isArray(o))for(let t=0,n;t<o.length;t++)(n=qt(o[t]))!==""&&(e+=(e&&" ")+n);else for(let t in o)o[t]&&(e+=(e&&" ")+t);return e}const Pi={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:o=>`Node type "${o}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:o=>`The old edge with id=${o} does not exist.`,error009:o=>`Marker type "${o}" doesn't exist.`,error008:(o,{id:e,sourceHandle:t,targetHandle:n})=>`Couldn't create edge for ${o} handle id: "${o==="source"?t:n}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:o=>`Edge type "${o}" not found. Using fallback type "default".`,error012:o=>`Node with id "${o}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(o="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${o}/dist/style.css' or base.css to make sure everything is working properly.`},hs=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]];var tr;(function(o){o.Strict="strict",o.Loose="loose"})(tr||(tr={}));var po;(function(o){o.Free="free",o.Vertical="vertical",o.Horizontal="horizontal"})(po||(po={}));var gs;(function(o){o.Partial="partial",o.Full="full"})(gs||(gs={}));const Oa={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var pr;(function(o){o.Bezier="default",o.Straight="straight",o.Step="step",o.SmoothStep="smoothstep",o.SimpleBezier="simplebezier"})(pr||(pr={}));var ms;(function(o){o.Arrow="arrow",o.ArrowClosed="arrowclosed"})(ms||(ms={}));var ft;(function(o){o.Left="left",o.Top="top",o.Right="right",o.Bottom="bottom"})(ft||(ft={}));const Ku={[ft.Left]:ft.Right,[ft.Right]:ft.Left,[ft.Top]:ft.Bottom,[ft.Bottom]:ft.Top};function dv(o,e){if(!o&&!e)return!0;if(!o||!e||o.size!==e.size)return!1;if(!o.size&&!e.size)return!0;for(const t of o.keys())if(!e.has(t))return!1;return!0}function Gu(o,e,t){if(!t)return;const n=[];o.forEach((r,i)=>{e!=null&&e.has(i)||n.push(r)}),n.length&&t(n)}function Wu(o){return o===null?null:o?"valid":"invalid"}const fv=o=>"id"in o&&"source"in o&&"target"in o,hv=o=>"id"in o&&"position"in o&&!("source"in o)&&!("target"in o),Ml=o=>"id"in o&&"internals"in o&&!("source"in o)&&!("target"in o),Bs=(o,e=[0,0])=>{const{width:t,height:n}=Pr(o),r=o.origin??e,i=t*r[0],s=n*r[1];return{x:o.position.x-i,y:o.position.y-s}},gv=(o,e={nodeOrigin:[0,0],nodeLookup:void 0})=>{if(o.length===0)return{x:0,y:0,width:0,height:0};const t=o.reduce((n,r)=>{const i=typeof r=="string";let s=!e.nodeLookup&&!i?r:void 0;e.nodeLookup&&(s=i?e.nodeLookup.get(r):Ml(r)?r:e.nodeLookup.get(r.id));const a=s?ps(s,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Fs(n,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Vs(t)},zs=(o,e={})=>{if(o.size===0)return{x:0,y:0,width:0,height:0};let t={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return o.forEach(n=>{if(e.filter===void 0||e.filter(n)){const r=ps(n);t=Fs(t,r)}}),Vs(t)},vg=(o,e,[t,n,r]=[0,0,1],i=!1,s=!1)=>{const a={...Oi(e,[t,n,r]),width:e.width/r,height:e.height/r},l=[];for(const c of o.values()){const{measured:u,selectable:d=!0,hidden:f=!1}=c;if(s&&!d||f)continue;const h=u.width??c.width??c.initialWidth??null,p=u.height??c.height??c.initialHeight??null,b=Ci(a,Er(c)),w=(h??0)*(p??0),m=i&&b>0;(!c.internals.handleBounds||m||b>=w||c.dragging)&&l.push(c)}return l},Na=(o,e)=>{const t=new Set;return o.forEach(n=>{t.add(n.id)}),e.filter(n=>t.has(n.source)||t.has(n.target))};function Yu(o,e){const t=new Map,n=e!=null&&e.nodes?new Set(e.nodes.map(r=>r.id)):null;return o.forEach(r=>{r.measured.width&&r.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!r.hidden)&&(!n||n.has(r.id))&&t.set(r.id,r)}),t}async function qu({nodes:o,width:e,height:t,panZoom:n,minZoom:r,maxZoom:i},s){if(o.size===0)return Promise.resolve(!1);const a=zs(o),l=Ol(a,e,t,(s==null?void 0:s.minZoom)??r,(s==null?void 0:s.maxZoom)??i,(s==null?void 0:s.padding)??.1);return await n.setViewport(l,{duration:s==null?void 0:s.duration}),Promise.resolve(!0)}function mv({nodeId:o,nextPosition:e,nodeLookup:t,nodeOrigin:n=[0,0],nodeExtent:r,onError:i}){const s=t.get(o),a=s.parentId?t.get(s.parentId):void 0,{x:l,y:c}=a?a.internals.positionAbsolute:{x:0,y:0},u=s.origin??n;let d=r;if(s.extent==="parent"&&!s.expandParent)if(!a)i==null||i("005",Pi.error005());else{const h=a.measured.width,p=a.measured.height;h&&p&&(d=[[l,c],[l+h,c+p]])}else a&&Ei(s.extent)&&(d=[[s.extent[0][0]+l,s.extent[0][1]+c],[s.extent[1][0]+l,s.extent[1][1]+c]]);const f=Ei(d)?Cr(e,d,s.measured):e;return{position:{x:f.x-l+s.measured.width*u[0],y:f.y-c+s.measured.height*u[1]},positionAbsolute:f}}async function kg({nodesToRemove:o=[],edgesToRemove:e=[],nodes:t,edges:n,onBeforeDelete:r}){const i=new Set(o.map(f=>f.id)),s=[];for(const f of t){if(f.deletable===!1)continue;const h=i.has(f.id),p=!h&&f.parentId&&s.find(b=>b.id===f.parentId);(h||p)&&s.push(f)}const a=new Set(e.map(f=>f.id)),l=n.filter(f=>f.deletable!==!1),u=Na(s,l);for(const f of l)a.has(f.id)&&!u.find(p=>p.id===f.id)&&u.push(f);if(!r)return{edges:u,nodes:s};const d=await r({nodes:s,edges:u});return typeof d=="boolean"?d?{edges:u,nodes:s}:{edges:[],nodes:[]}:d}const kr=(o,e=0,t=1)=>Math.min(Math.max(o,e),t),Cr=(o={x:0,y:0},e,t)=>({x:kr(o.x,e[0][0],e[1][0]-((t==null?void 0:t.width)??0)),y:kr(o.y,e[0][1],e[1][1]-((t==null?void 0:t.height)??0))});function Cg(o,e,t){const{width:n,height:r}=Pr(t),{x:i,y:s}=t.internals.positionAbsolute;return Cr(o,[[i,s],[i+n,s+r]],e)}const ju=(o,e,t)=>o<e?kr(Math.abs(o-e),1,e)/e:o>t?-kr(Math.abs(o-t),1,e)/e:0,Eg=(o,e,t=15,n=40)=>{const r=ju(o.x,n,e.width-n)*t,i=ju(o.y,n,e.height-n)*t;return[r,i]},Fs=(o,e)=>({x:Math.min(o.x,e.x),y:Math.min(o.y,e.y),x2:Math.max(o.x2,e.x2),y2:Math.max(o.y2,e.y2)}),Da=({x:o,y:e,width:t,height:n})=>({x:o,y:e,x2:o+t,y2:e+n}),Vs=({x:o,y:e,x2:t,y2:n})=>({x:o,y:e,width:t-o,height:n-e}),Er=(o,e=[0,0])=>{var r,i;const{x:t,y:n}=Ml(o)?o.internals.positionAbsolute:Bs(o,e);return{x:t,y:n,width:((r=o.measured)==null?void 0:r.width)??o.width??o.initialWidth??0,height:((i=o.measured)==null?void 0:i.height)??o.height??o.initialHeight??0}},ps=(o,e=[0,0])=>{var r,i;const{x:t,y:n}=Ml(o)?o.internals.positionAbsolute:Bs(o,e);return{x:t,y:n,x2:t+(((r=o.measured)==null?void 0:r.width)??o.width??o.initialWidth??0),y2:n+(((i=o.measured)==null?void 0:i.height)??o.height??o.initialHeight??0)}},pv=(o,e)=>Vs(Fs(Da(o),Da(e))),Ci=(o,e)=>{const t=Math.max(0,Math.min(o.x+o.width,e.x+e.width)-Math.max(o.x,e.x)),n=Math.max(0,Math.min(o.y+o.height,e.y+e.height)-Math.max(o.y,e.y));return Math.ceil(t*n)},Qu=o=>to(o.width)&&to(o.height)&&to(o.x)&&to(o.y),to=o=>!isNaN(o)&&isFinite(o),_v=(o,e)=>{},Pl=(o,e=[1,1])=>({x:e[0]*Math.round(o.x/e[0]),y:e[1]*Math.round(o.y/e[1])}),Oi=({x:o,y:e},[t,n,r],i=!1,s=[1,1])=>{const a={x:(o-t)/r,y:(e-n)/r};return i?Pl(a,s):a},Ig=({x:o,y:e},[t,n,r])=>({x:o*r+t,y:e*r+n}),Ol=(o,e,t,n,r,i)=>{const s=e/(o.width*(1+i)),a=t/(o.height*(1+i)),l=Math.min(s,a),c=kr(l,n,r),u=o.x+o.width/2,d=o.y+o.height/2,f=e/2-u*c,h=t/2-d*c;return{x:f,y:h,zoom:c}},_s=()=>{var o;return typeof navigator<"u"&&((o=navigator==null?void 0:navigator.userAgent)==null?void 0:o.indexOf("Mac"))>=0};function Ei(o){return o!==void 0&&o!=="parent"}function Pr(o){var e,t;return{width:((e=o.measured)==null?void 0:e.width)??o.width??o.initialWidth??0,height:((t=o.measured)==null?void 0:t.height)??o.height??o.initialHeight??0}}function Xu(o){var e,t;return(((e=o.measured)==null?void 0:e.width)??o.width??o.initialWidth)!==void 0&&(((t=o.measured)==null?void 0:t.height)??o.height??o.initialHeight)!==void 0}function bv(o,e={width:0,height:0},t,n,r){let i=t;const s={...o};for(;i;){const a=n.get(i);if(i=a==null?void 0:a.parentId,a){const l=a.origin||r;s.x+=a.internals.positionAbsolute.x-(e.width??0)*l[0],s.y+=a.internals.positionAbsolute.y-(e.height??0)*l[1]}}return s}function oa(o,{snapGrid:e=[0,0],snapToGrid:t=!1,transform:n}){const{x:r,y:i}=To(o),s=Oi({x:r,y:i},n),{x:a,y:l}=t?Pl(s,e):s;return{xSnapped:a,ySnapped:l,...s}}const Tg=o=>({width:o.offsetWidth,height:o.offsetHeight}),yv=o=>{var e;return((e=o.getRootNode)==null?void 0:e.call(o))||(window==null?void 0:window.document)},wv=["INPUT","SELECT","TEXTAREA"];function vv(o){var n,r;const e=((r=(n=o.composedPath)==null?void 0:n.call(o))==null?void 0:r[0])||o.target;return wv.includes(e==null?void 0:e.nodeName)||(e==null?void 0:e.hasAttribute("contenteditable"))||!!(e!=null&&e.closest(".nokey"))}const Sg=o=>"clientX"in o,To=(o,e)=>{var i,s;const t=Sg(o),n=t?o.clientX:(i=o.touches)==null?void 0:i[0].clientX,r=t?o.clientY:(s=o.touches)==null?void 0:s[0].clientY;return{x:n-((e==null?void 0:e.left)??0),y:r-((e==null?void 0:e.top)??0)}},Ju=(o,e,t,n,r)=>{const i=e.querySelectorAll(`.${o}`);return!i||!i.length?null:Array.from(i).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:o,nodeId:r,position:s.getAttribute("data-handlepos"),x:(a.left-t.left)/n,y:(a.top-t.top)/n,...Tg(s)}})};function kv({sourceX:o,sourceY:e,targetX:t,targetY:n,sourceControlX:r,sourceControlY:i,targetControlX:s,targetControlY:a}){const l=o*.125+r*.375+s*.375+t*.125,c=e*.125+i*.375+a*.375+n*.125,u=Math.abs(l-o),d=Math.abs(c-e);return[l,c,u,d]}function Qi(o,e){return o>=0?.5*o:e*25*Math.sqrt(-o)}function Zu({pos:o,x1:e,y1:t,x2:n,y2:r,c:i}){switch(o){case ft.Left:return[e-Qi(e-n,i),t];case ft.Right:return[e+Qi(n-e,i),t];case ft.Top:return[e,t-Qi(t-r,i)];case ft.Bottom:return[e,t+Qi(r-t,i)]}}function Ag({sourceX:o,sourceY:e,sourcePosition:t=ft.Bottom,targetX:n,targetY:r,targetPosition:i=ft.Top,curvature:s=.25}){const[a,l]=Zu({pos:t,x1:o,y1:e,x2:n,y2:r,c:s}),[c,u]=Zu({pos:i,x1:n,y1:r,x2:o,y2:e,c:s}),[d,f,h,p]=kv({sourceX:o,sourceY:e,targetX:n,targetY:r,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${o},${e} C${a},${l} ${c},${u} ${n},${r}`,d,f,h,p]}function Rg({sourceX:o,sourceY:e,targetX:t,targetY:n}){const r=Math.abs(t-o)/2,i=t<o?t+r:t-r,s=Math.abs(n-e)/2,a=n<e?n+s:n-s;return[i,a,r,s]}function Cv({sourceNode:o,targetNode:e,selected:t=!1,zIndex:n=0,elevateOnSelect:r=!1}){if(!r)return n;const i=t||e.selected||o.selected,s=Math.max(o.internals.z||0,e.internals.z||0,1e3);return n+(i?s:0)}function Ev({sourceNode:o,targetNode:e,width:t,height:n,transform:r}){const i=Fs(ps(o),ps(e));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const s={x:-r[0]/r[2],y:-r[1]/r[2],width:t/r[2],height:n/r[2]};return Ci(s,Vs(i))>0}const Iv=({source:o,sourceHandle:e,target:t,targetHandle:n})=>`xy-edge__${o}${e||""}-${t}${n||""}`,Tv=(o,e)=>e.some(t=>t.source===o.source&&t.target===o.target&&(t.sourceHandle===o.sourceHandle||!t.sourceHandle&&!o.sourceHandle)&&(t.targetHandle===o.targetHandle||!t.targetHandle&&!o.targetHandle)),Sv=(o,e)=>{if(!o.source||!o.target)return e;let t;return fv(o)?t={...o}:t={...o,id:Iv(o)},Tv(t,e)?e:(t.sourceHandle===null&&delete t.sourceHandle,t.targetHandle===null&&delete t.targetHandle,e.concat(t))};function Mg({sourceX:o,sourceY:e,targetX:t,targetY:n}){const[r,i,s,a]=Rg({sourceX:o,sourceY:e,targetX:t,targetY:n});return[`M ${o},${e}L ${t},${n}`,r,i,s,a]}const xu={[ft.Left]:{x:-1,y:0},[ft.Right]:{x:1,y:0},[ft.Top]:{x:0,y:-1},[ft.Bottom]:{x:0,y:1}},Av=({source:o,sourcePosition:e=ft.Bottom,target:t})=>e===ft.Left||e===ft.Right?o.x<t.x?{x:1,y:0}:{x:-1,y:0}:o.y<t.y?{x:0,y:1}:{x:0,y:-1},$u=(o,e)=>Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2));function Rv({source:o,sourcePosition:e=ft.Bottom,target:t,targetPosition:n=ft.Top,center:r,offset:i}){const s=xu[e],a=xu[n],l={x:o.x+s.x*i,y:o.y+s.y*i},c={x:t.x+a.x*i,y:t.y+a.y*i},u=Av({source:l,sourcePosition:e,target:c}),d=u.x!==0?"x":"y",f=u[d];let h=[],p,b;const w={x:0,y:0},m={x:0,y:0},[v,y,I,P]=Rg({sourceX:o.x,sourceY:o.y,targetX:t.x,targetY:t.y});if(s[d]*a[d]===-1){p=r.x??v,b=r.y??y;const k=[{x:p,y:l.y},{x:p,y:c.y}],N=[{x:l.x,y:b},{x:c.x,y:b}];s[d]===f?h=d==="x"?k:N:h=d==="x"?N:k}else{const k=[{x:l.x,y:c.y}],N=[{x:c.x,y:l.y}];if(d==="x"?h=s.x===f?N:k:h=s.y===f?k:N,e===n){const J=Math.abs(o[d]-t[d]);if(J<=i){const E=Math.min(i-1,i-J);s[d]===f?w[d]=(l[d]>o[d]?-1:1)*E:m[d]=(c[d]>t[d]?-1:1)*E}}if(e!==n){const J=d==="x"?"y":"x",E=s[d]===a[J],Y=l[J]>c[J],D=l[J]<c[J];(s[d]===1&&(!E&&Y||E&&D)||s[d]!==1&&(!E&&D||E&&Y))&&(h=d==="x"?k:N)}const M={x:l.x+w.x,y:l.y+w.y},H={x:c.x+m.x,y:c.y+m.y},V=Math.max(Math.abs(M.x-h[0].x),Math.abs(H.x-h[0].x)),Q=Math.max(Math.abs(M.y-h[0].y),Math.abs(H.y-h[0].y));V>=Q?(p=(M.x+H.x)/2,b=h[0].y):(p=h[0].x,b=(M.y+H.y)/2)}return[[o,{x:l.x+w.x,y:l.y+w.y},...h,{x:c.x+m.x,y:c.y+m.y},t],p,b,I,P]}function Mv(o,e,t,n){const r=Math.min($u(o,e)/2,$u(e,t)/2,n),{x:i,y:s}=e;if(o.x===i&&i===t.x||o.y===s&&s===t.y)return`L${i} ${s}`;if(o.y===s){const c=o.x<t.x?-1:1,u=o.y<t.y?1:-1;return`L ${i+r*c},${s}Q ${i},${s} ${i},${s+r*u}`}const a=o.x<t.x?1:-1,l=o.y<t.y?-1:1;return`L ${i},${s+r*l}Q ${i},${s} ${i+r*a},${s}`}function bs({sourceX:o,sourceY:e,sourcePosition:t=ft.Bottom,targetX:n,targetY:r,targetPosition:i=ft.Top,borderRadius:s=5,centerX:a,centerY:l,offset:c=20}){const[u,d,f,h,p]=Rv({source:{x:o,y:e},sourcePosition:t,target:{x:n,y:r},targetPosition:i,center:{x:a,y:l},offset:c});return[u.reduce((w,m,v)=>{let y="";return v>0&&v<u.length-1?y=Mv(u[v-1],m,u[v+1],s):y=`${v===0?"M":"L"}${m.x} ${m.y}`,w+=y,w},""),d,f,h,p]}function ed(o){var e;return o&&!!(o.internals.handleBounds||(e=o.handles)!=null&&e.length)&&!!(o.measured.width||o.width||o.initialWidth)}function Pv(o){var d;const{sourceNode:e,targetNode:t}=o;if(!ed(e)||!ed(t))return null;const n=e.internals.handleBounds||td(e.handles),r=t.internals.handleBounds||td(t.handles),i=nd((n==null?void 0:n.source)??[],o.sourceHandle),s=nd(o.connectionMode===tr.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),o.targetHandle);if(!i||!s)return(d=o.onError)==null||d.call(o,"008",Pi.error008(i?"target":"source",{id:o.id,sourceHandle:o.sourceHandle,targetHandle:o.targetHandle})),null;const a=(i==null?void 0:i.position)||ft.Bottom,l=(s==null?void 0:s.position)||ft.Top,c=Ii(e,i,a),u=Ii(t,s,l);return{sourceX:c.x,sourceY:c.y,targetX:u.x,targetY:u.y,sourcePosition:a,targetPosition:l}}function td(o){if(!o)return null;const e=[],t=[];for(const n of o)n.width=n.width??1,n.height=n.height??1,n.type==="source"?e.push(n):n.type==="target"&&t.push(n);return{source:e,target:t}}function Ii(o,e,t=ft.Left,n=!1){const r=((e==null?void 0:e.x)??0)+o.internals.positionAbsolute.x,i=((e==null?void 0:e.y)??0)+o.internals.positionAbsolute.y,{width:s,height:a}=e??Pr(o);if(n)return{x:r+s/2,y:i+a/2};switch((e==null?void 0:e.position)??t){case ft.Top:return{x:r+s/2,y:i};case ft.Right:return{x:r+s,y:i+a/2};case ft.Bottom:return{x:r+s/2,y:i+a};case ft.Left:return{x:r,y:i+a/2}}}function nd(o,e){return o&&(e?o.find(t=>t.id===e):o[0])||null}function Ha(o,e){return o?typeof o=="string"?o:`${e?`${e}__`:""}${Object.keys(o).sort().map(n=>`${n}=${o[n]}`).join("&")}`:""}function Ov(o,{id:e,defaultColor:t,defaultMarkerStart:n,defaultMarkerEnd:r}){const i=new Set;return o.reduce((s,a)=>([a.markerStart||n,a.markerEnd||r].forEach(l=>{if(l&&typeof l=="object"){const c=Ha(l,e);i.has(c)||(s.push({id:c,color:l.color||t,...l}),i.add(c))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const Pg={nodeOrigin:[0,0],nodeExtent:hs,elevateNodesOnSelect:!0,defaults:{}},Nv={...Pg,checkEquality:!0};function Og(o,e){const t={...o};for(const n in e)e[n]!==void 0&&(t[n]=e[n]);return t}function Ng(o,e,t,n){var a,l;const r=Og(Nv,n),i=new Map(e),s=r!=null&&r.elevateNodesOnSelect?1e3:0;e.clear(),t.clear();for(const c of o){let u=i.get(c.id);if(r.checkEquality&&c===(u==null?void 0:u.internals.userNode))e.set(c.id,u);else{const d=Bs(c,r.nodeOrigin),f=Ei(c.extent)?c.extent:r.nodeExtent,h=Cr(d,f,Pr(c));u={...r.defaults,...c,measured:{width:(a=c.measured)==null?void 0:a.width,height:(l=c.measured)==null?void 0:l.height},internals:{positionAbsolute:h,handleBounds:c.measured?u==null?void 0:u.internals.handleBounds:void 0,z:Hg(c,s),userNode:c}},e.set(c.id,u)}c.parentId&&Dg(u,e,t,n)}}function Dv(o,e){if(!o.parentId)return;const t=e.get(o.parentId);t?t.set(o.id,o):e.set(o.parentId,new Map([[o.id,o]]))}function Dg(o,e,t,n){const{elevateNodesOnSelect:r,nodeOrigin:i,nodeExtent:s}=Og(Pg,n),a=o.parentId,l=e.get(a);if(!l){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Dv(o,t);const c=r?1e3:0,{x:u,y:d,z:f}=Hv(o,l,i,s,c),{positionAbsolute:h}=o.internals,p=u!==h.x||d!==h.y;(p||f!==o.internals.z)&&(o.internals={...o.internals,positionAbsolute:p?{x:u,y:d}:h,z:f})}function Hg(o,e){return(to(o.zIndex)?o.zIndex:0)+(o.selected?e:0)}function Hv(o,e,t,n,r){const{x:i,y:s}=e.internals.positionAbsolute,a=Pr(o),l=Bs(o,t),c=Ei(o.extent)?Cr(l,o.extent,a):l;let u=Cr({x:i+c.x,y:s+c.y},n,a);o.extent==="parent"&&(u=Cg(u,a,e));const d=Hg(o,r),f=e.internals.z??0;return{x:u.x,y:u.y,z:f>d?f:d}}function Uv(o,e,t,n=[0,0]){var s;const r=[],i=new Map;for(const a of o){const l=e.get(a.parentId);if(!l)continue;const c=((s=i.get(a.parentId))==null?void 0:s.expandedRect)??Er(l),u=pv(c,a.rect);i.set(a.parentId,{expandedRect:u,parent:l})}return i.size>0&&i.forEach(({expandedRect:a,parent:l},c)=>{var y;const u=l.internals.positionAbsolute,d=Pr(l),f=l.origin??n,h=a.x<u.x?Math.round(Math.abs(u.x-a.x)):0,p=a.y<u.y?Math.round(Math.abs(u.y-a.y)):0,b=Math.max(d.width,Math.round(a.width)),w=Math.max(d.height,Math.round(a.height)),m=(b-d.width)*f[0],v=(w-d.height)*f[1];(h>0||p>0||m||v)&&(r.push({id:c,type:"position",position:{x:l.position.x-h+m,y:l.position.y-p+v}}),(y=t.get(c))==null||y.forEach(I=>{o.some(P=>P.id===I.id)||r.push({id:I.id,type:"position",position:{x:I.position.x+h,y:I.position.y+p}})})),(d.width<a.width||d.height<a.height||h||p)&&r.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:b+(h?f[0]*h-m:0),height:w+(p?f[1]*p-v:0)}})}),r}function Lv(o,e,t,n,r,i){const s=n==null?void 0:n.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const l=[],c=window.getComputedStyle(s),{m22:u}=new window.DOMMatrixReadOnly(c.transform),d=[];for(const f of o.values()){const h=e.get(f.id);if(h)if(h.hidden)h.internals={...h.internals,handleBounds:void 0},a=!0;else{const p=Tg(f.nodeElement),b=h.measured.width!==p.width||h.measured.height!==p.height;if(!!(p.width&&p.height&&(b||!h.internals.handleBounds||f.force))){const m=f.nodeElement.getBoundingClientRect(),v=Ei(h.extent)?h.extent:i;let{positionAbsolute:y}=h.internals;h.parentId&&h.extent==="parent"?y=Cg(y,p,e.get(h.parentId)):v&&(y=Cr(y,v,p)),h.measured=p,h.internals={...h.internals,positionAbsolute:y,handleBounds:{source:Ju("source",f.nodeElement,m,u,h.id),target:Ju("target",f.nodeElement,m,u,h.id)}},h.parentId&&Dg(h,e,t,{nodeOrigin:r}),a=!0,b&&(l.push({id:h.id,type:"dimensions",dimensions:p}),h.expandParent&&h.parentId&&d.push({id:h.id,parentId:h.parentId,rect:Er(h,r)}))}}}if(d.length>0){const f=Uv(d,e,t,r);l.push(...f)}return{changes:l,updatedInternals:a}}async function Bv({delta:o,panZoom:e,transform:t,translateExtent:n,width:r,height:i}){if(!e||!o.x&&!o.y)return Promise.resolve(!1);const s=await e.setViewportConstrained({x:t[0]+o.x,y:t[1]+o.y,zoom:t[2]},[[0,0],[r,i]],n),a=!!s&&(s.x!==t[0]||s.y!==t[1]||s.k!==t[2]);return Promise.resolve(a)}function Ug(o,e,t){o.clear(),e.clear();for(const n of t){const{source:r,target:i,sourceHandle:s=null,targetHandle:a=null}=n,l=`${r}-source-${s}`,c=`${i}-target-${a}`,u=o.get(l)||new Map,d=o.get(c)||new Map,f={edgeId:n.id,source:r,target:i,sourceHandle:s,targetHandle:a};e.set(n.id,n),o.set(l,u.set(`${i}-${a}`,f)),o.set(c,d.set(`${r}-${s}`,f))}}function Lg(o,e){if(!o.parentId)return!1;const t=e.get(o.parentId);return t?t.selected?!0:Lg(t,e):!1}function od(o,e,t){let n=o;do{if(n!=null&&n.matches(e))return!0;if(n===t)return!1;n=n.parentElement}while(n);return!1}function zv(o,e,t,n){const r=new Map;for(const[i,s]of o)if((s.selected||s.id===n)&&(!s.parentId||!Lg(s,o))&&(s.draggable||e&&typeof s.draggable>"u")){const a=o.get(i);a&&r.set(i,{id:i,position:a.position||{x:0,y:0},distance:{x:t.x-a.internals.positionAbsolute.x,y:t.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return r}function ra({nodeId:o,dragItems:e,nodeLookup:t,dragging:n=!0}){var s,a;const r=[];for(const[l,c]of e){const u=(s=t.get(l))==null?void 0:s.internals.userNode;u&&r.push({...u,position:c.position,dragging:n})}if(!o)return[r[0],r];const i=t.get(o).internals.userNode;return[{...i,position:((a=e.get(o))==null?void 0:a.position)||i.position,dragging:n},r]}function Fv({onNodeMouseDown:o,getStoreItems:e,onDragStart:t,onDrag:n,onDragStop:r}){let i={x:null,y:null},s=0,a=new Map,l=!1,c={x:0,y:0},u=null,d=!1,f=null,h=!1;function p({noDragClassName:w,handleSelector:m,domNode:v,isSelectable:y,nodeId:I,nodeClickDistance:P=0}){f=eo(v);function R({x:H,y:V},Q){const{nodeLookup:J,nodeExtent:E,snapGrid:Y,snapToGrid:D,nodeOrigin:W,onNodeDrag:F,onSelectionDrag:G,onError:K,updateNodePositions:j}=e();i={x:H,y:V};let re=!1,ue={x:0,y:0,x2:0,y2:0};if(a.size>1&&E){const X=zs(a);ue=Da(X)}for(const[X,me]of a){let ne={x:H-me.distance.x,y:V-me.distance.y};D&&(ne=Pl(ne,Y));let q=[[E[0][0],E[0][1]],[E[1][0],E[1][1]]];if(a.size>1&&E&&!me.extent){const{positionAbsolute:x}=me.internals,_e=x.x-ue.x+E[0][0],Pe=x.x+me.measured.width-ue.x2+E[1][0],De=x.y-ue.y+E[0][1],ge=x.y+me.measured.height-ue.y2+E[1][1];q=[[_e,De],[Pe,ge]]}const{position:he,positionAbsolute:Z}=mv({nodeId:X,nextPosition:ne,nodeLookup:J,nodeExtent:q,nodeOrigin:W,onError:K});re=re||me.position.x!==he.x||me.position.y!==he.y,me.position=he,me.internals.positionAbsolute=Z}if(re&&(j(a,!0),Q&&(n||F||!I&&G))){const[X,me]=ra({nodeId:I,dragItems:a,nodeLookup:J});n==null||n(Q,a,X,me),F==null||F(Q,X,me),I||G==null||G(Q,me)}}async function k(){if(!u)return;const{transform:H,panBy:V,autoPanSpeed:Q}=e(),[J,E]=Eg(c,u,Q);(J!==0||E!==0)&&(i.x=(i.x??0)-J/H[2],i.y=(i.y??0)-E/H[2],await V({x:J,y:E})&&R(i,null)),s=requestAnimationFrame(k)}function N(H){var re;const{nodeLookup:V,multiSelectionActive:Q,nodesDraggable:J,transform:E,snapGrid:Y,snapToGrid:D,selectNodesOnDrag:W,onNodeDragStart:F,onSelectionDragStart:G,unselectNodesAndEdges:K}=e();d=!0,(!W||!y)&&!Q&&I&&((re=V.get(I))!=null&&re.selected||K()),y&&W&&I&&(o==null||o(I));const j=oa(H.sourceEvent,{transform:E,snapGrid:Y,snapToGrid:D});if(i=j,a=zv(V,J,j,I),a.size>0&&(t||F||!I&&G)){const[ue,X]=ra({nodeId:I,dragItems:a,nodeLookup:V});t==null||t(H.sourceEvent,a,ue,X),F==null||F(H.sourceEvent,ue,X),I||G==null||G(H.sourceEvent,X)}}const M=Qp().clickDistance(P).on("start",H=>{const{domNode:V,nodeDragThreshold:Q,transform:J,snapGrid:E,snapToGrid:Y}=e();h=!1,Q===0&&N(H),i=oa(H.sourceEvent,{transform:J,snapGrid:E,snapToGrid:Y}),u=(V==null?void 0:V.getBoundingClientRect())||null,c=To(H.sourceEvent,u)}).on("drag",H=>{const{autoPanOnNodeDrag:V,transform:Q,snapGrid:J,snapToGrid:E,nodeDragThreshold:Y}=e(),D=oa(H.sourceEvent,{transform:Q,snapGrid:J,snapToGrid:E});if(H.sourceEvent.type==="touchmove"&&H.sourceEvent.touches.length>1&&(h=!0),!h){if(!l&&V&&d&&(l=!0,k()),!d){const W=D.xSnapped-(i.x??0),F=D.ySnapped-(i.y??0);Math.sqrt(W*W+F*F)>Y&&N(H)}(i.x!==D.xSnapped||i.y!==D.ySnapped)&&a&&d&&(c=To(H.sourceEvent,u),R(D,H.sourceEvent))}}).on("end",H=>{if(!(!d||h)&&(l=!1,d=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:V,updateNodePositions:Q,onNodeDragStop:J,onSelectionDragStop:E}=e();if(Q(a,!1),r||J||!I&&E){const[Y,D]=ra({nodeId:I,dragItems:a,nodeLookup:V,dragging:!1});r==null||r(H.sourceEvent,a,Y,D),J==null||J(H.sourceEvent,Y,D),I||E==null||E(H.sourceEvent,D)}}}).filter(H=>{const V=H.target;return!H.button&&(!w||!od(V,`.${w}`,v))&&(!m||od(V,m,v))});f.call(M)}function b(){f==null||f.on(".drag",null)}return{update:p,destroy:b}}function Vv(o,e,t){const n=[],r={x:o.x-t,y:o.y-t,width:t*2,height:t*2};for(const i of e.values())Ci(r,Er(i))>0&&n.push(i);return n}const Kv=250;function Gv(o,e,t,n){var a,l;let r=[],i=1/0;const s=Vv(o,t,e+Kv);for(const c of s){const u=[...((a=c.internals.handleBounds)==null?void 0:a.source)??[],...((l=c.internals.handleBounds)==null?void 0:l.target)??[]];for(const d of u){if(n.nodeId===d.nodeId&&n.type===d.type&&n.id===d.id)continue;const{x:f,y:h}=Ii(c,d,d.position,!0),p=Math.sqrt(Math.pow(f-o.x,2)+Math.pow(h-o.y,2));p>e||(p<i?(r=[{...d,x:f,y:h}],i=p):p===i&&r.push({...d,x:f,y:h}))}}if(!r.length)return null;if(r.length>1){const c=n.type==="source"?"target":"source";return r.find(u=>u.type===c)??r[0]}return r[0]}function Bg(o,e,t,n,r,i=!1){var c,u,d;const s=n.get(o);if(!s)return null;const a=r==="strict"?(c=s.internals.handleBounds)==null?void 0:c[e]:[...((u=s.internals.handleBounds)==null?void 0:u.source)??[],...((d=s.internals.handleBounds)==null?void 0:d.target)??[]],l=(t?a==null?void 0:a.find(f=>f.id===t):a==null?void 0:a[0])??null;return l&&i?{...l,...Ii(s,l,l.position,!0)}:l}function zg(o,e){return o||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function Wv(o,e){let t=null;return e?t=!0:o&&!e&&(t=!1),t}const Fg=()=>!0;function Yv(o,{connectionMode:e,connectionRadius:t,handleId:n,nodeId:r,edgeUpdaterType:i,isTarget:s,domNode:a,nodeLookup:l,lib:c,autoPanOnConnect:u,flowId:d,panBy:f,cancelConnection:h,onConnectStart:p,onConnect:b,onConnectEnd:w,isValidConnection:m=Fg,onReconnectEnd:v,updateConnection:y,getTransform:I,getFromHandle:P,autoPanSpeed:R}){const k=yv(o.target);let N=0,M;const{x:H,y:V}=To(o),Q=k==null?void 0:k.elementFromPoint(H,V),J=zg(i,Q),E=a==null?void 0:a.getBoundingClientRect();if(!E||!J)return;const Y=Bg(r,J,n,l,e);if(!Y)return;let D=To(o,E),W=!1,F=null,G=!1,K=null;function j(){if(!u||!E)return;const[Z,x]=Eg(D,E,R);f({x:Z,y:x}),N=requestAnimationFrame(j)}const re={...Y,nodeId:r,type:J,position:Y.position},ue=l.get(r),me={inProgress:!0,isValid:null,from:Ii(ue,re,ft.Left,!0),fromHandle:re,fromPosition:re.position,fromNode:ue,to:D,toHandle:null,toPosition:Ku[re.position],toNode:null};y(me);let ne=me;p==null||p(o,{nodeId:r,handleId:n,handleType:J});function q(Z){if(!P()||!re){he(Z);return}const x=I();D=To(Z,E),M=Gv(Oi(D,x,!1,[1,1]),t,l,re),W||(j(),W=!0);const _e=Vg(Z,{handle:M,connectionMode:e,fromNodeId:r,fromHandleId:n,fromType:s?"target":"source",isValidConnection:m,doc:k,lib:c,flowId:d,nodeLookup:l});K=_e.handleDomNode,F=_e.connection,G=Wv(!!M,_e.isValid);const Pe={...ne,isValid:G,to:M&&G?Ig({x:M.x,y:M.y},x):D,toHandle:_e.toHandle,toPosition:G&&_e.toHandle?_e.toHandle.position:Ku[re.position],toNode:_e.toHandle?l.get(_e.toHandle.nodeId):null};G&&M&&ne.toHandle&&Pe.toHandle&&ne.toHandle.type===Pe.toHandle.type&&ne.toHandle.nodeId===Pe.toHandle.nodeId&&ne.toHandle.id===Pe.toHandle.id&&ne.to.x===Pe.to.x&&ne.to.y===Pe.to.y||(y(Pe),ne=Pe)}function he(Z){(M||K)&&F&&G&&(b==null||b(F));const{inProgress:x,..._e}=ne,Pe={..._e,toPosition:ne.toHandle?ne.toPosition:null};w==null||w(Z,Pe),i&&(v==null||v(Z,Pe)),h(),cancelAnimationFrame(N),W=!1,G=!1,F=null,K=null,k.removeEventListener("mousemove",q),k.removeEventListener("mouseup",he),k.removeEventListener("touchmove",q),k.removeEventListener("touchend",he)}k.addEventListener("mousemove",q),k.addEventListener("mouseup",he),k.addEventListener("touchmove",q),k.addEventListener("touchend",he)}function Vg(o,{handle:e,connectionMode:t,fromNodeId:n,fromHandleId:r,fromType:i,doc:s,lib:a,flowId:l,isValidConnection:c=Fg,nodeLookup:u}){const d=i==="target",f=e?s.querySelector(`.${a}-flow__handle[data-id="${l}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:h,y:p}=To(o),b=s.elementFromPoint(h,p),w=b!=null&&b.classList.contains(`${a}-flow__handle`)?b:f,m={handleDomNode:w,isValid:!1,connection:null,toHandle:null};if(w){const v=zg(void 0,w),y=w.getAttribute("data-nodeid"),I=w.getAttribute("data-handleid"),P=w.classList.contains("connectable"),R=w.classList.contains("connectableend");if(!y||!v)return m;const k={source:d?y:n,sourceHandle:d?I:r,target:d?n:y,targetHandle:d?r:I};m.connection=k;const M=P&&R&&(t===tr.Strict?d&&v==="source"||!d&&v==="target":y!==n||I!==r);m.isValid=M&&c(k),m.toHandle=Bg(y,v,I,u,t,!1)}return m}const qv={onPointerDown:Yv,isValid:Vg},jv=(o,e)=>o.x!==e.x||o.y!==e.y||o.zoom!==e.k,Ks=o=>({x:o.x,y:o.y,zoom:o.k}),ia=({x:o,y:e,zoom:t})=>Ua.translate(o,e).scale(t),dr=(o,e)=>o.target.closest(`.${e}`),Kg=(o,e)=>e===2&&Array.isArray(o)&&o.includes(2),sa=(o,e=0,t=()=>{})=>{const n=typeof e=="number"&&e>0;return n||t(),n?o.transition().duration(e).on("end",t):o},Gg=o=>{const e=o.ctrlKey&&_s()?10:1;return-o.deltaY*(o.deltaMode===1?.05:o.deltaMode?1:.002)*e};function Qv({zoomPanValues:o,noWheelClassName:e,d3Selection:t,d3Zoom:n,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:l,onPanZoomEnd:c}){return u=>{if(dr(u,e))return!1;u.preventDefault(),u.stopImmediatePropagation();const d=t.property("__zoom").k||1;if(u.ctrlKey&&s){const w=co(u),m=Gg(u),v=d*Math.pow(2,m);n.scaleTo(t,v,w,u);return}const f=u.deltaMode===1?20:1;let h=r===po.Vertical?0:u.deltaX*f,p=r===po.Horizontal?0:u.deltaY*f;!_s()&&u.shiftKey&&r!==po.Vertical&&(h=u.deltaY*f,p=0),n.translateBy(t,-(h/d)*i,-(p/d)*i,{internal:!0});const b=Ks(t.property("__zoom"));clearTimeout(o.panScrollTimeout),o.isPanScrolling||(o.isPanScrolling=!0,a==null||a(u,b)),o.isPanScrolling&&(l==null||l(u,b),o.panScrollTimeout=setTimeout(()=>{c==null||c(u,b),o.isPanScrolling=!1},150))}}function Xv({noWheelClassName:o,preventScrolling:e,d3ZoomHandler:t}){return function(n,r){if(!e&&n.type==="wheel"&&!n.ctrlKey||dr(n,o))return null;n.preventDefault(),t.call(this,n,r)}}function Jv({zoomPanValues:o,onDraggingChange:e,onPanZoomStart:t}){return n=>{var i,s,a;if((i=n.sourceEvent)!=null&&i.internal)return;const r=Ks(n.transform);o.mouseButton=((s=n.sourceEvent)==null?void 0:s.button)||0,o.isZoomingOrPanning=!0,o.prevViewport=r,((a=n.sourceEvent)==null?void 0:a.type)==="mousedown"&&e(!0),t&&(t==null||t(n.sourceEvent,r))}}function Zv({zoomPanValues:o,panOnDrag:e,onPaneContextMenu:t,onTransformChange:n,onPanZoom:r}){return i=>{var s,a;o.usedRightMouseButton=!!(t&&Kg(e,o.mouseButton??0)),(s=i.sourceEvent)!=null&&s.sync||n([i.transform.x,i.transform.y,i.transform.k]),r&&!((a=i.sourceEvent)!=null&&a.internal)&&(r==null||r(i.sourceEvent,Ks(i.transform)))}}function xv({zoomPanValues:o,panOnDrag:e,panOnScroll:t,onDraggingChange:n,onPanZoomEnd:r,onPaneContextMenu:i}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(o.isZoomingOrPanning=!1,i&&Kg(e,o.mouseButton??0)&&!o.usedRightMouseButton&&s.sourceEvent&&i(s.sourceEvent),o.usedRightMouseButton=!1,n(!1),r&&jv(o.prevViewport,s.transform))){const l=Ks(s.transform);o.prevViewport=l,clearTimeout(o.timerId),o.timerId=setTimeout(()=>{r==null||r(s.sourceEvent,l)},t?150:0)}}}function $v({zoomActivationKeyPressed:o,zoomOnScroll:e,zoomOnPinch:t,panOnDrag:n,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:s,noWheelClassName:a,noPanClassName:l,lib:c}){return u=>{var p;const d=o||e,f=t&&u.ctrlKey;if(u.button===1&&u.type==="mousedown"&&(dr(u,`${c}-flow__node`)||dr(u,`${c}-flow__edge`)))return!0;if(!n&&!d&&!r&&!i&&!t||s||dr(u,a)&&u.type==="wheel"||dr(u,l)&&(u.type!=="wheel"||r&&u.type==="wheel"&&!o)||!t&&u.ctrlKey&&u.type==="wheel")return!1;if(!t&&u.type==="touchstart"&&((p=u.touches)==null?void 0:p.length)>1)return u.preventDefault(),!1;if(!d&&!r&&!f&&u.type==="wheel"||!n&&(u.type==="mousedown"||u.type==="touchstart")||Array.isArray(n)&&!n.includes(u.button)&&u.type==="mousedown")return!1;const h=Array.isArray(n)&&n.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||u.type==="wheel")&&h}}function ek({domNode:o,minZoom:e,maxZoom:t,paneClickDistance:n,translateExtent:r,viewport:i,onPanZoom:s,onPanZoomStart:a,onPanZoomEnd:l,onDraggingChange:c}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=o.getBoundingClientRect(),f=i_().clickDistance(!to(n)||n<0?0:n).scaleExtent([e,t]).translateExtent(r),h=eo(o).call(f);y({x:i.x,y:i.y,zoom:kr(i.zoom,e,t)},[[0,0],[d.width,d.height]],r);const p=h.on("wheel.zoom"),b=h.on("dblclick.zoom");f.wheelDelta(Gg);function w(Q,J){return h?new Promise(E=>{f==null||f.transform(sa(h,J==null?void 0:J.duration,()=>E(!0)),Q)}):Promise.resolve(!1)}function m({noWheelClassName:Q,noPanClassName:J,onPaneContextMenu:E,userSelectionActive:Y,panOnScroll:D,panOnDrag:W,panOnScrollMode:F,panOnScrollSpeed:G,preventScrolling:K,zoomOnPinch:j,zoomOnScroll:re,zoomOnDoubleClick:ue,zoomActivationKeyPressed:X,lib:me,onTransformChange:ne}){Y&&!u.isZoomingOrPanning&&v();const he=D&&!X&&!Y?Qv({zoomPanValues:u,noWheelClassName:Q,d3Selection:h,d3Zoom:f,panOnScrollMode:F,panOnScrollSpeed:G,zoomOnPinch:j,onPanZoomStart:a,onPanZoom:s,onPanZoomEnd:l}):Xv({noWheelClassName:Q,preventScrolling:K,d3ZoomHandler:p});if(h.on("wheel.zoom",he,{passive:!1}),!Y){const x=Jv({zoomPanValues:u,onDraggingChange:c,onPanZoomStart:a});f.on("start",x);const _e=Zv({zoomPanValues:u,panOnDrag:W,onPaneContextMenu:!!E,onPanZoom:s,onTransformChange:ne});f.on("zoom",_e);const Pe=xv({zoomPanValues:u,panOnDrag:W,panOnScroll:D,onPaneContextMenu:E,onPanZoomEnd:l,onDraggingChange:c});f.on("end",Pe)}const Z=$v({zoomActivationKeyPressed:X,panOnDrag:W,zoomOnScroll:re,panOnScroll:D,zoomOnDoubleClick:ue,zoomOnPinch:j,userSelectionActive:Y,noPanClassName:J,noWheelClassName:Q,lib:me});f.filter(Z),ue?h.on("dblclick.zoom",b):h.on("dblclick.zoom",null)}function v(){f.on("zoom",null)}async function y(Q,J,E){const Y=ia(Q),D=f==null?void 0:f.constrain()(Y,J,E);return D&&await w(D),new Promise(W=>W(D))}async function I(Q,J){const E=ia(Q);return await w(E,J),new Promise(Y=>Y(E))}function P(Q){if(h){const J=ia(Q),E=h.property("__zoom");(E.k!==Q.zoom||E.x!==Q.x||E.y!==Q.y)&&(f==null||f.transform(h,J,null,{sync:!0}))}}function R(){const Q=h?gm(h.node()):{x:0,y:0,k:1};return{x:Q.x,y:Q.y,zoom:Q.k}}function k(Q,J){return h?new Promise(E=>{f==null||f.scaleTo(sa(h,J==null?void 0:J.duration,()=>E(!0)),Q)}):Promise.resolve(!1)}function N(Q,J){return h?new Promise(E=>{f==null||f.scaleBy(sa(h,J==null?void 0:J.duration,()=>E(!0)),Q)}):Promise.resolve(!1)}function M(Q){f==null||f.scaleExtent(Q)}function H(Q){f==null||f.translateExtent(Q)}function V(Q){const J=!to(Q)||Q<0?0:Q;f==null||f.clickDistance(J)}return{update:m,destroy:v,setViewport:I,setViewportConstrained:y,getViewport:R,scaleTo:k,scaleBy:N,setScaleExtent:M,setTranslateExtent:H,syncViewport:P,setClickDistance:V}}var rd;(function(o){o.Line="line",o.Handle="handle"})(rd||(rd={}));function tk(o){let e,t,n,r,i,s;const a=o[45].default,l=pn(a,o,o[44],null);return{c(){e=U("div"),l&&l.c(),this.h()},l(c){e=L(c,"DIV",{"data-handleid":!0,"data-nodeid":!0,"data-handlepos":!0,"data-id":!0,class:!0,style:!0,role:!0,tabindex:!0});var u=A(e);l&&l.l(u),u.forEach(_),this.h()},h(){g(e,"data-handleid",o[6]),g(e,"data-nodeid",o[14]),g(e,"data-handlepos",o[2]),g(e,"data-id",t=o[13]+"-"+o[14]+"-"+(o[0]||null)+"-"+o[1]),g(e,"class",n=qt(["svelte-flow__handle",`svelte-flow__handle-${o[2]}`,"nodrag","nopan",o[2],o[4]])),g(e,"style",o[3]),g(e,"role","button"),g(e,"tabindex","-1"),dt(e,"valid",o[7]),dt(e,"connectingto",o[5]),dt(e,"connectingfrom",o[9]),dt(e,"source",!o[11]),dt(e,"target",o[11]),dt(e,"connectablestart",o[12]),dt(e,"connectableend",o[12]),dt(e,"connectable",o[12]),dt(e,"connectionindicator",o[12]&&(!o[10]||o[8]))},m(c,u){z(c,e,u),l&&l.m(e,null),r=!0,i||(s=[Ae(e,"mousedown",o[32]),Ae(e,"touchstart",o[32])],i=!0)},p(c,u){l&&l.p&&(!r||u[1]&8192)&&_n(l,a,c,c[44],r?yn(a,c[44],u,null):bn(c[44]),null),(!r||u[0]&64)&&g(e,"data-handleid",c[6]),(!r||u[0]&4)&&g(e,"data-handlepos",c[2]),(!r||u[0]&8195&&t!==(t=c[13]+"-"+c[14]+"-"+(c[0]||null)+"-"+c[1]))&&g(e,"data-id",t),(!r||u[0]&20&&n!==(n=qt(["svelte-flow__handle",`svelte-flow__handle-${c[2]}`,"nodrag","nopan",c[2],c[4]])))&&g(e,"class",n),(!r||u[0]&8)&&g(e,"style",c[3]),(!r||u[0]&148)&&dt(e,"valid",c[7]),(!r||u[0]&52)&&dt(e,"connectingto",c[5]),(!r||u[0]&532)&&dt(e,"connectingfrom",c[9]),(!r||u[0]&2068)&&dt(e,"source",!c[11]),(!r||u[0]&2068)&&dt(e,"target",c[11]),(!r||u[0]&4116)&&dt(e,"connectablestart",c[12]),(!r||u[0]&4116)&&dt(e,"connectableend",c[12]),(!r||u[0]&4116)&&dt(e,"connectable",c[12]),(!r||u[0]&5396)&&dt(e,"connectionindicator",c[12]&&(!c[10]||c[8]))},i(c){r||(T(l,c),r=!0)},o(c){O(l,c),r=!1},d(c){c&&_(e),l&&l.d(c),i=!1,wn(s)}}}function nk(o,e,t){let n,r,i,s,a,l,c,u,d,f,h,p,b,w,m,v,y,I,P,R,k,N,M,H,V,{$$slots:Q={},$$scope:J}=e,{id:E=void 0}=e,{type:Y="source"}=e,{position:D=ft.Top}=e,{style:W=void 0}=e,{isValidConnection:F=void 0}=e,{onconnect:G=void 0}=e,{ondisconnect:K=void 0}=e,{isConnectable:j=void 0}=e,{class:re=void 0}=e;const ue=rn("svelteflow__node_id"),X=rn("svelteflow__node_connectable");de(o,X,le=>t(43,V=le));const me=$t(),{connectionMode:ne,domNode:q,nodeLookup:he,connectionRadius:Z,viewport:x,isValidConnection:_e,lib:Pe,addEdge:De,onedgecreate:ge,panBy:ct,cancelConnection:at,updateConnection:kt,autoPanOnConnect:_t,edges:Dt,connectionLookup:Ot,onconnect:fn,onconnectstart:en,onconnectend:tn,flowId:nn,connection:ve}=me;de(o,ne,le=>t(40,f=le)),de(o,q,le=>t(55,M=le)),de(o,he,le=>t(54,N=le)),de(o,Z,le=>t(56,H=le)),de(o,x,le=>t(46,b=le)),de(o,_e,le=>t(51,I=le)),de(o,Pe,le=>t(53,k=le)),de(o,ge,le=>t(50,y=le)),de(o,_t,le=>t(52,R=le)),de(o,Dt,le=>t(42,p=le)),de(o,Ot,le=>t(41,h=le)),de(o,fn,le=>t(49,v=le)),de(o,en,le=>t(48,m=le)),de(o,tn,le=>t(47,w=le)),de(o,nn,le=>t(13,P=le)),de(o,ve,le=>t(39,d=le));function sn(le){const Xe=Sg(le);(Xe&&le.button===0||!Xe)&&qv.onPointerDown(le,{handleId:i,nodeId:ue,isTarget:n,connectionRadius:H,domNode:M,nodeLookup:N,connectionMode:f,lib:k,autoPanOnConnect:R,flowId:P,isValidConnection:F??I,updateConnection:kt,cancelConnection:at,panBy:ct,onConnect:vt=>{const fe=y?y(vt):vt;fe&&(De(fe),v==null||v(vt))},onConnectStart:(vt,fe)=>{m==null||m(vt,{nodeId:fe.nodeId,handleId:fe.handleId,handleType:fe.handleType})},onConnectEnd:(vt,fe)=>{w==null||w(vt,fe)},getTransform:()=>[b.x,b.y,b.zoom],getFromHandle:()=>d.fromHandle})}let Vt=null,Jt;return o.$$set=le=>{"id"in le&&t(0,E=le.id),"type"in le&&t(1,Y=le.type),"position"in le&&t(2,D=le.position),"style"in le&&t(3,W=le.style),"isValidConnection"in le&&t(33,F=le.isValidConnection),"onconnect"in le&&t(34,G=le.onconnect),"ondisconnect"in le&&t(35,K=le.ondisconnect),"isConnectable"in le&&t(36,j=le.isConnectable),"class"in le&&t(4,re=le.class),"$$scope"in le&&t(44,J=le.$$scope)},o.$$.update=()=>{var le,Xe,vt,fe,qe,Ke,nt,wt,pt;if(o.$$.dirty[0]&2&&t(11,n=Y==="target"),o.$$.dirty[1]&4128&&t(12,r=j!==void 0?j:V),o.$$.dirty[0]&1&&t(6,i=E||null),o.$$.dirty[0]&3|o.$$.dirty[1]&3096&&(G||K)&&t(38,Jt=h.get(`${ue}-${Y}-${E||null}`)),o.$$.dirty[1]&216){if(Vt&&!dv(Jt,Vt)){const Mt=Jt??new Map;Gu(Vt,Mt,K),Gu(Mt,Vt,G)}t(37,Vt=Jt??new Map)}o.$$.dirty[1]&256&&t(10,s=!!d.fromHandle),o.$$.dirty[0]&66|o.$$.dirty[1]&256&&t(9,a=((le=d.fromHandle)==null?void 0:le.nodeId)===ue&&((Xe=d.fromHandle)==null?void 0:Xe.type)===Y&&((vt=d.fromHandle)==null?void 0:vt.id)===i),o.$$.dirty[0]&66|o.$$.dirty[1]&256&&t(5,l=((fe=d.toHandle)==null?void 0:fe.nodeId)===ue&&((qe=d.toHandle)==null?void 0:qe.type)===Y&&((Ke=d.toHandle)==null?void 0:Ke.id)===i),o.$$.dirty[0]&66|o.$$.dirty[1]&768&&t(8,c=f===tr.Strict?((nt=d.fromHandle)==null?void 0:nt.type)!==Y:ue!==((wt=d.fromHandle)==null?void 0:wt.nodeId)||i!==((pt=d.fromHandle)==null?void 0:pt.id)),o.$$.dirty[0]&32|o.$$.dirty[1]&256&&t(7,u=l&&d.isValid)},[E,Y,D,W,re,l,i,u,c,a,s,n,r,P,ue,X,ne,q,he,Z,x,_e,Pe,ge,_t,Dt,Ot,fn,en,tn,nn,ve,sn,F,G,K,j,Vt,Jt,d,f,h,p,V,J,Q]}class Ir extends We{constructor(e){super(),Ye(this,e,nk,tk,Qe,{id:0,type:1,position:2,style:3,isValidConnection:33,onconnect:34,ondisconnect:35,isConnectable:36,class:4},null,[-1,-1])}}function ok(o){var l;let e,t,n=((l=o[0])==null?void 0:l.label)+"",r,i,s,a;return e=new Ir({props:{type:"target",position:o[1]??ft.Top}}),s=new Ir({props:{type:"source",position:o[2]??ft.Bottom}}),{c(){$(e.$$.fragment),t=ie(),r=Oe(n),i=ie(),$(s.$$.fragment)},l(c){oe(e.$$.fragment,c),t=se(c),r=Ne(c,n),i=se(c),oe(s.$$.fragment,c)},m(c,u){ee(e,c,u),z(c,t,u),z(c,r,u),z(c,i,u),ee(s,c,u),a=!0},p(c,[u]){var h;const d={};u&2&&(d.position=c[1]??ft.Top),e.$set(d),(!a||u&1)&&n!==(n=((h=c[0])==null?void 0:h.label)+"")&&Be(r,n);const f={};u&4&&(f.position=c[2]??ft.Bottom),s.$set(f)},i(c){a||(T(e.$$.fragment,c),T(s.$$.fragment,c),a=!0)},o(c){O(e.$$.fragment,c),O(s.$$.fragment,c),a=!1},d(c){c&&(_(t),_(r),_(i)),te(e,c),te(s,c)}}}function rk(o,e,t){const n=["data","targetPosition","sourcePosition"];xt(e,n);let{data:r={label:"Node"}}=e,{targetPosition:i=void 0}=e,{sourcePosition:s=void 0}=e;return o.$$set=a=>{e=Rt(Rt({},e),so(a)),t(3,xt(e,n)),"data"in a&&t(0,r=a.data),"targetPosition"in a&&t(1,i=a.targetPosition),"sourcePosition"in a&&t(2,s=a.sourcePosition)},[r,i,s]}class Wg extends We{constructor(e){super(),Ye(this,e,rk,ok,Qe,{data:0,targetPosition:1,sourcePosition:2})}}function ik(o){var s;let e=((s=o[0])==null?void 0:s.label)+"",t,n,r,i;return r=new Ir({props:{type:"source",position:o[1]??ft.Bottom}}),{c(){t=Oe(e),n=ie(),$(r.$$.fragment)},l(a){t=Ne(a,e),n=se(a),oe(r.$$.fragment,a)},m(a,l){z(a,t,l),z(a,n,l),ee(r,a,l),i=!0},p(a,[l]){var u;(!i||l&1)&&e!==(e=((u=a[0])==null?void 0:u.label)+"")&&Be(t,e);const c={};l&2&&(c.position=a[1]??ft.Bottom),r.$set(c)},i(a){i||(T(r.$$.fragment,a),i=!0)},o(a){O(r.$$.fragment,a),i=!1},d(a){a&&(_(t),_(n)),te(r,a)}}}function sk(o,e,t){const n=["data","sourcePosition"];xt(e,n);let{data:r={label:"Node"}}=e,{sourcePosition:i=void 0}=e;return o.$$set=s=>{e=Rt(Rt({},e),so(s)),t(2,xt(e,n)),"data"in s&&t(0,r=s.data),"sourcePosition"in s&&t(1,i=s.sourcePosition)},[r,i]}class ak extends We{constructor(e){super(),Ye(this,e,sk,ik,Qe,{data:0,sourcePosition:1})}}function lk(o){var s;let e=((s=o[0])==null?void 0:s.label)+"",t,n,r,i;return r=new Ir({props:{type:"target",position:o[1]??ft.Top}}),{c(){t=Oe(e),n=ie(),$(r.$$.fragment)},l(a){t=Ne(a,e),n=se(a),oe(r.$$.fragment,a)},m(a,l){z(a,t,l),z(a,n,l),ee(r,a,l),i=!0},p(a,[l]){var u;(!i||l&1)&&e!==(e=((u=a[0])==null?void 0:u.label)+"")&&Be(t,e);const c={};l&2&&(c.position=a[1]??ft.Top),r.$set(c)},i(a){i||(T(r.$$.fragment,a),i=!0)},o(a){O(r.$$.fragment,a),i=!1},d(a){a&&(_(t),_(n)),te(r,a)}}}function ck(o,e,t){const n=["data","targetPosition"];xt(e,n);let{data:r={label:"Node"}}=e,{targetPosition:i=void 0}=e;return o.$$set=s=>{e=Rt(Rt({},e),so(s)),t(2,xt(e,n)),"data"in s&&t(0,r=s.data),"targetPosition"in s&&t(1,i=s.targetPosition)},[r,i]}class uk extends We{constructor(e){super(),Ye(this,e,ck,lk,Qe,{data:0,targetPosition:1})}}function dk(o,e,t){const n=[];return xt(e,n),o.$$set=r=>{e=Rt(Rt({},e),so(r)),t(0,xt(e,n))},[]}class fk extends We{constructor(e){super(),Ye(this,e,dk,null,Qe,{})}}function id(o,e,t){if(!e)return;const n=t?e.querySelector(t):e;n&&n.appendChild(o)}function hk(o,{target:e,domNode:t}){return id(o,t,e),{async update({target:n,domNode:r}){id(o,r,n)},destroy(){o.parentNode&&o.parentNode.removeChild(o)}}}function gk(o){let e,t,n,r,i;const s=o[3].default,a=pn(s,o,o[2],null);return{c(){e=U("div"),a&&a.c()},l(l){e=L(l,"DIV",{});var c=A(e);a&&a.l(c),c.forEach(_)},m(l,c){z(l,e,c),a&&a.m(e,null),n=!0,r||(i=Bn(t=hk.call(null,e,{target:".svelte-flow__edgelabel-renderer",domNode:o[0]})),r=!0)},p(l,[c]){a&&a.p&&(!n||c&4)&&_n(a,s,l,l[2],n?yn(s,l[2],c,null):bn(l[2]),null),t&&gn(t.update)&&c&1&&t.update.call(null,{target:".svelte-flow__edgelabel-renderer",domNode:l[0]})},i(l){n||(T(a,l),n=!0)},o(l){O(a,l),n=!1},d(l){l&&_(e),a&&a.d(l),r=!1,i()}}}function mk(o,e,t){let n,{$$slots:r={},$$scope:i}=e;const{domNode:s}=$t();return de(o,s,a=>t(0,n=a)),o.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[n,s,i,r]}class pk extends We{constructor(e){super(),Ye(this,e,mk,gk,Qe,{})}}function Yg(){const{edgeLookup:o,selectionRect:e,selectionRectMode:t,multiselectionKeyPressed:n,addSelectedEdges:r,unselectNodesAndEdges:i,elementsSelectable:s}=$t();return a=>{const l=ye(o).get(a);if(!l){console.warn("012",Pi.error012(a));return}(l.selectable||ye(s)&&typeof l.selectable>"u")&&(e.set(null),t.set(null),l.selected?l.selected&&ye(n)&&i({nodes:[],edges:[l]}):r([a]))}}function _k(o){let e,t,n=`translate(-50%, -50%) translate(${o[1]}px,${o[2]}px)`,r,i,s;const a=o[5].default,l=pn(a,o,o[7],null);return{c(){e=U("div"),l&&l.c(),this.h()},l(c){e=L(c,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var u=A(e);l&&l.l(u),u.forEach(_),this.h()},h(){g(e,"class","svelte-flow__edge-label"),g(e,"style",t="pointer-events: all;"+o[0]),g(e,"role","button"),g(e,"tabindex","-1"),tt(e,"transform",n)},m(c,u){z(c,e,u),l&&l.m(e,null),r=!0,i||(s=[Ae(e,"keyup",yk),Ae(e,"click",o[6])],i=!0)},p(c,u){l&&l.p&&(!r||u&128)&&_n(l,a,c,c[7],r?yn(a,c[7],u,null):bn(c[7]),null),(!r||u&1&&t!==(t="pointer-events: all;"+c[0]))&&g(e,"style",t);const d=u&1;(u&7&&n!==(n=`translate(-50%, -50%) translate(${c[1]}px,${c[2]}px)`)||d)&&tt(e,"transform",n)},i(c){r||(T(l,c),r=!0)},o(c){O(l,c),r=!1},d(c){c&&_(e),l&&l.d(c),i=!1,wn(s)}}}function bk(o){let e,t;return e=new pk({props:{$$slots:{default:[_k]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,[r]){const i={};r&135&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}const yk=()=>{};function wk(o,e,t){let{$$slots:n={},$$scope:r}=e,{style:i=void 0}=e,{x:s=void 0}=e,{y:a=void 0}=e;const l=Yg(),c=rn("svelteflow__edge_id"),u=()=>{c&&l(c)};return o.$$set=d=>{"style"in d&&t(0,i=d.style),"x"in d&&t(1,s=d.x),"y"in d&&t(2,a=d.y),"$$scope"in d&&t(7,r=d.$$scope)},[i,s,a,l,c,n,u,r]}class vk extends We{constructor(e){super(),Ye(this,e,wk,bk,Qe,{style:0,x:1,y:2})}}function kk(o){let e;return{c(){e=Ce("path"),this.h()},l(t){e=Ee(t,"path",{d:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,class:!0}),A(e).forEach(_),this.h()},h(){g(e,"d",o[1]),g(e,"stroke-opacity",0),g(e,"stroke-width",o[10]),g(e,"fill","none"),g(e,"class","svelte-flow__edge-interaction")},m(t,n){z(t,e,n)},p(t,n){n&2&&g(e,"d",t[1])},d(t){t&&_(e)}}}function sd(o){let e,t;return e=new vk({props:{x:o[3],y:o[4],style:o[5],$$slots:{default:[Ck]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&8&&(i.x=n[3]),r&16&&(i.y=n[4]),r&32&&(i.style=n[5]),r&4100&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Ck(o){let e;return{c(){e=Oe(o[2])},l(t){e=Ne(t,o[2])},m(t,n){z(t,e,n)},p(t,n){n&4&&Be(e,t[2])},d(t){t&&_(e)}}}function Ek(o){let e,t,n,r,i,s,a=o[10]&&kk(o),l=o[2]&&sd(o);return{c(){e=Ce("path"),n=ie(),a&&a.c(),r=ie(),l&&l.c(),i=Ve(),this.h()},l(c){e=Ee(c,"path",{id:!0,d:!0,class:!0,"marker-start":!0,"marker-end":!0,fill:!0,style:!0}),A(e).forEach(_),n=se(c),a&&a.l(c),r=se(c),l&&l.l(c),i=Ve(),this.h()},h(){g(e,"id",o[0]),g(e,"d",o[1]),g(e,"class",t=qt(["svelte-flow__edge-path",o[9]])),g(e,"marker-start",o[6]),g(e,"marker-end",o[7]),g(e,"fill","none"),g(e,"style",o[8])},m(c,u){z(c,e,u),z(c,n,u),a&&a.m(c,u),z(c,r,u),l&&l.m(c,u),z(c,i,u),s=!0},p(c,[u]){(!s||u&1)&&g(e,"id",c[0]),(!s||u&2)&&g(e,"d",c[1]),(!s||u&512&&t!==(t=qt(["svelte-flow__edge-path",c[9]])))&&g(e,"class",t),(!s||u&64)&&g(e,"marker-start",c[6]),(!s||u&128)&&g(e,"marker-end",c[7]),(!s||u&256)&&g(e,"style",c[8]),c[10]&&a.p(c,u),c[2]?l?(l.p(c,u),u&4&&T(l,1)):(l=sd(c),l.c(),T(l,1),l.m(i.parentNode,i)):l&&(Re(),O(l,1,1,()=>{l=null}),Me())},i(c){s||(T(l),s=!0)},o(c){O(l),s=!1},d(c){c&&(_(e),_(n),_(r),_(i)),a&&a.d(c),l&&l.d(c)}}}function Ik(o,e,t){let{id:n=void 0}=e,{path:r}=e,{label:i=void 0}=e,{labelX:s=void 0}=e,{labelY:a=void 0}=e,{labelStyle:l=void 0}=e,{markerStart:c=void 0}=e,{markerEnd:u=void 0}=e,{style:d=void 0}=e,{interactionWidth:f=20}=e,{class:h=void 0}=e,p=f===void 0?20:f;return o.$$set=b=>{"id"in b&&t(0,n=b.id),"path"in b&&t(1,r=b.path),"label"in b&&t(2,i=b.label),"labelX"in b&&t(3,s=b.labelX),"labelY"in b&&t(4,a=b.labelY),"labelStyle"in b&&t(5,l=b.labelStyle),"markerStart"in b&&t(6,c=b.markerStart),"markerEnd"in b&&t(7,u=b.markerEnd),"style"in b&&t(8,d=b.style),"interactionWidth"in b&&t(11,f=b.interactionWidth),"class"in b&&t(9,h=b.class)},[n,r,i,s,a,l,c,u,d,h,p,f]}class Gs extends We{constructor(e){super(),Ye(this,e,Ik,Ek,Qe,{id:0,path:1,label:2,labelX:3,labelY:4,labelStyle:5,markerStart:6,markerEnd:7,style:8,interactionWidth:11,class:9})}}function Tk(o){let e,t;return e=new Gs({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Sk(o,e,t){let n,r,i;const s=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];xt(e,s);let{label:a=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:p}=e,{sourcePosition:b}=e,{targetX:w}=e,{targetY:m}=e,{targetPosition:v}=e;return o.$$set=y=>{e=Rt(Rt({},e),so(y)),t(15,xt(e,s)),"label"in y&&t(0,a=y.label),"labelStyle"in y&&t(1,l=y.labelStyle),"style"in y&&t(2,c=y.style),"markerStart"in y&&t(3,u=y.markerStart),"markerEnd"in y&&t(4,d=y.markerEnd),"interactionWidth"in y&&t(5,f=y.interactionWidth),"sourceX"in y&&t(9,h=y.sourceX),"sourceY"in y&&t(10,p=y.sourceY),"sourcePosition"in y&&t(11,b=y.sourcePosition),"targetX"in y&&t(12,w=y.targetX),"targetY"in y&&t(13,m=y.targetY),"targetPosition"in y&&t(14,v=y.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=Ag({sourceX:h,sourceY:p,targetX:w,targetY:m,sourcePosition:b,targetPosition:v}),n,(t(7,r),t(9,h),t(10,p),t(12,w),t(13,m),t(11,b),t(14,v)),(t(6,i),t(9,h),t(10,p),t(12,w),t(13,m),t(11,b),t(14,v)))},[a,l,c,u,d,f,i,r,n,h,p,b,w,m,v]}class qg extends We{constructor(e){super(),Ye(this,e,Sk,Tk,Qe,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function Ak(o){let e,t;return e=new Gs({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Rk(o,e,t){let n,r,i;const s=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];xt(e,s);let{label:a=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:p}=e,{sourcePosition:b}=e,{targetX:w}=e,{targetY:m}=e,{targetPosition:v}=e;return o.$$set=y=>{e=Rt(Rt({},e),so(y)),t(15,xt(e,s)),"label"in y&&t(0,a=y.label),"labelStyle"in y&&t(1,l=y.labelStyle),"style"in y&&t(2,c=y.style),"markerStart"in y&&t(3,u=y.markerStart),"markerEnd"in y&&t(4,d=y.markerEnd),"interactionWidth"in y&&t(5,f=y.interactionWidth),"sourceX"in y&&t(9,h=y.sourceX),"sourceY"in y&&t(10,p=y.sourceY),"sourcePosition"in y&&t(11,b=y.sourcePosition),"targetX"in y&&t(12,w=y.targetX),"targetY"in y&&t(13,m=y.targetY),"targetPosition"in y&&t(14,v=y.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=bs({sourceX:h,sourceY:p,targetX:w,targetY:m,sourcePosition:b,targetPosition:v}),n,(t(7,r),t(9,h),t(10,p),t(12,w),t(13,m),t(11,b),t(14,v)),(t(6,i),t(9,h),t(10,p),t(12,w),t(13,m),t(11,b),t(14,v)))},[a,l,c,u,d,f,i,r,n,h,p,b,w,m,v]}class Mk extends We{constructor(e){super(),Ye(this,e,Rk,Ak,Qe,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function Pk(o){let e,t;return e=new Gs({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Ok(o,e,t){let n,r,i;const s=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","targetX","targetY"];xt(e,s);let{label:a=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:p}=e,{targetX:b}=e,{targetY:w}=e;return o.$$set=m=>{e=Rt(Rt({},e),so(m)),t(13,xt(e,s)),"label"in m&&t(0,a=m.label),"labelStyle"in m&&t(1,l=m.labelStyle),"style"in m&&t(2,c=m.style),"markerStart"in m&&t(3,u=m.markerStart),"markerEnd"in m&&t(4,d=m.markerEnd),"interactionWidth"in m&&t(5,f=m.interactionWidth),"sourceX"in m&&t(9,h=m.sourceX),"sourceY"in m&&t(10,p=m.sourceY),"targetX"in m&&t(11,b=m.targetX),"targetY"in m&&t(12,w=m.targetY)},o.$$.update=()=>{o.$$.dirty&7680&&t(8,[n,r,i]=Mg({sourceX:h,sourceY:p,targetX:b,targetY:w}),n,(t(7,r),t(9,h),t(10,p),t(11,b),t(12,w)),(t(6,i),t(9,h),t(10,p),t(11,b),t(12,w)))},[a,l,c,u,d,f,i,r,n,h,p,b,w]}class Nk extends We{constructor(e){super(),Ye(this,e,Ok,Pk,Qe,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,targetX:11,targetY:12})}}function Dk(o){let e,t;return e=new Gs({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Hk(o,e,t){let n,r,i;const s=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];xt(e,s);let{label:a=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:p}=e,{sourcePosition:b}=e,{targetX:w}=e,{targetY:m}=e,{targetPosition:v}=e;return o.$$set=y=>{e=Rt(Rt({},e),so(y)),t(15,xt(e,s)),"label"in y&&t(0,a=y.label),"labelStyle"in y&&t(1,l=y.labelStyle),"style"in y&&t(2,c=y.style),"markerStart"in y&&t(3,u=y.markerStart),"markerEnd"in y&&t(4,d=y.markerEnd),"interactionWidth"in y&&t(5,f=y.interactionWidth),"sourceX"in y&&t(9,h=y.sourceX),"sourceY"in y&&t(10,p=y.sourceY),"sourcePosition"in y&&t(11,b=y.sourcePosition),"targetX"in y&&t(12,w=y.targetX),"targetY"in y&&t(13,m=y.targetY),"targetPosition"in y&&t(14,v=y.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=bs({sourceX:h,sourceY:p,targetX:w,targetY:m,sourcePosition:b,targetPosition:v,borderRadius:0}),n,(t(7,r),t(9,h),t(10,p),t(12,w),t(13,m),t(11,b),t(14,v)),(t(6,i),t(9,h),t(10,p),t(12,w),t(13,m),t(11,b),t(14,v)))},[a,l,c,u,d,f,i,r,n,h,p,b,w,m,v]}class Uk extends We{constructor(e){super(),Ye(this,e,Hk,Dk,Qe,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function Lk(o,e){const t=o.set,n=e.set,r=ye(o),i=ye(e);let a=r.length===0&&i.length>0?i:r;o.set(a);const l=c=>{const u=t(c);return a=u,n(a),u};o.set=e.set=l,o.update=e.update=c=>l(c(a))}function Bk(o,e){const t=o.set,n=e.set;let r=ye(e);o.set(r);const i=s=>{t(s),n(s),r=s};o.set=e.set=i,o.update=e.update=s=>i(s(r))}const zk=(o,e,t)=>{if(!t)return;const n=ye(o),r=e.set,i=t.set;let s=t?ye(t):{x:0,y:0,zoom:1};e.set(s),e.set=a=>(r(a),i(a),s=a,a),t.set=a=>(n==null||n.syncViewport(a),r(a),i(a),s=a,a),e.update=a=>{e.set(a(s))},t.update=a=>{t.set(a(s))}},Fk=(o,e,t,n=[0,0],r=hs)=>{const{subscribe:i,set:s,update:a}=et([]);let l=o,c={},u=!0;const d=b=>(Ng(b,e,t,{elevateNodesOnSelect:u,nodeOrigin:n,nodeExtent:r,defaults:c,checkEquality:!1}),l=b,s(l),l),f=b=>d(b(l)),h=b=>{c=b},p=b=>{u=b.elevateNodesOnSelect??u};return d(l),{subscribe:i,set:d,update:f,setDefaultOptions:h,setOptions:p}},Vk=(o,e,t,n)=>{const{subscribe:r,set:i,update:s}=et([]);let a=o,l={};const c=f=>{const h=l?f.map(p=>({...l,...p})):f;Ug(e,t,h),a=h,i(a)},u=f=>c(f(a)),d=f=>{l=f};return c(a),{subscribe:r,set:c,update:u,setDefaultOptions:d}},jg={input:ak,output:uk,default:Wg,group:fk},Qg={straight:Nk,smoothstep:Mk,default:qg,step:Uk},Kk=({nodes:o=[],edges:e=[],width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s})=>{const a=new Map,l=new Map,c=new Map,u=new Map,d=i??[0,0],f=s??hs;Ng(o,a,l,{nodeExtent:f,nodeOrigin:d,elevateNodesOnSelect:!1,checkEquality:!1}),Ug(c,u,e);let h={x:0,y:0,zoom:1};if(r&&t&&n){const p=zs(a,{filter:b=>!!((b.width||b.initialWidth)&&(b.height||b.initialHeight))});h=Ol(p,t,n,.5,2,.1)}return{flowId:et(null),nodes:Fk(o,a,l,d,f),nodeLookup:xn(a),parentLookup:xn(l),edgeLookup:xn(u),visibleNodes:xn([]),edges:Vk(e,c,u),visibleEdges:xn([]),connectionLookup:xn(c),height:et(500),width:et(500),minZoom:et(.5),maxZoom:et(2),nodeOrigin:et(d),nodeDragThreshold:et(1),nodeExtent:et(f),translateExtent:et(hs),autoPanOnNodeDrag:et(!0),autoPanOnConnect:et(!0),fitViewOnInit:et(!1),fitViewOnInitDone:et(!1),fitViewOptions:et(void 0),panZoom:et(null),snapGrid:et(null),dragging:et(!1),selectionRect:et(null),selectionKeyPressed:et(!1),multiselectionKeyPressed:et(!1),deleteKeyPressed:et(!1),panActivationKeyPressed:et(!1),zoomActivationKeyPressed:et(!1),selectionRectMode:et(null),selectionMode:et(gs.Partial),nodeTypes:et(jg),edgeTypes:et(Qg),viewport:et(h),connectionMode:et(tr.Strict),domNode:et(null),connection:xn(Oa),connectionLineType:et(pr.Bezier),connectionRadius:et(20),isValidConnection:et(()=>!0),nodesDraggable:et(!0),nodesConnectable:et(!0),elementsSelectable:et(!0),selectNodesOnDrag:et(!0),markers:xn([]),defaultMarkerColor:et("#b1b1b7"),lib:xn("svelte"),onlyRenderVisibleElements:et(!1),onerror:et(_v),ondelete:et(void 0),onedgecreate:et(void 0),onconnect:et(void 0),onconnectstart:et(void 0),onconnectend:et(void 0),onbeforedelete:et(void 0),nodesInitialized:et(!1),edgesInitialized:et(!1),viewportInitialized:et(!1),initialized:xn(!1)}};function Gk(o){const e=fr([o.edges,o.nodes,o.nodeLookup,o.onlyRenderVisibleElements,o.viewport,o.width,o.height],([t,,n,r,i,s,a])=>r&&s&&a?t.filter(c=>{const u=n.get(c.source),d=n.get(c.target);return u&&d&&Ev({sourceNode:u,targetNode:d,width:s,height:a,transform:[i.x,i.y,i.zoom]})}):t);return fr([e,o.nodes,o.nodeLookup,o.connectionMode,o.onerror],([t,,n,r,i])=>t.reduce((a,l)=>{const c=n.get(l.source),u=n.get(l.target);if(!c||!u)return a;const d=Pv({id:l.id,sourceNode:c,targetNode:u,sourceHandle:l.sourceHandle||null,targetHandle:l.targetHandle||null,connectionMode:r,onError:i});return d&&a.push({...l,zIndex:Cv({selected:l.selected,zIndex:l.zIndex,sourceNode:c,targetNode:u,elevateOnSelect:!1}),...d}),a},[]))}function Wk(o){return fr([o.nodeLookup,o.onlyRenderVisibleElements,o.width,o.height,o.viewport,o.nodes],([e,t,n,r,i])=>{const s=[i.x,i.y,i.zoom];return t?vg(e,{x:0,y:0,width:n,height:r},s,!0):Array.from(e.values())})}const Ws=Symbol();function Xg({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s}){const a=Kk({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s});function l(D){a.nodeTypes.set({...jg,...D})}function c(D){a.edgeTypes.set({...Qg,...D})}function u(D){const W=ye(a.edges);a.edges.set(Sv(D,W))}const d=(D,W=!1)=>{var G;const F=ye(a.nodeLookup);for(const[K,j]of D){const re=(G=F.get(K))==null?void 0:G.internals.userNode;re&&(re.position=j.position,re.dragging=W)}a.nodes.update(K=>K)};function f(D){var K,j,re;const W=ye(a.nodeLookup),{changes:F,updatedInternals:G}=Lv(D,W,ye(a.parentLookup),ye(a.domNode),ye(a.nodeOrigin));if(G){if(!ye(a.fitViewOnInitDone)&&ye(a.fitViewOnInit)){const ue=ye(a.fitViewOptions),X=p({...ue,nodes:ue==null?void 0:ue.nodes});a.fitViewOnInitDone.set(X)}for(const ue of F){const X=(K=W.get(ue.id))==null?void 0:K.internals.userNode;if(X)switch(ue.type){case"dimensions":{const me={...X.measured,...ue.dimensions};ue.setAttributes&&(X.width=((j=ue.dimensions)==null?void 0:j.width)??X.width,X.height=((re=ue.dimensions)==null?void 0:re.height)??X.height),X.measured=me;break}case"position":X.position=ue.position??X.position;break}}a.nodes.update(ue=>ue),ye(a.nodesInitialized)||a.nodesInitialized.set(!0)}}function h(D){const W=ye(a.panZoom);if(!W)return Promise.resolve(!1);const F=Yu(ye(a.nodeLookup),D);return qu({nodes:F,width:ye(a.width),height:ye(a.height),minZoom:ye(a.minZoom),maxZoom:ye(a.maxZoom),panZoom:W},D)}function p(D){const W=ye(a.panZoom);if(!W)return!1;const F=Yu(ye(a.nodeLookup),D);return qu({nodes:F,width:ye(a.width),height:ye(a.height),minZoom:ye(a.minZoom),maxZoom:ye(a.maxZoom),panZoom:W},D),F.size>0}function b(D,W){const F=ye(a.panZoom);return F?F.scaleBy(D,W):Promise.resolve(!1)}function w(D){return b(1.2,D)}function m(D){return b(1/1.2,D)}function v(D){const W=ye(a.panZoom);W&&(W.setScaleExtent([D,ye(a.maxZoom)]),a.minZoom.set(D))}function y(D){const W=ye(a.panZoom);W&&(W.setScaleExtent([ye(a.minZoom),D]),a.maxZoom.set(D))}function I(D){const W=ye(a.panZoom);W&&(W.setTranslateExtent(D),a.translateExtent.set(D))}function P(D){let W=!1;return D.forEach(F=>{F.selected&&(F.selected=!1,W=!0)}),W}function R(D){var W;(W=ye(a.panZoom))==null||W.setClickDistance(D)}function k(D){P((D==null?void 0:D.nodes)||ye(a.nodes))&&a.nodes.set(ye(a.nodes)),P((D==null?void 0:D.edges)||ye(a.edges))&&a.edges.set(ye(a.edges))}a.deleteKeyPressed.subscribe(async D=>{var W;if(D){const F=ye(a.nodes),G=ye(a.edges),K=F.filter(X=>X.selected),j=G.filter(X=>X.selected),{nodes:re,edges:ue}=await kg({nodesToRemove:K,edgesToRemove:j,nodes:F,edges:G,onBeforeDelete:ye(a.onbeforedelete)});(re.length||ue.length)&&(a.nodes.update(X=>X.filter(me=>!re.some(ne=>ne.id===me.id))),a.edges.update(X=>X.filter(me=>!ue.some(ne=>ne.id===me.id))),(W=ye(a.ondelete))==null||W({nodes:re,edges:ue}))}});function N(D){const W=ye(a.multiselectionKeyPressed);a.nodes.update(F=>F.map(G=>{const K=D.includes(G.id),j=W&&G.selected||K;return G.selected=j,G})),W||a.edges.update(F=>F.map(G=>(G.selected=!1,G)))}function M(D){const W=ye(a.multiselectionKeyPressed);a.edges.update(F=>F.map(G=>{const K=D.includes(G.id),j=W&&G.selected||K;return G.selected=j,G})),W||a.nodes.update(F=>F.map(G=>(G.selected=!1,G)))}function H(D){var F;const W=(F=ye(a.nodes))==null?void 0:F.find(G=>G.id===D);if(!W){console.warn("012",Pi.error012(D));return}a.selectionRect.set(null),a.selectionRectMode.set(null),W.selected?W.selected&&ye(a.multiselectionKeyPressed)&&k({nodes:[W],edges:[]}):N([D])}function V(D){const W=ye(a.viewport);return Bv({delta:D,panZoom:ye(a.panZoom),transform:[W.x,W.y,W.zoom],translateExtent:ye(a.translateExtent),width:ye(a.width),height:ye(a.height)})}const Q=et(Oa),J=D=>{Q.set({...D})};function E(){Q.set(Oa)}function Y(){a.fitViewOnInitDone.set(!1),a.selectionRect.set(null),a.selectionRectMode.set(null),a.snapGrid.set(null),a.isValidConnection.set(()=>!0),k(),E()}return{...a,visibleEdges:Gk(a),visibleNodes:Wk(a),connection:fr([Q,a.viewport],([D,W])=>D.inProgress?{...D,to:Oi(D.to,[W.x,W.y,W.zoom])}:{...D}),markers:fr([a.edges,a.defaultMarkerColor,a.flowId],([D,W,F])=>Ov(D,{defaultColor:W,id:F})),initialized:(()=>{let D=!1;const W=ye(a.nodes).length,F=ye(a.edges).length;return fr([a.nodesInitialized,a.edgesInitialized,a.viewportInitialized],([G,K,j])=>D||(W===0?D=j:F===0?D=j&&G:D=j&&G&&K,D))})(),syncNodeStores:D=>Lk(a.nodes,D),syncEdgeStores:D=>Bk(a.edges,D),syncViewport:D=>zk(a.panZoom,a.viewport,D),setNodeTypes:l,setEdgeTypes:c,addEdge:u,updateNodePositions:d,updateNodeInternals:f,zoomIn:w,zoomOut:m,fitView:D=>h(D),setMinZoom:v,setMaxZoom:y,setTranslateExtent:I,setPaneClickDistance:R,unselectNodesAndEdges:k,addSelectedNodes:N,addSelectedEdges:M,handleNodeSelection:H,panBy:V,updateConnection:J,cancelConnection:E,reset:Y}}function $t(){const o=rn(Ws);if(!o)throw new Error("In order to use useStore you need to wrap your component in a <SvelteFlowProvider />");return o.getStore()}function Yk({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s}){const a=Xg({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:s});return hi(Ws,{getStore:()=>a}),a}function qk(o,e){const{panZoom:t,minZoom:n,maxZoom:r,initialViewport:i,viewport:s,dragging:a,translateExtent:l,paneClickDistance:c}=e,u=ek({domNode:o,minZoom:n,maxZoom:r,translateExtent:l,viewport:i,paneClickDistance:c,onDraggingChange:a.set}),d=u.getViewport();return s.set(d),t.set(u),u.update(e),{update(f){u.update(f)}}}function jk(o){let e,t,n,r,i;const s=o[35].default,a=pn(s,o,o[34],null);return{c(){e=U("div"),a&&a.c(),this.h()},l(l){e=L(l,"DIV",{class:!0});var c=A(e);a&&a.l(c),c.forEach(_),this.h()},h(){g(e,"class","svelte-flow__zoom svelte-4xkw84")},m(l,c){z(l,e,c),a&&a.m(e,null),n=!0,r||(i=Bn(t=qk.call(null,e,{viewport:o[18],minZoom:o[12],maxZoom:o[13],initialViewport:o[11],dragging:o[23],panZoom:o[19],onPanZoomStart:o[0],onPanZoom:o[1],onPanZoomEnd:o[2],zoomOnScroll:o[5],zoomOnDoubleClick:o[6],zoomOnPinch:o[7],panOnScroll:o[9],panOnDrag:o[10],panOnScrollSpeed:.5,panOnScrollMode:o[3]||po.Free,zoomActivationKeyPressed:o[14],preventScrolling:typeof o[4]=="boolean"?o[4]:!0,noPanClassName:"nopan",noWheelClassName:"nowheel",userSelectionActive:!!o[15],translateExtent:o[16],lib:o[17],paneClickDistance:o[8],onTransformChange:o[29]})),r=!0)},p(l,c){a&&a.p&&(!n||c[1]&8)&&_n(a,s,l,l[34],n?yn(s,l[34],c,null):bn(l[34]),null),t&&gn(t.update)&&c[0]&262143&&t.update.call(null,{viewport:l[18],minZoom:l[12],maxZoom:l[13],initialViewport:l[11],dragging:l[23],panZoom:l[19],onPanZoomStart:l[0],onPanZoom:l[1],onPanZoomEnd:l[2],zoomOnScroll:l[5],zoomOnDoubleClick:l[6],zoomOnPinch:l[7],panOnScroll:l[9],panOnDrag:l[10],panOnScrollSpeed:.5,panOnScrollMode:l[3]||po.Free,zoomActivationKeyPressed:l[14],preventScrolling:typeof l[4]=="boolean"?l[4]:!0,noPanClassName:"nopan",noWheelClassName:"nowheel",userSelectionActive:!!l[15],translateExtent:l[16],lib:l[17],paneClickDistance:l[8],onTransformChange:l[29]})},i(l){n||(T(a,l),n=!0)},o(l){O(a,l),n=!1},d(l){l&&_(e),a&&a.d(l),r=!1,i()}}}function Qk(o,e,t){let n,r,i,s,a,l,c,u,d,f,h,{$$slots:p={},$$scope:b}=e,{initialViewport:w=void 0}=e,{onMoveStart:m=void 0}=e,{onMove:v=void 0}=e,{onMoveEnd:y=void 0}=e,{panOnScrollMode:I}=e,{preventScrolling:P}=e,{zoomOnScroll:R}=e,{zoomOnDoubleClick:k}=e,{zoomOnPinch:N}=e,{panOnDrag:M}=e,{panOnScroll:H}=e,{paneClickDistance:V}=e;const{viewport:Q,panZoom:J,selectionRect:E,minZoom:Y,maxZoom:D,dragging:W,translateExtent:F,lib:G,panActivationKeyPressed:K,zoomActivationKeyPressed:j,viewportInitialized:re}=$t();de(o,E,X=>t(15,d=X)),de(o,Y,X=>t(12,l=X)),de(o,D,X=>t(13,c=X)),de(o,F,X=>t(16,f=X)),de(o,G,X=>t(17,h=X)),de(o,K,X=>t(33,a=X)),de(o,j,X=>t(14,u=X)),de(o,re,X=>t(36,s=X));const ue=X=>Q.set({x:X[0],y:X[1],zoom:X[2]});return Qn(()=>{xi(re,s=!0,s)}),o.$$set=X=>{"initialViewport"in X&&t(30,w=X.initialViewport),"onMoveStart"in X&&t(0,m=X.onMoveStart),"onMove"in X&&t(1,v=X.onMove),"onMoveEnd"in X&&t(2,y=X.onMoveEnd),"panOnScrollMode"in X&&t(3,I=X.panOnScrollMode),"preventScrolling"in X&&t(4,P=X.preventScrolling),"zoomOnScroll"in X&&t(5,R=X.zoomOnScroll),"zoomOnDoubleClick"in X&&t(6,k=X.zoomOnDoubleClick),"zoomOnPinch"in X&&t(7,N=X.zoomOnPinch),"panOnDrag"in X&&t(31,M=X.panOnDrag),"panOnScroll"in X&&t(32,H=X.panOnScroll),"paneClickDistance"in X&&t(8,V=X.paneClickDistance),"$$scope"in X&&t(34,b=X.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&1073741824&&t(11,n=w||{x:0,y:0,zoom:1}),o.$$.dirty[1]&5&&t(10,r=a||M),o.$$.dirty[1]&6&&t(9,i=a||H)},[m,v,y,I,P,R,k,N,V,i,r,n,l,c,u,d,f,h,Q,J,E,Y,D,W,F,G,K,j,re,ue,w,M,H,a,b,p]}class Xk extends We{constructor(e){super(),Ye(this,e,Qk,jk,Qe,{initialViewport:30,onMoveStart:0,onMove:1,onMoveEnd:2,panOnScrollMode:3,preventScrolling:4,zoomOnScroll:5,zoomOnDoubleClick:6,zoomOnPinch:7,panOnDrag:31,panOnScroll:32,paneClickDistance:8},null,[-1,-1])}}function Jk(o){let e,t,n,r;const i=o[28].default,s=pn(i,o,o[27],null);return{c(){e=U("div"),s&&s.c(),this.h()},l(a){e=L(a,"DIV",{class:!0});var l=A(e);s&&s.l(l),l.forEach(_),this.h()},h(){g(e,"class","svelte-flow__pane svelte-1esy7hx"),dt(e,"draggable",o[0]===!0||Array.isArray(o[0])&&o[0].includes(0)),dt(e,"dragging",o[4]),dt(e,"selection",o[1])},m(a,l){z(a,e,l),s&&s.m(e,null),o[29](e),t=!0,n||(r=[Ae(e,"click",function(){gn(o[3]?void 0:Xi(o[15],o[2]))&&(o[3]?void 0:Xi(o[15],o[2])).apply(this,arguments)}),Ae(e,"pointerdown",function(){gn(o[3]?o[16]:void 0)&&(o[3]?o[16]:void 0).apply(this,arguments)}),Ae(e,"pointermove",function(){gn(o[3]?o[17]:void 0)&&(o[3]?o[17]:void 0).apply(this,arguments)}),Ae(e,"pointerup",function(){gn(o[3]?o[18]:void 0)&&(o[3]?o[18]:void 0).apply(this,arguments)}),Ae(e,"contextmenu",function(){gn(Xi(o[19],o[2]))&&Xi(o[19],o[2]).apply(this,arguments)})],n=!0)},p(a,l){o=a,s&&s.p&&(!t||l[0]&134217728)&&_n(s,i,o,o[27],t?yn(i,o[27],l,null):bn(o[27]),null),(!t||l[0]&1)&&dt(e,"draggable",o[0]===!0||Array.isArray(o[0])&&o[0].includes(0)),(!t||l[0]&16)&&dt(e,"dragging",o[4]),(!t||l[0]&2)&&dt(e,"selection",o[1])},i(a){t||(T(s,a),t=!0)},o(a){O(s,a),t=!1},d(a){a&&_(e),s&&s.d(a),o[29](null),n=!1,wn(r)}}}function Xi(o,e){return t=>{t.target===e&&(o==null||o(t))}}function ad(o){return e=>{const t=o.includes(e.id);return e.selected!==t&&(e.selected=t),e}}function Zk(o,e,t){let n,r,i,s,a,l,c,u,d,f,h,p,b,{$$slots:w={},$$scope:m}=e,{panOnDrag:v=void 0}=e,{selectionOnDrag:y=void 0}=e;const I=On(),{nodes:P,nodeLookup:R,edges:k,viewport:N,dragging:M,elementsSelectable:H,selectionRect:V,selectionRectMode:Q,selectionKeyPressed:J,selectionMode:E,panActivationKeyPressed:Y,unselectNodesAndEdges:D}=$t();de(o,R,q=>t(36,d=q)),de(o,k,q=>t(33,l=q)),de(o,N,q=>t(35,u=q)),de(o,M,q=>t(4,b=q)),de(o,H,q=>t(25,h=q)),de(o,V,q=>t(24,f=q)),de(o,Q,q=>t(23,a=q)),de(o,J,q=>t(22,s=q)),de(o,E,q=>t(34,c=q)),de(o,Y,q=>t(26,p=q));let W,F=null,G=[],K=!1;function j(q){if(K){K=!1;return}I("paneclick",{event:q}),D(),Q.set(null)}function re(q){var x,_e;if(F=W.getBoundingClientRect(),!H||!r||q.button!==0||q.target!==W||!F)return;(_e=(x=q.target)==null?void 0:x.setPointerCapture)==null||_e.call(x,q.pointerId);const{x:he,y:Z}=To(q,F);D(),V.set({width:0,height:0,startX:he,startY:Z,x:he,y:Z})}function ue(q){if(!r||!F||!f)return;K=!0;const he=To(q,F),Z=f.startX??0,x=f.startY??0,_e={...f,x:he.x<Z?he.x:Z,y:he.y<x?he.y:x,width:Math.abs(he.x-Z),height:Math.abs(he.y-x)},Pe=G.map(at=>at.id),De=Na(G,l).map(at=>at.id);G=vg(d,_e,[u.x,u.y,u.zoom],c===gs.Partial,!0);const ge=Na(G,l).map(at=>at.id),ct=G.map(at=>at.id);(Pe.length!==ct.length||ct.some(at=>!Pe.includes(at)))&&P.update(at=>at.map(ad(ct))),(De.length!==ge.length||ge.some(at=>!De.includes(at)))&&k.update(at=>at.map(ad(ge))),Q.set("user"),V.set(_e)}function X(q){var he,Z;q.button===0&&((Z=(he=q.target)==null?void 0:he.releasePointerCapture)==null||Z.call(he,q.pointerId),!r&&a==="user"&&q.target===W&&(j==null||j(q)),V.set(null),G.length>0&&xi(Q,a="nodes",a),s&&(K=!1))}const me=q=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){q.preventDefault();return}I("panecontextmenu",{event:q})};function ne(q){ze[q?"unshift":"push"](()=>{W=q,t(2,W)})}return o.$$set=q=>{"panOnDrag"in q&&t(0,v=q.panOnDrag),"selectionOnDrag"in q&&t(20,y=q.selectionOnDrag),"$$scope"in q&&t(27,m=q.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&67108865&&t(21,n=p||v),o.$$.dirty[0]&24117248&&t(1,r=s||f||y&&n!==!0),o.$$.dirty[0]&41943042&&t(3,i=h&&(r||a==="user"))},[v,r,W,i,b,R,k,N,M,H,V,Q,J,E,Y,j,re,ue,X,me,y,n,s,a,f,h,p,m,w,ne]}class xk extends We{constructor(e){super(),Ye(this,e,Zk,Jk,Qe,{panOnDrag:0,selectionOnDrag:20},null,[-1,-1])}}function $k(o){let e,t;const n=o[3].default,r=pn(n,o,o[2],null);return{c(){e=U("div"),r&&r.c(),this.h()},l(i){e=L(i,"DIV",{class:!0,style:!0});var s=A(e);r&&r.l(s),s.forEach(_),this.h()},h(){g(e,"class","svelte-flow__viewport xyflow__viewport svelte-1floaup"),tt(e,"transform","translate("+o[0].x+"px, "+o[0].y+"px) scale("+o[0].zoom+")")},m(i,s){z(i,e,s),r&&r.m(e,null),t=!0},p(i,[s]){r&&r.p&&(!t||s&4)&&_n(r,n,i,i[2],t?yn(n,i[2],s,null):bn(i[2]),null),(!t||s&1)&&tt(e,"transform","translate("+i[0].x+"px, "+i[0].y+"px) scale("+i[0].zoom+")")},i(i){t||(T(r,i),t=!0)},o(i){O(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function eC(o,e,t){let n,{$$slots:r={},$$scope:i}=e;const{viewport:s}=$t();return de(o,s,a=>t(0,n=a)),o.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[n,s,i,r]}class tC extends We{constructor(e){super(),Ye(this,e,eC,$k,Qe,{})}}function Jg(o,e){const{store:t,onDrag:n,onDragStart:r,onDragStop:i,onNodeMouseDown:s}=e,a=Fv({onDrag:n,onDragStart:r,onDragStop:i,onNodeMouseDown:s,getStoreItems:()=>{const c=ye(t.snapGrid),u=ye(t.viewport);return{nodes:ye(t.nodes),nodeLookup:ye(t.nodeLookup),edges:ye(t.edges),nodeExtent:ye(t.nodeExtent),snapGrid:c||[0,0],snapToGrid:!!c,nodeOrigin:ye(t.nodeOrigin),multiSelectionActive:ye(t.multiselectionKeyPressed),domNode:ye(t.domNode),transform:[u.x,u.y,u.zoom],autoPanOnNodeDrag:ye(t.autoPanOnNodeDrag),nodesDraggable:ye(t.nodesDraggable),selectNodesOnDrag:ye(t.selectNodesOnDrag),nodeDragThreshold:ye(t.nodeDragThreshold),unselectNodesAndEdges:t.unselectNodesAndEdges,updateNodePositions:t.updateNodePositions,panBy:t.panBy}}});function l(c,u){if(u.disabled){a.destroy();return}a.update({domNode:c,noDragClassName:u.noDragClass,handleSelector:u.handleSelector,nodeId:u.nodeId,isSelectable:u.isSelectable,nodeClickDistance:u.nodeClickDistance})}return l(o,e),{update(c){l(o,c)},destroy(){a.destroy()}}}function nC({width:o,height:e,initialWidth:t,initialHeight:n,measuredWidth:r,measuredHeight:i}){if(r===void 0&&i===void 0){const s=o??t,a=e??n;return{width:s?`width:${s}px;`:"",height:a?`height:${a}px;`:""}}return{width:o?`width:${o}px;`:"",height:e?`height:${e}px;`:""}}function ld(o){let e,t,n,r,i,s=`translate(${o[12]}px, ${o[13]}px)`,a,l,c;var u=o[27];function d(f,h){return{props:{data:f[2],id:f[1],selected:f[3],selectable:f[5],deletable:f[7],sourcePosition:f[14],targetPosition:f[15],zIndex:f[16],dragging:f[9],draggable:f[4],dragHandle:f[19],parentId:f[21],type:f[25],isConnectable:f[28],positionAbsoluteX:f[12],positionAbsoluteY:f[13],width:f[17],height:f[18]}}}return u&&(t=$i(u,d(o))),{c(){e=U("div"),t&&$(t.$$.fragment),this.h()},l(f){e=L(f,"DIV",{"data-id":!0,class:!0,style:!0});var h=A(e);t&&oe(t.$$.fragment,h),h.forEach(_),this.h()},h(){g(e,"data-id",o[1]),g(e,"class",n=qt(["svelte-flow__node",`svelte-flow__node-${o[25]}`,o[23]])),g(e,"style",r=(o[10]??"")+";"+o[26].width+o[26].height),dt(e,"dragging",o[9]),dt(e,"selected",o[3]),dt(e,"draggable",o[4]),dt(e,"connectable",o[6]),dt(e,"selectable",o[5]),dt(e,"nopan",o[4]),dt(e,"parent",o[11]),tt(e,"z-index",o[16]),tt(e,"transform",s),tt(e,"visibility",o[20]?"visible":"hidden")},m(f,h){z(f,e,h),t&&ee(t,e,null),o[50](e),a=!0,l||(c=[Bn(i=Jg.call(null,e,{nodeId:o[1],isSelectable:o[5],disabled:!1,handleSelector:o[19],noDragClass:"nodrag",nodeClickDistance:o[22],onNodeMouseDown:o[31],onDrag:o[47],onDragStart:o[48],onDragStop:o[49],store:o[29]})),Ae(e,"click",o[34]),Ae(e,"mouseenter",o[51]),Ae(e,"mouseleave",o[52]),Ae(e,"mousemove",o[53]),Ae(e,"contextmenu",o[54])],l=!0)},p(f,h){if(h[0]&134217728&&u!==(u=f[27])){if(t){Re();const b=t;O(b.$$.fragment,1,0,()=>{te(b,1)}),Me()}u?(t=$i(u,d(f)),$(t.$$.fragment),T(t.$$.fragment,1),ee(t,e,null)):t=null}else if(u){const b={};h[0]&4&&(b.data=f[2]),h[0]&2&&(b.id=f[1]),h[0]&8&&(b.selected=f[3]),h[0]&32&&(b.selectable=f[5]),h[0]&128&&(b.deletable=f[7]),h[0]&16384&&(b.sourcePosition=f[14]),h[0]&32768&&(b.targetPosition=f[15]),h[0]&65536&&(b.zIndex=f[16]),h[0]&512&&(b.dragging=f[9]),h[0]&16&&(b.draggable=f[4]),h[0]&524288&&(b.dragHandle=f[19]),h[0]&2097152&&(b.parentId=f[21]),h[0]&33554432&&(b.type=f[25]),h[0]&268435456&&(b.isConnectable=f[28]),h[0]&4096&&(b.positionAbsoluteX=f[12]),h[0]&8192&&(b.positionAbsoluteY=f[13]),h[0]&131072&&(b.width=f[17]),h[0]&262144&&(b.height=f[18]),t.$set(b)}(!a||h[0]&2)&&g(e,"data-id",f[1]),(!a||h[0]&41943040&&n!==(n=qt(["svelte-flow__node",`svelte-flow__node-${f[25]}`,f[23]])))&&g(e,"class",n),(!a||h[0]&67109888&&r!==(r=(f[10]??"")+";"+f[26].width+f[26].height))&&g(e,"style",r),i&&gn(i.update)&&h[0]&4718626&&i.update.call(null,{nodeId:f[1],isSelectable:f[5],disabled:!1,handleSelector:f[19],noDragClass:"nodrag",nodeClickDistance:f[22],onNodeMouseDown:f[31],onDrag:f[47],onDragStart:f[48],onDragStop:f[49],store:f[29]}),(!a||h[0]&41943552)&&dt(e,"dragging",f[9]),(!a||h[0]&41943048)&&dt(e,"selected",f[3]),(!a||h[0]&41943056)&&dt(e,"draggable",f[4]),(!a||h[0]&41943104)&&dt(e,"connectable",f[6]),(!a||h[0]&41943072)&&dt(e,"selectable",f[5]),(!a||h[0]&41943056)&&dt(e,"nopan",f[4]),(!a||h[0]&41945088)&&dt(e,"parent",f[11]);const p=h[0]&67109888;(h[0]&67175424||p)&&tt(e,"z-index",f[16]),(h[0]&67122176&&s!==(s=`translate(${f[12]}px, ${f[13]}px)`)||p)&&tt(e,"transform",s),(h[0]&68158464||p)&&tt(e,"visibility",f[20]?"visible":"hidden")},i(f){a||(t&&T(t.$$.fragment,f),a=!0)},o(f){t&&O(t.$$.fragment,f),a=!1},d(f){f&&_(e),t&&te(t),o[50](null),l=!1,wn(c)}}}function oC(o){let e,t,n=!o[8]&&ld(o);return{c(){n&&n.c(),e=Ve()},l(r){n&&n.l(r),e=Ve()},m(r,i){n&&n.m(r,i),z(r,e,i),t=!0},p(r,i){r[8]?n&&(Re(),O(n,1,1,()=>{n=null}),Me()):n?(n.p(r,i),i[0]&256&&T(n,1)):(n=ld(r),n.c(),T(n,1),n.m(e.parentNode,e))},i(r){t||(T(n),t=!0)},o(r){O(n),t=!1},d(r){r&&_(e),n&&n.d(r)}}}function rC(o,e,t){let n,r,i,s,a,l,{node:c}=e,{id:u}=e,{data:d={}}=e,{selected:f=!1}=e,{draggable:h=void 0}=e,{selectable:p=void 0}=e,{connectable:b=!0}=e,{deletable:w=!0}=e,{hidden:m=!1}=e,{dragging:v=!1}=e,{resizeObserver:y=null}=e,{style:I=void 0}=e,{type:P="default"}=e,{isParent:R=!1}=e,{positionX:k}=e,{positionY:N}=e,{sourcePosition:M=void 0}=e,{targetPosition:H=void 0}=e,{zIndex:V}=e,{measuredWidth:Q=void 0}=e,{measuredHeight:J=void 0}=e,{initialWidth:E=void 0}=e,{initialHeight:Y=void 0}=e,{width:D=void 0}=e,{height:W=void 0}=e,{dragHandle:F=void 0}=e,{initialized:G=!1}=e,{parentId:K=void 0}=e,{nodeClickDistance:j=void 0}=e,{class:re=""}=e;const ue=$t(),{nodeTypes:X,nodeDragThreshold:me,selectNodesOnDrag:ne,handleNodeSelection:q,updateNodeInternals:he}=ue;de(o,X,ve=>t(46,a=ve));let Z,x=null;const _e=On(),Pe=et(b);de(o,Pe,ve=>t(28,l=ve));let De,ge,ct;hi("svelteflow__node_id",u),hi("svelteflow__node_connectable",Pe),Bo(()=>{x&&(y==null||y.unobserve(x))});function at(ve){p&&(!ye(ne)||!h||ye(me)>0)&&q(u),_e("nodeclick",{node:c.internals.userNode,event:ve})}const kt=(ve,sn,Vt,Jt)=>{_e("nodedrag",{event:ve,targetNode:Vt,nodes:Jt})},_t=(ve,sn,Vt,Jt)=>{_e("nodedragstart",{event:ve,targetNode:Vt,nodes:Jt})},Dt=(ve,sn,Vt,Jt)=>{_e("nodedragstop",{event:ve,targetNode:Vt,nodes:Jt})};function Ot(ve){ze[ve?"unshift":"push"](()=>{Z=ve,t(24,Z)})}const fn=ve=>_e("nodemouseenter",{node:c,event:ve}),en=ve=>_e("nodemouseleave",{node:c,event:ve}),tn=ve=>_e("nodemousemove",{node:c,event:ve}),nn=ve=>_e("nodecontextmenu",{node:c,event:ve});return o.$$set=ve=>{"node"in ve&&t(0,c=ve.node),"id"in ve&&t(1,u=ve.id),"data"in ve&&t(2,d=ve.data),"selected"in ve&&t(3,f=ve.selected),"draggable"in ve&&t(4,h=ve.draggable),"selectable"in ve&&t(5,p=ve.selectable),"connectable"in ve&&t(6,b=ve.connectable),"deletable"in ve&&t(7,w=ve.deletable),"hidden"in ve&&t(8,m=ve.hidden),"dragging"in ve&&t(9,v=ve.dragging),"resizeObserver"in ve&&t(35,y=ve.resizeObserver),"style"in ve&&t(10,I=ve.style),"type"in ve&&t(36,P=ve.type),"isParent"in ve&&t(11,R=ve.isParent),"positionX"in ve&&t(12,k=ve.positionX),"positionY"in ve&&t(13,N=ve.positionY),"sourcePosition"in ve&&t(14,M=ve.sourcePosition),"targetPosition"in ve&&t(15,H=ve.targetPosition),"zIndex"in ve&&t(16,V=ve.zIndex),"measuredWidth"in ve&&t(37,Q=ve.measuredWidth),"measuredHeight"in ve&&t(38,J=ve.measuredHeight),"initialWidth"in ve&&t(39,E=ve.initialWidth),"initialHeight"in ve&&t(40,Y=ve.initialHeight),"width"in ve&&t(17,D=ve.width),"height"in ve&&t(18,W=ve.height),"dragHandle"in ve&&t(19,F=ve.dragHandle),"initialized"in ve&&t(20,G=ve.initialized),"parentId"in ve&&t(21,K=ve.parentId),"nodeClickDistance"in ve&&t(22,j=ve.nodeClickDistance),"class"in ve&&t(23,re=ve.class)},o.$$.update=()=>{o.$$.dirty[1]&32&&t(25,n=P||"default"),o.$$.dirty[0]&33554432|o.$$.dirty[1]&32768&&t(45,r=!!a[n]),o.$$.dirty[0]&33554432|o.$$.dirty[1]&32768&&t(27,i=a[n]||Wg),o.$$.dirty[1]&16416&&(r||console.warn("003",Pi.error003(P))),o.$$.dirty[0]&393216|o.$$.dirty[1]&960&&t(26,s=nC({width:D,height:W,initialWidth:E,initialHeight:Y,measuredWidth:Q,measuredHeight:J})),o.$$.dirty[0]&64&&Pe.set(!!b),o.$$.dirty[0]&50380802|o.$$.dirty[1]&14336&&((De&&n!==De||ge&&M!==ge||ct&&H!==ct)&&requestAnimationFrame(()=>he(new Map([[u,{id:u,nodeElement:Z,force:!0}]]))),t(42,De=n),t(43,ge=M),t(44,ct=H)),o.$$.dirty[0]&17825792|o.$$.dirty[1]&1040&&y&&(Z!==x||!G)&&(x&&y.unobserve(x),Z&&y.observe(Z),t(41,x=Z))},[c,u,d,f,h,p,b,w,m,v,I,R,k,N,M,H,V,D,W,F,G,K,j,re,Z,n,s,i,l,ue,X,q,_e,Pe,at,y,P,Q,J,E,Y,x,De,ge,ct,r,a,kt,_t,Dt,Ot,fn,en,tn,nn]}class iC extends We{constructor(e){super(),Ye(this,e,rC,oC,uf,{node:0,id:1,data:2,selected:3,draggable:4,selectable:5,connectable:6,deletable:7,hidden:8,dragging:9,resizeObserver:35,style:10,type:36,isParent:11,positionX:12,positionY:13,sourcePosition:14,targetPosition:15,zIndex:16,measuredWidth:37,measuredHeight:38,initialWidth:39,initialHeight:40,width:17,height:18,dragHandle:19,initialized:20,parentId:21,nodeClickDistance:22,class:23},null,[-1,-1])}}const{Map:sC}=df;function cd(o,e,t){const n=o.slice();return n[21]=e[t],n}function ud(o,e){let t,n,r;return n=new iC({props:{node:e[21],id:e[21].id,data:e[21].data,selected:!!e[21].selected,hidden:!!e[21].hidden,draggable:!!(e[21].draggable||e[2]&&typeof e[21].draggable>"u"),selectable:!!(e[21].selectable||e[3]&&typeof e[21].selectable>"u"),connectable:!!(e[21].connectable||e[4]&&typeof e[21].connectable>"u"),deletable:e[21].deletable??!0,positionX:e[21].internals.positionAbsolute.x,positionY:e[21].internals.positionAbsolute.y,isParent:e[5].has(e[21].id),style:e[21].style,class:e[21].class,type:e[21].type??"default",sourcePosition:e[21].sourcePosition,targetPosition:e[21].targetPosition,dragging:e[21].dragging,zIndex:e[21].internals.z??0,dragHandle:e[21].dragHandle,initialized:Xu(e[21]),width:e[21].width,height:e[21].height,initialWidth:e[21].initialWidth,initialHeight:e[21].initialHeight,measuredWidth:e[21].measured.width,measuredHeight:e[21].measured.height,parentId:e[21].parentId,resizeObserver:e[11],nodeClickDistance:e[0]}}),n.$on("nodeclick",e[12]),n.$on("nodemouseenter",e[13]),n.$on("nodemousemove",e[14]),n.$on("nodemouseleave",e[15]),n.$on("nodedrag",e[16]),n.$on("nodedragstart",e[17]),n.$on("nodedragstop",e[18]),n.$on("nodecontextmenu",e[19]),{key:o,first:null,c(){t=Ve(),$(n.$$.fragment),this.h()},l(i){t=Ve(),oe(n.$$.fragment,i),this.h()},h(){this.first=t},m(i,s){z(i,t,s),ee(n,i,s),r=!0},p(i,s){e=i;const a={};s&2&&(a.node=e[21]),s&2&&(a.id=e[21].id),s&2&&(a.data=e[21].data),s&2&&(a.selected=!!e[21].selected),s&2&&(a.hidden=!!e[21].hidden),s&6&&(a.draggable=!!(e[21].draggable||e[2]&&typeof e[21].draggable>"u")),s&10&&(a.selectable=!!(e[21].selectable||e[3]&&typeof e[21].selectable>"u")),s&18&&(a.connectable=!!(e[21].connectable||e[4]&&typeof e[21].connectable>"u")),s&2&&(a.deletable=e[21].deletable??!0),s&2&&(a.positionX=e[21].internals.positionAbsolute.x),s&2&&(a.positionY=e[21].internals.positionAbsolute.y),s&34&&(a.isParent=e[5].has(e[21].id)),s&2&&(a.style=e[21].style),s&2&&(a.class=e[21].class),s&2&&(a.type=e[21].type??"default"),s&2&&(a.sourcePosition=e[21].sourcePosition),s&2&&(a.targetPosition=e[21].targetPosition),s&2&&(a.dragging=e[21].dragging),s&2&&(a.zIndex=e[21].internals.z??0),s&2&&(a.dragHandle=e[21].dragHandle),s&2&&(a.initialized=Xu(e[21])),s&2&&(a.width=e[21].width),s&2&&(a.height=e[21].height),s&2&&(a.initialWidth=e[21].initialWidth),s&2&&(a.initialHeight=e[21].initialHeight),s&2&&(a.measuredWidth=e[21].measured.width),s&2&&(a.measuredHeight=e[21].measured.height),s&2&&(a.parentId=e[21].parentId),s&1&&(a.nodeClickDistance=e[0]),n.$set(a)},i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){O(n.$$.fragment,i),r=!1},d(i){i&&_(t),te(n,i)}}}function aC(o){let e,t=[],n=new sC,r,i=yt(o[1]);const s=a=>a[21].id;for(let a=0;a<i.length;a+=1){let l=cd(o,i,a),c=s(l);n.set(c,t[a]=ud(c,l))}return{c(){e=U("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=L(a,"DIV",{class:!0});var l=A(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(_),this.h()},h(){g(e,"class","svelte-flow__nodes svelte-tf4uy4")},m(a,l){z(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);r=!0},p(a,[l]){l&2111&&(i=yt(a[1]),Re(),t=ws(t,l,s,1,a,i,n,e,vs,ud,null,cd),Me())},i(a){if(!r){for(let l=0;l<i.length;l+=1)T(t[l]);r=!0}},o(a){for(let l=0;l<t.length;l+=1)O(t[l]);r=!1},d(a){a&&_(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function lC(o,e,t){let n,r,i,s,a,{nodeClickDistance:l=0}=e;const{visibleNodes:c,nodesDraggable:u,nodesConnectable:d,elementsSelectable:f,updateNodeInternals:h,parentLookup:p}=$t();de(o,c,N=>t(1,n=N)),de(o,u,N=>t(2,r=N)),de(o,d,N=>t(4,s=N)),de(o,f,N=>t(3,i=N)),de(o,p,N=>t(5,a=N));const b=typeof ResizeObserver>"u"?null:new ResizeObserver(N=>{const M=new Map;N.forEach(H=>{const V=H.target.getAttribute("data-id");M.set(V,{id:V,nodeElement:H.target,force:!0})}),h(M)});Bo(()=>{b==null||b.disconnect()});function w(N){Et.call(this,o,N)}function m(N){Et.call(this,o,N)}function v(N){Et.call(this,o,N)}function y(N){Et.call(this,o,N)}function I(N){Et.call(this,o,N)}function P(N){Et.call(this,o,N)}function R(N){Et.call(this,o,N)}function k(N){Et.call(this,o,N)}return o.$$set=N=>{"nodeClickDistance"in N&&t(0,l=N.nodeClickDistance)},[l,n,r,i,s,a,c,u,d,f,p,b,w,m,v,y,I,P,R,k]}class cC extends We{constructor(e){super(),Ye(this,e,lC,aC,Qe,{nodeClickDistance:0})}}function dd(o){let e,t,n,r,i,s,a,l;var c=o[27];function u(d,f){return{props:{id:d[0],source:d[1],target:d[2],sourceX:d[14],sourceY:d[15],targetX:d[16],targetY:d[17],sourcePosition:d[18],targetPosition:d[19],animated:d[6],selected:d[7],label:d[10],labelStyle:d[11],data:d[3],style:d[4],interactionWidth:d[21],selectable:d[24],deletable:d[8]??!0,type:d[23],sourceHandleId:d[12],targetHandleId:d[13],markerStart:d[26],markerEnd:d[25]}}}return c&&(n=$i(c,u(o))),{c(){e=Ce("svg"),t=Ce("g"),n&&$(n.$$.fragment),this.h()},l(d){e=Ee(d,"svg",{});var f=A(e);t=Ee(f,"g",{class:!0,"data-id":!0,"aria-label":!0,role:!0});var h=A(t);n&&oe(n.$$.fragment,h),h.forEach(_),f.forEach(_),this.h()},h(){g(t,"class",r=qt(["svelte-flow__edge",o[22]])),g(t,"data-id",o[0]),g(t,"aria-label",i=o[20]===null?void 0:o[20]?o[20]:`Edge from ${o[1]} to ${o[2]}`),g(t,"role","img"),dt(t,"animated",o[6]),dt(t,"selected",o[7]),dt(t,"selectable",o[24]),tt(e,"z-index",o[5])},m(d,f){z(d,e,f),S(e,t),n&&ee(n,t,null),s=!0,a||(l=[Ae(t,"click",o[32]),Ae(t,"contextmenu",o[41]),Ae(t,"mouseenter",o[42]),Ae(t,"mouseleave",o[43])],a=!0)},p(d,f){if(f[0]&134217728&&c!==(c=d[27])){if(n){Re();const h=n;O(h.$$.fragment,1,0,()=>{te(h,1)}),Me()}c?(n=$i(c,u(d)),$(n.$$.fragment),T(n.$$.fragment,1),ee(n,t,null)):n=null}else if(c){const h={};f[0]&1&&(h.id=d[0]),f[0]&2&&(h.source=d[1]),f[0]&4&&(h.target=d[2]),f[0]&16384&&(h.sourceX=d[14]),f[0]&32768&&(h.sourceY=d[15]),f[0]&65536&&(h.targetX=d[16]),f[0]&131072&&(h.targetY=d[17]),f[0]&262144&&(h.sourcePosition=d[18]),f[0]&524288&&(h.targetPosition=d[19]),f[0]&64&&(h.animated=d[6]),f[0]&128&&(h.selected=d[7]),f[0]&1024&&(h.label=d[10]),f[0]&2048&&(h.labelStyle=d[11]),f[0]&8&&(h.data=d[3]),f[0]&16&&(h.style=d[4]),f[0]&2097152&&(h.interactionWidth=d[21]),f[0]&16777216&&(h.selectable=d[24]),f[0]&256&&(h.deletable=d[8]??!0),f[0]&8388608&&(h.type=d[23]),f[0]&4096&&(h.sourceHandleId=d[12]),f[0]&8192&&(h.targetHandleId=d[13]),f[0]&67108864&&(h.markerStart=d[26]),f[0]&33554432&&(h.markerEnd=d[25]),n.$set(h)}(!s||f[0]&4194304&&r!==(r=qt(["svelte-flow__edge",d[22]])))&&g(t,"class",r),(!s||f[0]&1)&&g(t,"data-id",d[0]),(!s||f[0]&1048582&&i!==(i=d[20]===null?void 0:d[20]?d[20]:`Edge from ${d[1]} to ${d[2]}`))&&g(t,"aria-label",i),(!s||f[0]&4194368)&&dt(t,"animated",d[6]),(!s||f[0]&4194432)&&dt(t,"selected",d[7]),(!s||f[0]&20971520)&&dt(t,"selectable",d[24]),f[0]&32&&tt(e,"z-index",d[5])},i(d){s||(n&&T(n.$$.fragment,d),s=!0)},o(d){n&&O(n.$$.fragment,d),s=!1},d(d){d&&_(e),n&&te(n),a=!1,wn(l)}}}function uC(o){let e,t,n=!o[9]&&dd(o);return{c(){n&&n.c(),e=Ve()},l(r){n&&n.l(r),e=Ve()},m(r,i){n&&n.m(r,i),z(r,e,i),t=!0},p(r,i){r[9]?n&&(Re(),O(n,1,1,()=>{n=null}),Me()):n?(n.p(r,i),i[0]&512&&T(n,1)):(n=dd(r),n.c(),T(n,1),n.m(e.parentNode,e))},i(r){t||(T(n),t=!0)},o(r){O(n),t=!1},d(r){r&&_(e),n&&n.d(r)}}}function dC(o,e,t){let n,r,i,s,a,l,c,u,d,{id:f}=e,{type:h="default"}=e,{source:p=""}=e,{target:b=""}=e,{data:w={}}=e,{style:m=void 0}=e,{zIndex:v=void 0}=e,{animated:y=!1}=e,{selected:I=!1}=e,{selectable:P=void 0}=e,{deletable:R=void 0}=e,{hidden:k=!1}=e,{label:N=void 0}=e,{labelStyle:M=void 0}=e,{markerStart:H=void 0}=e,{markerEnd:V=void 0}=e,{sourceHandle:Q=void 0}=e,{targetHandle:J=void 0}=e,{sourceX:E}=e,{sourceY:Y}=e,{targetX:D}=e,{targetY:W}=e,{sourcePosition:F}=e,{targetPosition:G}=e,{ariaLabel:K=void 0}=e,{interactionWidth:j=void 0}=e,{class:re=""}=e;hi("svelteflow__edge_id",f);const{edgeLookup:ue,edgeTypes:X,flowId:me,elementsSelectable:ne}=$t();de(o,ue,ge=>t(44,l=ge)),de(o,X,ge=>t(40,d=ge)),de(o,me,ge=>t(39,u=ge)),de(o,ne,ge=>t(38,c=ge));const q=On(),he=Yg();function Z(ge){const ct=l.get(f);ct&&(he(f),q("edgeclick",{event:ge,edge:ct}))}function x(ge,ct){const at=l.get(f);at&&q(ct,{event:ge,edge:at})}const _e=ge=>{x(ge,"edgecontextmenu")},Pe=ge=>{x(ge,"edgemouseenter")},De=ge=>{x(ge,"edgemouseleave")};return o.$$set=ge=>{"id"in ge&&t(0,f=ge.id),"type"in ge&&t(34,h=ge.type),"source"in ge&&t(1,p=ge.source),"target"in ge&&t(2,b=ge.target),"data"in ge&&t(3,w=ge.data),"style"in ge&&t(4,m=ge.style),"zIndex"in ge&&t(5,v=ge.zIndex),"animated"in ge&&t(6,y=ge.animated),"selected"in ge&&t(7,I=ge.selected),"selectable"in ge&&t(35,P=ge.selectable),"deletable"in ge&&t(8,R=ge.deletable),"hidden"in ge&&t(9,k=ge.hidden),"label"in ge&&t(10,N=ge.label),"labelStyle"in ge&&t(11,M=ge.labelStyle),"markerStart"in ge&&t(36,H=ge.markerStart),"markerEnd"in ge&&t(37,V=ge.markerEnd),"sourceHandle"in ge&&t(12,Q=ge.sourceHandle),"targetHandle"in ge&&t(13,J=ge.targetHandle),"sourceX"in ge&&t(14,E=ge.sourceX),"sourceY"in ge&&t(15,Y=ge.sourceY),"targetX"in ge&&t(16,D=ge.targetX),"targetY"in ge&&t(17,W=ge.targetY),"sourcePosition"in ge&&t(18,F=ge.sourcePosition),"targetPosition"in ge&&t(19,G=ge.targetPosition),"ariaLabel"in ge&&t(20,K=ge.ariaLabel),"interactionWidth"in ge&&t(21,j=ge.interactionWidth),"class"in ge&&t(22,re=ge.class)},o.$$.update=()=>{o.$$.dirty[1]&8&&t(23,n=h||"default"),o.$$.dirty[0]&8388608|o.$$.dirty[1]&512&&t(27,r=d[n]||qg),o.$$.dirty[1]&288&&t(26,i=H?`url('#${Ha(H,u)}')`:void 0),o.$$.dirty[1]&320&&t(25,s=V?`url('#${Ha(V,u)}')`:void 0),o.$$.dirty[1]&144&&t(24,a=P??c)},[f,p,b,w,m,v,y,I,R,k,N,M,Q,J,E,Y,D,W,F,G,K,j,re,n,a,s,i,r,ue,X,me,ne,Z,x,h,P,H,V,c,u,d,_e,Pe,De]}class fC extends We{constructor(e){super(),Ye(this,e,dC,uC,uf,{id:0,type:34,source:1,target:2,data:3,style:4,zIndex:5,animated:6,selected:7,selectable:35,deletable:8,hidden:9,label:10,labelStyle:11,markerStart:36,markerEnd:37,sourceHandle:12,targetHandle:13,sourceX:14,sourceY:15,targetX:16,targetY:17,sourcePosition:18,targetPosition:19,ariaLabel:20,interactionWidth:21,class:22},null,[-1,-1])}}function hC(o,e,t){let{onMount:n=void 0}=e,{onDestroy:r=void 0}=e;return Qn(()=>(n==null||n(),r)),o.$$set=i=>{"onMount"in i&&t(0,n=i.onMount),"onDestroy"in i&&t(1,r=i.onDestroy)},[n,r]}class gC extends We{constructor(e){super(),Ye(this,e,hC,null,Qe,{onMount:0,onDestroy:1})}}function fd(o,e,t){const n=o.slice();return n[2]=e[t],n}function hd(o,e){let t,n,r;const i=[e[2]];let s={};for(let a=0;a<i.length;a+=1)s=Rt(s,i[a]);return n=new kC({props:s}),{key:o,first:null,c(){t=Ve(),$(n.$$.fragment),this.h()},l(a){t=Ve(),oe(n.$$.fragment,a),this.h()},h(){this.first=t},m(a,l){z(a,t,l),ee(n,a,l),r=!0},p(a,l){e=a;const c=l&1?Ho(i,[pi(e[2])]):{};n.$set(c)},i(a){r||(T(n.$$.fragment,a),r=!0)},o(a){O(n.$$.fragment,a),r=!1},d(a){a&&_(t),te(n,a)}}}function mC(o){let e,t=[],n=new Map,r,i=yt(o[0]);const s=a=>a[2].id;for(let a=0;a<i.length;a+=1){let l=fd(o,i,a),c=s(l);n.set(c,t[a]=hd(c,l))}return{c(){e=Ce("defs");for(let a=0;a<t.length;a+=1)t[a].c()},l(a){e=Ee(a,"defs",{});var l=A(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(_)},m(a,l){z(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);r=!0},p(a,[l]){l&1&&(i=yt(a[0]),Re(),t=ws(t,l,s,1,a,i,n,e,vs,hd,null,fd),Me())},i(a){if(!r){for(let l=0;l<i.length;l+=1)T(t[l]);r=!0}},o(a){for(let l=0;l<t.length;l+=1)O(t[l]);r=!1},d(a){a&&_(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function pC(o,e,t){let n;const{markers:r}=$t();return de(o,r,i=>t(0,n=i)),[n,r]}class _C extends We{constructor(e){super(),Ye(this,e,pC,mC,Qe,{})}}function bC(o){let e;return{c(){e=Ce("polyline"),this.h()},l(t){e=Ee(t,"polyline",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,fill:!0,points:!0}),A(e).forEach(_),this.h()},h(){g(e,"stroke",o[6]),g(e,"stroke-linecap","round"),g(e,"stroke-linejoin","round"),g(e,"stroke-width",o[7]),g(e,"fill",o[6]),g(e,"points","-5,-4 0,0 -5,4 -5,-4")},m(t,n){z(t,e,n)},p(t,n){n&64&&g(e,"stroke",t[6]),n&128&&g(e,"stroke-width",t[7]),n&64&&g(e,"fill",t[6])},d(t){t&&_(e)}}}function yC(o){let e;return{c(){e=Ce("polyline"),this.h()},l(t){e=Ee(t,"polyline",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,fill:!0,points:!0}),A(e).forEach(_),this.h()},h(){g(e,"stroke",o[6]),g(e,"stroke-linecap","round"),g(e,"stroke-linejoin","round"),g(e,"stroke-width",o[7]),g(e,"fill","none"),g(e,"points","-5,-4 0,0 -5,4")},m(t,n){z(t,e,n)},p(t,n){n&64&&g(e,"stroke",t[6]),n&128&&g(e,"stroke-width",t[7])},d(t){t&&_(e)}}}function wC(o){let e,t,n;function r(a,l){if(a[1]===ms.Arrow)return yC;if(a[1]===ms.ArrowClosed)return bC}let i=r(o),s=i&&i(o);return{c(){e=Ce("marker"),s&&s.c(),this.h()},l(a){e=Ee(a,"marker",{class:!0,id:!0,markerWidth:!0,markerHeight:!0,viewBox:!0,markerUnits:!0,orient:!0,refX:!0,refY:!0});var l=A(e);s&&s.l(l),l.forEach(_),this.h()},h(){g(e,"class","svelte-flow__arrowhead"),g(e,"id",o[0]),g(e,"markerWidth",t=`${o[2]}`),g(e,"markerHeight",n=`${o[3]}`),g(e,"viewBox","-10 -10 20 20"),g(e,"markerUnits",o[4]),g(e,"orient",o[5]),g(e,"refX","0"),g(e,"refY","0")},m(a,l){z(a,e,l),s&&s.m(e,null)},p(a,[l]){i===(i=r(a))&&s?s.p(a,l):(s&&s.d(1),s=i&&i(a),s&&(s.c(),s.m(e,null))),l&1&&g(e,"id",a[0]),l&4&&t!==(t=`${a[2]}`)&&g(e,"markerWidth",t),l&8&&n!==(n=`${a[3]}`)&&g(e,"markerHeight",n),l&16&&g(e,"markerUnits",a[4]),l&32&&g(e,"orient",a[5])},i:Ue,o:Ue,d(a){a&&_(e),s&&s.d()}}}function vC(o,e,t){let{id:n}=e,{type:r}=e,{width:i=12.5}=e,{height:s=12.5}=e,{markerUnits:a="strokeWidth"}=e,{orient:l="auto-start-reverse"}=e,{color:c=void 0}=e,{strokeWidth:u=void 0}=e;return o.$$set=d=>{"id"in d&&t(0,n=d.id),"type"in d&&t(1,r=d.type),"width"in d&&t(2,i=d.width),"height"in d&&t(3,s=d.height),"markerUnits"in d&&t(4,a=d.markerUnits),"orient"in d&&t(5,l=d.orient),"color"in d&&t(6,c=d.color),"strokeWidth"in d&&t(7,u=d.strokeWidth)},[n,r,i,s,a,l,c,u]}class kC extends We{constructor(e){super(),Ye(this,e,vC,wC,Qe,{id:0,type:1,width:2,height:3,markerUnits:4,orient:5,color:6,strokeWidth:7})}}function gd(o,e,t){const n=o.slice();return n[14]=e[t],n}function md(o,e){let t,n,r;return n=new fC({props:{id:e[14].id,source:e[14].source,target:e[14].target,data:e[14].data,style:e[14].style,animated:e[14].animated,selected:e[14].selected,selectable:e[14].selectable??e[1],deletable:e[14].deletable,hidden:e[14].hidden,label:e[14].label,labelStyle:e[14].labelStyle,markerStart:e[14].markerStart,markerEnd:e[14].markerEnd,sourceHandle:e[14].sourceHandle,targetHandle:e[14].targetHandle,sourceX:e[14].sourceX,sourceY:e[14].sourceY,targetX:e[14].targetX,targetY:e[14].targetY,sourcePosition:e[14].sourcePosition,targetPosition:e[14].targetPosition,ariaLabel:e[14].ariaLabel,interactionWidth:e[14].interactionWidth,class:e[14].class,type:e[14].type||"default",zIndex:e[14].zIndex}}),n.$on("edgeclick",e[7]),n.$on("edgecontextmenu",e[8]),n.$on("edgemouseenter",e[9]),n.$on("edgemouseleave",e[10]),{key:o,first:null,c(){t=Ve(),$(n.$$.fragment),this.h()},l(i){t=Ve(),oe(n.$$.fragment,i),this.h()},h(){this.first=t},m(i,s){z(i,t,s),ee(n,i,s),r=!0},p(i,s){e=i;const a={};s&1&&(a.id=e[14].id),s&1&&(a.source=e[14].source),s&1&&(a.target=e[14].target),s&1&&(a.data=e[14].data),s&1&&(a.style=e[14].style),s&1&&(a.animated=e[14].animated),s&1&&(a.selected=e[14].selected),s&3&&(a.selectable=e[14].selectable??e[1]),s&1&&(a.deletable=e[14].deletable),s&1&&(a.hidden=e[14].hidden),s&1&&(a.label=e[14].label),s&1&&(a.labelStyle=e[14].labelStyle),s&1&&(a.markerStart=e[14].markerStart),s&1&&(a.markerEnd=e[14].markerEnd),s&1&&(a.sourceHandle=e[14].sourceHandle),s&1&&(a.targetHandle=e[14].targetHandle),s&1&&(a.sourceX=e[14].sourceX),s&1&&(a.sourceY=e[14].sourceY),s&1&&(a.targetX=e[14].targetX),s&1&&(a.targetY=e[14].targetY),s&1&&(a.sourcePosition=e[14].sourcePosition),s&1&&(a.targetPosition=e[14].targetPosition),s&1&&(a.ariaLabel=e[14].ariaLabel),s&1&&(a.interactionWidth=e[14].interactionWidth),s&1&&(a.class=e[14].class),s&1&&(a.type=e[14].type||"default"),s&1&&(a.zIndex=e[14].zIndex),n.$set(a)},i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){O(n.$$.fragment,i),r=!1},d(i){i&&_(t),te(n,i)}}}function pd(o){let e,t;return e=new gC({props:{onMount:o[11],onDestroy:o[12]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&4&&(i.onMount=n[11]),r&4&&(i.onDestroy=n[12]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function CC(o){let e,t,n,r,i=[],s=new Map,a,l;n=new _C({});let c=yt(o[0]);const u=f=>f[14].id;for(let f=0;f<c.length;f+=1){let h=gd(o,c,f),p=u(h);s.set(p,i[f]=md(p,h))}let d=o[0].length>0&&pd(o);return{c(){e=U("div"),t=Ce("svg"),$(n.$$.fragment),r=ie();for(let f=0;f<i.length;f+=1)i[f].c();a=ie(),d&&d.c(),this.h()},l(f){e=L(f,"DIV",{class:!0});var h=A(e);t=Ee(h,"svg",{class:!0});var p=A(t);oe(n.$$.fragment,p),p.forEach(_),r=se(h);for(let b=0;b<i.length;b+=1)i[b].l(h);a=se(h),d&&d.l(h),h.forEach(_),this.h()},h(){g(t,"class","svelte-flow__marker"),g(e,"class","svelte-flow__edges")},m(f,h){z(f,e,h),S(e,t),ee(n,t,null),S(e,r);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(e,null);S(e,a),d&&d.m(e,null),l=!0},p(f,[h]){h&3&&(c=yt(f[0]),Re(),i=ws(i,h,u,1,f,c,s,e,vs,md,a,gd),Me()),f[0].length>0?d?(d.p(f,h),h&1&&T(d,1)):(d=pd(f),d.c(),T(d,1),d.m(e,null)):d&&(Re(),O(d,1,1,()=>{d=null}),Me())},i(f){if(!l){T(n.$$.fragment,f);for(let h=0;h<c.length;h+=1)T(i[h]);T(d),l=!0}},o(f){O(n.$$.fragment,f);for(let h=0;h<i.length;h+=1)O(i[h]);O(d),l=!1},d(f){f&&_(e),te(n);for(let h=0;h<i.length;h+=1)i[h].d();d&&d.d()}}}function EC(o,e,t){let n,r,i,{defaultEdgeOptions:s}=e;const{visibleEdges:a,edgesInitialized:l,edges:{setDefaultOptions:c},elementsSelectable:u}=$t();de(o,a,m=>t(0,n=m)),de(o,l,m=>t(2,i=m)),de(o,u,m=>t(1,r=m)),Qn(()=>{s&&c(s)});function d(m){Et.call(this,o,m)}function f(m){Et.call(this,o,m)}function h(m){Et.call(this,o,m)}function p(m){Et.call(this,o,m)}const b=()=>{xi(l,i=!0,i)},w=()=>{xi(l,i=!1,i)};return o.$$set=m=>{"defaultEdgeOptions"in m&&t(6,s=m.defaultEdgeOptions)},[n,r,i,a,l,u,s,d,f,h,p,b,w]}class IC extends We{constructor(e){super(),Ye(this,e,EC,CC,Qe,{defaultEdgeOptions:6})}}function _d(o){let e;return{c(){e=U("div"),this.h()},l(t){e=L(t,"DIV",{class:!0}),A(e).forEach(_),this.h()},h(){g(e,"class","svelte-flow__selection svelte-1iugwpu"),tt(e,"width",typeof o[2]=="string"?o[2]:`${o[2]}px`),tt(e,"height",typeof o[3]=="string"?o[3]:`${o[3]}px`),tt(e,"transform",`translate(${o[0]}px, ${o[1]}px)`)},m(t,n){z(t,e,n)},p(t,n){n&4&&tt(e,"width",typeof t[2]=="string"?t[2]:`${t[2]}px`),n&8&&tt(e,"height",typeof t[3]=="string"?t[3]:`${t[3]}px`),n&3&&tt(e,"transform",`translate(${t[0]}px, ${t[1]}px)`)},d(t){t&&_(e)}}}function TC(o){let e,t=o[4]&&_d(o);return{c(){t&&t.c(),e=Ve()},l(n){t&&t.l(n),e=Ve()},m(n,r){t&&t.m(n,r),z(n,e,r)},p(n,[r]){n[4]?t?t.p(n,r):(t=_d(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ue,o:Ue,d(n){n&&_(e),t&&t.d(n)}}}function SC(o,e,t){let{x:n=0}=e,{y:r=0}=e,{width:i=0}=e,{height:s=0}=e,{isVisible:a=!0}=e;return o.$$set=l=>{"x"in l&&t(0,n=l.x),"y"in l&&t(1,r=l.y),"width"in l&&t(2,i=l.width),"height"in l&&t(3,s=l.height),"isVisible"in l&&t(4,a=l.isVisible)},[n,r,i,s,a]}class Zg extends We{constructor(e){super(),Ye(this,e,SC,TC,Qe,{x:0,y:1,width:2,height:3,isVisible:4})}}function AC(o){var n,r,i,s;let e,t;return e=new Zg({props:{isVisible:!!(o[0]&&o[1]==="user"),width:(n=o[0])==null?void 0:n.width,height:(r=o[0])==null?void 0:r.height,x:(i=o[0])==null?void 0:i.x,y:(s=o[0])==null?void 0:s.y}}),{c(){$(e.$$.fragment)},l(a){oe(e.$$.fragment,a)},m(a,l){ee(e,a,l),t=!0},p(a,[l]){var u,d,f,h;const c={};l&3&&(c.isVisible=!!(a[0]&&a[1]==="user")),l&1&&(c.width=(u=a[0])==null?void 0:u.width),l&1&&(c.height=(d=a[0])==null?void 0:d.height),l&1&&(c.x=(f=a[0])==null?void 0:f.x),l&1&&(c.y=(h=a[0])==null?void 0:h.y),e.$set(c)},i(a){t||(T(e.$$.fragment,a),t=!0)},o(a){O(e.$$.fragment,a),t=!1},d(a){te(e,a)}}}function RC(o,e,t){let n,r;const{selectionRect:i,selectionRectMode:s}=$t();return de(o,i,a=>t(0,n=a)),de(o,s,a=>t(1,r=a)),[n,r,i,s]}class MC extends We{constructor(e){super(),Ye(this,e,RC,AC,Qe,{})}}function bd(o){let e,t,n,r,i;return t=new Zg({props:{width:"100%",height:"100%",x:0,y:0}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(s){e=L(s,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var a=A(e);oe(t.$$.fragment,a),a.forEach(_),this.h()},h(){g(e,"class","selection-wrapper nopan svelte-5pxri"),tt(e,"width",o[1].width+"px"),tt(e,"height",o[1].height+"px"),tt(e,"transform","translate("+o[1].x+"px, "+o[1].y+"px)"),g(e,"role","button"),g(e,"tabindex","-1")},m(s,a){z(s,e,a),ee(t,e,null),n=!0,r||(i=[Bn(Jg.call(null,e,{disabled:!1,store:o[2],onDrag:o[11],onDragStart:o[12],onDragStop:o[13]})),Ae(e,"contextmenu",o[7]),Ae(e,"click",o[8]),Ae(e,"keyup",OC)],r=!0)},p(s,a){(!n||a&2)&&tt(e,"width",s[1].width+"px"),(!n||a&2)&&tt(e,"height",s[1].height+"px"),(!n||a&2)&&tt(e,"transform","translate("+s[1].x+"px, "+s[1].y+"px)")},i(s){n||(T(t.$$.fragment,s),n=!0)},o(s){O(t.$$.fragment,s),n=!1},d(s){s&&_(e),te(t),r=!1,wn(i)}}}function PC(o){let e=o[0]==="nodes"&&o[1]&&to(o[1].x)&&to(o[1].y),t,n,r=e&&bd(o);return{c(){r&&r.c(),t=Ve()},l(i){r&&r.l(i),t=Ve()},m(i,s){r&&r.m(i,s),z(i,t,s),n=!0},p(i,[s]){s&3&&(e=i[0]==="nodes"&&i[1]&&to(i[1].x)&&to(i[1].y)),e?r?(r.p(i,s),s&3&&T(r,1)):(r=bd(i),r.c(),T(r,1),r.m(t.parentNode,t)):r&&(Re(),O(r,1,1,()=>{r=null}),Me())},i(i){n||(T(r),n=!0)},o(i){O(r),n=!1},d(i){i&&_(t),r&&r.d(i)}}}const OC=()=>{};function NC(o,e,t){let n,r,i;const s=$t(),{selectionRectMode:a,nodes:l,nodeLookup:c}=s;de(o,a,m=>t(0,i=m)),de(o,l,m=>t(9,n=m)),de(o,c,m=>t(10,r=m));const u=On();let d=null;function f(m){const v=n.filter(y=>y.selected);u("selectioncontextmenu",{nodes:v,event:m})}function h(m){const v=n.filter(y=>y.selected);u("selectionclick",{nodes:v,event:m})}const p=(m,v,y,I)=>{u("nodedrag",{event:m,targetNode:null,nodes:I})},b=(m,v,y,I)=>{u("nodedragstart",{event:m,targetNode:null,nodes:I})},w=(m,v,y,I)=>{u("nodedragstop",{event:m,targetNode:null,nodes:I})};return o.$$.update=()=>{o.$$.dirty&1537&&i==="nodes"&&t(1,d=zs(r,{filter:m=>!!m.selected}))},[i,d,s,a,l,c,u,f,h,n,r,p,b,w]}class DC extends We{constructor(e){super(),Ye(this,e,NC,PC,Qe,{})}}function lo(o,e){let{enabled:t=!0,trigger:n,type:r="keydown"}=e;function i(s){const a=Array.isArray(n)?n:[n],l={alt:s.altKey,ctrl:s.ctrlKey,shift:s.shiftKey,meta:s.metaKey};for(const c of a){const u={modifier:[],preventDefault:!1,enabled:!0,...c},{modifier:d,key:f,callback:h,preventDefault:p,enabled:b}=u;if(b){if(d.length&&!(Array.isArray(d)?d:[d]).map(v=>typeof v=="string"?[v]:v).some(v=>v.every(y=>l[y])))continue;if(s.key===f){p&&s.preventDefault();const w={node:o,trigger:u,originalEvent:s};o.dispatchEvent(new CustomEvent("shortcut",{detail:w})),h==null||h(w)}}}}return t&&o.addEventListener(r,i),{update:s=>{const{enabled:a=!0,type:l="keydown"}=s;t&&(!a||r!==l)?o.removeEventListener(r,i):!t&&a&&o.addEventListener(l,i),t=a,r=l,n=s.trigger},destroy:()=>{o.removeEventListener(r,i)}}}function HC(o){let e,t,n,r,i,s,a,l,c,u,d,f;return{c:Ue,l:Ue,m(h,p){d||(f=[Bn(e=lo.call(null,window,{trigger:un(o[0],o[11]),type:"keydown"})),Bn(t=lo.call(null,window,{trigger:un(o[0],o[12]),type:"keyup"})),Bn(n=lo.call(null,window,{trigger:un(o[1],o[13]),type:"keydown"})),Bn(r=lo.call(null,window,{trigger:un(o[1],o[14]),type:"keyup"})),Bn(i=lo.call(null,window,{trigger:un(o[2],o[15]),type:"keydown"})),Bn(s=lo.call(null,window,{trigger:un(o[2],o[16]),type:"keyup"})),Bn(a=lo.call(null,window,{trigger:un(o[3],o[17]),type:"keydown"})),Bn(l=lo.call(null,window,{trigger:un(o[3],o[18]),type:"keyup"})),Bn(c=lo.call(null,window,{trigger:un(o[4],o[19]),type:"keydown"})),Bn(u=lo.call(null,window,{trigger:un(o[4],o[20]),type:"keyup"})),Ae(window,"blur",o[10]),Ae(window,"contextmenu",o[10])],d=!0)},p(h,[p]){e&&gn(e.update)&&p&1&&e.update.call(null,{trigger:un(h[0],h[11]),type:"keydown"}),t&&gn(t.update)&&p&1&&t.update.call(null,{trigger:un(h[0],h[12]),type:"keyup"}),n&&gn(n.update)&&p&2&&n.update.call(null,{trigger:un(h[1],h[13]),type:"keydown"}),r&&gn(r.update)&&p&2&&r.update.call(null,{trigger:un(h[1],h[14]),type:"keyup"}),i&&gn(i.update)&&p&4&&i.update.call(null,{trigger:un(h[2],h[15]),type:"keydown"}),s&&gn(s.update)&&p&4&&s.update.call(null,{trigger:un(h[2],h[16]),type:"keyup"}),a&&gn(a.update)&&p&8&&a.update.call(null,{trigger:un(h[3],h[17]),type:"keydown"}),l&&gn(l.update)&&p&8&&l.update.call(null,{trigger:un(h[3],h[18]),type:"keyup"}),c&&gn(c.update)&&p&16&&c.update.call(null,{trigger:un(h[4],h[19]),type:"keydown"}),u&&gn(u.update)&&p&16&&u.update.call(null,{trigger:un(h[4],h[20]),type:"keyup"})},i:Ue,o:Ue,d(h){d=!1,wn(f)}}}function xg(o){return o!==null&&typeof o=="object"}function UC(o){return xg(o)?o.modifier||[]:[]}function LC(o){return o==null?"":xg(o)?o.key:o}function un(o,e){return(Array.isArray(o)?o:[o]).map(n=>{const r=LC(n);return{key:r,modifier:UC(n),enabled:r!==null,callback:e}})}function BC(o,e,t){let{selectionKey:n="Shift"}=e,{multiSelectionKey:r=_s()?"Meta":"Control"}=e,{deleteKey:i="Backspace"}=e,{panActivationKey:s=" "}=e,{zoomActivationKey:a=_s()?"Meta":"Control"}=e;const{selectionKeyPressed:l,multiselectionKeyPressed:c,deleteKeyPressed:u,panActivationKeyPressed:d,zoomActivationKeyPressed:f,selectionRect:h}=$t();function p(){h.set(null),l.set(!1),c.set(!1),u.set(!1),d.set(!1),f.set(!1)}const b=()=>l.set(!0),w=()=>l.set(!1),m=()=>c.set(!0),v=()=>c.set(!1),y=M=>{!(M.originalEvent.ctrlKey||M.originalEvent.metaKey||M.originalEvent.shiftKey)&&!vv(M.originalEvent)&&u.set(!0)},I=()=>u.set(!1),P=()=>d.set(!0),R=()=>d.set(!1),k=()=>f.set(!0),N=()=>f.set(!1);return o.$$set=M=>{"selectionKey"in M&&t(0,n=M.selectionKey),"multiSelectionKey"in M&&t(1,r=M.multiSelectionKey),"deleteKey"in M&&t(2,i=M.deleteKey),"panActivationKey"in M&&t(3,s=M.panActivationKey),"zoomActivationKey"in M&&t(4,a=M.zoomActivationKey)},[n,r,i,s,a,l,c,u,d,f,p,b,w,m,v,y,I,P,R,k,N]}class zC extends We{constructor(e){super(),Ye(this,e,BC,HC,Qe,{selectionKey:0,multiSelectionKey:1,deleteKey:2,panActivationKey:3,zoomActivationKey:4})}}const FC=o=>({}),yd=o=>({});function wd(o){let e,t,n,r;const i=o[13].connectionLine,s=pn(i,o,o[12],yd);let a=!o[2]&&vd(o);return{c(){e=Ce("svg"),t=Ce("g"),s&&s.c(),a&&a.c(),this.h()},l(l){e=Ee(l,"svg",{width:!0,height:!0,class:!0,style:!0});var c=A(e);t=Ee(c,"g",{class:!0});var u=A(t);s&&s.l(u),a&&a.l(u),u.forEach(_),c.forEach(_),this.h()},h(){g(t,"class",n=qt(["svelte-flow__connection",Wu(o[3].isValid)])),g(e,"width",o[5]),g(e,"height",o[6]),g(e,"class","svelte-flow__connectionline"),g(e,"style",o[0])},m(l,c){z(l,e,c),S(e,t),s&&s.m(t,null),a&&a.m(t,null),r=!0},p(l,c){s&&s.p&&(!r||c&4096)&&_n(s,i,l,l[12],r?yn(i,l[12],c,FC):bn(l[12]),yd),l[2]?a&&(a.d(1),a=null):a?a.p(l,c):(a=vd(l),a.c(),a.m(t,null)),(!r||c&8&&n!==(n=qt(["svelte-flow__connection",Wu(l[3].isValid)])))&&g(t,"class",n),(!r||c&32)&&g(e,"width",l[5]),(!r||c&64)&&g(e,"height",l[6]),(!r||c&1)&&g(e,"style",l[0])},i(l){r||(T(s,l),r=!0)},o(l){O(s,l),r=!1},d(l){l&&_(e),s&&s.d(l),a&&a.d()}}}function vd(o){let e;return{c(){e=Ce("path"),this.h()},l(t){e=Ee(t,"path",{d:!0,style:!0,fill:!0,class:!0}),A(e).forEach(_),this.h()},h(){g(e,"d",o[4]),g(e,"style",o[1]),g(e,"fill","none"),g(e,"class","svelte-flow__connection-path")},m(t,n){z(t,e,n)},p(t,n){n&16&&g(e,"d",t[4]),n&2&&g(e,"style",t[1])},d(t){t&&_(e)}}}function VC(o){let e,t,n=o[3].inProgress&&wd(o);return{c(){n&&n.c(),e=Ve()},l(r){n&&n.l(r),e=Ve()},m(r,i){n&&n.m(r,i),z(r,e,i),t=!0},p(r,[i]){r[3].inProgress?n?(n.p(r,i),i&8&&T(n,1)):(n=wd(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Re(),O(n,1,1,()=>{n=null}),Me())},i(r){t||(T(n),t=!0)},o(r){O(n),t=!1},d(r){r&&_(e),n&&n.d(r)}}}function KC(o,e,t){let n,r,i,s,{$$slots:a={},$$scope:l}=e,{containerStyle:c=""}=e,{style:u=""}=e,{isCustomComponent:d=!1}=e;const{width:f,height:h,connection:p,connectionLineType:b}=$t();de(o,f,m=>t(5,i=m)),de(o,h,m=>t(6,s=m)),de(o,p,m=>t(3,r=m)),de(o,b,m=>t(11,n=m));let w=null;return o.$$set=m=>{"containerStyle"in m&&t(0,c=m.containerStyle),"style"in m&&t(1,u=m.style),"isCustomComponent"in m&&t(2,d=m.isCustomComponent),"$$scope"in m&&t(12,l=m.$$scope)},o.$$.update=()=>{if(o.$$.dirty&2060&&r.inProgress&&!d){const{from:m,to:v,fromPosition:y,toPosition:I}=r,P={sourceX:m.x,sourceY:m.y,sourcePosition:y,targetX:v.x,targetY:v.y,targetPosition:I};switch(n){case pr.Bezier:t(4,[w]=Ag(P),w);break;case pr.Step:t(4,[w]=bs({...P,borderRadius:0}),w);break;case pr.SmoothStep:t(4,[w]=bs(P),w);break;default:t(4,[w]=Mg(P),w)}}},[c,u,d,r,w,i,s,f,h,p,b,n,l,a]}class GC extends We{constructor(e){super(),Ye(this,e,KC,VC,Qe,{containerStyle:0,style:1,isCustomComponent:2})}}function WC(o){let e,t,n;const r=o[8].default,i=pn(r,o,o[7],null);let s=[{class:t=qt(["svelte-flow__panel",o[1],...o[2]])},{style:o[0]},o[5]],a={};for(let l=0;l<s.length;l+=1)a=Rt(a,s[l]);return{c(){e=U("div"),i&&i.c(),this.h()},l(l){e=L(l,"DIV",{class:!0,style:!0});var c=A(e);i&&i.l(c),c.forEach(_),this.h()},h(){_r(e,a),tt(e,"pointer-events",o[3]?"none":"")},m(l,c){z(l,e,c),i&&i.m(e,null),n=!0},p(l,[c]){i&&i.p&&(!n||c&128)&&_n(i,r,l,l[7],n?yn(r,l[7],c,null):bn(l[7]),null),_r(e,a=Ho(s,[(!n||c&6&&t!==(t=qt(["svelte-flow__panel",l[1],...l[2]])))&&{class:t},(!n||c&1)&&{style:l[0]},c&32&&l[5]])),tt(e,"pointer-events",l[3]?"none":"")},i(l){n||(T(i,l),n=!0)},o(l){O(i,l),n=!1},d(l){l&&_(e),i&&i.d(l)}}}function YC(o,e,t){let n;const r=["position","style","class"];let i=xt(e,r),s,{$$slots:a={},$$scope:l}=e,{position:c="top-right"}=e,{style:u=void 0}=e,{class:d=void 0}=e;const{selectionRectMode:f}=$t();return de(o,f,h=>t(3,s=h)),o.$$set=h=>{e=Rt(Rt({},e),so(h)),t(5,i=xt(e,r)),"position"in h&&t(6,c=h.position),"style"in h&&t(0,u=h.style),"class"in h&&t(1,d=h.class),"$$scope"in h&&t(7,l=h.$$scope)},o.$$.update=()=>{o.$$.dirty&64&&t(2,n=`${c}`.split("-"))},[u,d,n,s,f,i,c,l,a]}class $g extends We{constructor(e){super(),Ye(this,e,YC,WC,Qe,{position:6,style:0,class:1})}}function kd(o){let e,t;return e=new $g({props:{position:o[1],class:"svelte-flow__attribution","data-message":"Feel free to remove the attribution or check out how you could support us: https://svelteflow.dev/support-us",$$slots:{default:[qC]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&2&&(i.position=n[1]),r&4&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function qC(o){let e,t="Svelte Flow";return{c(){e=U("a"),e.textContent=t,this.h()},l(n){e=L(n,"A",{href:!0,target:!0,rel:!0,"aria-label":!0,"data-svelte-h":!0}),dn(e)!=="svelte-2vm8e4"&&(e.textContent=t),this.h()},h(){g(e,"href","https://svelteflow.dev"),g(e,"target","_blank"),g(e,"rel","noopener noreferrer"),g(e,"aria-label","Svelte Flow attribution")},m(n,r){z(n,e,r)},p:Ue,d(n){n&&_(e)}}}function jC(o){var r;let e,t,n=!((r=o[0])!=null&&r.hideAttribution)&&kd(o);return{c(){n&&n.c(),e=Ve()},l(i){n&&n.l(i),e=Ve()},m(i,s){n&&n.m(i,s),z(i,e,s),t=!0},p(i,[s]){var a;(a=i[0])!=null&&a.hideAttribution?n&&(Re(),O(n,1,1,()=>{n=null}),Me()):n?(n.p(i,s),s&1&&T(n,1)):(n=kd(i),n.c(),T(n,1),n.m(e.parentNode,e))},i(i){t||(T(n),t=!0)},o(i){O(n),t=!1},d(i){i&&_(e),n&&n.d(i)}}}function QC(o,e,t){let{proOptions:n=void 0}=e,{position:r="bottom-right"}=e;return o.$$set=i=>{"proOptions"in i&&t(0,n=i.proOptions),"position"in i&&t(1,r=i.position)},[n,r]}class XC extends We{constructor(e){super(),Ye(this,e,QC,jC,Qe,{proOptions:0,position:1})}}function Cd(o,{nodeTypes:e,edgeTypes:t,minZoom:n,maxZoom:r,translateExtent:i,paneClickDistance:s}){e!==void 0&&o.setNodeTypes(e),t!==void 0&&o.setEdgeTypes(t),n!==void 0&&o.setMinZoom(n),r!==void 0&&o.setMaxZoom(r),i!==void 0&&o.setTranslateExtent(i),s!==void 0&&o.setPaneClickDistance(s)}const JC=o=>Object.keys(o);function ZC(o,e){JC(e).forEach(t=>{const n=e[t];n!==void 0&&o[t].set(n)})}function xC(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function $C(o="light"){return xn("light",t=>{if(o!=="system"){t(o);return}const n=xC(),r=()=>t(n!=null&&n.matches?"dark":"light");return t(n!=null&&n.matches?"dark":"light"),n==null||n.addEventListener("change",r),()=>{n==null||n.removeEventListener("change",r)}})}const eE=o=>({}),Ed=o=>({slot:"connectionLine"});function tE(o){let e;const t=o[75].connectionLine,n=pn(t,o,o[99],Ed);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i[3]&64)&&_n(n,t,r,r[99],e?yn(t,r[99],i,eE):bn(r[99]),Ed)},i(r){e||(T(n,r),e=!0)},o(r){O(n,r),e=!1},d(r){n&&n.d(r)}}}function nE(o){let e,t,n,r,i,s,a,l,c,u,d,f;return e=new IC({props:{defaultEdgeOptions:o[21]}}),e.$on("edgeclick",o[78]),e.$on("edgecontextmenu",o[79]),e.$on("edgemouseenter",o[80]),e.$on("edgemouseleave",o[81]),n=new GC({props:{containerStyle:o[7],style:o[6],isCustomComponent:o[34].connectionLine,$$slots:{connectionLine:[tE]},$$scope:{ctx:o}}}),c=new cC({props:{nodeClickDistance:o[23]}}),c.$on("nodeclick",o[82]),c.$on("nodemouseenter",o[83]),c.$on("nodemousemove",o[84]),c.$on("nodemouseleave",o[85]),c.$on("nodedragstart",o[86]),c.$on("nodedrag",o[87]),c.$on("nodedragstop",o[88]),c.$on("nodecontextmenu",o[89]),d=new DC({}),d.$on("selectionclick",o[90]),d.$on("selectioncontextmenu",o[91]),d.$on("nodedragstart",o[92]),d.$on("nodedrag",o[93]),d.$on("nodedragstop",o[94]),{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment),r=ie(),i=U("div"),s=ie(),a=U("div"),l=ie(),$(c.$$.fragment),u=ie(),$(d.$$.fragment),this.h()},l(h){oe(e.$$.fragment,h),t=se(h),oe(n.$$.fragment,h),r=se(h),i=L(h,"DIV",{class:!0}),A(i).forEach(_),s=se(h),a=L(h,"DIV",{class:!0}),A(a).forEach(_),l=se(h),oe(c.$$.fragment,h),u=se(h),oe(d.$$.fragment,h),this.h()},h(){g(i,"class","svelte-flow__edgelabel-renderer"),g(a,"class","svelte-flow__viewport-portal")},m(h,p){ee(e,h,p),z(h,t,p),ee(n,h,p),z(h,r,p),z(h,i,p),z(h,s,p),z(h,a,p),z(h,l,p),ee(c,h,p),z(h,u,p),ee(d,h,p),f=!0},p(h,p){const b={};p[0]&2097152&&(b.defaultEdgeOptions=h[21]),e.$set(b);const w={};p[0]&128&&(w.containerStyle=h[7]),p[0]&64&&(w.style=h[6]),p[1]&8&&(w.isCustomComponent=h[34].connectionLine),p[3]&64&&(w.$$scope={dirty:p,ctx:h}),n.$set(w);const m={};p[0]&8388608&&(m.nodeClickDistance=h[23]),c.$set(m)},i(h){f||(T(e.$$.fragment,h),T(n.$$.fragment,h),T(c.$$.fragment,h),T(d.$$.fragment,h),f=!0)},o(h){O(e.$$.fragment,h),O(n.$$.fragment,h),O(c.$$.fragment,h),O(d.$$.fragment,h),f=!1},d(h){h&&(_(t),_(r),_(i),_(s),_(a),_(l),_(u)),te(e,h),te(n,h),te(c,h),te(d,h)}}}function oE(o){let e,t,n,r;return e=new tC({props:{$$slots:{default:[nE]},$$scope:{ctx:o}}}),n=new MC({}),{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment)},l(i){oe(e.$$.fragment,i),t=se(i),oe(n.$$.fragment,i)},m(i,s){ee(e,i,s),z(i,t,s),ee(n,i,s),r=!0},p(i,s){const a={};s[0]&10485952|s[1]&8|s[3]&64&&(a.$$scope={dirty:s,ctx:i}),e.$set(a)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),O(n.$$.fragment,i),r=!1},d(i){i&&_(t),te(e,i),te(n,i)}}}function rE(o){let e,t;return e=new xk({props:{panOnDrag:o[17]===void 0?!0:o[17],selectionOnDrag:o[18],$$slots:{default:[oE]},$$scope:{ctx:o}}}),e.$on("paneclick",o[95]),e.$on("panecontextmenu",o[96]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&131072&&(i.panOnDrag=n[17]===void 0?!0:n[17]),r[0]&262144&&(i.selectionOnDrag=n[18]),r[0]&10485952|r[1]&8|r[3]&64&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function iE(o){let e,t,n,r,i,s,a,l,c,u,d,f;t=new zC({props:{selectionKey:o[1],deleteKey:o[5],panActivationKey:o[2],multiSelectionKey:o[3],zoomActivationKey:o[4]}}),r=new Xk({props:{initialViewport:o[31],onMoveStart:o[8],onMove:o[9],onMoveEnd:o[10],panOnScrollMode:o[11]===void 0?po.Free:o[11],preventScrolling:o[12]===void 0?!0:o[12],zoomOnScroll:o[13]===void 0?!0:o[13],zoomOnDoubleClick:o[14]===void 0?!0:o[14],zoomOnPinch:o[15]===void 0?!0:o[15],panOnScroll:o[16]===void 0?!1:o[16],panOnDrag:o[17]===void 0?!0:o[17],paneClickDistance:o[22]===void 0?0:o[22],$$slots:{default:[rE]},$$scope:{ctx:o}}}),s=new XC({props:{proOptions:o[20],position:o[19]}});const h=o[75].default,p=pn(h,o,o[99],null);let b=[{style:o[24]},{class:l=qt(["svelte-flow",o[25],o[30]])},{"data-testid":"svelte-flow__wrapper"},o[33],{role:"application"}],w={};for(let m=0;m<b.length;m+=1)w=Rt(w,b[m]);return{c(){e=U("div"),$(t.$$.fragment),n=ie(),$(r.$$.fragment),i=ie(),$(s.$$.fragment),a=ie(),p&&p.c(),this.h()},l(m){e=L(m,"DIV",{style:!0,class:!0,"data-testid":!0,role:!0});var v=A(e);oe(t.$$.fragment,v),n=se(v),oe(r.$$.fragment,v),i=se(v),oe(s.$$.fragment,v),a=se(v),p&&p.l(v),v.forEach(_),this.h()},h(){_r(e,w),Po(()=>o[98].call(e)),dt(e,"svelte-12wlba6",!0)},m(m,v){z(m,e,v),ee(t,e,null),S(e,n),ee(r,e,null),S(e,i),ee(s,e,null),S(e,a),p&&p.m(e,null),o[97](e),c=am(e,o[98].bind(e)),u=!0,d||(f=[Ae(e,"dragover",o[76]),Ae(e,"drop",o[77])],d=!0)},p(m,v){const y={};v[0]&2&&(y.selectionKey=m[1]),v[0]&32&&(y.deleteKey=m[5]),v[0]&4&&(y.panActivationKey=m[2]),v[0]&8&&(y.multiSelectionKey=m[3]),v[0]&16&&(y.zoomActivationKey=m[4]),t.$set(y);const I={};v[0]&256&&(I.onMoveStart=m[8]),v[0]&512&&(I.onMove=m[9]),v[0]&1024&&(I.onMoveEnd=m[10]),v[0]&2048&&(I.panOnScrollMode=m[11]===void 0?po.Free:m[11]),v[0]&4096&&(I.preventScrolling=m[12]===void 0?!0:m[12]),v[0]&8192&&(I.zoomOnScroll=m[13]===void 0?!0:m[13]),v[0]&16384&&(I.zoomOnDoubleClick=m[14]===void 0?!0:m[14]),v[0]&32768&&(I.zoomOnPinch=m[15]===void 0?!0:m[15]),v[0]&65536&&(I.panOnScroll=m[16]===void 0?!1:m[16]),v[0]&131072&&(I.panOnDrag=m[17]===void 0?!0:m[17]),v[0]&4194304&&(I.paneClickDistance=m[22]===void 0?0:m[22]),v[0]&10879168|v[1]&8|v[3]&64&&(I.$$scope={dirty:v,ctx:m}),r.$set(I);const P={};v[0]&1048576&&(P.proOptions=m[20]),v[0]&524288&&(P.position=m[19]),s.$set(P),p&&p.p&&(!u||v[3]&64)&&_n(p,h,m,m[99],u?yn(h,m[99],v,null):bn(m[99]),null),_r(e,w=Ho(b,[(!u||v[0]&16777216)&&{style:m[24]},(!u||v[0]&1107296256&&l!==(l=qt(["svelte-flow",m[25],m[30]])))&&{class:l},{"data-testid":"svelte-flow__wrapper"},v[1]&4&&m[33],{role:"application"}])),dt(e,"svelte-12wlba6",!0)},i(m){u||(T(t.$$.fragment,m),T(r.$$.fragment,m),T(s.$$.fragment,m),T(p,m),u=!0)},o(m){O(t.$$.fragment,m),O(r.$$.fragment,m),O(s.$$.fragment,m),O(p,m),u=!1},d(m){m&&_(e),te(t),te(r),te(s),p&&p.d(m),o[97](null),c(),d=!1,wn(f)}}}function sE(o,e,t){let n;const r=["id","nodes","edges","fitView","fitViewOptions","minZoom","maxZoom","initialViewport","viewport","nodeTypes","edgeTypes","selectionKey","selectionMode","panActivationKey","multiSelectionKey","zoomActivationKey","nodesDraggable","nodesConnectable","nodeDragThreshold","elementsSelectable","snapGrid","deleteKey","connectionRadius","connectionLineType","connectionMode","connectionLineStyle","connectionLineContainerStyle","onMoveStart","onMove","onMoveEnd","isValidConnection","translateExtent","nodeExtent","onlyRenderVisibleElements","panOnScrollMode","preventScrolling","zoomOnScroll","zoomOnDoubleClick","zoomOnPinch","panOnScroll","panOnDrag","selectionOnDrag","autoPanOnConnect","autoPanOnNodeDrag","onerror","ondelete","onedgecreate","attributionPosition","proOptions","defaultEdgeOptions","width","height","colorMode","onconnect","onconnectstart","onconnectend","onbeforedelete","oninit","nodeOrigin","paneClickDistance","nodeClickDistance","defaultMarkerColor","style","class"];let i=xt(e,r),s,a,l=Ue,c=()=>(l(),l=zl(N,C=>t(100,a=C)),N),u,d=Ue,f=()=>(d(),d=zl(n,C=>t(30,u=C)),n);o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>d());let{$$slots:h={},$$scope:p}=e;const b=lm(h);let{id:w="1"}=e,{nodes:m}=e,{edges:v}=e,{fitView:y=void 0}=e,{fitViewOptions:I=void 0}=e,{minZoom:P=void 0}=e,{maxZoom:R=void 0}=e,{initialViewport:k=void 0}=e,{viewport:N=void 0}=e;c();let{nodeTypes:M=void 0}=e,{edgeTypes:H=void 0}=e,{selectionKey:V=void 0}=e,{selectionMode:Q=void 0}=e,{panActivationKey:J=void 0}=e,{multiSelectionKey:E=void 0}=e,{zoomActivationKey:Y=void 0}=e,{nodesDraggable:D=void 0}=e,{nodesConnectable:W=void 0}=e,{nodeDragThreshold:F=void 0}=e,{elementsSelectable:G=void 0}=e,{snapGrid:K=void 0}=e,{deleteKey:j=void 0}=e,{connectionRadius:re=void 0}=e,{connectionLineType:ue=void 0}=e,{connectionMode:X=tr.Strict}=e,{connectionLineStyle:me=""}=e,{connectionLineContainerStyle:ne=""}=e,{onMoveStart:q=void 0}=e,{onMove:he=void 0}=e,{onMoveEnd:Z=void 0}=e,{isValidConnection:x=void 0}=e,{translateExtent:_e=void 0}=e,{nodeExtent:Pe=void 0}=e,{onlyRenderVisibleElements:De=void 0}=e,{panOnScrollMode:ge=po.Free}=e,{preventScrolling:ct=!0}=e,{zoomOnScroll:at=!0}=e,{zoomOnDoubleClick:kt=!0}=e,{zoomOnPinch:_t=!0}=e,{panOnScroll:Dt=!1}=e,{panOnDrag:Ot=!0}=e,{selectionOnDrag:fn=void 0}=e,{autoPanOnConnect:en=!0}=e,{autoPanOnNodeDrag:tn=!0}=e,{onerror:nn=void 0}=e,{ondelete:ve=void 0}=e,{onedgecreate:sn=void 0}=e,{attributionPosition:Vt=void 0}=e,{proOptions:Jt=void 0}=e,{defaultEdgeOptions:le=void 0}=e,{width:Xe=void 0}=e,{height:vt=void 0}=e,{colorMode:fe="light"}=e,{onconnect:qe=void 0}=e,{onconnectstart:Ke=void 0}=e,{onconnectend:nt=void 0}=e,{onbeforedelete:wt=void 0}=e,{oninit:pt=void 0}=e,{nodeOrigin:Mt=void 0}=e,{paneClickDistance:Kt=0}=e,{nodeClickDistance:an=0}=e,{defaultMarkerColor:jt="#b1b1b7"}=e,{style:ln=void 0}=e,{class:vn=void 0}=e,At,hn,kn;const Sn=a||k,Lt=cm(Ws)?$t():Yk({nodes:ye(m),edges:ye(v),width:Xe,height:vt,fitView:y,nodeOrigin:Mt,nodeExtent:Pe});Qn(()=>(Lt.width.set(hn),Lt.height.set(kn),Lt.domNode.set(At),Lt.syncNodeStores(m),Lt.syncEdgeStores(v),Lt.syncViewport(N),y!==void 0&&Lt.fitViewOnInit.set(y),I&&Lt.fitViewOptions.set(I),Cd(Lt,{nodeTypes:M,edgeTypes:H,minZoom:P,maxZoom:R,translateExtent:_e,paneClickDistance:Kt}),()=>{Lt.reset()}));const{initialized:Ro}=Lt;de(o,Ro,C=>t(74,s=C));let zo=!1;function Or(C){Et.call(this,o,C)}function Nr(C){Et.call(this,o,C)}function Dr(C){Et.call(this,o,C)}function Hr(C){Et.call(this,o,C)}function Ur(C){Et.call(this,o,C)}function Lr(C){Et.call(this,o,C)}function Br(C){Et.call(this,o,C)}function zr(C){Et.call(this,o,C)}function Fr(C){Et.call(this,o,C)}function Vr(C){Et.call(this,o,C)}function Kr(C){Et.call(this,o,C)}function Gr(C){Et.call(this,o,C)}function Wr(C){Et.call(this,o,C)}function Yr(C){Et.call(this,o,C)}function qr(C){Et.call(this,o,C)}function jr(C){Et.call(this,o,C)}function Qr(C){Et.call(this,o,C)}function Xr(C){Et.call(this,o,C)}function Jr(C){Et.call(this,o,C)}function Zr(C){Et.call(this,o,C)}function xr(C){Et.call(this,o,C)}function $r(C){ze[C?"unshift":"push"](()=>{At=C,t(28,At)})}function ei(){hn=this.clientWidth,kn=this.clientHeight,t(26,hn),t(27,kn)}return o.$$set=C=>{e=Rt(Rt({},e),so(C)),t(33,i=xt(e,r)),"id"in C&&t(35,w=C.id),"nodes"in C&&t(36,m=C.nodes),"edges"in C&&t(37,v=C.edges),"fitView"in C&&t(38,y=C.fitView),"fitViewOptions"in C&&t(39,I=C.fitViewOptions),"minZoom"in C&&t(40,P=C.minZoom),"maxZoom"in C&&t(41,R=C.maxZoom),"initialViewport"in C&&t(42,k=C.initialViewport),"viewport"in C&&c(t(0,N=C.viewport)),"nodeTypes"in C&&t(43,M=C.nodeTypes),"edgeTypes"in C&&t(44,H=C.edgeTypes),"selectionKey"in C&&t(1,V=C.selectionKey),"selectionMode"in C&&t(45,Q=C.selectionMode),"panActivationKey"in C&&t(2,J=C.panActivationKey),"multiSelectionKey"in C&&t(3,E=C.multiSelectionKey),"zoomActivationKey"in C&&t(4,Y=C.zoomActivationKey),"nodesDraggable"in C&&t(46,D=C.nodesDraggable),"nodesConnectable"in C&&t(47,W=C.nodesConnectable),"nodeDragThreshold"in C&&t(48,F=C.nodeDragThreshold),"elementsSelectable"in C&&t(49,G=C.elementsSelectable),"snapGrid"in C&&t(50,K=C.snapGrid),"deleteKey"in C&&t(5,j=C.deleteKey),"connectionRadius"in C&&t(51,re=C.connectionRadius),"connectionLineType"in C&&t(52,ue=C.connectionLineType),"connectionMode"in C&&t(53,X=C.connectionMode),"connectionLineStyle"in C&&t(6,me=C.connectionLineStyle),"connectionLineContainerStyle"in C&&t(7,ne=C.connectionLineContainerStyle),"onMoveStart"in C&&t(8,q=C.onMoveStart),"onMove"in C&&t(9,he=C.onMove),"onMoveEnd"in C&&t(10,Z=C.onMoveEnd),"isValidConnection"in C&&t(54,x=C.isValidConnection),"translateExtent"in C&&t(55,_e=C.translateExtent),"nodeExtent"in C&&t(56,Pe=C.nodeExtent),"onlyRenderVisibleElements"in C&&t(57,De=C.onlyRenderVisibleElements),"panOnScrollMode"in C&&t(11,ge=C.panOnScrollMode),"preventScrolling"in C&&t(12,ct=C.preventScrolling),"zoomOnScroll"in C&&t(13,at=C.zoomOnScroll),"zoomOnDoubleClick"in C&&t(14,kt=C.zoomOnDoubleClick),"zoomOnPinch"in C&&t(15,_t=C.zoomOnPinch),"panOnScroll"in C&&t(16,Dt=C.panOnScroll),"panOnDrag"in C&&t(17,Ot=C.panOnDrag),"selectionOnDrag"in C&&t(18,fn=C.selectionOnDrag),"autoPanOnConnect"in C&&t(58,en=C.autoPanOnConnect),"autoPanOnNodeDrag"in C&&t(59,tn=C.autoPanOnNodeDrag),"onerror"in C&&t(60,nn=C.onerror),"ondelete"in C&&t(61,ve=C.ondelete),"onedgecreate"in C&&t(62,sn=C.onedgecreate),"attributionPosition"in C&&t(19,Vt=C.attributionPosition),"proOptions"in C&&t(20,Jt=C.proOptions),"defaultEdgeOptions"in C&&t(21,le=C.defaultEdgeOptions),"width"in C&&t(63,Xe=C.width),"height"in C&&t(64,vt=C.height),"colorMode"in C&&t(65,fe=C.colorMode),"onconnect"in C&&t(66,qe=C.onconnect),"onconnectstart"in C&&t(67,Ke=C.onconnectstart),"onconnectend"in C&&t(68,nt=C.onconnectend),"onbeforedelete"in C&&t(69,wt=C.onbeforedelete),"oninit"in C&&t(70,pt=C.oninit),"nodeOrigin"in C&&t(71,Mt=C.nodeOrigin),"paneClickDistance"in C&&t(22,Kt=C.paneClickDistance),"nodeClickDistance"in C&&t(23,an=C.nodeClickDistance),"defaultMarkerColor"in C&&t(72,jt=C.defaultMarkerColor),"style"in C&&t(24,ln=C.style),"class"in C&&t(25,vn=C.class),"$$scope"in C&&t(99,p=C.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&201326592&&hn!==void 0&&kn!==void 0&&(Lt.width.set(hn),Lt.height.set(kn)),o.$$.dirty[2]&6400&&!zo&&s&&(pt==null||pt(),t(73,zo=!0)),o.$$.dirty[1]&2097135632|o.$$.dirty[2]&1777&&ZC(Lt,{flowId:w,connectionLineType:ue,connectionRadius:re,selectionMode:Q,snapGrid:K,defaultMarkerColor:jt,nodesDraggable:D,nodesConnectable:W,elementsSelectable:G,onlyRenderVisibleElements:De,isValidConnection:x,autoPanOnConnect:en,autoPanOnNodeDrag:tn,onerror:nn,ondelete:ve,onedgecreate:sn,connectionMode:X,nodeDragThreshold:F,onconnect:qe,onconnectstart:Ke,onconnectend:nt,onbeforedelete:wt,nodeOrigin:Mt}),o.$$.dirty[0]&4194304|o.$$.dirty[1]&16791040&&Cd(Lt,{nodeTypes:M,edgeTypes:H,minZoom:P,maxZoom:R,translateExtent:_e,paneClickDistance:Kt}),o.$$.dirty[2]&8&&f(t(29,n=$C(fe)))},[N,V,J,E,Y,j,me,ne,q,he,Z,ge,ct,at,kt,_t,Dt,Ot,fn,Vt,Jt,le,Kt,an,ln,vn,hn,kn,At,n,u,Sn,Ro,i,b,w,m,v,y,I,P,R,k,M,H,Q,D,W,F,G,K,re,ue,X,x,_e,Pe,De,en,tn,nn,ve,sn,Xe,vt,fe,qe,Ke,nt,wt,pt,Mt,jt,zo,s,h,Or,Nr,Dr,Hr,Ur,Lr,Br,zr,Fr,Vr,Kr,Gr,Wr,Yr,qr,jr,Qr,Xr,Jr,Zr,xr,$r,ei,p]}class aE extends We{constructor(e){super(),Ye(this,e,sE,iE,Qe,{id:35,nodes:36,edges:37,fitView:38,fitViewOptions:39,minZoom:40,maxZoom:41,initialViewport:42,viewport:0,nodeTypes:43,edgeTypes:44,selectionKey:1,selectionMode:45,panActivationKey:2,multiSelectionKey:3,zoomActivationKey:4,nodesDraggable:46,nodesConnectable:47,nodeDragThreshold:48,elementsSelectable:49,snapGrid:50,deleteKey:5,connectionRadius:51,connectionLineType:52,connectionMode:53,connectionLineStyle:6,connectionLineContainerStyle:7,onMoveStart:8,onMove:9,onMoveEnd:10,isValidConnection:54,translateExtent:55,nodeExtent:56,onlyRenderVisibleElements:57,panOnScrollMode:11,preventScrolling:12,zoomOnScroll:13,zoomOnDoubleClick:14,zoomOnPinch:15,panOnScroll:16,panOnDrag:17,selectionOnDrag:18,autoPanOnConnect:58,autoPanOnNodeDrag:59,onerror:60,ondelete:61,onedgecreate:62,attributionPosition:19,proOptions:20,defaultEdgeOptions:21,width:63,height:64,colorMode:65,onconnect:66,onconnectstart:67,onconnectend:68,onbeforedelete:69,oninit:70,nodeOrigin:71,paneClickDistance:22,nodeClickDistance:23,defaultMarkerColor:72,style:24,class:25},null,[-1,-1,-1,-1])}}function lE(o){let e;const t=o[7].default,n=pn(t,o,o[6],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,[i]){n&&n.p&&(!e||i&64)&&_n(n,t,r,r[6],e?yn(t,r[6],i,null):bn(r[6]),null)},i(r){e||(T(n,r),e=!0)},o(r){O(n,r),e=!1},d(r){n&&n.d(r)}}}function cE(o,e,t){let{$$slots:n={},$$scope:r}=e,{initialNodes:i=void 0}=e,{initialEdges:s=void 0}=e,{initialWidth:a=void 0}=e,{initialHeight:l=void 0}=e,{fitView:c=void 0}=e,{nodeOrigin:u=void 0}=e;const d=Xg({nodes:i,edges:s,width:a,height:l,nodeOrigin:u,fitView:c});return hi(Ws,{getStore:()=>d}),Bo(()=>{d.reset()}),o.$$set=f=>{"initialNodes"in f&&t(0,i=f.initialNodes),"initialEdges"in f&&t(1,s=f.initialEdges),"initialWidth"in f&&t(2,a=f.initialWidth),"initialHeight"in f&&t(3,l=f.initialHeight),"fitView"in f&&t(4,c=f.fitView),"nodeOrigin"in f&&t(5,u=f.nodeOrigin),"$$scope"in f&&t(6,r=f.$$scope)},[i,s,a,l,c,u,r,n]}class uE extends We{constructor(e){super(),Ye(this,e,cE,lE,Qe,{initialNodes:0,initialEdges:1,initialWidth:2,initialHeight:3,fitView:4,nodeOrigin:5})}}const dE=o=>({}),Id=o=>({class:"button-svg"});function fE(o){let e,t,n,r,i;const s=o[8].default,a=pn(s,o,o[7],Id);let l=[{type:"button"},{class:t=qt(["svelte-flow__controls-button",o[0]])},o[6]],c={};for(let u=0;u<l.length;u+=1)c=Rt(c,l[u]);return{c(){e=U("button"),a&&a.c(),this.h()},l(u){e=L(u,"BUTTON",{type:!0,class:!0});var d=A(e);a&&a.l(d),d.forEach(_),this.h()},h(){_r(e,c),tt(e,"--xy-controls-button-background-color-props",o[1]),tt(e,"--xy-controls-button-background-color-hover-props",o[2]),tt(e,"--xy-controls-button-color-props",o[3]),tt(e,"--xy-controls-button-color-hover-props",o[4]),tt(e,"--xy-controls-button-border-color-props",o[5])},m(u,d){z(u,e,d),a&&a.m(e,null),e.autofocus&&e.focus(),n=!0,r||(i=Ae(e,"click",o[9]),r=!0)},p(u,[d]){a&&a.p&&(!n||d&128)&&_n(a,s,u,u[7],n?yn(s,u[7],d,dE):bn(u[7]),Id),_r(e,c=Ho(l,[{type:"button"},(!n||d&1&&t!==(t=qt(["svelte-flow__controls-button",u[0]])))&&{class:t},d&64&&u[6]])),tt(e,"--xy-controls-button-background-color-props",u[1]),tt(e,"--xy-controls-button-background-color-hover-props",u[2]),tt(e,"--xy-controls-button-color-props",u[3]),tt(e,"--xy-controls-button-color-hover-props",u[4]),tt(e,"--xy-controls-button-border-color-props",u[5])},i(u){n||(T(a,u),n=!0)},o(u){O(a,u),n=!1},d(u){u&&_(e),a&&a.d(u),r=!1,i()}}}function hE(o,e,t){const n=["class"];let r=xt(e,n),{$$slots:i={},$$scope:s}=e,{class:a=void 0}=e,l,c,u,d,f;function h(p){Et.call(this,o,p)}return o.$$set=p=>{e=Rt(Rt({},e),so(p)),t(6,r=xt(e,n)),"class"in p&&t(0,a=p.class),"$$scope"in p&&t(7,s=p.$$scope)},[a,l,c,u,d,f,r,s,i,h]}class ys extends We{constructor(e){super(),Ye(this,e,hE,fE,Qe,{class:0})}}function gE(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Ee(r,"path",{d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"d","M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 32")},m(n,r){z(n,e,r),S(e,t)},p:Ue,i:Ue,o:Ue,d(n){n&&_(e)}}}class mE extends We{constructor(e){super(),Ye(this,e,null,gE,Qe,{})}}function pE(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Ee(r,"path",{d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"d","M0 0h32v4.2H0z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 5")},m(n,r){z(n,e,r),S(e,t)},p:Ue,i:Ue,o:Ue,d(n){n&&_(e)}}}class _E extends We{constructor(e){super(),Ye(this,e,null,pE,Qe,{})}}function bE(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Ee(r,"path",{d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"d","M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 30")},m(n,r){z(n,e,r),S(e,t)},p:Ue,i:Ue,o:Ue,d(n){n&&_(e)}}}class yE extends We{constructor(e){super(),Ye(this,e,null,bE,Qe,{})}}function wE(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Ee(r,"path",{d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"d","M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 25 32")},m(n,r){z(n,e,r),S(e,t)},p:Ue,i:Ue,o:Ue,d(n){n&&_(e)}}}class vE extends We{constructor(e){super(),Ye(this,e,null,wE,Qe,{})}}function kE(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,viewBox:!0});var r=A(e);t=Ee(r,"path",{d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"d","M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 25 32")},m(n,r){z(n,e,r),S(e,t)},p:Ue,i:Ue,o:Ue,d(n){n&&_(e)}}}class CE extends We{constructor(e){super(),Ye(this,e,null,kE,Qe,{})}}const EE=o=>({}),Td=o=>({}),IE=o=>({}),Sd=o=>({});function Ad(o){let e,t,n,r;const i=[{class:"svelte-flow__controls-zoomin"},{title:"zoom in"},{"aria-label":"zoom in"},{disabled:o[9]},o[17]];let s={$$slots:{default:[TE]},$$scope:{ctx:o}};for(let c=0;c<i.length;c+=1)s=Rt(s,i[c]);e=new ys({props:s}),e.$on("click",o[18]);const a=[{class:"svelte-flow__controls-zoomout"},{title:"zoom out"},{"aria-label":"zoom out"},{disabled:o[10]},o[17]];let l={$$slots:{default:[SE]},$$scope:{ctx:o}};for(let c=0;c<a.length;c+=1)l=Rt(l,a[c]);return n=new ys({props:l}),n.$on("click",o[19]),{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment)},l(c){oe(e.$$.fragment,c),t=se(c),oe(n.$$.fragment,c)},m(c,u){ee(e,c,u),z(c,t,u),ee(n,c,u),r=!0},p(c,u){const d=u[0]&131584?Ho(i,[i[0],i[1],i[2],u[0]&512&&{disabled:c[9]},u[0]&131072&&pi(c[17])]):{};u[1]&32&&(d.$$scope={dirty:u,ctx:c}),e.$set(d);const f=u[0]&132096?Ho(a,[a[0],a[1],a[2],u[0]&1024&&{disabled:c[10]},u[0]&131072&&pi(c[17])]):{};u[1]&32&&(f.$$scope={dirty:u,ctx:c}),n.$set(f)},i(c){r||(T(e.$$.fragment,c),T(n.$$.fragment,c),r=!0)},o(c){O(e.$$.fragment,c),O(n.$$.fragment,c),r=!1},d(c){c&&_(t),te(e,c),te(n,c)}}}function TE(o){let e,t;return e=new mE({}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function SE(o){let e,t;return e=new _E({}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Rd(o){let e,t;const n=[{class:"svelte-flow__controls-fitview"},{title:"fit view"},{"aria-label":"fit view"},o[17]];let r={$$slots:{default:[AE]},$$scope:{ctx:o}};for(let i=0;i<n.length;i+=1)r=Rt(r,n[i]);return e=new ys({props:r}),e.$on("click",o[20]),{c(){$(e.$$.fragment)},l(i){oe(e.$$.fragment,i)},m(i,s){ee(e,i,s),t=!0},p(i,s){const a=s[0]&131072?Ho(n,[n[0],n[1],n[2],pi(i[17])]):{};s[1]&32&&(a.$$scope={dirty:s,ctx:i}),e.$set(a)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){te(e,i)}}}function AE(o){let e,t;return e=new yE({}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Md(o){let e,t;const n=[{class:"svelte-flow__controls-interactive"},{title:"toggle interactivity"},{"aria-label":"toggle interactivity"},o[17]];let r={$$slots:{default:[PE]},$$scope:{ctx:o}};for(let i=0;i<n.length;i+=1)r=Rt(r,n[i]);return e=new ys({props:r}),e.$on("click",o[21]),{c(){$(e.$$.fragment)},l(i){oe(e.$$.fragment,i)},m(i,s){ee(e,i,s),t=!0},p(i,s){const a=s[0]&131072?Ho(n,[n[0],n[1],n[2],pi(i[17])]):{};s[0]&256|s[1]&32&&(a.$$scope={dirty:s,ctx:i}),e.$set(a)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){te(e,i)}}}function RE(o){let e,t;return e=new vE({}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function ME(o){let e,t;return e=new CE({}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function PE(o){let e,t,n,r;const i=[ME,RE],s=[];function a(l,c){return l[8]?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=Ve()},l(l){t.l(l),n=Ve()},m(l,c){s[e].m(l,c),z(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e!==u&&(Re(),O(s[u],1,1,()=>{s[u]=null}),Me(),t=s[e],t||(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){O(t),r=!1},d(l){l&&_(n),s[e].d(l)}}}function OE(o){let e,t,n,r,i,s;const a=o[35].before,l=pn(a,o,o[36],Sd);let c=o[1]&&Ad(o),u=o[2]&&Rd(o),d=o[3]&&Md(o);const f=o[35].default,h=pn(f,o,o[36],null),p=o[35].after,b=pn(p,o,o[36],Td);return{c(){l&&l.c(),e=ie(),c&&c.c(),t=ie(),u&&u.c(),n=ie(),d&&d.c(),r=ie(),h&&h.c(),i=ie(),b&&b.c()},l(w){l&&l.l(w),e=se(w),c&&c.l(w),t=se(w),u&&u.l(w),n=se(w),d&&d.l(w),r=se(w),h&&h.l(w),i=se(w),b&&b.l(w)},m(w,m){l&&l.m(w,m),z(w,e,m),c&&c.m(w,m),z(w,t,m),u&&u.m(w,m),z(w,n,m),d&&d.m(w,m),z(w,r,m),h&&h.m(w,m),z(w,i,m),b&&b.m(w,m),s=!0},p(w,m){l&&l.p&&(!s||m[1]&32)&&_n(l,a,w,w[36],s?yn(a,w[36],m,IE):bn(w[36]),Sd),w[1]?c?(c.p(w,m),m[0]&2&&T(c,1)):(c=Ad(w),c.c(),T(c,1),c.m(t.parentNode,t)):c&&(Re(),O(c,1,1,()=>{c=null}),Me()),w[2]?u?(u.p(w,m),m[0]&4&&T(u,1)):(u=Rd(w),u.c(),T(u,1),u.m(n.parentNode,n)):u&&(Re(),O(u,1,1,()=>{u=null}),Me()),w[3]?d?(d.p(w,m),m[0]&8&&T(d,1)):(d=Md(w),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(Re(),O(d,1,1,()=>{d=null}),Me()),h&&h.p&&(!s||m[1]&32)&&_n(h,f,w,w[36],s?yn(f,w[36],m,null):bn(w[36]),null),b&&b.p&&(!s||m[1]&32)&&_n(b,p,w,w[36],s?yn(p,w[36],m,EE):bn(w[36]),Td)},i(w){s||(T(l,w),T(c),T(u),T(d),T(h,w),T(b,w),s=!0)},o(w){O(l,w),O(c),O(u),O(d),O(h,w),O(b,w),s=!1},d(w){w&&(_(e),_(t),_(n),_(r),_(i)),l&&l.d(w),c&&c.d(w),u&&u.d(w),d&&d.d(w),h&&h.d(w),b&&b.d(w)}}}function NE(o){let e,t;return e=new $g({props:{class:qt(["svelte-flow__controls",o[7],o[6]]),position:o[0],"data-testid":"svelte-flow__controls","aria-label":o[4]??"Svelte Flow controls",style:o[5],$$slots:{default:[OE]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&192&&(i.class=qt(["svelte-flow__controls",n[7],n[6]])),r[0]&1&&(i.position=n[0]),r[0]&16&&(i["aria-label"]=n[4]??"Svelte Flow controls"),r[0]&32&&(i.style=n[5]),r[0]&1806|r[1]&32&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function DE(o,e,t){let n,r,i,s,a,l,c,u,d,f,{$$slots:h={},$$scope:p}=e,{position:b="bottom-left"}=e,{showZoom:w=!0}=e,{showFitView:m=!0}=e,{showLock:v=!0}=e,{buttonBgColor:y=void 0}=e,{buttonBgColorHover:I=void 0}=e,{buttonColor:P=void 0}=e,{buttonColorHover:R=void 0}=e,{buttonBorderColor:k=void 0}=e,{ariaLabel:N=void 0}=e,{style:M=void 0}=e,{orientation:H="vertical"}=e,{fitViewOptions:V=void 0}=e,{class:Q=""}=e;const{zoomIn:J,zoomOut:E,fitView:Y,viewport:D,minZoom:W,maxZoom:F,nodesDraggable:G,nodesConnectable:K,elementsSelectable:j}=$t();de(o,D,q=>t(30,l=q)),de(o,W,q=>t(31,c=q)),de(o,F,q=>t(29,a=q)),de(o,G,q=>t(34,f=q)),de(o,K,q=>t(33,d=q)),de(o,j,q=>t(32,u=q));const re={bgColor:y,bgColorHover:I,color:P,colorHover:R,borderColor:k},ue=()=>{J()},X=()=>{E()},me=()=>{Y(V)},ne=()=>{t(8,n=!n),G.set(n),K.set(n),j.set(n)};return o.$$set=q=>{"position"in q&&t(0,b=q.position),"showZoom"in q&&t(1,w=q.showZoom),"showFitView"in q&&t(2,m=q.showFitView),"showLock"in q&&t(3,v=q.showLock),"buttonBgColor"in q&&t(22,y=q.buttonBgColor),"buttonBgColorHover"in q&&t(23,I=q.buttonBgColorHover),"buttonColor"in q&&t(24,P=q.buttonColor),"buttonColorHover"in q&&t(25,R=q.buttonColorHover),"buttonBorderColor"in q&&t(26,k=q.buttonBorderColor),"ariaLabel"in q&&t(4,N=q.ariaLabel),"style"in q&&t(5,M=q.style),"orientation"in q&&t(27,H=q.orientation),"fitViewOptions"in q&&t(28,V=q.fitViewOptions),"class"in q&&t(6,Q=q.class),"$$scope"in q&&t(36,p=q.$$scope)},o.$$.update=()=>{o.$$.dirty[1]&14&&t(8,n=f||d||u),o.$$.dirty[0]&1073741824|o.$$.dirty[1]&1&&t(10,r=l.zoom<=c),o.$$.dirty[0]&1610612736&&t(9,i=l.zoom>=a),o.$$.dirty[0]&134217728&&t(7,s=H==="horizontal"?"horizontal":"vertical")},[b,w,m,v,N,M,Q,s,n,i,r,D,W,F,G,K,j,re,ue,X,me,ne,y,I,P,R,k,H,V,a,l,c,u,d,f,h,p]}let HE=class extends We{constructor(e){super(),Ye(this,e,DE,NE,Qe,{position:0,showZoom:1,showFitView:2,showLock:3,buttonBgColor:22,buttonBgColorHover:23,buttonColor:24,buttonColorHover:25,buttonBorderColor:26,ariaLabel:4,style:5,orientation:27,fitViewOptions:28,class:6},null,[-1,-1])}};var So;(function(o){o.Lines="lines",o.Dots="dots",o.Cross="cross"})(So||(So={}));function UE(o){let e,t;return{c(){e=Ce("circle"),this.h()},l(n){e=Ee(n,"circle",{cx:!0,cy:!0,r:!0,class:!0}),A(e).forEach(_),this.h()},h(){g(e,"cx",o[0]),g(e,"cy",o[0]),g(e,"r",o[0]),g(e,"class",t=qt(["svelte-flow__background-pattern","dots",o[1]]))},m(n,r){z(n,e,r)},p(n,[r]){r&1&&g(e,"cx",n[0]),r&1&&g(e,"cy",n[0]),r&1&&g(e,"r",n[0]),r&2&&t!==(t=qt(["svelte-flow__background-pattern","dots",n[1]]))&&g(e,"class",t)},i:Ue,o:Ue,d(n){n&&_(e)}}}function LE(o,e,t){let{radius:n=5}=e,{class:r=""}=e;return o.$$set=i=>{"radius"in i&&t(0,n=i.radius),"class"in i&&t(1,r=i.class)},[n,r]}class BE extends We{constructor(e){super(),Ye(this,e,LE,UE,Qe,{radius:0,class:1})}}function zE(o){let e,t,n;return{c(){e=Ce("path"),this.h()},l(r){e=Ee(r,"path",{"stroke-width":!0,d:!0,class:!0}),A(e).forEach(_),this.h()},h(){g(e,"stroke-width",o[0]),g(e,"d",t=`M${o[1][0]/2} 0 V${o[1][1]} M0 ${o[1][1]/2} H${o[1][0]}`),g(e,"class",n=qt(["svelte-flow__background-pattern",o[2],o[3]]))},m(r,i){z(r,e,i)},p(r,[i]){i&1&&g(e,"stroke-width",r[0]),i&2&&t!==(t=`M${r[1][0]/2} 0 V${r[1][1]} M0 ${r[1][1]/2} H${r[1][0]}`)&&g(e,"d",t),i&12&&n!==(n=qt(["svelte-flow__background-pattern",r[2],r[3]]))&&g(e,"class",n)},i:Ue,o:Ue,d(r){r&&_(e)}}}function FE(o,e,t){let{lineWidth:n=1}=e,{dimensions:r}=e,{variant:i=void 0}=e,{class:s=""}=e;return o.$$set=a=>{"lineWidth"in a&&t(0,n=a.lineWidth),"dimensions"in a&&t(1,r=a.dimensions),"variant"in a&&t(2,i=a.variant),"class"in a&&t(3,s=a.class)},[n,r,i,s]}class VE extends We{constructor(e){super(),Ye(this,e,FE,zE,Qe,{lineWidth:0,dimensions:1,variant:2,class:3})}}function KE(o){let e,t;return e=new VE({props:{dimensions:o[6],variant:o[0],lineWidth:o[1],class:o[4]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&64&&(i.dimensions=n[6]),r&1&&(i.variant=n[0]),r&2&&(i.lineWidth=n[1]),r&16&&(i.class=n[4]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function GE(o){let e,t;return e=new BE({props:{radius:o[7]/2,class:o[4]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&128&&(i.radius=n[7]/2),r&16&&(i.class=n[4]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function WE(o){let e,t,n,r,i,s,a,l,c,u,d,f,h;const p=[GE,KE],b=[];function w(m,v){return m[14]?0:1}return n=w(o),r=b[n]=p[n](o),{c(){e=Ce("svg"),t=Ce("pattern"),r.c(),u=Ce("rect"),this.h()},l(m){e=Ee(m,"svg",{class:!0,"data-testid":!0});var v=A(e);t=Ee(v,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0,patternTransform:!0});var y=A(t);r.l(y),y.forEach(_),u=Ee(v,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0}),A(u).forEach(_),v.forEach(_),this.h()},h(){g(t,"id",o[11]),g(t,"x",i=o[9].x%o[8][0]),g(t,"y",s=o[9].y%o[8][1]),g(t,"width",a=o[8][0]),g(t,"height",l=o[8][1]),g(t,"patternUnits","userSpaceOnUse"),g(t,"patternTransform",c=`translate(-${o[10][0]},-${o[10][1]})`),g(u,"x","0"),g(u,"y","0"),g(u,"width","100%"),g(u,"height","100%"),g(u,"fill",d=`url(#${o[11]})`),g(e,"class",f=Fl(qt(["svelte-flow__background",o[5]]))+" svelte-1r7pe8d"),g(e,"data-testid","svelte-flow__background"),tt(e,"--xy-background-color-props",o[2]),tt(e,"--xy-background-pattern-color-props",o[3])},m(m,v){z(m,e,v),S(e,t),b[n].m(t,null),S(e,u),h=!0},p(m,[v]){r.p(m,v),(!h||v&2048)&&g(t,"id",m[11]),(!h||v&768&&i!==(i=m[9].x%m[8][0]))&&g(t,"x",i),(!h||v&768&&s!==(s=m[9].y%m[8][1]))&&g(t,"y",s),(!h||v&256&&a!==(a=m[8][0]))&&g(t,"width",a),(!h||v&256&&l!==(l=m[8][1]))&&g(t,"height",l),(!h||v&1024&&c!==(c=`translate(-${m[10][0]},-${m[10][1]})`))&&g(t,"patternTransform",c),(!h||v&2048&&d!==(d=`url(#${m[11]})`))&&g(u,"fill",d),(!h||v&32&&f!==(f=Fl(qt(["svelte-flow__background",m[5]]))+" svelte-1r7pe8d"))&&g(e,"class",f),v&4&&tt(e,"--xy-background-color-props",m[2]),v&8&&tt(e,"--xy-background-pattern-color-props",m[3])},i(m){h||(T(r),h=!0)},o(m){O(r),h=!1},d(m){m&&_(e),b[n].d()}}}const YE={[So.Dots]:1,[So.Lines]:1,[So.Cross]:6};function qE(o,e,t){let n,r,i,s,a,l,c,{id:u=void 0}=e,{variant:d=So.Dots}=e,{gap:f=20}=e,{size:h=1}=e,{lineWidth:p=1}=e,{bgColor:b=void 0}=e,{patternColor:w=void 0}=e,{patternClass:m=void 0}=e,{class:v=""}=e;const{viewport:y,flowId:I}=$t();de(o,y,M=>t(9,l=M)),de(o,I,M=>t(18,c=M));const P=h||YE[d],R=d===So.Dots,k=d===So.Cross,N=Array.isArray(f)?f:[f,f];return o.$$set=M=>{"id"in M&&t(15,u=M.id),"variant"in M&&t(0,d=M.variant),"gap"in M&&t(16,f=M.gap),"size"in M&&t(17,h=M.size),"lineWidth"in M&&t(1,p=M.lineWidth),"bgColor"in M&&t(2,b=M.bgColor),"patternColor"in M&&t(3,w=M.patternColor),"patternClass"in M&&t(4,m=M.patternClass),"class"in M&&t(5,v=M.class)},o.$$.update=()=>{o.$$.dirty&294912&&t(11,n=`background-pattern-${c}-${u||""}`),o.$$.dirty&512&&t(8,r=[N[0]*l.zoom||1,N[1]*l.zoom||1]),o.$$.dirty&512&&t(7,i=P*l.zoom),o.$$.dirty&384&&t(6,s=k?[i,i]:r),o.$$.dirty&192&&t(10,a=R?[i/2,i/2]:[s[0]/2,s[1]/2])},[d,p,b,w,m,v,s,i,r,l,a,n,y,I,R,u,f,h,c]}class jE extends We{constructor(e){super(),Ye(this,e,qE,WE,Qe,{id:15,variant:0,gap:16,size:17,lineWidth:1,bgColor:2,patternColor:3,patternClass:4,class:5})}}const Pd=o=>hv(o);function QE(){const{zoomIn:o,zoomOut:e,fitView:t,onbeforedelete:n,snapGrid:r,viewport:i,width:s,height:a,minZoom:l,maxZoom:c,panZoom:u,nodes:d,edges:f,domNode:h,nodeLookup:p,nodeOrigin:b,edgeLookup:w,connectionLookup:m}=$t(),v=P=>{var H,V;const R=ye(p),k=Pd(P)?P:R.get(P.id),N=k.parentId?bv(k.position,k.measured,k.parentId,R,ye(b)):k.position,M={id:k.id,position:N,width:((H=k.measured)==null?void 0:H.width)??k.width,height:((V=k.measured)==null?void 0:V.height)??k.height,data:k.data};return Er(M)},y=(P,R,k={replace:!1})=>{var H;const N=(H=ye(p).get(P))==null?void 0:H.internals.userNode;if(!N)return;const M=typeof R=="function"?R(N):R;k.replace?d.update(V=>V.map(Q=>Q.id===P?Pd(M)?M:{...Q,...M}:Q)):(Object.assign(N,M),d.update(V=>V))},I=P=>ye(p).get(P);return{zoomIn:o,zoomOut:e,getInternalNode:I,getNode:P=>{var R;return(R=I(P))==null?void 0:R.internals.userNode},getNodes:P=>P===void 0?ye(d):Od(ye(p),P),getEdge:P=>ye(w).get(P),getEdges:P=>P===void 0?ye(f):Od(ye(w),P),setZoom:(P,R)=>{const k=ye(u);return k?k.scaleTo(P,{duration:R==null?void 0:R.duration}):Promise.resolve(!1)},getZoom:()=>ye(i).zoom,setViewport:async(P,R)=>{const k=ye(i),N=ye(u);return N?(await N.setViewport({x:P.x??k.x,y:P.y??k.y,zoom:P.zoom??k.zoom},{duration:R==null?void 0:R.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>ye(i),setCenter:async(P,R,k)=>{const N=typeof(k==null?void 0:k.zoom)<"u"?k.zoom:ye(c),M=ye(u);return M?(await M.setViewport({x:ye(s)/2-P*N,y:ye(a)/2-R*N,zoom:N},{duration:k==null?void 0:k.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitView:t,fitBounds:async(P,R)=>{const k=ye(u);if(!k)return Promise.resolve(!1);const N=Ol(P,ye(s),ye(a),ye(l),ye(c),(R==null?void 0:R.padding)??.1);return await k.setViewport(N,{duration:R==null?void 0:R.duration}),Promise.resolve(!0)},getIntersectingNodes:(P,R=!0,k)=>{const N=Qu(P),M=N?P:v(P);return M?(k||ye(d)).filter(H=>{const V=ye(p).get(H.id);if(!V||!N&&H.id===P.id)return!1;const Q=Er(V),J=Ci(Q,M);return R&&J>0||J>=M.width*M.height}):[]},isNodeIntersecting:(P,R,k=!0)=>{const M=Qu(P)?P:v(P);if(!M)return!1;const H=Ci(M,R);return k&&H>0||H>=M.width*M.height},deleteElements:async({nodes:P=[],edges:R=[]})=>{const{nodes:k,edges:N}=await kg({nodesToRemove:P,edgesToRemove:R,nodes:ye(d),edges:ye(f),onBeforeDelete:ye(n)});return k&&d.update(M=>M.filter(H=>!k.some(({id:V})=>V===H.id))),N&&f.update(M=>M.filter(H=>!N.some(({id:V})=>V===H.id))),{deletedNodes:k,deletedEdges:N}},screenToFlowPosition:(P,R={snapToGrid:!0})=>{const k=ye(h);if(!k)return P;const N=R.snapToGrid?ye(r):!1,{x:M,y:H,zoom:V}=ye(i),{x:Q,y:J}=k.getBoundingClientRect(),E={x:P.x-Q,y:P.y-J};return Oi(E,[M,H,V],N!==null,N||[1,1])},flowToScreenPosition:P=>{const R=ye(h);if(!R)return P;const{x:k,y:N,zoom:M}=ye(i),{x:H,y:V}=R.getBoundingClientRect(),Q=Ig(P,[k,N,M]);return{x:Q.x+H,y:Q.y+V}},toObject:()=>({nodes:ye(d).map(P=>({...P,position:{...P.position},data:{...P.data}})),edges:ye(f).map(P=>({...P})),viewport:{...ye(i)}}),updateNode:y,updateNodeData:(P,R,k)=>{var H;const N=(H=ye(p).get(P))==null?void 0:H.internals.userNode;if(!N)return;const M=typeof R=="function"?R(N):R;N.data=k!=null&&k.replace?M:{...N.data,...M},d.update(V=>V)},getNodesBounds:P=>{const R=ye(p),k=ye(b);return gv(P,{nodeLookup:R,nodeOrigin:k})},getHandleConnections:({type:P,id:R,nodeId:k})=>{var N;return Array.from(((N=ye(m).get(`${k}-${P}-${R??null}`))==null?void 0:N.values())??[])},viewport:i}}function Od(o,e){var n;const t=[];for(const r of e){const i=o.get(r);if(i){const s="internals"in i?(n=i.internals)==null?void 0:n.userNode:i;t.push(s)}}return t}function XE(){const{nodesInitialized:o}=$t();return{subscribe:o.subscribe}}function Nd(o,e,t){const n=o.slice();return n[25]=e[t],n[27]=t,n}function Dd(o,e,t){const n=o.slice();return n[22]=e[t],n[24]=t,n}function JE(o){let e,t;return e=new Cs({props:{className:"size-4"}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p:Ue,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function ZE(o){let e,t,n,r,i,s,a,l=o[8].t("Tools")+"",c,u,d=o[8].t("Functions")+"",f,h,p,b,w,m,v,y;function I(N,M){if(N[1]==="tools")return $E;if(N[1]==="functions")return xE}let P=I(o),R=P&&P(o),k=o[2]&&Ld(o);return{c(){e=U("form"),t=U("div"),n=U("div"),r=U("div"),i=U("div"),s=U("select"),a=U("option"),c=Oe(l),u=U("option"),f=Oe(d),h=ie(),p=U("div"),b=U("select"),R&&R.c(),w=ie(),k&&k.c(),this.h()},l(N){e=L(N,"FORM",{class:!0});var M=A(e);t=L(M,"DIV",{class:!0});var H=A(t);n=L(H,"DIV",{class:!0});var V=A(n);r=L(V,"DIV",{class:!0});var Q=A(r);i=L(Q,"DIV",{class:!0});var J=A(i);s=L(J,"SELECT",{class:!0,placeholder:!0});var E=A(s);a=L(E,"OPTION",{class:!0});var Y=A(a);c=Ne(Y,l),Y.forEach(_),u=L(E,"OPTION",{class:!0});var D=A(u);f=Ne(D,d),D.forEach(_),E.forEach(_),J.forEach(_),h=se(Q),p=L(Q,"DIV",{class:!0});var W=A(p);b=L(W,"SELECT",{class:!0});var F=A(b);R&&R.l(F),F.forEach(_),W.forEach(_),Q.forEach(_),V.forEach(_),w=se(H),k&&k.l(H),H.forEach(_),M.forEach(_),this.h()},h(){a.__value="tools",Xn(a,a.__value),g(a,"class","bg-gray-100 dark:bg-gray-800"),u.__value="functions",Xn(u,u.__value),g(u,"class","bg-gray-100 dark:bg-gray-800"),g(s,"class","w-full rounded-sm text-xs py-2 px-1 bg-transparent outline-hidden"),g(s,"placeholder","Select"),o[1]===void 0&&Po(()=>o[13].call(s)),g(i,"class","flex-1"),g(b,"class","w-full rounded-sm py-2 px-1 text-xs bg-transparent outline-hidden"),o[2]===void 0&&Po(()=>o[14].call(b)),g(p,"class","flex-1"),g(r,"class","flex gap-2"),g(n,"class","space-y-1"),g(t,"class","flex flex-col"),g(e,"class","flex flex-col h-full justify-between space-y-3 text-sm")},m(N,M){z(N,e,M),S(e,t),S(t,n),S(n,r),S(r,i),S(i,s),S(s,a),S(a,c),S(s,u),S(u,f),Hi(s,o[1],!0),S(r,h),S(r,p),S(p,b),R&&R.m(b,null),Hi(b,o[2],!0),S(t,w),k&&k.m(t,null),m=!0,v||(y=[Ae(s,"change",o[13]),Ae(b,"change",o[14]),Ae(b,"change",o[15]),Ae(e,"submit",Tr(o[18]))],v=!0)},p(N,M){(!m||M&256)&&l!==(l=N[8].t("Tools")+"")&&Be(c,l),(!m||M&256)&&d!==(d=N[8].t("Functions")+"")&&Be(f,d),M&2&&Hi(s,N[1]),P===(P=I(N))&&R?R.p(N,M):(R&&R.d(1),R=P&&P(N),R&&(R.c(),R.m(b,null))),M&196&&Hi(b,N[2]),N[2]?k?(k.p(N,M),M&4&&T(k,1)):(k=Ld(N),k.c(),T(k,1),k.m(t,null)):k&&(Re(),O(k,1,1,()=>{k=null}),Me())},i(N){m||(T(k),m=!0)},o(N){O(k),m=!1},d(N){N&&_(e),R&&R.d(),k&&k.d(),v=!1,wn(y)}}}function xE(o){let e,t=o[8].t("Select a function")+"",n,r,i=yt(o[7]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Hd(Nd(o,i,a));return{c(){e=U("option"),n=Oe(t);for(let a=0;a<s.length;a+=1)s[a].c();r=Ve(),this.h()},l(a){e=L(a,"OPTION",{class:!0});var l=A(e);n=Ne(l,t),l.forEach(_);for(let c=0;c<s.length;c+=1)s[c].l(a);r=Ve(),this.h()},h(){e.__value="",Xn(e,e.__value),e.selected=!0,e.disabled=!0,g(e,"class","bg-gray-100 dark:bg-gray-800")},m(a,l){z(a,e,l),S(e,n);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,l);z(a,r,l)},p(a,l){if(l&256&&t!==(t=a[8].t("Select a function")+"")&&Be(n,t),l&128){i=yt(a[7]);let c;for(c=0;c<i.length;c+=1){const u=Nd(a,i,c);s[c]?s[c].p(u,l):(s[c]=Hd(u),s[c].c(),s[c].m(r.parentNode,r))}for(;c<s.length;c+=1)s[c].d(1);s.length=i.length}},d(a){a&&(_(e),_(r)),Hn(s,a)}}}function $E(o){let e,t=o[8].t("Select a tool")+"",n,r,i=yt(o[6]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Ud(Dd(o,i,a));return{c(){e=U("option"),n=Oe(t);for(let a=0;a<s.length;a+=1)s[a].c();r=Ve(),this.h()},l(a){e=L(a,"OPTION",{class:!0});var l=A(e);n=Ne(l,t),l.forEach(_);for(let c=0;c<s.length;c+=1)s[c].l(a);r=Ve(),this.h()},h(){e.__value="",Xn(e,e.__value),e.selected=!0,e.disabled=!0,g(e,"class","bg-gray-100 dark:bg-gray-800")},m(a,l){z(a,e,l),S(e,n);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,l);z(a,r,l)},p(a,l){if(l&256&&t!==(t=a[8].t("Select a tool")+"")&&Be(n,t),l&64){i=yt(a[6]);let c;for(c=0;c<i.length;c+=1){const u=Dd(a,i,c);s[c]?s[c].p(u,l):(s[c]=Ud(u),s[c].c(),s[c].m(r.parentNode,r))}for(;c<s.length;c+=1)s[c].d(1);s.length=i.length}},d(a){a&&(_(e),_(r)),Hn(s,a)}}}function Hd(o){let e,t=o[25].name+"",n,r;return{c(){e=U("option"),n=Oe(t),this.h()},l(i){e=L(i,"OPTION",{class:!0});var s=A(e);n=Ne(s,t),s.forEach(_),this.h()},h(){e.__value=r=o[25].id,Xn(e,e.__value),g(e,"class","bg-gray-100 dark:bg-gray-800")},m(i,s){z(i,e,s),S(e,n)},p(i,s){s&128&&t!==(t=i[25].name+"")&&Be(n,t),s&128&&r!==(r=i[25].id)&&(e.__value=r,Xn(e,e.__value))},d(i){i&&_(e)}}}function Ud(o){let e,t=o[22].name+"",n,r;return{c(){e=U("option"),n=Oe(t),this.h()},l(i){e=L(i,"OPTION",{class:!0});var s=A(e);n=Ne(s,t),s.forEach(_),this.h()},h(){e.__value=r=o[22].id,Xn(e,e.__value),g(e,"class","bg-gray-100 dark:bg-gray-800")},m(i,s){z(i,e,s),S(e,n)},p(i,s){s&64&&t!==(t=i[22].name+"")&&Be(n,t),s&64&&r!==(r=i[22].id)&&(e.__value=r,Xn(e,e.__value))},d(i){i&&_(e)}}}function Ld(o){let e,t,n,r,i,s;const a=[tI,eI],l=[];function c(u,d){return u[3]?1:0}return r=c(o),i=l[r]=a[r](o),{c(){e=U("hr"),t=ie(),n=U("div"),i.c(),this.h()},l(u){e=L(u,"HR",{class:!0}),t=se(u),n=L(u,"DIV",{class:!0});var d=A(n);i.l(d),d.forEach(_),this.h()},h(){g(e,"class","border-gray-50 dark:border-gray-800 my-1 w-full"),g(n,"class","my-2 text-xs")},m(u,d){z(u,e,d),z(u,t,d),z(u,n,d),l[r].m(n,null),s=!0},p(u,d){let f=r;r=c(u),r===f?l[r].p(u,d):(Re(),O(l[f],1,1,()=>{l[f]=null}),Me(),i=l[r],i?i.p(u,d):(i=l[r]=a[r](u),i.c()),T(i,1),i.m(n,null))},i(u){s||(T(i),s=!0)},o(u){O(i),s=!1},d(u){u&&(_(e),_(t),_(n)),l[r].d()}}}function eI(o){let e,t;return e=new Cs({props:{className:"size-5"}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p:Ue,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function tI(o){let e,t,n;function r(s){o[16](s)}let i={valvesSpec:o[4]};return o[5]!==void 0&&(i.valves=o[5]),e=new Np({props:i}),ze.push(()=>Ze(e,"valves",r)),e.$on("change",o[17]),{c(){$(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,a){ee(e,s,a),n=!0},p(s,a){const l={};a&16&&(l.valvesSpec=s[4]),!t&&a&32&&(t=!0,l.valves=s[5],Je(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function nI(o){let e,t,n,r;const i=[ZE,JE],s=[];function a(l,c){return l[0]&&!l[3]?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=Ve()},l(l){t.l(l),n=Ve()},m(l,c){s[e].m(l,c),z(l,n,c),r=!0},p(l,[c]){let u=e;e=a(l),e===u?s[e].p(l,c):(Re(),O(s[u],1,1,()=>{s[u]=null}),Me(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){O(t),r=!1},d(l){l&&_(n),s[e].d(l)}}}function oI(o,e,t){let n,r,i;de(o,Xo,M=>t(6,n=M)),de(o,Yl,M=>t(7,r=M));const s=On(),a=rn("i18n");de(o,a,M=>t(8,i=M));let{show:l=!1}=e,c="tools",u="",d=!1,f=null,h={},p;const b=async()=>{p&&clearTimeout(p),p=setTimeout(()=>{m()},500)},w=async()=>{var M;if(t(3,d=!0),c==="tools"?(t(5,h=await xm(localStorage.token,u)),t(4,f=await $m(localStorage.token,u))):c==="functions"&&(t(5,h=await Mp(localStorage.token,u)),t(4,f=await Pp(localStorage.token,u))),f)for(const H in f.properties)((M=f.properties[H])==null?void 0:M.type)==="array"&&t(5,h[H]=(h[H]??[]).join(","),h);t(3,d=!1)},m=async()=>{var M;if(f){for(const H in f.properties)((M=f.properties[H])==null?void 0:M.type)==="array"&&t(5,h[H]=(h[H]??"").split(",").map(V=>V.trim()),h);if(c==="tools"){const H=await ep(localStorage.token,u,h).catch(V=>(rt.error(`${V}`),null));H&&(rt.success(i.t("Valves updated")),t(5,h=H))}else if(c==="functions"){const H=await Op(localStorage.token,u,h).catch(V=>(rt.error(`${V}`),null));H&&(rt.success(i.t("Valves updated")),t(5,h=H))}}},v=async()=>{t(3,d=!0),r===null&&Yl.set(await Rp(localStorage.token)),n===null&&Xo.set(await Ba(localStorage.token)),t(3,d=!1)};function y(){c=Vl(this),t(1,c)}function I(){u=Vl(this),t(2,u),t(1,c)}const P=async()=>{await $e()};function R(M){h=M,t(5,h)}const k=()=>{b()},N=()=>{m(),s("save")};return o.$$set=M=>{"show"in M&&t(0,l=M.show)},o.$$.update=()=>{o.$$.dirty&2&&c&&t(2,u=""),o.$$.dirty&4&&u&&w(),o.$$.dirty&1&&l&&v()},[l,c,u,d,f,h,n,r,i,s,a,b,m,y,I,P,R,k,N]}class rI extends We{constructor(e){super(),Ye(this,e,oI,nI,Qe,{show:0})}}function Bd(o,e,t){const n=o.slice();return n[14]=e[t],n[16]=t,n}function zd(o){let e,t,n,r;return e=new Sr({props:{title:o[3].t("Files"),open:!0,buttonClassName:"w-full",$$slots:{content:[iI]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment),t=ie(),n=U("hr"),this.h()},l(i){oe(e.$$.fragment,i),t=se(i),n=L(i,"HR",{class:!0}),this.h()},h(){g(n,"class","my-2 border-gray-50 dark:border-gray-700/10")},m(i,s){ee(e,i,s),z(i,t,s),z(i,n,s),r=!0},p(i,s){const a={};s&8&&(a.title=i[3].t("Files")),s&131073&&(a.$$scope={dirty:s,ctx:i}),e.$set(a)},i(i){r||(T(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){i&&(_(t),_(n)),te(e,i)}}}function Fd(o){var i,s;let e,t;function n(){return o[9](o[16])}function r(){return o[10](o[14])}return e=new Cf({props:{className:"w-full",item:o[14],edit:!0,url:(i=o[14])!=null&&i.url?o[14].url:null,name:o[14].name,type:o[14].type,size:(s=o[14])==null?void 0:s.size,dismissible:!0}}),e.$on("dismiss",n),e.$on("click",r),{c(){$(e.$$.fragment)},l(a){oe(e.$$.fragment,a)},m(a,l){ee(e,a,l),t=!0},p(a,l){var u,d;o=a;const c={};l&1&&(c.item=o[14]),l&1&&(c.url=(u=o[14])!=null&&u.url?o[14].url:null),l&1&&(c.name=o[14].name),l&1&&(c.type=o[14].type),l&1&&(c.size=(d=o[14])==null?void 0:d.size),e.$set(c)},i(a){t||(T(e.$$.fragment,a),t=!0)},o(a){O(e.$$.fragment,a),t=!1},d(a){te(e,a)}}}function iI(o){let e,t,n=yt(o[0]),r=[];for(let s=0;s<n.length;s+=1)r[s]=Fd(Bd(o,n,s));const i=s=>O(r[s],1,1,()=>{r[s]=null});return{c(){e=U("div");for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=L(s,"DIV",{class:!0,slot:!0});var a=A(e);for(let l=0;l<r.length;l+=1)r[l].l(a);a.forEach(_),this.h()},h(){g(e,"class","flex flex-col gap-1 mt-1.5"),g(e,"slot","content")},m(s,a){z(s,e,a);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(e,null);t=!0},p(s,a){if(a&1){n=yt(s[0]);let l;for(l=0;l<n.length;l+=1){const c=Bd(s,n,l);r[l]?(r[l].p(c,a),T(r[l],1)):(r[l]=Fd(c),r[l].c(),T(r[l],1),r[l].m(e,null))}for(Re(),l=n.length;l<r.length;l+=1)i(l);Me()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(r[a]);t=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)O(r[a]);t=!1},d(s){s&&_(e),Hn(r,s)}}}function sI(o){let e,t,n;return t=new rI({props:{show:o[2]}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{class:!0,slot:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"class","text-sm"),g(e,"slot","content")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i&4&&(s.show=r[2]),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function Vd(o){let e,t,n,r;return n=new Sr({props:{title:o[3].t("System Prompt"),open:!0,buttonClassName:"w-full",$$slots:{content:[aI]},$$scope:{ctx:o}}}),{c(){e=U("hr"),t=ie(),$(n.$$.fragment),this.h()},l(i){e=L(i,"HR",{class:!0}),t=se(i),oe(n.$$.fragment,i),this.h()},h(){g(e,"class","my-2 border-gray-50 dark:border-gray-700/10")},m(i,s){z(i,e,s),z(i,t,s),ee(n,i,s),r=!0},p(i,s){const a={};s&8&&(a.title=i[3].t("System Prompt")),s&131082&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){O(n.$$.fragment,i),r=!1},d(i){i&&(_(e),_(t)),te(n,i)}}}function aI(o){let e,t,n,r,i;return{c(){e=U("div"),t=U("textarea"),this.h()},l(s){e=L(s,"DIV",{class:!0,slot:!0});var a=A(e);t=L(a,"TEXTAREA",{class:!0,rows:!0,placeholder:!0}),A(t).forEach(_),a.forEach(_),this.h()},h(){g(t,"class","w-full text-xs py-1.5 bg-transparent outline-hidden resize-none"),g(t,"rows","4"),g(t,"placeholder",n=o[3].t("Enter system prompt")),g(e,"class",""),g(e,"slot","content")},m(s,a){z(s,e,a),S(e,t),Xn(t,o[1].system),r||(i=Ae(t,"input",o[12]),r=!0)},p(s,a){a&8&&n!==(n=s[3].t("Enter system prompt"))&&g(t,"placeholder",n),a&2&&Xn(t,s[1].system)},d(s){s&&_(e),r=!1,i()}}}function Kd(o){let e,t,n,r;return n=new Sr({props:{title:o[3].t("Advanced Params"),open:!0,buttonClassName:"w-full",$$slots:{content:[lI]},$$scope:{ctx:o}}}),{c(){e=U("hr"),t=ie(),$(n.$$.fragment),this.h()},l(i){e=L(i,"HR",{class:!0}),t=se(i),oe(n.$$.fragment,i),this.h()},h(){g(e,"class","my-2 border-gray-50 dark:border-gray-700/10")},m(i,s){z(i,e,s),z(i,t,s),ee(n,i,s),r=!0},p(i,s){const a={};s&8&&(a.title=i[3].t("Advanced Params")),s&131090&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){O(n.$$.fragment,i),r=!1},d(i){i&&(_(e),_(t)),te(n,i)}}}function lI(o){var l;let e,t,n,r,i;function s(c){o[13](c)}let a={admin:((l=o[4])==null?void 0:l.role)==="admin",custom:!0};return o[1]!==void 0&&(a.params=o[1]),n=new Ap({props:a}),ze.push(()=>Ze(n,"params",s)),{c(){e=U("div"),t=U("div"),$(n.$$.fragment),this.h()},l(c){e=L(c,"DIV",{class:!0,slot:!0});var u=A(e);t=L(u,"DIV",{});var d=A(t);oe(n.$$.fragment,d),d.forEach(_),u.forEach(_),this.h()},h(){g(e,"class","text-sm mt-1.5"),g(e,"slot","content")},m(c,u){z(c,e,u),S(e,t),ee(n,t,null),i=!0},p(c,u){var f;const d={};u&16&&(d.admin=((f=c[4])==null?void 0:f.role)==="admin"),!r&&u&2&&(r=!0,d.params=c[1],Je(()=>r=!1)),n.$set(d)},i(c){i||(T(n.$$.fragment,c),i=!0)},o(c){O(n.$$.fragment,c),i=!1},d(c){c&&_(e),te(n)}}}function cI(o){var N,M,H,V,Q,J;let e,t,n,r=o[3].t("Chat Controls")+"",i,s,a,l,c,u,d,f,h,p,b,w,m,v;l=new Es({props:{className:"size-3.5"}});let y=o[0].length>0&&zd(o);function I(E){o[11](E)}let P={title:o[3].t("Valves"),buttonClassName:"w-full",$$slots:{content:[sI]},$$scope:{ctx:o}};o[2]!==void 0&&(P.open=o[2]),f=new Sr({props:P}),ze.push(()=>Ze(f,"open",I));let R=(((N=o[4])==null?void 0:N.role)==="admin"||(((H=(M=o[4])==null?void 0:M.permissions.chat)==null?void 0:H.system_prompt)??!0))&&Vd(o),k=(((V=o[4])==null?void 0:V.role)==="admin"||(((J=(Q=o[4])==null?void 0:Q.permissions.chat)==null?void 0:J.controls)??!0))&&Kd(o);return{c(){e=U("div"),t=U("div"),n=U("div"),i=Oe(r),s=ie(),a=U("button"),$(l.$$.fragment),c=ie(),u=U("div"),y&&y.c(),d=ie(),$(f.$$.fragment),p=ie(),R&&R.c(),b=ie(),k&&k.c(),this.h()},l(E){e=L(E,"DIV",{class:!0});var Y=A(e);t=L(Y,"DIV",{class:!0});var D=A(t);n=L(D,"DIV",{class:!0});var W=A(n);i=Ne(W,r),W.forEach(_),s=se(D),a=L(D,"BUTTON",{class:!0});var F=A(a);oe(l.$$.fragment,F),F.forEach(_),D.forEach(_),c=se(Y),u=L(Y,"DIV",{class:!0});var G=A(u);y&&y.l(G),d=se(G),oe(f.$$.fragment,G),p=se(G),R&&R.l(G),b=se(G),k&&k.l(G),G.forEach(_),Y.forEach(_),this.h()},h(){g(n,"class","text-lg font-medium self-center font-primary"),g(a,"class","self-center"),g(t,"class","flex items-center justify-between dark:text-gray-100 mb-2"),g(u,"class","dark:text-gray-200 text-sm font-primary py-0.5 px-0.5"),g(e,"class","dark:text-white")},m(E,Y){z(E,e,Y),S(e,t),S(t,n),S(n,i),S(t,s),S(t,a),ee(l,a,null),S(e,c),S(e,u),y&&y.m(u,null),S(u,d),ee(f,u,null),S(u,p),R&&R.m(u,null),S(u,b),k&&k.m(u,null),w=!0,m||(v=Ae(a,"click",o[8]),m=!0)},p(E,[Y]){var W,F,G,K,j,re;(!w||Y&8)&&r!==(r=E[3].t("Chat Controls")+"")&&Be(i,r),E[0].length>0?y?(y.p(E,Y),Y&1&&T(y,1)):(y=zd(E),y.c(),T(y,1),y.m(u,d)):y&&(Re(),O(y,1,1,()=>{y=null}),Me());const D={};Y&8&&(D.title=E[3].t("Valves")),Y&131076&&(D.$$scope={dirty:Y,ctx:E}),!h&&Y&4&&(h=!0,D.open=E[2],Je(()=>h=!1)),f.$set(D),((W=E[4])==null?void 0:W.role)==="admin"||(((G=(F=E[4])==null?void 0:F.permissions.chat)==null?void 0:G.system_prompt)??!0)?R?(R.p(E,Y),Y&16&&T(R,1)):(R=Vd(E),R.c(),T(R,1),R.m(u,b)):R&&(Re(),O(R,1,1,()=>{R=null}),Me()),((K=E[4])==null?void 0:K.role)==="admin"||(((re=(j=E[4])==null?void 0:j.permissions.chat)==null?void 0:re.controls)??!0)?k?(k.p(E,Y),Y&16&&T(k,1)):(k=Kd(E),k.c(),T(k,1),k.m(u,null)):k&&(Re(),O(k,1,1,()=>{k=null}),Me())},i(E){w||(T(l.$$.fragment,E),T(y),T(f.$$.fragment,E),T(R),T(k),w=!0)},o(E){O(l.$$.fragment,E),O(y),O(f.$$.fragment,E),O(R),O(k),w=!1},d(E){E&&_(e),te(l),y&&y.d(),te(f),R&&R.d(),k&&k.d(),m=!1,v()}}}function uI(o,e,t){let n,r;de(o,bo,m=>t(4,r=m));const i=On(),s=rn("i18n");de(o,s,m=>t(3,n=m));let{models:a=[]}=e,{chatFiles:l=[]}=e,{params:c={}}=e,u=!1;const d=()=>{i("close")},f=m=>{l.splice(m,1),t(0,l)},h=m=>{};function p(m){u=m,t(2,u)}function b(){c.system=this.value,t(1,c)}function w(m){c=m,t(1,c)}return o.$$set=m=>{"models"in m&&t(7,a=m.models),"chatFiles"in m&&t(0,l=m.chatFiles),"params"in m&&t(1,c=m.params)},[l,c,u,n,r,i,s,a,d,f,h,p,b,w]}class em extends We{constructor(e){super(),Ye(this,e,uI,cI,Qe,{models:7,chatFiles:0,params:1})}}function Gd(o,e,t){const n=o.slice();return n[10]=e[t],n}function dI(o){let e;const t=o[4].default,n=pn(t,o,o[8],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&256)&&_n(n,t,r,r[8],e?yn(t,r[8],i,null):bn(r[8]),null)},i(r){e||(T(n,r),e=!0)},o(r){O(n,r),e=!1},d(r){n&&n.d(r)}}}function fI(o){var s;let e,t,n=(((s=o[10])==null?void 0:s.label)??"Camera")+"",r,i;return{c(){e=U("div"),t=U("div"),r=Oe(n),i=ie(),this.h()},l(a){e=L(a,"DIV",{class:!0});var l=A(e);t=L(l,"DIV",{class:!0});var c=A(t);r=Ne(c,n),c.forEach(_),l.forEach(_),i=se(a),this.h()},h(){g(t,"class","line-clamp-1"),g(e,"class","flex items-center")},m(a,l){z(a,e,l),S(e,t),S(t,r),z(a,i,l)},p(a,l){var c;l&2&&n!==(n=(((c=a[10])==null?void 0:c.label)??"Camera")+"")&&Be(r,n)},d(a){a&&(_(e),_(i))}}}function Wd(o){let e,t;function n(){return o[5](o[10])}return e=new zn({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[fI]},$$scope:{ctx:o}}}),e.$on("click",n),{c(){$(e.$$.fragment)},l(r){oe(e.$$.fragment,r)},m(r,i){ee(e,r,i),t=!0},p(r,i){o=r;const s={};i&258&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(r){t||(T(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){te(e,r)}}}function hI(o){let e,t,n=yt(o[1]),r=[];for(let s=0;s<n.length;s+=1)r[s]=Wd(Gd(o,n,s));const i=s=>O(r[s],1,1,()=>{r[s]=null});return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Ve()},l(s){for(let a=0;a<r.length;a+=1)r[a].l(s);e=Ve()},m(s,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(s,a);z(s,e,a),t=!0},p(s,a){if(a&10){n=yt(s[1]);let l;for(l=0;l<n.length;l+=1){const c=Gd(s,n,l);r[l]?(r[l].p(c,a),T(r[l],1)):(r[l]=Wd(c),r[l].c(),T(r[l],1),r[l].m(e.parentNode,e))}for(Re(),l=n.length;l<r.length;l+=1)i(l);Me()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(r[a]);t=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)O(r[a]);t=!1},d(s){s&&_(e),Hn(r,s)}}}function gI(o){let e,t,n;return t=new za({props:{class:"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-9999 bg-white dark:bg-gray-900 dark:text-white shadow-xs",sideOffset:6,side:"top",align:"start",transition:ks,$$slots:{default:[hI]},$$scope:{ctx:o}}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{slot:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"slot","content")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p(r,i){const s={};i&258&&(s.$$scope={dirty:i,ctx:r}),t.$set(s)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function mI(o){let e,t,n;function r(s){o[6](s)}let i={$$slots:{content:[gI],default:[dI]},$$scope:{ctx:o}};return o[2]!==void 0&&(i.show=o[2]),e=new Fa({props:i}),ze.push(()=>Ze(e,"show",r)),e.$on("change",o[7]),{c(){$(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,a){ee(e,s,a),n=!0},p(s,[a]){const l={};a&258&&(l.$$scope={dirty:a,ctx:s}),!t&&a&4&&(t=!0,l.show=s[2],Je(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function pI(o,e,t){let{$$slots:n={},$$scope:r}=e;rn("i18n");const i=On();let{onClose:s=()=>{}}=e,{devices:a}=e,l=!1;const c=f=>{i("change",f.deviceId)};function u(f){l=f,t(2,l)}const d=f=>{f.detail===!1&&s()};return o.$$set=f=>{"onClose"in f&&t(0,s=f.onClose),"devices"in f&&t(1,a=f.devices),"$$scope"in f&&t(8,r=f.$$scope)},[s,a,l,i,n,c,u,d,r]}class _I extends We{constructor(e){super(),Ye(this,e,pI,mI,Qe,{onClose:0,devices:1})}}function Yd(o){let e,t,n,r,i,s,a,l,c,u,d,f,h,p,b,w='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"></path></svg>',m,v,y,I=o[4]&&qd(o);function P(E,Y){return E[4]?vI:kI}let R=P(o),k=R(o);const N=[SI,TI],M=[];function H(E,Y){return E[4]?0:1}a=H(o),l=M[a]=N[a](o);function V(E,Y){return E[1]?OI:E[2]?PI:MI}let Q=V(o),J=Q(o);return{c(){e=U("div"),I&&I.c(),t=ie(),n=U("div"),k.c(),r=ie(),i=U("div"),s=U("div"),l.c(),c=ie(),u=U("div"),d=U("button"),f=U("div"),J.c(),h=ie(),p=U("div"),b=U("button"),b.innerHTML=w,this.h()},l(E){e=L(E,"DIV",{class:!0});var Y=A(e);I&&I.l(Y),t=se(Y),n=L(Y,"DIV",{class:!0});var D=A(n);k.l(D),D.forEach(_),r=se(Y),i=L(Y,"DIV",{class:!0});var W=A(i);s=L(W,"DIV",{});var F=A(s);l.l(F),F.forEach(_),c=se(W),u=L(W,"DIV",{});var G=A(u);d=L(G,"BUTTON",{type:!0});var K=A(d);f=L(K,"DIV",{class:!0});var j=A(f);J.l(j),j.forEach(_),K.forEach(_),G.forEach(_),h=se(W),p=L(W,"DIV",{});var re=A(p);b=L(re,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),dn(b)!=="svelte-1k5eavb"&&(b.innerHTML=w),re.forEach(_),W.forEach(_),Y.forEach(_),this.h()},h(){g(n,"class","flex justify-center items-center flex-1 h-full w-full max-h-full"),g(f,"class","line-clamp-1 text-sm font-medium"),g(d,"type","button"),g(b,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(b,"type","button"),g(i,"class","flex justify-between items-center pb-2 w-full"),g(e,"class","max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6")},m(E,Y){z(E,e,Y),I&&I.m(e,null),S(e,t),S(e,n),k.m(n,null),S(e,r),S(e,i),S(i,s),M[a].m(s,null),S(i,c),S(i,u),S(u,d),S(d,f),J.m(f,null),S(i,h),S(i,p),S(p,b),m=!0,v||(y=[Ae(d,"click",o[31]),Ae(b,"click",o[32])],v=!0)},p(E,Y){E[4]?I?I.p(E,Y):(I=qd(E),I.c(),I.m(e,t)):I&&(I.d(1),I=null),R===(R=P(E))&&k?k.p(E,Y):(k.d(1),k=R(E),k&&(k.c(),k.m(n,null)));let D=a;a=H(E),a===D?M[a].p(E,Y):(Re(),O(M[D],1,1,()=>{M[D]=null}),Me(),l=M[a],l?l.p(E,Y):(l=M[a]=N[a](E),l.c()),T(l,1),l.m(s,null)),Q===(Q=V(E))&&J?J.p(E,Y):(J.d(1),J=Q(E),J&&(J.c(),J.m(f,null)))},i(E){m||(T(l),m=!0)},o(E){O(l),m=!1},d(E){E&&_(e),I&&I.d(),k.d(),M[a].d(),J.d(),v=!1,wn(y)}}}function qd(o){let e,t,n;function r(a,l){return a[3]?wI:a[1]||a[2]?yI:bI}let i=r(o),s=i(o);return{c(){e=U("button"),s.c(),this.h()},l(a){e=L(a,"BUTTON",{type:!0,class:!0});var l=A(e);s.l(l),l.forEach(_),this.h()},h(){g(e,"type","button"),g(e,"class","flex justify-center items-center w-full h-20 min-h-20")},m(a,l){z(a,e,l),s.m(e,null),t||(n=Ae(e,"click",o[26]),t=!0)},p(a,l){i===(i=r(a))&&s?s.p(a,l):(s.d(1),s=i(a),s&&(s.c(),s.m(e,null)))},d(a){a&&_(e),s.d(),t=!1,n()}}}function bI(o){let e,t,n;return{c(){e=U("div"),this.h()},l(r){e=L(r,"DIV",{class:!0,style:!0}),A(e).forEach(_),this.h()},h(){var r,i,s,a,l,c,u,d,f;g(e,"class",t=(o[6]*100>4?" size-[4.5rem]":o[6]*100>2?" size-16":o[6]*100>1?"size-14":"size-12")+" transition-all rounded-full "+((((s=(i=(r=o[0])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:s.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")+" bg-black dark:bg-white"),g(e,"style",n=(((c=(l=(a=o[0])==null?void 0:a.info)==null?void 0:l.meta)==null?void 0:c.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(f=(d=(u=o[0])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url}');`:"")},m(r,i){z(r,e,i)},p(r,i){var s,a,l,c,u,d,f,h,p;i[0]&65&&t!==(t=(r[6]*100>4?" size-[4.5rem]":r[6]*100>2?" size-16":r[6]*100>1?"size-14":"size-12")+" transition-all rounded-full "+((((l=(a=(s=r[0])==null?void 0:s.info)==null?void 0:a.meta)==null?void 0:l.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")+" bg-black dark:bg-white")&&g(e,"class",t),i[0]&1&&n!==(n=(((d=(u=(c=r[0])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(p=(h=(f=r[0])==null?void 0:f.info)==null?void 0:h.meta)==null?void 0:p.profile_image_url}');`:"")&&g(e,"style",n)},d(r){r&&_(e)}}}function yI(o){let e,t,n,r,i,s;return{c(){e=Ce("svg"),t=Ce("style"),n=Oe(`.spinner_qM83 {
								animation: spinner_8HQG 1.05s infinite;
							}
							.spinner_oXPr {
								animation-delay: 0.1s;
							}
							.spinner_ZTLf {
								animation-delay: 0.2s;
							}
							@keyframes spinner_8HQG {
								0%,
								57.14% {
									animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
									transform: translate(0);
								}
								28.57% {
									animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
									transform: translateY(-6px);
								}
								100% {
									transform: translate(0);
								}
							}
						`),r=Ce("circle"),i=Ce("circle"),s=Ce("circle"),this.h()},l(a){e=Ee(a,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var l=A(e);t=Ee(l,"style",{});var c=A(t);n=Ne(c,`.spinner_qM83 {
								animation: spinner_8HQG 1.05s infinite;
							}
							.spinner_oXPr {
								animation-delay: 0.1s;
							}
							.spinner_ZTLf {
								animation-delay: 0.2s;
							}
							@keyframes spinner_8HQG {
								0%,
								57.14% {
									animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
									transform: translate(0);
								}
								28.57% {
									animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
									transform: translateY(-6px);
								}
								100% {
									transform: translate(0);
								}
							}
						`),c.forEach(_),r=Ee(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(r).forEach(_),i=Ee(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(i).forEach(_),s=Ee(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(s).forEach(_),l.forEach(_),this.h()},h(){g(r,"class","spinner_qM83"),g(r,"cx","4"),g(r,"cy","12"),g(r,"r","3"),g(i,"class","spinner_qM83 spinner_oXPr"),g(i,"cx","12"),g(i,"cy","12"),g(i,"r","3"),g(s,"class","spinner_qM83 spinner_ZTLf"),g(s,"cx","20"),g(s,"cy","12"),g(s,"r","3"),g(e,"class","size-12 text-gray-900 dark:text-gray-400"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"xmlns","http://www.w3.org/2000/svg")},m(a,l){z(a,e,l),S(e,t),S(t,n),S(e,r),S(e,i),S(e,s)},p:Ue,d(a){a&&_(e)}}}function wI(o){let e,t;return{c(){e=U("div"),t=Oe(o[3]),this.h()},l(n){e=L(n,"DIV",{class:!0,style:!0});var r=A(e);t=Ne(r,o[3]),r.forEach(_),this.h()},h(){g(e,"class","transition-all rounded-full"),tt(e,"font-size",(o[6]*100>4?"4.5":o[6]*100>2?"4.25":o[6]*100>1?"3.75":"3.5")+"rem"),tt(e,"width","100%"),tt(e,"text-align","center")},m(n,r){z(n,e,r),S(e,t)},p(n,r){r[0]&8&&Be(t,n[3]),r[0]&64&&tt(e,"font-size",(n[6]*100>4?"4.5":n[6]*100>2?"4.25":n[6]*100>1?"3.75":"3.5")+"rem")},d(n){n&&_(e)}}}function vI(o){let e,t,n,r,i,s,a,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-6"><path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"></path></svg>',c,u;return{c(){e=U("div"),t=U("video"),n=ie(),r=U("canvas"),i=ie(),s=U("div"),a=U("button"),a.innerHTML=l,this.h()},l(d){e=L(d,"DIV",{class:!0});var f=A(e);t=L(f,"VIDEO",{id:!0,class:!0}),A(t).forEach(_),n=se(f),r=L(f,"CANVAS",{id:!0,style:!0}),A(r).forEach(_),i=se(f),s=L(f,"DIV",{class:!0});var h=A(s);a=L(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),dn(a)!=="svelte-16ul42n"&&(a.innerHTML=l),h.forEach(_),f.forEach(_),this.h()},h(){g(t,"id","camera-feed"),t.autoplay=!0,g(t,"class","rounded-2xl h-full min-w-full object-cover object-center"),t.playsInline=!0,g(r,"id","camera-canvas"),tt(r,"display","none"),g(a,"type","button"),g(a,"class","p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full"),g(s,"class","absolute top-4 md:top-8 left-4"),g(e,"class","relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full")},m(d,f){z(d,e,f),S(e,t),S(e,n),S(e,r),S(e,i),S(e,s),S(s,a),c||(u=Ae(a,"click",o[28]),c=!0)},p:Ue,d(d){d&&_(e),c=!1,u()}}}function kI(o){let e,t,n;function r(a,l){return a[3]?II:a[1]||a[2]?EI:CI}let i=r(o),s=i(o);return{c(){e=U("button"),s.c(),this.h()},l(a){e=L(a,"BUTTON",{type:!0});var l=A(e);s.l(l),l.forEach(_),this.h()},h(){g(e,"type","button")},m(a,l){z(a,e,l),s.m(e,null),t||(n=Ae(e,"click",o[27]),t=!0)},p(a,l){i===(i=r(a))&&s?s.p(a,l):(s.d(1),s=i(a),s&&(s.c(),s.m(e,null)))},d(a){a&&_(e),s.d(),t=!1,n()}}}function CI(o){let e,t,n;return{c(){e=U("div"),this.h()},l(r){e=L(r,"DIV",{class:!0,style:!0}),A(e).forEach(_),this.h()},h(){var r,i,s,a,l,c,u,d,f;g(e,"class",t=(o[6]*100>4?" size-52":o[6]*100>2?"size-48":o[6]*100>1?"size-44":"size-40")+" transition-all rounded-full "+((((s=(i=(r=o[0])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:s.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")),g(e,"style",n=(((c=(l=(a=o[0])==null?void 0:a.info)==null?void 0:l.meta)==null?void 0:c.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(f=(d=(u=o[0])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url}');`:"")},m(r,i){z(r,e,i)},p(r,i){var s,a,l,c,u,d,f,h,p;i[0]&65&&t!==(t=(r[6]*100>4?" size-52":r[6]*100>2?"size-48":r[6]*100>1?"size-44":"size-40")+" transition-all rounded-full "+((((l=(a=(s=r[0])==null?void 0:s.info)==null?void 0:a.meta)==null?void 0:l.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white"))&&g(e,"class",t),i[0]&1&&n!==(n=(((d=(u=(c=r[0])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(p=(h=(f=r[0])==null?void 0:f.info)==null?void 0:h.meta)==null?void 0:p.profile_image_url}');`:"")&&g(e,"style",n)},d(r){r&&_(e)}}}function EI(o){let e,t,n,r,i,s;return{c(){e=Ce("svg"),t=Ce("style"),n=Oe(`.spinner_qM83 {
									animation: spinner_8HQG 1.05s infinite;
								}
								.spinner_oXPr {
									animation-delay: 0.1s;
								}
								.spinner_ZTLf {
									animation-delay: 0.2s;
								}
								@keyframes spinner_8HQG {
									0%,
									57.14% {
										animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
										transform: translate(0);
									}
									28.57% {
										animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
										transform: translateY(-6px);
									}
									100% {
										transform: translate(0);
									}
								}
							`),r=Ce("circle"),i=Ce("circle"),s=Ce("circle"),this.h()},l(a){e=Ee(a,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var l=A(e);t=Ee(l,"style",{});var c=A(t);n=Ne(c,`.spinner_qM83 {
									animation: spinner_8HQG 1.05s infinite;
								}
								.spinner_oXPr {
									animation-delay: 0.1s;
								}
								.spinner_ZTLf {
									animation-delay: 0.2s;
								}
								@keyframes spinner_8HQG {
									0%,
									57.14% {
										animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
										transform: translate(0);
									}
									28.57% {
										animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
										transform: translateY(-6px);
									}
									100% {
										transform: translate(0);
									}
								}
							`),c.forEach(_),r=Ee(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(r).forEach(_),i=Ee(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(i).forEach(_),s=Ee(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),A(s).forEach(_),l.forEach(_),this.h()},h(){g(r,"class","spinner_qM83"),g(r,"cx","4"),g(r,"cy","12"),g(r,"r","3"),g(i,"class","spinner_qM83 spinner_oXPr"),g(i,"cx","12"),g(i,"cy","12"),g(i,"r","3"),g(s,"class","spinner_qM83 spinner_ZTLf"),g(s,"cx","20"),g(s,"cy","12"),g(s,"r","3"),g(e,"class","size-44 text-gray-900 dark:text-gray-400"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"xmlns","http://www.w3.org/2000/svg")},m(a,l){z(a,e,l),S(e,t),S(t,n),S(e,r),S(e,i),S(e,s)},p:Ue,d(a){a&&_(e)}}}function II(o){let e,t;return{c(){e=U("div"),t=Oe(o[3]),this.h()},l(n){e=L(n,"DIV",{class:!0,style:!0});var r=A(e);t=Ne(r,o[3]),r.forEach(_),this.h()},h(){g(e,"class","transition-all rounded-full"),tt(e,"font-size",(o[6]*100>4?"13":o[6]*100>2?"12":o[6]*100>1?"11.5":"11")+"rem"),tt(e,"width","100%"),tt(e,"text-align","center")},m(n,r){z(n,e,r),S(e,t)},p(n,r){r[0]&8&&Be(t,n[3]),r[0]&64&&tt(e,"font-size",(n[6]*100>4?"13":n[6]*100>2?"12":n[6]*100>1?"11.5":"11")+"rem")},d(n){n&&_(e)}}}function TI(o){let e,t;return e=new Ft({props:{content:o[11].t("Camera"),$$slots:{default:[AI]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&2048&&(i.content=n[11].t("Camera")),r[2]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function SI(o){let e,t;return e=new _I({props:{devices:o[8],$$slots:{default:[RI]},$$scope:{ctx:o}}}),e.$on("change",o[29]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&256&&(i.devices=n[8]),r[2]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function AI(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"></path></svg>',n,r;return{c(){e=U("button"),e.innerHTML=t,this.h()},l(i){e=L(i,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),dn(e)!=="svelte-1n1gs9g"&&(e.innerHTML=t),this.h()},h(){g(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(e,"type","button")},m(i,s){z(i,e,s),n||(r=Ae(e,"click",o[30]),n=!0)},p:Ue,d(i){i&&_(e),n=!1,r()}}}function RI(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd"></path></svg>';return{c(){e=U("button"),e.innerHTML=t,this.h()},l(n){e=L(n,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),dn(e)!=="svelte-5e0pue"&&(e.innerHTML=t),this.h()},h(){g(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(e,"type","button")},m(n,r){z(n,e,r)},p:Ue,d(n){n&&_(e)}}}function MI(o){let e=o[11].t("Listening...")+"",t;return{c(){t=Oe(e)},l(n){t=Ne(n,e)},m(n,r){z(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Listening...")+"")&&Be(t,e)},d(n){n&&_(t)}}}function PI(o){let e=o[11].t("Tap to interrupt")+"",t;return{c(){t=Oe(e)},l(n){t=Ne(n,e)},m(n,r){z(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Tap to interrupt")+"")&&Be(t,e)},d(n){n&&_(t)}}}function OI(o){let e=o[11].t("Thinking...")+"",t;return{c(){t=Oe(e)},l(n){t=Ne(n,e)},m(n,r){z(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Thinking...")+"")&&Be(t,e)},d(n){n&&_(t)}}}function NI(o){let e,t,n=o[10]&&Yd(o);return{c(){n&&n.c(),e=Ve()},l(r){n&&n.l(r),e=Ve()},m(r,i){n&&n.m(r,i),z(r,e,i),t=!0},p(r,i){r[10]?n?(n.p(r,i),i[0]&1024&&T(n,1)):(n=Yd(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Re(),O(n,1,1,()=>{n=null}),Me())},i(r){t||(T(n),t=!0)},o(r){O(n),t=!1},d(r){r&&_(e),n&&n.d(r)}}}function DI(o,e,t){let n,r,i,s,a,l;de(o,nr,fe=>t(45,n=fe)),de(o,Ar,fe=>t(46,r=fe)),de(o,qn,fe=>t(47,i=fe)),de(o,la,fe=>t(48,s=fe)),de(o,Wn,fe=>t(10,a=fe));const c=On(),u=rn("i18n");de(o,u,fe=>t(11,l=fe));let{eventTarget:d}=e,{submitPrompt:f}=e,{stopResponse:h}=e,{files:p}=e,{chatId:b}=e,{modelId:w}=e,m=null,v=null,y=!1,I=!1,P=!1,R=null,k=!1,N=null,M=!1,H=0,V=!1,Q,J=null,E=[],Y=[],D=null;const W=async()=>{const fe=await navigator.mediaDevices.enumerateDevices();t(8,Y=fe.filter(qe=>qe.kind==="videoinput")),navigator.mediaDevices.getDisplayMedia&&t(8,Y=[...Y,{deviceId:"screen",label:"Screen Share"}]),D===null&&Y.length>0&&t(9,D=Y[0].deviceId)},F=async()=>{if(await W(),N===null){t(4,k=!0),await $e();try{await G()}catch(fe){console.error("Error accessing webcam: ",fe)}}},G=async()=>{const fe=document.getElementById("camera-feed");fe&&(D==="screen"?t(5,N=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1})):t(5,N=await navigator.mediaDevices.getUserMedia({video:{deviceId:D?{exact:D}:void 0}})),N&&(await W(),fe.srcObject=N,await fe.play()))},K=async()=>{N&&N.getTracks().forEach(qe=>qe.stop()),t(5,N=null)},j=()=>{const fe=document.getElementById("camera-feed"),qe=document.getElementById("camera-canvas");if(!qe)return;const Ke=qe.getContext("2d");qe.width=fe.videoWidth,qe.height=fe.videoHeight,Ke.drawImage(fe,0,0,fe.videoWidth,fe.videoHeight);const nt=qe.toDataURL("image/png");return nt},re=async()=>{await K(),t(4,k=!1)},ue=-55,X=async fe=>{var nt,wt;await $e();const qe=Dm(fe,"recording.wav"),Ke=await Up(localStorage.token,qe,(wt=(nt=i==null?void 0:i.audio)==null?void 0:nt.stt)==null?void 0:wt.language).catch(pt=>(rt.error(`${pt}`),null));if(Ke&&(Ke.text,Ke.text!=="")){const pt=await f(Ke.text,{_raw:!0})}},me=async(fe=!0)=>{if(a){const qe=E.slice(0);if(E=[],Q=!1,fe&&ne(),I){if(t(1,y=!0),t(3,R=null),N){const nt=j();t(20,p=[{type:"image",url:nt}])}const Ke=new Blob(qe,{type:"audio/wav"});await X(Ke),I=!1,t(1,y=!1)}}else E=[],Q=!1,J&&J.getTracks().forEach(Ke=>Ke.stop()),t(7,J=null)},ne=async()=>{a&&(J||t(7,J=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})),Q=new MediaRecorder(J),Q.onstart=()=>{E=[]},Q.ondataavailable=fe=>{V&&E.push(fe.data)},Q.onstop=fe=>{me()},Z(J))},q=async()=>{try{Q&&Q.stop()}catch(fe){}J&&(J.getAudioTracks().forEach(function(fe){fe.stop()}),t(7,J=null))},he=fe=>{let qe=0;for(let Ke=0;Ke<fe.length;Ke++){const nt=(fe[Ke]-128)/128;qe+=nt*nt}return Math.sqrt(qe/fe.length)},Z=fe=>{const qe=new AudioContext,Ke=qe.createMediaStreamSource(fe),nt=qe.createAnalyser();nt.minDecibels=ue,Ke.connect(nt);const wt=nt.frequencyBinCount,pt=new Uint8Array(wt),Mt=new Uint8Array(nt.fftSize);let Kt=Date.now();V=!1,(()=>{const jt=()=>{if(!Q||!a)return;if(P&&!((i==null?void 0:i.voiceInterruption)??!1)?(nt.maxDecibels=0,nt.minDecibels=-1):(nt.minDecibels=ue,nt.maxDecibels=-30),nt.getByteTimeDomainData(Mt),nt.getByteFrequencyData(pt),t(6,H=he(Mt)),pt.some(vn=>vn>0)&&(Q&&Q.state!=="recording"&&Q.start(),V||(V=!0,ct()),Kt=Date.now()),V&&Date.now()-Kt>2e3&&(I=!0,Q)){Q.stop();return}window.requestAnimationFrame(jt)};window.requestAnimationFrame(jt)})()};let x={},_e=null,Pe=null;const De=fe=>a?new Promise(qe=>{let Ke=[];const nt=setInterval(async()=>{var wt,pt,Mt;if(Ke=await speechSynthesis.getVoices(),Ke.length>0){clearInterval(nt);const Kt=((wt=Ke==null?void 0:Ke.filter(an=>{var jt,ln,vn,At;return an.voiceURI===(((ln=(jt=i==null?void 0:i.audio)==null?void 0:jt.tts)==null?void 0:ln.voice)??((At=(vn=r==null?void 0:r.audio)==null?void 0:vn.tts)==null?void 0:At.voice))}))==null?void 0:wt.at(0))??void 0;Pe=new SpeechSynthesisUtterance(fe),Pe.rate=((Mt=(pt=i.audio)==null?void 0:pt.tts)==null?void 0:Mt.playbackRate)??1,Kt&&(Pe.voice=Kt),speechSynthesis.speak(Pe),Pe.onend=async an=>{await new Promise(jt=>setTimeout(jt,200)),qe(an)}}},100)}):Promise.resolve(),ge=fe=>a?new Promise(qe=>{var nt,wt;const Ke=document.getElementById("audioElement");Ke&&(Ke.src=fe.src,Ke.muted=!0,Ke.playbackRate=((wt=(nt=i.audio)==null?void 0:nt.tts)==null?void 0:wt.playbackRate)??1,Ke.play().then(()=>{Ke.muted=!1}).catch(pt=>{console.error(pt)}),Ke.onended=async pt=>{await new Promise(Mt=>setTimeout(Mt,100)),qe(pt)})}):Promise.resolve(),ct=async()=>{t(2,P=!1),M&&h(),Pe&&(speechSynthesis.cancel(),Pe=null);const fe=document.getElementById("audioElement");fe&&(fe.muted=!0,fe.pause(),fe.currentTime=0)};let at=new AbortController;const kt=new Map,_t=new Map,Dt=async fe=>{var qe,Ke,nt,wt,pt,Mt,Kt,an,jt,ln,vn,At,hn,kn;if(!kt.has(fe))try{if((i==null?void 0:i.showEmojiInCall)??!1){const Sn=await qm(localStorage.token,w,fe,b);Sn&&_t.set(fe,Sn)}if(((Ke=(qe=i.audio)==null?void 0:qe.tts)==null?void 0:Ke.engine)==="browser-kokoro"){const Sn=await s.generate({text:fe,voice:((wt=(nt=i==null?void 0:i.audio)==null?void 0:nt.tts)==null?void 0:wt.voice)??((Mt=(pt=r==null?void 0:r.audio)==null?void 0:pt.tts)==null?void 0:Mt.voice)}).catch(Lt=>{console.error(Lt),rt.error(`${Lt}`)});Sn&&kt.set(fe,new Audio(Sn))}else if(r.audio.tts.engine!==""){const Sn=await Hp(localStorage.token,((an=(Kt=i==null?void 0:i.audio)==null?void 0:Kt.tts)==null?void 0:an.defaultVoice)===r.audio.tts.voice?((ln=(jt=i==null?void 0:i.audio)==null?void 0:jt.tts)==null?void 0:ln.voice)??((At=(vn=r==null?void 0:r.audio)==null?void 0:vn.tts)==null?void 0:At.voice):(kn=(hn=r==null?void 0:r.audio)==null?void 0:hn.tts)==null?void 0:kn.voice,fe).catch(Lt=>(console.error(Lt),null));if(Sn){const Lt=await Sn.blob(),Ro=URL.createObjectURL(Lt);kt.set(fe,new Audio(Ro))}}else kt.set(fe,!0)}catch(Sn){console.error("Error synthesizing speech:",Sn)}return kt.get(fe)};let Ot={};const fn=async(fe,qe)=>{for(;!qe.aborted;)if(Ot[fe]&&Ot[fe].length>0){const Ke=Ot[fe].shift();if(kt.has(Ke))if(((i==null?void 0:i.showEmojiInCall)??!1)&&_t.has(Ke)?t(3,R=_t.get(Ke)):t(3,R=null),r.audio.tts.engine!=="")try{`${Ke}`;const nt=kt.get(Ke);await ge(nt),`${Ke}`,await new Promise(wt=>setTimeout(wt,200))}catch(nt){console.error("Error playing audio:",nt)}else await De(Ke);else Ot[fe].unshift(Ke),`${Ke}`,await new Promise(nt=>setTimeout(nt,200))}else if(x[fe]&&Ot[fe]&&Ot[fe].length===0){t(2,P=!1);break}else await new Promise(Ke=>setTimeout(Ke,200));`${fe}`},en=async fe=>{const{id:qe}=fe.detail;M=!0,_e!==qe&&(`${qe}`,_e=qe,at&&at.abort(),at=new AbortController,t(2,P=!0),fn(qe,at.signal))},tn=async fe=>{const{id:qe,content:Ke}=fe.detail;if(_e===qe){`${qe}${Ke}`;try{Ot[qe]===void 0?Ot[qe]=[Ke]:Ot[qe].push(Ke),Dt(Ke)}catch(nt){console.error("Failed to fetch or play audio:",nt)}}},nn=async fe=>{const{id:qe,content:Ke}=fe.detail;x[qe]=!0,M=!1};Qn(async()=>{const fe=async()=>{try{m=await navigator.wakeLock.request("screen")}catch(qe){}m&&m.addEventListener("release",()=>{})};return"wakeLock"in navigator&&(await fe(),document.addEventListener("visibilitychange",async()=>{m!==null&&document.visibilityState==="visible"&&await fe()})),t(0,v=n.find(qe=>qe.id===w)),ne(),d.addEventListener("chat:start",en),d.addEventListener("chat",tn),d.addEventListener("chat:finish",nn),async()=>{await ct(),q(),d.removeEventListener("chat:start",en),d.removeEventListener("chat",tn),d.removeEventListener("chat:finish",nn),at.abort(),await $e(),await ct(),await me(!1),await re()}}),Bo(async()=>{await ct(),await me(!1),await re(),await q(),d.removeEventListener("chat:start",en),d.removeEventListener("chat",tn),d.removeEventListener("chat:finish",nn),at.abort(),await $e(),await ct()});const ve=()=>{P&&ct()},sn=()=>{P&&ct()},Vt=()=>{re()},Jt=async fe=>{fe.detail,t(9,D=fe.detail),await K(),await G()},le=async()=>{await navigator.mediaDevices.getUserMedia({video:!0}),F()},Xe=()=>{P&&ct()},vt=async()=>{await q(),await K(),Wn.set(!1),c("close")};return o.$$set=fe=>{"eventTarget"in fe&&t(21,d=fe.eventTarget),"submitPrompt"in fe&&t(22,f=fe.submitPrompt),"stopResponse"in fe&&t(23,h=fe.stopResponse),"files"in fe&&t(20,p=fe.files),"chatId"in fe&&t(24,b=fe.chatId),"modelId"in fe&&t(25,w=fe.modelId)},[v,y,P,R,k,N,H,J,Y,D,a,l,c,u,F,G,K,re,q,ct,p,d,f,h,b,w,ve,sn,Vt,Jt,le,Xe,vt]}class tm extends We{constructor(e){super(),Ye(this,e,DI,NI,Qe,{eventTarget:21,submitPrompt:22,stopResponse:23,files:20,chatId:24,modelId:25},null,[-1,-1,-1])}}function HI(o){var I,P,R,k,N,M,H,V,Q,J;let e,t,n,r,i,s,a=(((P=(I=o[0])==null?void 0:I.model)==null?void 0:P.name)??((k=(R=o[0])==null?void 0:R.message)==null?void 0:k.model)??"Assistant")+"",l,c,u,d,f,h,p,b,w;t=new Ef({props:{src:((V=(H=(M=(N=o[0])==null?void 0:N.model)==null?void 0:M.info)==null?void 0:H.meta)==null?void 0:V.profile_image_url)??"",className:"size-5 -translate-y-[1px]"}}),d=new Dp({props:{className:"size-3 "+((J=(Q=o[0])==null?void 0:Q.message)!=null&&J.favorite?"fill-red-500 stroke-red-500":"hover:fill-red-500 hover:stroke-red-500")+" ",strokeWidth:"2.5"}});function m(E,Y){var D,W;return(W=(D=E[0])==null?void 0:D.message)!=null&&W.error?BI:LI}let v=m(o),y=v(o);return{c(){e=U("div"),$(t.$$.fragment),n=ie(),r=U("div"),i=U("div"),s=U("div"),l=Oe(a),c=ie(),u=U("button"),$(d.$$.fragment),h=ie(),y.c(),this.h()},l(E){e=L(E,"DIV",{class:!0});var Y=A(e);oe(t.$$.fragment,Y),n=se(Y),r=L(Y,"DIV",{class:!0});var D=A(r);i=L(D,"DIV",{class:!0});var W=A(i);s=L(W,"DIV",{class:!0});var F=A(s);l=Ne(F,a),F.forEach(_),c=se(W),u=L(W,"BUTTON",{class:!0});var G=A(u);oe(d.$$.fragment,G),G.forEach(_),W.forEach(_),h=se(D),y.l(D),D.forEach(_),Y.forEach(_),this.h()},h(){var E,Y;g(s,"class","text-xs text-black dark:text-white font-medium line-clamp-1"),g(u,"class",f=(Y=(E=o[0])==null?void 0:E.message)!=null&&Y.favorite?"":"invisible group-hover:visible"),g(i,"class","flex justify-between items-center"),g(r,"class","ml-2"),g(e,"class","flex w-full")},m(E,Y){z(E,e,Y),ee(t,e,null),S(e,n),S(e,r),S(r,i),S(i,s),S(s,l),S(i,c),S(i,u),ee(d,u,null),S(r,h),y.m(r,null),p=!0,b||(w=Ae(u,"click",o[1]),b=!0)},p(E,Y){var F,G,K,j,re,ue,X,me,ne,q,he,Z;const D={};Y&1&&(D.src=((j=(K=(G=(F=E[0])==null?void 0:F.model)==null?void 0:G.info)==null?void 0:K.meta)==null?void 0:j.profile_image_url)??""),t.$set(D),(!p||Y&1)&&a!==(a=(((ue=(re=E[0])==null?void 0:re.model)==null?void 0:ue.name)??((me=(X=E[0])==null?void 0:X.message)==null?void 0:me.model)??"Assistant")+"")&&Be(l,a);const W={};Y&1&&(W.className="size-3 "+((q=(ne=E[0])==null?void 0:ne.message)!=null&&q.favorite?"fill-red-500 stroke-red-500":"hover:fill-red-500 hover:stroke-red-500")+" "),d.$set(W),(!p||Y&1&&f!==(f=(Z=(he=E[0])==null?void 0:he.message)!=null&&Z.favorite?"":"invisible group-hover:visible"))&&g(u,"class",f),v===(v=m(E))&&y?y.p(E,Y):(y.d(1),y=v(E),y&&(y.c(),y.m(r,null)))},i(E){p||(T(t.$$.fragment,E),T(d.$$.fragment,E),p=!0)},o(E){O(t.$$.fragment,E),O(d.$$.fragment,E),p=!1},d(E){E&&_(e),te(t),te(d),y.d(),b=!1,w()}}}function UI(o){var p,b,w;let e,t,n,r,i,s,a=(((b=(p=o[0])==null?void 0:p.user)==null?void 0:b.name)??"User")+"",l,c,u;t=new Ef({props:{src:((w=o[0].user)==null?void 0:w.profile_image_url)??"/user.png",className:"size-5 -translate-y-[1px]"}});function d(m,v){var y,I;return(I=(y=m[0])==null?void 0:y.message)!=null&&I.error?FI:zI}let f=d(o),h=f(o);return{c(){e=U("div"),$(t.$$.fragment),n=ie(),r=U("div"),i=U("div"),s=U("div"),l=Oe(a),c=ie(),h.c(),this.h()},l(m){e=L(m,"DIV",{class:!0});var v=A(e);oe(t.$$.fragment,v),n=se(v),r=L(v,"DIV",{class:!0});var y=A(r);i=L(y,"DIV",{class:!0});var I=A(i);s=L(I,"DIV",{class:!0});var P=A(s);l=Ne(P,a),P.forEach(_),I.forEach(_),c=se(y),h.l(y),y.forEach(_),v.forEach(_),this.h()},h(){g(s,"class","text-xs text-black dark:text-white font-medium line-clamp-1"),g(i,"class","flex justify-between items-center"),g(r,"class","ml-2"),g(e,"class","flex w-full")},m(m,v){z(m,e,v),ee(t,e,null),S(e,n),S(e,r),S(r,i),S(i,s),S(s,l),S(r,c),h.m(r,null),u=!0},p(m,v){var I,P,R;const y={};v&1&&(y.src=((I=m[0].user)==null?void 0:I.profile_image_url)??"/user.png"),t.$set(y),(!u||v&1)&&a!==(a=(((R=(P=m[0])==null?void 0:P.user)==null?void 0:R.name)??"User")+"")&&Be(l,a),f===(f=d(m))&&h?h.p(m,v):(h.d(1),h=f(m),h&&(h.c(),h.m(r,null)))},i(m){u||(T(t.$$.fragment,m),u=!0)},o(m){O(t.$$.fragment,m),u=!1},d(m){m&&_(e),te(t),h.d()}}}function LI(o){let e,t=o[0].message.content+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","text-gray-500 line-clamp-2 text-xs mt-0.5")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i&1&&t!==(t=r[0].message.content+"")&&Be(n,t)},d(r){r&&_(e)}}}function BI(o){let e,t=o[0].message.error.content+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","text-red-500 line-clamp-2 text-xs mt-0.5")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i&1&&t!==(t=r[0].message.error.content+"")&&Be(n,t)},d(r){r&&_(e)}}}function zI(o){let e,t=o[0].message.content+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","text-gray-500 line-clamp-2 text-xs mt-0.5")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i&1&&t!==(t=r[0].message.content+"")&&Be(n,t)},d(r){r&&_(e)}}}function FI(o){let e,t=o[0].message.error.content+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","text-red-500 line-clamp-2 text-xs mt-0.5")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i&1&&t!==(t=r[0].message.error.content+"")&&Be(n,t)},d(r){r&&_(e)}}}function VI(o){let e,t,n,r;const i=[UI,HI],s=[];function a(l,c){return l[0].message.role==="user"?0:1}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=Ve()},l(l){t.l(l),n=Ve()},m(l,c){s[e].m(l,c),z(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?s[e].p(l,c):(Re(),O(s[u],1,1,()=>{s[u]=null}),Me(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){O(t),r=!1},d(l){l&&_(n),s[e].d(l)}}}function KI(o){var l,c;let e,t,n,r,i,s,a;return t=new Ft({props:{content:(c=(l=o[0])==null?void 0:l.message)!=null&&c.error?o[0].message.error.content:o[0].message.content,class:"w-full",allowHTML:!1,$$slots:{default:[VI]},$$scope:{ctx:o}}}),r=new Ir({props:{type:"target",position:ft.Top,class:"w-2 rounded-full dark:bg-gray-900"}}),s=new Ir({props:{type:"source",position:ft.Bottom,class:"w-2 rounded-full dark:bg-gray-900"}}),{c(){e=U("div"),$(t.$$.fragment),n=ie(),$(r.$$.fragment),i=ie(),$(s.$$.fragment),this.h()},l(u){e=L(u,"DIV",{class:!0});var d=A(e);oe(t.$$.fragment,d),n=se(d),oe(r.$$.fragment,d),i=se(d),oe(s.$$.fragment,d),d.forEach(_),this.h()},h(){g(e,"class","px-4 py-3 shadow-md rounded-xl dark:bg-black bg-white border dark:border-gray-900 w-60 h-20 group")},m(u,d){z(u,e,d),ee(t,e,null),S(e,n),ee(r,e,null),S(e,i),ee(s,e,null),a=!0},p(u,[d]){var h,p;const f={};d&1&&(f.content=(p=(h=u[0])==null?void 0:h.message)!=null&&p.error?u[0].message.error.content:u[0].message.content),d&5&&(f.$$scope={dirty:d,ctx:u}),t.$set(f)},i(u){a||(T(t.$$.fragment,u),T(r.$$.fragment,u),T(s.$$.fragment,u),a=!0)},o(u){O(t.$$.fragment,u),O(r.$$.fragment,u),O(s.$$.fragment,u),a=!1},d(u){u&&_(e),te(t),te(r),te(s)}}}function GI(o,e,t){let{data:n}=e;const r=()=>{var i;t(0,n.message.favorite=!(((i=n==null?void 0:n.message)==null?void 0:i.favorite)??!1),n)};return o.$$set=i=>{"data"in i&&t(0,n=i.data)},[n,r]}class WI extends We{constructor(e){super(),Ye(this,e,GI,KI,Qe,{data:0})}}function YI(o){let e,t,n,r;return e=new HE({props:{showLock:!1}}),n=new jE({props:{variant:So.Dots}}),{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment)},l(i){oe(e.$$.fragment,i),t=se(i),oe(n.$$.fragment,i)},m(i,s){ee(e,i,s),z(i,t,s),ee(n,i,s),r=!0},p:Ue,i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),O(n.$$.fragment,i),r=!1},d(i){i&&_(t),te(e,i),te(n,i)}}}function qI(o){let e,t;return e=new aE({props:{nodes:o[0],nodeTypes:o[1],edges:o[2],fitView:!0,minZoom:.001,colorMode:o[3].includes("dark")||o[3]==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",nodesConnectable:!1,nodesDraggable:!1,oninit:o[5],$$slots:{default:[YI]},$$scope:{ctx:o}}}),e.$on("nodeclick",o[6]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,[r]){const i={};r&1&&(i.nodes=n[0]),r&2&&(i.nodeTypes=n[1]),r&4&&(i.edges=n[2]),r&8&&(i.colorMode=n[3].includes("dark")||n[3]==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),r&128&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function jI(o,e,t){let n;de(o,Cm,u=>t(3,n=u));const r=On();let{nodes:i}=e,{nodeTypes:s}=e,{edges:a}=e;const l=()=>{},c=u=>r("nodeclick",u.detail);return o.$$set=u=>{"nodes"in u&&t(0,i=u.nodes),"nodeTypes"in u&&t(1,s=u.nodeTypes),"edges"in u&&t(2,a=u.edges)},[i,s,a,n,r,l,c]}class QI extends We{constructor(e){super(),Ye(this,e,jI,qI,Qe,{nodes:0,nodeTypes:1,edges:2})}}function XI(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=A(e);t=Ee(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){z(n,e,r),S(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Ue,o:Ue,d(n){n&&_(e)}}}function JI(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class nm extends We{constructor(e){super(),Ye(this,e,JI,XI,Qe,{className:0,strokeWidth:1})}}function jd(o){let e,t;return e=new QI({props:{nodes:o[6],nodeTypes:o[8],edges:o[7]}}),e.$on("nodeclick",o[12]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p:Ue,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function ZI(o){let e,t,n,r,i,s,a,l=o[1].t("Chat Overview")+"",c,u,d,f,h,p,b,w;i=new nm({props:{className:"size-3.5"}}),f=new Es({props:{className:"size-3.5"}});let m=o[2].length>0&&jd(o);return{c(){e=U("div"),t=U("div"),n=U("div"),r=U("button"),$(i.$$.fragment),s=ie(),a=U("div"),c=Oe(l),u=ie(),d=U("button"),$(f.$$.fragment),h=ie(),m&&m.c(),this.h()},l(v){e=L(v,"DIV",{class:!0});var y=A(e);t=L(y,"DIV",{class:!0});var I=A(t);n=L(I,"DIV",{class:!0});var P=A(n);r=L(P,"BUTTON",{class:!0});var R=A(r);oe(i.$$.fragment,R),R.forEach(_),s=se(P),a=L(P,"DIV",{class:!0});var k=A(a);c=Ne(k,l),k.forEach(_),P.forEach(_),u=se(I),d=L(I,"BUTTON",{class:!0});var N=A(d);oe(f.$$.fragment,N),N.forEach(_),I.forEach(_),h=se(y),m&&m.l(y),y.forEach(_),this.h()},h(){g(r,"class","self-center p-0.5"),g(a,"class","text-lg font-medium self-center font-primary"),g(n,"class","flex items-center gap-2.5"),g(d,"class","self-center p-0.5"),g(t,"class","absolute z-50 w-full flex justify-between dark:text-gray-100 px-4 py-3.5"),g(e,"class","w-full h-full relative")},m(v,y){z(v,e,y),S(e,t),S(t,n),S(n,r),ee(i,r,null),S(n,s),S(n,a),S(a,c),S(t,u),S(t,d),ee(f,d,null),S(e,h),m&&m.m(e,null),p=!0,b||(w=[Ae(r,"click",o[10]),Ae(d,"click",o[11])],b=!0)},p(v,[y]){(!p||y&2)&&l!==(l=v[1].t("Chat Overview")+"")&&Be(c,l),v[2].length>0?m?(m.p(v,y),y&4&&T(m,1)):(m=jd(v),m.c(),T(m,1),m.m(e,null)):m&&(Re(),O(m,1,1,()=>{m=null}),Me())},i(v){p||(T(i.$$.fragment,v),T(f.$$.fragment,v),T(m),p=!0)},o(v){O(i.$$.fragment,v),O(f.$$.fragment,v),O(m),p=!1},d(v){v&&_(e),te(i),te(f),m&&m.d(),b=!1,wn(w)}}}function xI(o,e,t){let n,r,i,s;de(o,nr,M=>t(13,n=M)),de(o,bo,M=>t(14,r=M));const a=On(),l=rn("i18n");de(o,l,M=>t(1,i=M));const{width:c,height:u}=$t(),{fitView:d,getViewport:f}=QE(),h=XE();let{history:p}=e,b=null;const w=et([]);de(o,w,M=>t(2,s=M));const m=et([]),v={custom:WI},y=async()=>{b===null?await d({nodes:[{id:p.currentId}]}):await d({nodes:[{id:b}]}),t(0,b=null)},I=async()=>{const M=[],H=[];let J=new Map,E={};Object.keys(p.messages).forEach(Y=>{var F;const D=p.messages[Y],W=D.parentId?(((F=J.get(D.parentId))==null?void 0:F.level)??-1)+1:0;E[W]||(E[W]=0),J.set(Y,{id:D.id,level:W,position:E[W]++})}),Object.keys(p.messages).forEach(Y=>{const D=J.get(Y),W=D.position*250,F=D.level*150,G=W;M.push({id:D.id,type:"custom",data:{user:r,message:p.messages[Y],model:n.find(j=>j.id===p.messages[Y].model)},position:{x:G,y:F}});const K=p.messages[Y].parentId;K&&H.push({id:K+"-"+D.id,source:K,target:D.id,selectable:!1,class:" dark:fill-gray-300 fill-gray-300",type:"smoothstep",animated:p.currentId===Y||P(Y,p.currentId)})}),await m.set([...H]),await w.set([...M])},P=(M,H)=>{const V=p.messages[M];return V.childrenIds&&V.childrenIds.some(Q=>Q===H||P(Q,H))};Qn(()=>{I(),h.subscribe(async M=>{M&&(await $e(),await d({nodes:[{id:p.currentId}]}))}),c.subscribe(M=>{M&&d({nodes:[{id:p.currentId}]})}),u.subscribe(M=>{M&&d({nodes:[{id:p.currentId}]})})}),Bo(()=>{w.set([]),m.set([])});const R=()=>{Co.set(!1)},k=()=>{a("close"),Co.set(!1)},N=M=>{M.detail.node.data,a("nodeclick",M.detail),t(0,b=M.detail.node.data.message.id),d({nodes:[{id:b}]})};return o.$$set=M=>{"history"in M&&t(9,p=M.history)},o.$$.update=()=>{o.$$.dirty&512&&p&&I(),o.$$.dirty&512&&p&&p.currentId&&y()},[b,i,s,a,l,d,w,m,v,p,R,k,N]}class om extends We{constructor(e){super(),Ye(this,e,xI,ZI,Qe,{history:9})}}function $I(o){let e,t;return{c(){e=Ce("svg"),t=Ce("path"),this.h()},l(n){e=Ee(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=A(e);t=Ee(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(t).forEach(_),r.forEach(_),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){z(n,e,r),S(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Ue,o:Ue,d(n){n&&_(e)}}}function e2(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class t2 extends We{constructor(e){super(),Ye(this,e,e2,$I,Qe,{className:0,strokeWidth:1})}}function Qd(o){let e,t,n,r,i,s,a,l,c,u,d,f,h,p=o[5].t("Version {{selectedVersion}} of {{totalVersions}}",{selectedVersion:o[2]+1,totalVersions:o[1].length})+"",b,w,m,v,y,I,P,R,k,N=(o[3]?o[5].t("Copied"):o[5].t("Copy"))+"",M,H,V,Q,J,E,Y,D,W,F;n=new nm({props:{className:"size-3.5  text-gray-900 dark:text-white"}}),V=new Ft({props:{content:o[5].t("Download"),$$slots:{default:[n2]},$$scope:{ctx:o}}});let G=o[1][o[2]].type==="iframe"&&Xd(o);return Y=new Es({props:{className:"size-3.5 text-gray-900 dark:text-white"}}),{c(){e=U("div"),t=U("button"),$(n.$$.fragment),r=ie(),i=U("div"),s=U("div"),a=U("div"),l=U("button"),c=Ce("svg"),u=Ce("path"),f=ie(),h=U("div"),b=Oe(p),w=ie(),m=U("button"),v=Ce("svg"),y=Ce("path"),P=ie(),R=U("div"),k=U("button"),M=Oe(N),H=ie(),$(V.$$.fragment),Q=ie(),G&&G.c(),J=ie(),E=U("button"),$(Y.$$.fragment),this.h()},l(K){e=L(K,"DIV",{class:!0});var j=A(e);t=L(j,"BUTTON",{class:!0});var re=A(t);oe(n.$$.fragment,re),re.forEach(_),r=se(j),i=L(j,"DIV",{class:!0});var ue=A(i);s=L(ue,"DIV",{class:!0});var X=A(s);a=L(X,"DIV",{class:!0,dir:!0});var me=A(a);l=L(me,"BUTTON",{class:!0});var ne=A(l);c=Ee(ne,"svg",{xmlns:!0,fill:!0,viewBox:!0,stroke:!0,"stroke-width":!0,class:!0});var q=A(c);u=Ee(q,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(u).forEach(_),q.forEach(_),ne.forEach(_),f=se(me),h=L(me,"DIV",{class:!0});var he=A(h);b=Ne(he,p),he.forEach(_),w=se(me),m=L(me,"BUTTON",{class:!0});var Z=A(m);v=Ee(Z,"svg",{xmlns:!0,fill:!0,viewBox:!0,stroke:!0,"stroke-width":!0,class:!0});var x=A(v);y=Ee(x,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),A(y).forEach(_),x.forEach(_),Z.forEach(_),me.forEach(_),X.forEach(_),P=se(ue),R=L(ue,"DIV",{class:!0});var _e=A(R);k=L(_e,"BUTTON",{class:!0});var Pe=A(k);M=Ne(Pe,N),Pe.forEach(_),H=se(_e),oe(V.$$.fragment,_e),Q=se(_e),G&&G.l(_e),_e.forEach(_),ue.forEach(_),J=se(j),E=L(j,"BUTTON",{class:!0});var De=A(E);oe(Y.$$.fragment,De),De.forEach(_),j.forEach(_),this.h()},h(){g(t,"class","self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850"),g(u,"stroke-linecap","round"),g(u,"stroke-linejoin","round"),g(u,"d","M15.75 19.5 8.25 12l7.5-7.5"),g(c,"xmlns","http://www.w3.org/2000/svg"),g(c,"fill","none"),g(c,"viewBox","0 0 24 24"),g(c,"stroke","currentColor"),g(c,"stroke-width","2.5"),g(c,"class","size-3.5"),g(l,"class","self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed"),l.disabled=d=o[1].length<=1,g(h,"class","text-xs self-center dark:text-gray-100 min-w-fit"),g(y,"stroke-linecap","round"),g(y,"stroke-linejoin","round"),g(y,"d","m8.25 4.5 7.5 7.5-7.5 7.5"),g(v,"xmlns","http://www.w3.org/2000/svg"),g(v,"fill","none"),g(v,"viewBox","0 0 24 24"),g(v,"stroke","currentColor"),g(v,"stroke-width","2.5"),g(v,"class","size-3.5"),g(m,"class","self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed"),m.disabled=I=o[1].length<=1,g(a,"class","flex items-center gap-0.5 self-center min-w-fit"),g(a,"dir","ltr"),g(s,"class","flex items-center space-x-2"),g(k,"class","copy-code-button bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md px-1.5 py-0.5"),g(R,"class","flex items-center gap-1.5"),g(i,"class","flex-1 flex items-center justify-between pr-1"),g(E,"class","self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850"),g(e,"class","pointer-events-auto z-20 flex justify-between items-center p-2.5 font-primar text-gray-900 dark:text-white")},m(K,j){z(K,e,j),S(e,t),ee(n,t,null),S(e,r),S(e,i),S(i,s),S(s,a),S(a,l),S(l,c),S(c,u),S(a,f),S(a,h),S(h,b),S(a,w),S(a,m),S(m,v),S(v,y),S(i,P),S(i,R),S(R,k),S(k,M),S(R,H),ee(V,R,null),S(R,Q),G&&G.m(R,null),S(e,J),S(e,E),ee(Y,E,null),D=!0,W||(F=[Ae(t,"click",o[14]),Ae(l,"click",o[15]),Ae(m,"click",o[16]),Ae(k,"click",o[17]),Ae(E,"click",o[18])],W=!0)},p(K,j){(!D||j&2&&d!==(d=K[1].length<=1))&&(l.disabled=d),(!D||j&38)&&p!==(p=K[5].t("Version {{selectedVersion}} of {{totalVersions}}",{selectedVersion:K[2]+1,totalVersions:K[1].length})+"")&&Be(b,p),(!D||j&2&&I!==(I=K[1].length<=1))&&(m.disabled=I),(!D||j&40)&&N!==(N=(K[3]?K[5].t("Copied"):K[5].t("Copy"))+"")&&Be(M,N);const re={};j&32&&(re.content=K[5].t("Download")),j&8388608&&(re.$$scope={dirty:j,ctx:K}),V.$set(re),K[1][K[2]].type==="iframe"?G?(G.p(K,j),j&6&&T(G,1)):(G=Xd(K),G.c(),T(G,1),G.m(R,null)):G&&(Re(),O(G,1,1,()=>{G=null}),Me())},i(K){D||(T(n.$$.fragment,K),T(V.$$.fragment,K),T(G),T(Y.$$.fragment,K),D=!0)},o(K){O(n.$$.fragment,K),O(V.$$.fragment,K),O(G),O(Y.$$.fragment,K),D=!1},d(K){K&&_(e),te(n),te(V),G&&G.d(),te(Y),W=!1,wn(F)}}}function n2(o){let e,t,n,r,i;return t=new zp({props:{className:"size-3.5"}}),{c(){e=U("button"),$(t.$$.fragment),this.h()},l(s){e=L(s,"BUTTON",{class:!0});var a=A(e);oe(t.$$.fragment,a),a.forEach(_),this.h()},h(){g(e,"class","bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5")},m(s,a){z(s,e,a),ee(t,e,null),n=!0,r||(i=Ae(e,"click",o[12]),r=!0)},p:Ue,i(s){n||(T(t.$$.fragment,s),n=!0)},o(s){O(t.$$.fragment,s),n=!1},d(s){s&&_(e),te(t),r=!1,i()}}}function Xd(o){let e,t;return e=new Ft({props:{content:o[5].t("Open in full screen"),$$slots:{default:[o2]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&32&&(i.content=n[5].t("Open in full screen")),r&8388608&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function o2(o){let e,t,n,r,i;return t=new t2({props:{className:"size-3.5"}}),{c(){e=U("button"),$(t.$$.fragment),this.h()},l(s){e=L(s,"BUTTON",{class:!0});var a=A(e);oe(t.$$.fragment,a),a.forEach(_),this.h()},h(){g(e,"class","bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5")},m(s,a){z(s,e,a),ee(t,e,null),n=!0,r||(i=Ae(e,"click",o[11]),r=!0)},p:Ue,i(s){n||(T(t.$$.fragment,s),n=!0)},o(s){O(t.$$.fragment,s),n=!1},d(s){s&&_(e),te(t),r=!1,i()}}}function Jd(o){let e;return{c(){e=U("div"),this.h()},l(t){e=L(t,"DIV",{class:!0}),A(e).forEach(_),this.h()},h(){g(e,"class","absolute top-0 left-0 right-0 bottom-0 z-10")},m(t,n){z(t,e,n)},d(t){t&&_(e)}}}function r2(o){let e,t=o[5].t("No HTML, CSS, or JavaScript content found.")+"",n;return{c(){e=U("div"),n=Oe(t),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);n=Ne(i,t),i.forEach(_),this.h()},h(){g(e,"class","m-auto font-medium text-xs text-gray-900 dark:text-white")},m(r,i){z(r,e,i),S(e,n)},p(r,i){i&32&&t!==(t=r[5].t("No HTML, CSS, or JavaScript content found.")+"")&&Be(n,t)},i:Ue,o:Ue,d(r){r&&_(e)}}}function i2(o){let e,t,n,r;const i=[a2,s2],s=[];function a(l,c){return l[1][l[2]].type==="iframe"?0:l[1][l[2]].type==="svg"?1:-1}return~(t=a(o))&&(n=s[t]=i[t](o)),{c(){e=U("div"),n&&n.c(),this.h()},l(l){e=L(l,"DIV",{class:!0});var c=A(e);n&&n.l(c),c.forEach(_),this.h()},h(){g(e,"class","max-w-full w-full h-full")},m(l,c){z(l,e,c),~t&&s[t].m(e,null),r=!0},p(l,c){let u=t;t=a(l),t===u?~t&&s[t].p(l,c):(n&&(Re(),O(s[u],1,1,()=>{s[u]=null}),Me()),~t?(n=s[t],n?n.p(l,c):(n=s[t]=i[t](l),n.c()),T(n,1),n.m(e,null)):n=null)},i(l){r||(T(n),r=!0)},o(l){O(n),r=!1},d(l){l&&_(e),~t&&s[t].d()}}}function s2(o){let e,t;return e=new mm({props:{className:" w-full h-full max-h-full overflow-hidden",svg:o[1][o[2]].content}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r&6&&(i.svg=n[1][n[2]].content),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function a2(o){let e,t,n,r,i;return{c(){e=U("iframe"),this.h()},l(s){e=L(s,"IFRAME",{title:!0,srcdoc:!0,class:!0,sandbox:!0}),A(e).forEach(_),this.h()},h(){var s,a;g(e,"title","Content"),g(e,"srcdoc",t=o[1][o[2]].content),g(e,"class","w-full border-0 h-full rounded-none"),g(e,"sandbox",n="allow-scripts allow-downloads"+(((s=o[6])==null?void 0:s.iframeSandboxAllowForms)??!1?" allow-forms":"")+(((a=o[6])==null?void 0:a.iframeSandboxAllowSameOrigin)??!1?" allow-same-origin":""))},m(s,a){z(s,e,a),o[19](e),r||(i=Ae(e,"load",o[10]),r=!0)},p(s,a){var l,c;a&6&&t!==(t=s[1][s[2]].content)&&g(e,"srcdoc",t),a&64&&n!==(n="allow-scripts allow-downloads"+(((l=s[6])==null?void 0:l.iframeSandboxAllowForms)??!1?" allow-forms":"")+(((c=s[6])==null?void 0:c.iframeSandboxAllowSameOrigin)??!1?" allow-same-origin":""))&&g(e,"sandbox",n)},i:Ue,o:Ue,d(s){s&&_(e),o[19](null),r=!1,i()}}}function l2(o){let e,t,n,r,i,s,a,l,c,u=o[1].length>0&&Qd(o),d=o[0]&&Jd();const f=[i2,r2],h=[];function p(b,w){return b[1].length>0?0:1}return a=p(o),l=h[a]=f[a](o),{c(){e=U("div"),t=U("div"),u&&u.c(),n=ie(),d&&d.c(),r=ie(),i=U("div"),s=U("div"),l.c(),this.h()},l(b){e=L(b,"DIV",{class:!0});var w=A(e);t=L(w,"DIV",{class:!0});var m=A(t);u&&u.l(m),n=se(m),d&&d.l(m),r=se(m),i=L(m,"DIV",{class:!0});var v=A(i);s=L(v,"DIV",{class:!0});var y=A(s);l.l(y),y.forEach(_),v.forEach(_),m.forEach(_),w.forEach(_),this.h()},h(){g(s,"class","h-full flex flex-col"),g(i,"class","flex-1 w-full h-full"),g(t,"class","w-full h-full flex flex-col flex-1 relative"),g(e,"class","w-full h-full relative flex flex-col bg-gray-50 dark:bg-gray-850")},m(b,w){z(b,e,w),S(e,t),u&&u.m(t,null),S(t,n),d&&d.m(t,null),S(t,r),S(t,i),S(i,s),h[a].m(s,null),c=!0},p(b,[w]){b[1].length>0?u?(u.p(b,w),w&2&&T(u,1)):(u=Qd(b),u.c(),T(u,1),u.m(t,n)):u&&(Re(),O(u,1,1,()=>{u=null}),Me()),b[0]?d||(d=Jd(),d.c(),d.m(t,r)):d&&(d.d(1),d=null);let m=a;a=p(b),a===m?h[a].p(b,w):(Re(),O(h[m],1,1,()=>{h[m]=null}),Me(),l=h[a],l?l.p(b,w):(l=h[a]=f[a](b),l.c()),T(l,1),l.m(s,null))},i(b){c||(T(u),T(l),c=!0)},o(b){O(u),O(l),c=!1},d(b){b&&_(e),u&&u.d(),d&&d.d(),h[a].d()}}}function c2(o,e,t){let n,r,i;de(o,qo,H=>t(21,n=H)),de(o,qn,H=>t(6,i=H));const s=rn("i18n");de(o,s,H=>t(5,r=H));const a=On();let{overlay:l=!1}=e,{history:c}=e,u=[],d=[],f=0,h=!1,p;const b=()=>{t(1,d=[]),u.forEach(H=>{if((H==null?void 0:H.role)!=="user"&&(H!=null&&H.content)){const V=H.content.match(/```[\s\S]*?```/g);let Q=[];V&&V.forEach(G=>{const K=G.split(`
`)[0].replace("```","").trim().toLowerCase(),j=G.replace(/```[\s\S]*?\n/,"").replace(/```$/,"");Q.push({lang:K,code:j})});let J="",E="",Y="";Q.forEach(G=>{const{lang:K,code:j}=G;K==="html"?J+=j+`
`:K==="css"?E+=j+`
`:(K==="javascript"||K==="js")&&(Y+=j+`
`)});const D=H.content.match(/<html>[\s\S]*?<\/html>/gi),W=H.content.match(/<style>[\s\S]*?<\/style>/gi),F=H.content.match(/<script>[\s\S]*?<\/script>/gi);if(D&&D.forEach(G=>{const K=G.replace(/<\/?html>/gi,"");J+=K+`
`}),W&&W.forEach(G=>{const K=G.replace(/<\/?style>/gi,"");E+=K+`
`}),F&&F.forEach(G=>{const K=G.replace(/<\/?script>/gi,"");Y+=K+`
`}),J||E||Y){const G=`
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
							<style>
								body {
									background-color: white; /* Ensure the iframe has a white background */
								}

								${E}
							</style>
                        </head>
                        <body>
                            ${J}

							<script>
                            	${Y}
							<\/script>
                        </body>
                        </html>
                    `;t(1,d=[...d,{type:"iframe",content:G}])}else for(const G of Q)(G.lang==="svg"||G.lang==="xml"&&G.code.includes("<svg"))&&t(1,d=[...d,{type:"svg",content:G.code}])}}),d.length===0&&(Zt.set(!1),go.set(!1)),t(2,f=d?d.length-1:0)};function w(H){t(2,f=H==="prev"?Math.max(f-1,0):Math.min(f+1,d.length-1))}const m=()=>{p.contentWindow.addEventListener("click",function(H){const V=H.target.closest("a");if(V&&V.href){H.preventDefault();const Q=new URL(V.href,p.baseURI);Q.origin===window.location.origin?p.contentWindow.history.pushState(null,"",Q.pathname+Q.search+Q.hash):console.info("External navigation blocked:",Q.href)}},!0),p.contentWindow.addEventListener("mouseenter",function(H){H.preventDefault(),p.contentWindow.addEventListener("dragstart",V=>{V.preventDefault()})})},v=()=>{p.requestFullscreen?p.requestFullscreen():p.webkitRequestFullscreen?p.webkitRequestFullscreen():p.msRequestFullscreen&&p.msRequestFullscreen()},y=()=>{const H=new Blob([d[f].content],{type:"text/html"}),V=URL.createObjectURL(H),Q=document.createElement("a");Q.href=V,Q.download=`artifact-${n}-${f}.html`,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),URL.revokeObjectURL(V)};Qn(()=>{Em.subscribe(H=>{if(d){const V=d.findIndex(Q=>Q.content.includes(H));t(2,f=V!==-1?V:0)}})});const I=()=>{go.set(!1)},P=()=>w("prev"),R=()=>w("next"),k=()=>{La(d[f].content),t(3,h=!0),setTimeout(()=>{t(3,h=!1)},2e3)},N=()=>{a("close"),Zt.set(!1),go.set(!1)};function M(H){ze[H?"unshift":"push"](()=>{p=H,t(4,p)})}return o.$$set=H=>{"overlay"in H&&t(0,l=H.overlay),"history"in H&&t(13,c=H.history)},o.$$.update=()=>{o.$$.dirty&8192&&(c?(u=Gn(c,c.currentId),b()):(u=[],b()))},[l,d,f,h,p,r,i,s,a,w,m,v,y,c,I,P,R,k,N,M]}class rm extends We{constructor(e){super(),Ye(this,e,c2,l2,Qe,{overlay:0,history:13})}}function u2(o){let e,t,n,r,i=o[16]&&Zd(o);function s(l){o[37](l)}let a={defaultSize:0,onResize:o[35],onCollapse:o[36],collapsible:!0,class:" z-10 ",$$slots:{default:[_2]},$$scope:{ctx:o}};return o[4]!==void 0&&(a.pane=o[4]),t=new hf({props:a}),ze.push(()=>Ze(t,"pane",s)),{c(){i&&i.c(),e=ie(),$(t.$$.fragment)},l(l){i&&i.l(l),e=se(l),oe(t.$$.fragment,l)},m(l,c){i&&i.m(l,c),z(l,e,c),ee(t,l,c),r=!0},p(l,c){l[16]?i?c[0]&65536&&T(i,1):(i=Zd(l),i.c(),T(i,1),i.m(e.parentNode,e)):i&&(Re(),O(i,1,1,()=>{i=null}),Me());const u={};c[0]&81936&&(u.onResize=l[35]),c[0]&503791|c[1]&4096&&(u.$$scope={dirty:c,ctx:l}),!n&&c[0]&16&&(n=!0,u.pane=l[4],Je(()=>n=!1)),t.$set(u)},i(l){r||(T(i),T(t.$$.fragment,l),r=!0)},o(l){O(i),O(t.$$.fragment,l),r=!1},d(l){l&&_(e),i&&i.d(l),te(t,l)}}}function d2(o){let e,t,n=o[16]&&$d(o);return{c(){n&&n.c(),e=Ve()},l(r){n&&n.l(r),e=Ve()},m(r,i){n&&n.m(r,i),z(r,e,i),t=!0},p(r,i){r[16]?n?(n.p(r,i),i[0]&65536&&T(n,1)):(n=$d(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Re(),O(n,1,1,()=>{n=null}),Me())},i(r){t||(T(n),t=!0)},o(r){O(n),t=!1},d(r){r&&_(e),n&&n.d(r)}}}function Zd(o){let e,t;return e=new bm({props:{class:"relative flex w-2 items-center justify-center bg-background group",$$slots:{default:[f2]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function f2(o){let e,t,n;return t=new Bp({props:{className:"size-4 invisible group-hover:visible"}}),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(r){e=L(r,"DIV",{class:!0});var i=A(e);oe(t.$$.fragment,i),i.forEach(_),this.h()},h(){g(e,"class","z-10 flex h-7 w-5 items-center justify-center rounded-xs")},m(r,i){z(r,e,i),ee(t,e,null),n=!0},p:Ue,i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){O(t.$$.fragment,r),n=!1},d(r){r&&_(e),te(t)}}}function xd(o){let e,t,n,r,i,s;const a=[p2,m2,g2,h2],l=[];function c(u,d){return u[15]?0:u[18]?1:u[17]?2:3}return n=c(o),r=l[n]=a[n](o),{c(){e=U("div"),t=U("div"),r.c(),this.h()},l(u){e=L(u,"DIV",{class:!0});var d=A(e);t=L(d,"DIV",{class:!0});var f=A(t);r.l(f),f.forEach(_),d.forEach(_),this.h()},h(){g(t,"class",i="w-full "+((o[17]||o[18])&&!o[15]?" ":"px-4 py-4 bg-white dark:shadow-lg dark:bg-gray-850  border border-gray-100 dark:border-gray-850")+" z-40 pointer-events-auto overflow-y-auto scrollbar-hidden"),g(e,"class","flex max-h-full min-h-full")},m(u,d){z(u,e,d),S(e,t),l[n].m(t,null),s=!0},p(u,d){let f=n;n=c(u),n===f?l[n].p(u,d):(Re(),O(l[f],1,1,()=>{l[f]=null}),Me(),r=l[n],r?r.p(u,d):(r=l[n]=a[n](u),r.c()),T(r,1),r.m(t,null)),(!s||d[0]&425984&&i!==(i="w-full "+((u[17]||u[18])&&!u[15]?" ":"px-4 py-4 bg-white dark:shadow-lg dark:bg-gray-850  border border-gray-100 dark:border-gray-850")+" z-40 pointer-events-auto overflow-y-auto scrollbar-hidden"))&&g(t,"class",i)},i(u){s||(T(r),s=!0)},o(u){O(r),s=!1},d(u){u&&_(e),l[n].d()}}}function h2(o){let e,t,n,r;function i(l){o[32](l)}function s(l){o[33](l)}let a={models:o[5]};return o[1]!==void 0&&(a.chatFiles=o[1]),o[2]!==void 0&&(a.params=o[2]),e=new em({props:a}),ze.push(()=>Ze(e,"chatFiles",i)),ze.push(()=>Ze(e,"params",s)),e.$on("close",o[34]),{c(){$(e.$$.fragment)},l(l){oe(e.$$.fragment,l)},m(l,c){ee(e,l,c),r=!0},p(l,c){const u={};c[0]&32&&(u.models=l[5]),!t&&c[0]&2&&(t=!0,u.chatFiles=l[1],Je(()=>t=!1)),!n&&c[0]&4&&(n=!0,u.params=l[2],Je(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){O(e.$$.fragment,l),r=!1},d(l){te(e,l)}}}function g2(o){let e,t;return e=new om({props:{history:o[0]}}),e.$on("nodeclick",o[30]),e.$on("close",o[31]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function m2(o){let e,t;return e=new rm({props:{history:o[0],overlay:o[13]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),r[0]&8192&&(i.overlay=n[13]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function p2(o){let e,t,n,r;function i(a){o[28](a)}let s={submitPrompt:o[8],stopResponse:o[9],modelId:o[11],chatId:o[6],eventTarget:o[7]};return o[3]!==void 0&&(s.files=o[3]),t=new tm({props:s}),ze.push(()=>Ze(t,"files",i)),t.$on("close",o[29]),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(a){e=L(a,"DIV",{class:!0});var l=A(e);oe(t.$$.fragment,l),l.forEach(_),this.h()},h(){g(e,"class","w-full h-full flex justify-center")},m(a,l){z(a,e,l),ee(t,e,null),r=!0},p(a,l){const c={};l[0]&256&&(c.submitPrompt=a[8]),l[0]&512&&(c.stopResponse=a[9]),l[0]&2048&&(c.modelId=a[11]),l[0]&64&&(c.chatId=a[6]),l[0]&128&&(c.eventTarget=a[7]),!n&&l[0]&8&&(n=!0,c.files=a[3],Je(()=>n=!1)),t.$set(c)},i(a){r||(T(t.$$.fragment,a),r=!0)},o(a){O(t.$$.fragment,a),r=!1},d(a){a&&_(e),te(t)}}}function _2(o){let e,t,n=o[16]&&xd(o);return{c(){n&&n.c(),e=Ve()},l(r){n&&n.l(r),e=Ve()},m(r,i){n&&n.m(r,i),z(r,e,i),t=!0},p(r,i){r[16]?n?(n.p(r,i),i[0]&65536&&T(n,1)):(n=xd(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Re(),O(n,1,1,()=>{n=null}),Me())},i(r){t||(T(n),t=!0)},o(r){O(n),t=!1},d(r){r&&_(e),n&&n.d(r)}}}function $d(o){let e,t;return e=new Lp({props:{show:o[16],onClose:o[27],$$slots:{default:[k2]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&65536&&(i.show=n[16]),r[0]&430063|r[1]&4096&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function b2(o){let e,t,n,r;function i(l){o[24](l)}function s(l){o[25](l)}let a={models:o[5]};return o[1]!==void 0&&(a.chatFiles=o[1]),o[2]!==void 0&&(a.params=o[2]),e=new em({props:a}),ze.push(()=>Ze(e,"chatFiles",i)),ze.push(()=>Ze(e,"params",s)),e.$on("close",o[26]),{c(){$(e.$$.fragment)},l(l){oe(e.$$.fragment,l)},m(l,c){ee(e,l,c),r=!0},p(l,c){const u={};c[0]&32&&(u.models=l[5]),!t&&c[0]&2&&(t=!0,u.chatFiles=l[1],Je(()=>t=!1)),!n&&c[0]&4&&(n=!0,u.params=l[2],Je(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){O(e.$$.fragment,l),r=!1},d(l){te(e,l)}}}function y2(o){let e,t;return e=new om({props:{history:o[0]}}),e.$on("nodeclick",o[22]),e.$on("close",o[23]),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function w2(o){let e,t;return e=new rm({props:{history:o[0]}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function v2(o){let e,t,n,r;function i(a){o[20](a)}let s={submitPrompt:o[8],stopResponse:o[9],modelId:o[11],chatId:o[6],eventTarget:o[7]};return o[3]!==void 0&&(s.files=o[3]),t=new tm({props:s}),ze.push(()=>Ze(t,"files",i)),t.$on("close",o[21]),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(a){e=L(a,"DIV",{class:!0});var l=A(e);oe(t.$$.fragment,l),l.forEach(_),this.h()},h(){g(e,"class","h-full max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center")},m(a,l){z(a,e,l),ee(t,e,null),r=!0},p(a,l){const c={};l[0]&256&&(c.submitPrompt=a[8]),l[0]&512&&(c.stopResponse=a[9]),l[0]&2048&&(c.modelId=a[11]),l[0]&64&&(c.chatId=a[6]),l[0]&128&&(c.eventTarget=a[7]),!n&&l[0]&8&&(n=!0,c.files=a[3],Je(()=>n=!1)),t.$set(c)},i(a){r||(T(t.$$.fragment,a),r=!0)},o(a){O(t.$$.fragment,a),r=!1},d(a){a&&_(e),te(t)}}}function k2(o){let e,t,n,r,i;const s=[v2,w2,y2,b2],a=[];function l(c,u){return c[15]?0:c[18]?1:c[17]?2:3}return t=l(o),n=a[t]=s[t](o),{c(){e=U("div"),n.c(),this.h()},l(c){e=L(c,"DIV",{class:!0});var u=A(e);n.l(u),u.forEach(_),this.h()},h(){g(e,"class",r=(o[15]||o[17]||o[18]?" h-screen  w-full":"px-6 py-4")+" h-full")},m(c,u){z(c,e,u),a[t].m(e,null),i=!0},p(c,u){let d=t;t=l(c),t===d?a[t].p(c,u):(Re(),O(a[d],1,1,()=>{a[d]=null}),Me(),n=a[t],n?n.p(c,u):(n=a[t]=s[t](c),n.c()),T(n,1),n.m(e,null)),(!i||u[0]&425984&&r!==(r=(c[15]||c[17]||c[18]?" h-screen  w-full":"px-6 py-4")+" h-full"))&&g(e,"class",r)},i(c){i||(T(n),i=!0)},o(c){O(n),i=!1},d(c){c&&_(e),a[t].d()}}}function C2(o){let e,t,n,r;const i=[d2,u2],s=[];function a(l,c){return l[12]?1:0}return e=a(o),t=s[e]=i[e](o),{c(){t.c(),n=Ve()},l(l){t.l(l),n=Ve()},m(l,c){s[e].m(l,c),z(l,n,c),r=!0},p(l,c){let u=e;e=a(l),e===u?s[e].p(l,c):(Re(),O(s[u],1,1,()=>{s[u]=null}),Me(),t=s[e],t?t.p(l,c):(t=s[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){O(t),r=!1},d(l){l&&_(n),s[e].d(l)}}}function E2(o){let e,t;return e=new uE({props:{$$slots:{default:[C2]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&524287|r[1]&4096&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function I2(o,e,t){let n,r,i,s;de(o,Wn,x=>t(15,n=x)),de(o,Zt,x=>t(16,r=x)),de(o,Co,x=>t(17,i=x)),de(o,go,x=>t(18,s=x));let{history:a}=e,{models:l=[]}=e,{chatId:c=null}=e,{chatFiles:u=[]}=e,{params:d={}}=e,{eventTarget:f}=e,{submitPrompt:h}=e,{stopResponse:p}=e,{showMessage:b}=e,{files:w}=e,{modelId:m}=e,{pane:v}=e,y,I=!1,P=!1,R=0;const k=()=>{parseInt(localStorage==null?void 0:localStorage.chatControlsSize)?v.resize(parseInt(localStorage==null?void 0:localStorage.chatControlsSize)):v.resize(R)},N=async x=>{x.matches?(t(12,I=!0),n&&(Wn.set(!1),await $e(),Wn.set(!0))):(t(12,I=!1),n&&(Wn.set(!1),await $e(),Wn.set(!0)),t(4,v=null))},M=x=>{t(13,P=!0)},H=x=>{t(13,P=!1)};Qn(()=>{y=window.matchMedia("(min-width: 1024px)"),y.addEventListener("change",N),N(y);const x=document.getElementById("chat-container");t(14,R=Math.floor(350/x.clientWidth*100)),new ResizeObserver(Pe=>{for(let De of Pe){const ct=350/De.contentRect.width*100;t(14,R=Math.floor(ct)),r&&v&&v.isExpanded()&&v.getSize()<R&&v.resize(R)}}).observe(x),document.addEventListener("mousedown",M),document.addEventListener("mouseup",H)}),Bo(()=>{Zt.set(!1),y.removeEventListener("change",N),document.removeEventListener("mousedown",M),document.removeEventListener("mouseup",H)});const V=()=>{Zt.set(!1),Co.set(!1),go.set(!1),n&&Wn.set(!1)};function Q(x){w=x,t(3,w)}const J=()=>{Zt.set(!1)},E=x=>{b(x.detail.node.data.message)},Y=()=>{Zt.set(!1)};function D(x){u=x,t(1,u)}function W(x){d=x,t(2,d)}const F=()=>{Zt.set(!1)},G=()=>{Zt.set(!1)};function K(x){w=x,t(3,w)}const j=()=>{Zt.set(!1)},re=x=>{x.detail.node.data.message.favorite?t(0,a.messages[x.detail.node.data.message.id].favorite=!0,a):t(0,a.messages[x.detail.node.data.message.id].favorite=null,a),b(x.detail.node.data.message)},ue=()=>{Zt.set(!1)};function X(x){u=x,t(1,u)}function me(x){d=x,t(2,d)}const ne=()=>{Zt.set(!1)},q=x=>{r&&v.isExpanded()&&(x<R&&v.resize(R),x<R?localStorage.chatControlsSize=0:localStorage.chatControlsSize=x)},he=()=>{Zt.set(!1)};function Z(x){v=x,t(4,v)}return o.$$set=x=>{"history"in x&&t(0,a=x.history),"models"in x&&t(5,l=x.models),"chatId"in x&&t(6,c=x.chatId),"chatFiles"in x&&t(1,u=x.chatFiles),"params"in x&&t(2,d=x.params),"eventTarget"in x&&t(7,f=x.eventTarget),"submitPrompt"in x&&t(8,h=x.submitPrompt),"stopResponse"in x&&t(9,p=x.stopResponse),"showMessage"in x&&t(10,b=x.showMessage),"files"in x&&t(3,w=x.files),"modelId"in x&&t(11,m=x.modelId),"pane"in x&&t(4,v=x.pane)},o.$$.update=()=>{o.$$.dirty[0]&64&&(c||V())},[a,u,d,w,v,l,c,f,h,p,b,m,I,P,R,n,r,i,s,k,Q,J,E,Y,D,W,F,G,K,j,re,ue,X,me,ne,q,he,Z]}class T2 extends We{constructor(e){super(),Ye(this,e,I2,E2,Qe,{history:0,models:5,chatId:6,chatFiles:1,params:2,eventTarget:7,submitPrompt:8,stopResponse:9,showMessage:10,files:3,modelId:11,pane:4,openPane:19},null,[-1,-1])}get openPane(){return this.$$.ctx[19]}}function ef(o,e,t){const n=o.slice();return n[39]=e[t],n[41]=t,n}function tf(o){let e,t;return e=new Ft({props:{content:o[17].t("This chat won't appear in history and your messages will not be saved."),className:"w-full flex justify-center mb-0.5",placement:"top",$$slots:{default:[S2]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,r){ee(e,n,r),t=!0},p(n,r){const i={};r[0]&131072&&(i.content=n[17].t("This chat won't appear in history and your messages will not be saved.")),r[0]&131072|r[1]&2048&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function S2(o){let e,t,n=o[17].t("Temporary Chat")+"",r,i;return t=new Vp({props:{strokeWidth:"2.5",className:"size-5"}}),{c(){e=U("div"),$(t.$$.fragment),r=Oe(n),this.h()},l(s){e=L(s,"DIV",{class:!0});var a=A(e);oe(t.$$.fragment,a),r=Ne(a,n),a.forEach(_),this.h()},h(){g(e,"class","flex items-center gap-2 text-gray-500 font-medium text-lg my-2 w-fit")},m(s,a){z(s,e,a),ee(t,e,null),S(e,r),i=!0},p(s,a){(!i||a[0]&131072)&&n!==(n=s[17].t("Temporary Chat")+"")&&Be(r,n)},i(s){i||(T(t.$$.fragment,s),i=!0)},o(s){O(t.$$.fragment,s),i=!1},d(s){s&&_(e),te(t)}}}function A2(o){let e,t,n,r,i,s;function a(){return o[25](o[41])}return{c(){e=U("button"),t=U("img"),r=ie(),this.h()},l(l){e=L(l,"BUTTON",{});var c=A(e);t=L(c,"IMG",{crossorigin:!0,src:!0,class:!0,alt:!0,draggable:!0}),c.forEach(_),r=se(l),this.h()},h(){var l,c,u;g(t,"crossorigin","anonymous"),oo(t.src,n=((u=(c=(l=o[39])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.profile_image_url)??(o[17].language==="dg-DG"?"/doge.png":`${gi}/static/favicon.png`))||g(t,"src",n),g(t,"class","size-9 @sm:size-10 rounded-full border-[1px] border-gray-100 dark:border-none"),g(t,"alt","logo"),g(t,"draggable","false")},m(l,c){z(l,e,c),S(e,t),z(l,r,c),i||(s=Ae(e,"click",a),i=!0)},p(l,c){var u,d,f;o=l,c[0]&163840&&!oo(t.src,n=((f=(d=(u=o[39])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url)??(o[17].language==="dg-DG"?"/doge.png":`${gi}/static/favicon.png`))&&g(t,"src",n)},d(l){l&&(_(e),_(r)),i=!1,s()}}}function nf(o){var n,r,i;let e,t;return e=new Ft({props:{content:(((i=(r=(n=o[15][o[41]])==null?void 0:n.info)==null?void 0:r.meta)==null?void 0:i.tags)??[]).map(sf).join(", "),placement:"top",$$slots:{default:[A2]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,a){ee(e,s,a),t=!0},p(s,a){var c,u,d;const l={};a[0]&32768&&(l.content=(((d=(u=(c=s[15][s[41]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.tags)??[]).map(sf).join(", ")),a[0]&229376|a[1]&2048&&(l.$$scope={dirty:a,ctx:s}),e.$set(l)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){O(e.$$.fragment,s),t=!1},d(s){te(e,s)}}}function R2(o){var n;let e=o[17].t("Hello, {{name}}",{name:(n=o[19])==null?void 0:n.name})+"",t;return{c(){t=Oe(e)},l(r){t=Ne(r,e)},m(r,i){z(r,t,i)},p(r,i){var s;i[0]&655360&&e!==(e=r[17].t("Hello, {{name}}",{name:(s=r[19])==null?void 0:s.name})+"")&&Be(t,e)},i:Ue,o:Ue,d(r){r&&_(t)}}}function M2(o){var n;let e,t;return e=new Ft({props:{content:(n=o[15][o[16]])==null?void 0:n.name,placement:"top",className:" flex items-center ",$$slots:{default:[P2]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(r){oe(e.$$.fragment,r)},m(r,i){ee(e,r,i),t=!0},p(r,i){var a;const s={};i[0]&98304&&(s.content=(a=r[15][r[16]])==null?void 0:a.name),i[0]&98304|i[1]&2048&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){t||(T(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){te(e,r)}}}function P2(o){var r;let e,t=((r=o[15][o[16]])==null?void 0:r.name)+"",n;return{c(){e=U("span"),n=Oe(t),this.h()},l(i){e=L(i,"SPAN",{class:!0});var s=A(e);n=Ne(s,t),s.forEach(_),this.h()},h(){g(e,"class","line-clamp-1")},m(i,s){z(i,e,s),S(e,n)},p(i,s){var a;s[0]&98304&&t!==(t=((a=i[15][i[16]])==null?void 0:a.name)+"")&&Be(n,t)},d(i){i&&_(e)}}}function of(o){var s,a,l,c,u,d;let e,t,n,r;e=new Ft({props:{className:" w-fit",content:br.parse(es(((l=(a=(s=o[15][o[16]])==null?void 0:s.info)==null?void 0:a.meta)==null?void 0:l.description)??"")),placement:"top",$$slots:{default:[O2]},$$scope:{ctx:o}}});let i=((d=(u=(c=o[15][o[16]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.user)&&rf(o);return{c(){$(e.$$.fragment),t=ie(),i&&i.c(),n=Ve()},l(f){oe(e.$$.fragment,f),t=se(f),i&&i.l(f),n=Ve()},m(f,h){ee(e,f,h),z(f,t,h),i&&i.m(f,h),z(f,n,h),r=!0},p(f,h){var b,w,m,v,y,I;const p={};h[0]&98304&&(p.content=br.parse(es(((m=(w=(b=f[15][f[16]])==null?void 0:b.info)==null?void 0:w.meta)==null?void 0:m.description)??""))),h[0]&98304|h[1]&2048&&(p.$$scope={dirty:h,ctx:f}),e.$set(p),(I=(y=(v=f[15][f[16]])==null?void 0:v.info)==null?void 0:y.meta)!=null&&I.user?i?i.p(f,h):(i=rf(f),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},i(f){r||(T(e.$$.fragment,f),r=!0)},o(f){O(e.$$.fragment,f),r=!1},d(f){f&&(_(t),_(n)),te(e,f),i&&i.d(f)}}}function O2(o){var r,i,s;let e,t,n=br.parse(es((s=(i=(r=o[15][o[16]])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:s.description))+"";return{c(){e=U("div"),t=new lf(!1),this.h()},l(a){e=L(a,"DIV",{class:!0});var l=A(e);t=cf(l,!1),l.forEach(_),this.h()},h(){t.a=null,g(e,"class","mt-0.5 px-2 text-sm font-normal text-gray-500 dark:text-gray-400 line-clamp-2 max-w-xl markdown")},m(a,l){z(a,e,l),t.m(n,e)},p(a,l){var c,u,d;l[0]&98304&&n!==(n=br.parse(es((d=(u=(c=a[15][a[16]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.description))+"")&&t.p(n)},d(a){a&&_(e)}}}function rf(o){let e,t;function n(s,a){var l,c,u;return(u=(c=(l=s[15][s[16]])==null?void 0:l.info)==null?void 0:c.meta)!=null&&u.user.community?D2:N2}let r=n(o),i=r(o);return{c(){e=U("div"),t=Oe(`By
								`),i.c(),this.h()},l(s){e=L(s,"DIV",{class:!0});var a=A(e);t=Ne(a,`By
								`),i.l(a),a.forEach(_),this.h()},h(){g(e,"class","mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500")},m(s,a){z(s,e,a),S(e,t),i.m(e,null)},p(s,a){r===(r=n(s))&&i?i.p(s,a):(i.d(1),i=r(s),i&&(i.c(),i.m(e,null)))},d(s){s&&_(e),i.d()}}}function N2(o){var n,r,i;let e=((i=(r=(n=o[15][o[16]])==null?void 0:n.info)==null?void 0:r.meta)==null?void 0:i.user.name)+"",t;return{c(){t=Oe(e)},l(s){t=Ne(s,e)},m(s,a){z(s,t,a)},p(s,a){var l,c,u;a[0]&98304&&e!==(e=((u=(c=(l=s[15][s[16]])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.user.name)+"")&&Be(t,e)},d(s){s&&_(t)}}}function D2(o){var i,s,a,l,c,u,d,f,h;let e,t=((a=(s=(i=o[15][o[16]])==null?void 0:i.info)==null?void 0:s.meta)!=null&&a.user.name?(u=(c=(l=o[15][o[16]])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.user.name:`@${(h=(f=(d=o[15][o[16]])==null?void 0:d.info)==null?void 0:f.meta)==null?void 0:h.user.username}`)+"",n,r;return{c(){e=U("a"),n=Oe(t),this.h()},l(p){e=L(p,"A",{href:!0});var b=A(e);n=Ne(b,t),b.forEach(_),this.h()},h(){var p,b,w;g(e,"href",r="https://openwebui.com/m/"+((w=(b=(p=o[15][o[16]])==null?void 0:p.info)==null?void 0:b.meta)==null?void 0:w.user.username))},m(p,b){z(p,e,b),S(e,n)},p(p,b){var w,m,v,y,I,P,R,k,N,M,H,V;b[0]&98304&&t!==(t=((v=(m=(w=p[15][p[16]])==null?void 0:w.info)==null?void 0:m.meta)!=null&&v.user.name?(P=(I=(y=p[15][p[16]])==null?void 0:y.info)==null?void 0:I.meta)==null?void 0:P.user.name:`@${(N=(k=(R=p[15][p[16]])==null?void 0:R.info)==null?void 0:k.meta)==null?void 0:N.user.username}`)+"")&&Be(n,t),b[0]&98304&&r!==(r="https://openwebui.com/m/"+((V=(H=(M=p[15][p[16]])==null?void 0:M.info)==null?void 0:H.meta)==null?void 0:V.user.username))&&g(e,"href",r)},d(p){p&&_(e)}}}function H2(o){var Dt,Ot,fn,en,tn,nn,ve,sn,Vt,Jt;let e,t,n,r,i,s,a,l,c,u,d,f,h,p,b,w,m,v,y,I,P,R,k,N,M,H,V,Q,J,E,Y,D,W,F,G,K,j=o[18]&&tf(o),re=yt(o[15]),ue=[];for(let le=0;le<re.length;le+=1)ue[le]=nf(ef(o,re,le));const X=le=>O(ue[le],1,1,()=>{ue[le]=null}),me=[M2,R2],ne=[];function q(le,Xe){var vt;return(vt=le[15][le[16]])!=null&&vt.name?0:1}d=q(o),f=ne[d]=me[d](o);let he=(((fn=(Ot=(Dt=o[15][o[16]])==null?void 0:Dt.info)==null?void 0:Ot.meta)==null?void 0:fn.description)??null)&&of(o);function Z(le){o[27](le)}function x(le){o[28](le)}function _e(le){o[29](le)}function Pe(le){o[30](le)}function De(le){o[31](le)}function ge(le){o[32](le)}function ct(le){o[33](le)}function at(le){o[34](le)}function kt(le){o[35](le)}let _t={history:o[13],selectedModels:o[12],toolServers:o[14],transparentBackground:o[9],stopResponse:o[11],createMessagePair:o[10],placeholder:o[17].t("How can I help you today?"),onChange:o[26]};return o[3]!==void 0&&(_t.files=o[3]),o[2]!==void 0&&(_t.prompt=o[2]),o[0]!==void 0&&(_t.autoScroll=o[0]),o[4]!==void 0&&(_t.selectedToolIds=o[4]),o[5]!==void 0&&(_t.selectedFilterIds=o[5]),o[6]!==void 0&&(_t.imageGenerationEnabled=o[6]),o[7]!==void 0&&(_t.codeInterpreterEnabled=o[7]),o[8]!==void 0&&(_t.webSearchEnabled=o[8]),o[1]!==void 0&&(_t.atSelectedModel=o[1]),I=new yg({props:_t}),ze.push(()=>Ze(I,"files",Z)),ze.push(()=>Ze(I,"prompt",x)),ze.push(()=>Ze(I,"autoScroll",_e)),ze.push(()=>Ze(I,"selectedToolIds",Pe)),ze.push(()=>Ze(I,"selectedFilterIds",De)),ze.push(()=>Ze(I,"imageGenerationEnabled",ge)),ze.push(()=>Ze(I,"codeInterpreterEnabled",ct)),ze.push(()=>Ze(I,"webSearchEnabled",at)),ze.push(()=>Ze(I,"atSelectedModel",kt)),I.$on("upload",o[36]),I.$on("submit",o[37]),F=new _p({props:{suggestionPrompts:((nn=(tn=(en=o[1])==null?void 0:en.info)==null?void 0:tn.meta)==null?void 0:nn.suggestion_prompts)??((Vt=(sn=(ve=o[15][o[16]])==null?void 0:ve.info)==null?void 0:sn.meta)==null?void 0:Vt.suggestion_prompts)??((Jt=o[20])==null?void 0:Jt.default_prompt_suggestions)??[],inputValue:o[2]}}),F.$on("select",o[38]),{c(){e=U("div"),j&&j.c(),t=ie(),n=U("div"),r=U("div"),i=U("div"),s=U("div"),a=U("div");for(let le=0;le<ue.length;le+=1)ue[le].c();c=ie(),u=U("div"),f.c(),p=ie(),b=U("div"),w=U("div"),he&&he.c(),v=ie(),y=U("div"),$(I.$$.fragment),Y=ie(),D=U("div"),W=U("div"),$(F.$$.fragment),this.h()},l(le){e=L(le,"DIV",{class:!0});var Xe=A(e);j&&j.l(Xe),t=se(Xe),n=L(Xe,"DIV",{class:!0});var vt=A(n);r=L(vt,"DIV",{class:!0});var fe=A(r);i=L(fe,"DIV",{class:!0});var qe=A(i);s=L(qe,"DIV",{class:!0});var Ke=A(s);a=L(Ke,"DIV",{class:!0});var nt=A(a);for(let ln=0;ln<ue.length;ln+=1)ue[ln].l(nt);nt.forEach(_),Ke.forEach(_),c=se(qe),u=L(qe,"DIV",{class:!0});var wt=A(u);f.l(wt),wt.forEach(_),qe.forEach(_),p=se(fe),b=L(fe,"DIV",{class:!0});var pt=A(b);w=L(pt,"DIV",{});var Mt=A(w);he&&he.l(Mt),Mt.forEach(_),pt.forEach(_),v=se(fe),y=L(fe,"DIV",{class:!0});var Kt=A(y);oe(I.$$.fragment,Kt),Kt.forEach(_),fe.forEach(_),vt.forEach(_),Y=se(Xe),D=L(Xe,"DIV",{class:!0});var an=A(D);W=L(an,"DIV",{class:!0});var jt=A(W);oe(F.$$.fragment,jt),jt.forEach(_),an.forEach(_),Xe.forEach(_),this.h()},h(){g(a,"class","flex -space-x-4 mb-0.5"),g(s,"class","flex shrink-0 justify-center"),g(u,"class","text-3xl @sm:text-3xl line-clamp-1 flex items-center"),g(i,"class","flex flex-row justify-center gap-3 @sm:gap-3.5 w-fit px-5 max-w-xl"),g(b,"class","flex mt-1 mb-2"),g(y,"class",E="text-base font-normal @md:max-w-3xl w-full py-3 "+(o[1]?"mt-2":"")),g(r,"class","w-full flex flex-col justify-center items-center"),g(n,"class","w-full text-3xl text-gray-800 dark:text-gray-100 text-center flex items-center gap-4 font-primary"),g(W,"class","mx-5"),g(D,"class","mx-auto max-w-2xl font-primary mt-2"),g(e,"class","m-auto w-full max-w-6xl px-2 @2xl:px-20 translate-y-6 py-24 text-center")},m(le,Xe){z(le,e,Xe),j&&j.m(e,null),S(e,t),S(e,n),S(n,r),S(r,i),S(i,s),S(s,a);for(let vt=0;vt<ue.length;vt+=1)ue[vt]&&ue[vt].m(a,null);S(i,c),S(i,u),ne[d].m(u,null),S(r,p),S(r,b),S(b,w),he&&he.m(w,null),S(r,v),S(r,y),ee(I,y,null),S(e,Y),S(e,D),S(D,W),ee(F,W,null),K=!0},p(le,Xe){var Ke,nt,wt,pt,Mt,Kt,an,jt,ln,vn;if(le[18]?j?(j.p(le,Xe),Xe[0]&262144&&T(j,1)):(j=tf(le),j.c(),T(j,1),j.m(e,t)):j&&(Re(),O(j,1,1,()=>{j=null}),Me()),Xe[0]&229376){re=yt(le[15]);let At;for(At=0;At<re.length;At+=1){const hn=ef(le,re,At);ue[At]?(ue[At].p(hn,Xe),T(ue[At],1)):(ue[At]=nf(hn),ue[At].c(),T(ue[At],1),ue[At].m(a,null))}for(Re(),At=re.length;At<ue.length;At+=1)X(At);Me()}let vt=d;d=q(le),d===vt?ne[d].p(le,Xe):(Re(),O(ne[vt],1,1,()=>{ne[vt]=null}),Me(),f=ne[d],f?f.p(le,Xe):(f=ne[d]=me[d](le),f.c()),T(f,1),f.m(u,null)),((wt=(nt=(Ke=le[15][le[16]])==null?void 0:Ke.info)==null?void 0:nt.meta)==null?void 0:wt.description)??null?he?(he.p(le,Xe),Xe[0]&98304&&T(he,1)):(he=of(le),he.c(),T(he,1),he.m(w,null)):he&&(Re(),O(he,1,1,()=>{he=null}),Me());const fe={};Xe[0]&8192&&(fe.history=le[13]),Xe[0]&4096&&(fe.selectedModels=le[12]),Xe[0]&16384&&(fe.toolServers=le[14]),Xe[0]&512&&(fe.transparentBackground=le[9]),Xe[0]&2048&&(fe.stopResponse=le[11]),Xe[0]&1024&&(fe.createMessagePair=le[10]),Xe[0]&131072&&(fe.placeholder=le[17].t("How can I help you today?")),Xe[0]&262144&&(fe.onChange=le[26]),!P&&Xe[0]&8&&(P=!0,fe.files=le[3],Je(()=>P=!1)),!R&&Xe[0]&4&&(R=!0,fe.prompt=le[2],Je(()=>R=!1)),!k&&Xe[0]&1&&(k=!0,fe.autoScroll=le[0],Je(()=>k=!1)),!N&&Xe[0]&16&&(N=!0,fe.selectedToolIds=le[4],Je(()=>N=!1)),!M&&Xe[0]&32&&(M=!0,fe.selectedFilterIds=le[5],Je(()=>M=!1)),!H&&Xe[0]&64&&(H=!0,fe.imageGenerationEnabled=le[6],Je(()=>H=!1)),!V&&Xe[0]&128&&(V=!0,fe.codeInterpreterEnabled=le[7],Je(()=>V=!1)),!Q&&Xe[0]&256&&(Q=!0,fe.webSearchEnabled=le[8],Je(()=>Q=!1)),!J&&Xe[0]&2&&(J=!0,fe.atSelectedModel=le[1],Je(()=>J=!1)),I.$set(fe),(!K||Xe[0]&2&&E!==(E="text-base font-normal @md:max-w-3xl w-full py-3 "+(le[1]?"mt-2":"")))&&g(y,"class",E);const qe={};Xe[0]&1146882&&(qe.suggestionPrompts=((Kt=(Mt=(pt=le[1])==null?void 0:pt.info)==null?void 0:Mt.meta)==null?void 0:Kt.suggestion_prompts)??((ln=(jt=(an=le[15][le[16]])==null?void 0:an.info)==null?void 0:jt.meta)==null?void 0:ln.suggestion_prompts)??((vn=le[20])==null?void 0:vn.default_prompt_suggestions)??[]),Xe[0]&4&&(qe.inputValue=le[2]),F.$set(qe)},i(le){if(!K){T(j);for(let Xe=0;Xe<re.length;Xe+=1)T(ue[Xe]);le&&(l||Po(()=>{l=si(a,ai,{duration:100}),l.start()})),T(f),le&&(h||Po(()=>{h=si(u,ai,{duration:100}),h.start()})),T(he),le&&(m||Po(()=>{m=si(w,ai,{duration:100,delay:50}),m.start()})),T(I.$$.fragment,le),T(F.$$.fragment,le),le&&(G||Po(()=>{G=si(D,ai,{duration:200,delay:200}),G.start()})),K=!0}},o(le){O(j),ue=ue.filter(Boolean);for(let Xe=0;Xe<ue.length;Xe+=1)O(ue[Xe]);O(f),O(he),O(I.$$.fragment,le),O(F.$$.fragment,le),K=!1},d(le){le&&_(e),j&&j.d(),Hn(ue,le),ne[d].d(),he&&he.d(),te(I),te(F)}}}const sf=o=>o.name.toUpperCase();function U2(o,e,t){let n,r,i,s,a;de(o,nr,ne=>t(24,n=ne)),de(o,mi,ne=>t(18,i=ne)),de(o,bo,ne=>t(19,s=ne)),de(o,Ar,ne=>t(20,a=ne));const l=On(),c=rn("i18n");de(o,c,ne=>t(17,r=ne));let{transparentBackground:u=!1}=e,{createMessagePair:d}=e,{stopResponse:f}=e,{autoScroll:h=!1}=e,{atSelectedModel:p}=e,{selectedModels:b}=e,{history:w}=e,{prompt:m=""}=e,{files:v=[]}=e,{selectedToolIds:y=[]}=e,{selectedFilterIds:I=[]}=e,{imageGenerationEnabled:P=!1}=e,{codeInterpreterEnabled:R=!1}=e,{webSearchEnabled:k=!1}=e,{toolServers:N=[]}=e,M=[];const H=async ne=>{let q=ne;if(ne.includes("{{CLIPBOARD}}")){const x=await navigator.clipboard.readText().catch(_e=>(rt.error(r.t("Failed to read clipboard contents")),"{{CLIPBOARD}}"));q=ne.replaceAll("{{CLIPBOARD}}",x)}t(2,m=q),await $e();const he=document.getElementById("chat-input-container"),Z=document.getElementById("chat-input");he&&(he.scrollTop=he.scrollHeight),await $e(),Z&&(Z.focus(),Z.dispatchEvent(new Event("input"))),await $e()};let V=0;Qn(()=>{});const Q=ne=>{t(16,V=ne)},J=ne=>{i||(ne.prompt!==null?localStorage.setItem("chat-input",JSON.stringify(ne)):localStorage.removeItem("chat-input"))};function E(ne){v=ne,t(3,v)}function Y(ne){m=ne,t(2,m)}function D(ne){h=ne,t(0,h)}function W(ne){y=ne,t(4,y)}function F(ne){I=ne,t(5,I)}function G(ne){P=ne,t(6,P)}function K(ne){R=ne,t(7,R)}function j(ne){k=ne,t(8,k)}function re(ne){p=ne,t(1,p)}const ue=ne=>{l("upload",ne.detail)},X=ne=>{l("submit",ne.detail)},me=ne=>{H(ne.detail)};return o.$$set=ne=>{"transparentBackground"in ne&&t(9,u=ne.transparentBackground),"createMessagePair"in ne&&t(10,d=ne.createMessagePair),"stopResponse"in ne&&t(11,f=ne.stopResponse),"autoScroll"in ne&&t(0,h=ne.autoScroll),"atSelectedModel"in ne&&t(1,p=ne.atSelectedModel),"selectedModels"in ne&&t(12,b=ne.selectedModels),"history"in ne&&t(13,w=ne.history),"prompt"in ne&&t(2,m=ne.prompt),"files"in ne&&t(3,v=ne.files),"selectedToolIds"in ne&&t(4,y=ne.selectedToolIds),"selectedFilterIds"in ne&&t(5,I=ne.selectedFilterIds),"imageGenerationEnabled"in ne&&t(6,P=ne.imageGenerationEnabled),"codeInterpreterEnabled"in ne&&t(7,R=ne.codeInterpreterEnabled),"webSearchEnabled"in ne&&t(8,k=ne.webSearchEnabled),"toolServers"in ne&&t(14,N=ne.toolServers)},o.$$.update=()=>{o.$$.dirty[0]&16781312&&t(15,M=b.map(ne=>n.find(q=>q.id===ne))),o.$$.dirty[0]&36864&&b.length>0&&t(16,V=M.length-1)},[h,p,m,v,y,I,P,R,k,u,d,f,b,w,N,M,V,r,i,s,a,l,c,H,n,Q,J,E,Y,D,W,F,G,K,j,re,ue,X,me]}class L2 extends We{constructor(e){super(),Ye(this,e,U2,H2,Qe,{transparentBackground:9,createMessagePair:10,stopResponse:11,autoScroll:0,atSelectedModel:1,selectedModels:12,history:13,prompt:2,files:3,selectedToolIds:4,selectedFilterIds:5,imageGenerationEnabled:6,codeInterpreterEnabled:7,webSearchEnabled:8,toolServers:14},null,[-1,-1])}}const{document:aa}=df;function B2(o){let e,t,n,r;return n=new Cs({}),{c(){e=U("div"),t=U("div"),$(n.$$.fragment),this.h()},l(i){e=L(i,"DIV",{class:!0});var s=A(e);t=L(s,"DIV",{class:!0});var a=A(t);oe(n.$$.fragment,a),a.forEach(_),s.forEach(_),this.h()},h(){g(t,"class","m-auto"),g(e,"class","flex items-center justify-center h-full w-full")},m(i,s){z(i,e,s),S(e,t),ee(n,t,null),r=!0},p:Ue,i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){O(n.$$.fragment,i),r=!1},d(i){i&&_(e),te(n)}}}function z2(o){var a;let e,t,n,r,i,s=(((a=o[29])==null?void 0:a.backgroundImageUrl)??null)&&af(o);return n=new ym({props:{direction:"horizontal",class:"w-full h-full",$$slots:{default:[G2]},$$scope:{ctx:o}}}),{c(){e=U("div"),s&&s.c(),t=ie(),$(n.$$.fragment),this.h()},l(l){e=L(l,"DIV",{class:!0});var c=A(e);s&&s.l(c),t=se(c),oe(n.$$.fragment,c),c.forEach(_),this.h()},h(){g(e,"class","w-full h-full flex flex-col")},m(l,c){z(l,e,c),s&&s.m(e,null),S(e,t),ee(n,e,null),i=!0},p(l,c){var d;((d=l[29])==null?void 0:d.backgroundImageUrl)??null?s?s.p(l,c):(s=af(l),s.c(),s.m(e,t)):s&&(s.d(1),s=null);const u={};c[0]&2147353583|c[1]&3|c[3]&536870912&&(u.$$scope={dirty:c,ctx:l}),n.$set(u)},i(l){i||(T(n.$$.fragment,l),l&&(r||Po(()=>{r=si(e,ai,{duration:50}),r.start()})),i=!0)},o(l){O(n.$$.fragment,l),i=!1},d(l){l&&_(e),s&&s.d(),te(n)}}}function af(o){let e,t,n,r;return{c(){e=U("div"),n=ie(),r=U("div"),this.h()},l(i){e=L(i,"DIV",{class:!0,style:!0}),A(e).forEach(_),n=se(i),r=L(i,"DIV",{class:!0}),A(r).forEach(_),this.h()},h(){g(e,"class",t="absolute "+(o[34]?"md:max-w-[calc(100%-260px)] md:translate-x-[260px]":"")+" top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat"),tt(e,"background-image","url("+o[29].backgroundImageUrl+")"),g(r,"class","absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0")},m(i,s){z(i,e,s),z(i,n,s),z(i,r,s)},p(i,s){s[1]&8&&t!==(t="absolute "+(i[34]?"md:max-w-[calc(100%-260px)] md:translate-x-[260px]":"")+" top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat")&&g(e,"class",t),s[0]&536870912&&tt(e,"background-image","url("+i[29].backgroundImageUrl+")")},d(i){i&&(_(e),_(n),_(r))}}}function F2(o){var k;let e,t,n,r,i,s,a,l,c,u,d,f;function h(N){o[76](N)}function p(N){o[77](N)}function b(N){o[78](N)}function w(N){o[79](N)}function m(N){o[80](N)}function v(N){o[81](N)}function y(N){o[82](N)}function I(N){o[83](N)}function P(N){o[84](N)}let R={history:o[22],selectedModels:o[0],transparentBackground:((k=o[29])==null?void 0:k.backgroundImageUrl)??!1,toolServers:o[31],stopResponse:o[47],createMessagePair:o[43]};return o[26]!==void 0&&(R.files=o[26]),o[24]!==void 0&&(R.prompt=o[24]),o[7]!==void 0&&(R.autoScroll=o[7]),o[17]!==void 0&&(R.selectedToolIds=o[17]),o[18]!==void 0&&(R.selectedFilterIds=o[18]),o[19]!==void 0&&(R.imageGenerationEnabled=o[19]),o[21]!==void 0&&(R.codeInterpreterEnabled=o[21]),o[20]!==void 0&&(R.webSearchEnabled=o[20]),o[1]!==void 0&&(R.atSelectedModel=o[1]),t=new L2({props:R}),ze.push(()=>Ze(t,"files",h)),ze.push(()=>Ze(t,"prompt",p)),ze.push(()=>Ze(t,"autoScroll",b)),ze.push(()=>Ze(t,"selectedToolIds",w)),ze.push(()=>Ze(t,"selectedFilterIds",m)),ze.push(()=>Ze(t,"imageGenerationEnabled",v)),ze.push(()=>Ze(t,"codeInterpreterEnabled",y)),ze.push(()=>Ze(t,"webSearchEnabled",I)),ze.push(()=>Ze(t,"atSelectedModel",P)),t.$on("upload",o[85]),t.$on("submit",o[86]),{c(){e=U("div"),$(t.$$.fragment),this.h()},l(N){e=L(N,"DIV",{class:!0});var M=A(e);oe(t.$$.fragment,M),M.forEach(_),this.h()},h(){g(e,"class","overflow-auto w-full h-full flex items-center")},m(N,M){z(N,e,M),ee(t,e,null),f=!0},p(N,M){var V;const H={};M[0]&4194304&&(H.history=N[22]),M[0]&1&&(H.selectedModels=N[0]),M[0]&536870912&&(H.transparentBackground=((V=N[29])==null?void 0:V.backgroundImageUrl)??!1),M[1]&1&&(H.toolServers=N[31]),!n&&M[0]&67108864&&(n=!0,H.files=N[26],Je(()=>n=!1)),!r&&M[0]&16777216&&(r=!0,H.prompt=N[24],Je(()=>r=!1)),!i&&M[0]&128&&(i=!0,H.autoScroll=N[7],Je(()=>i=!1)),!s&&M[0]&131072&&(s=!0,H.selectedToolIds=N[17],Je(()=>s=!1)),!a&&M[0]&262144&&(a=!0,H.selectedFilterIds=N[18],Je(()=>a=!1)),!l&&M[0]&524288&&(l=!0,H.imageGenerationEnabled=N[19],Je(()=>l=!1)),!c&&M[0]&2097152&&(c=!0,H.codeInterpreterEnabled=N[21],Je(()=>c=!1)),!u&&M[0]&1048576&&(u=!0,H.webSearchEnabled=N[20],Je(()=>u=!1)),!d&&M[0]&2&&(d=!0,H.atSelectedModel=N[1],Je(()=>d=!1)),t.$set(H)},i(N){f||(T(t.$$.fragment,N),f=!0)},o(N){O(t.$$.fragment,N),f=!1},d(N){N&&_(e),te(t)}}}function V2(o){var ue;let e,t,n,r,i,s,a,l,c,u,d,f,h,p,b,w,m,v,y,I,P="",R,k,N;function M(X){o[59](X)}function H(X){o[60](X)}function V(X){o[61](X)}let Q={chatId:o[28],selectedModels:o[0],atSelectedModel:o[1],sendPrompt:o[46],showMessage:o[37],submitMessage:o[48],continueResponse:o[50],regenerateResponse:o[49],mergeResponses:o[51],chatActionHandler:o[42],addMessages:o[44],bottomPadding:o[26].length>0};o[22]!==void 0&&(Q.history=o[22]),o[7]!==void 0&&(Q.autoScroll=o[7]),o[24]!==void 0&&(Q.prompt=o[24]),n=new bp({props:Q}),ze.push(()=>Ze(n,"history",M)),ze.push(()=>Ze(n,"autoScroll",H)),ze.push(()=>Ze(n,"prompt",V));function J(X){o[65](X)}function E(X){o[66](X)}function Y(X){o[67](X)}function D(X){o[68](X)}function W(X){o[69](X)}function F(X){o[70](X)}function G(X){o[71](X)}function K(X){o[72](X)}function j(X){o[73](X)}let re={history:o[22],taskIds:o[23],selectedModels:o[0],toolServers:o[31],transparentBackground:((ue=o[29])==null?void 0:ue.backgroundImageUrl)??!1,stopResponse:o[47],createMessagePair:o[43],onChange:o[64]};return o[26]!==void 0&&(re.files=o[26]),o[24]!==void 0&&(re.prompt=o[24]),o[7]!==void 0&&(re.autoScroll=o[7]),o[17]!==void 0&&(re.selectedToolIds=o[17]),o[18]!==void 0&&(re.selectedFilterIds=o[18]),o[19]!==void 0&&(re.imageGenerationEnabled=o[19]),o[21]!==void 0&&(re.codeInterpreterEnabled=o[21]),o[20]!==void 0&&(re.webSearchEnabled=o[20]),o[1]!==void 0&&(re.atSelectedModel=o[1]),c=new yg({props:re}),ze.push(()=>Ze(c,"files",J)),ze.push(()=>Ze(c,"prompt",E)),ze.push(()=>Ze(c,"autoScroll",Y)),ze.push(()=>Ze(c,"selectedToolIds",D)),ze.push(()=>Ze(c,"selectedFilterIds",W)),ze.push(()=>Ze(c,"imageGenerationEnabled",F)),ze.push(()=>Ze(c,"codeInterpreterEnabled",G)),ze.push(()=>Ze(c,"webSearchEnabled",K)),ze.push(()=>Ze(c,"atSelectedModel",j)),c.$on("upload",o[74]),c.$on("submit",o[75]),{c(){e=U("div"),t=U("div"),$(n.$$.fragment),a=ie(),l=U("div"),$(c.$$.fragment),y=ie(),I=U("div"),I.innerHTML=P,this.h()},l(X){e=L(X,"DIV",{class:!0,id:!0});var me=A(e);t=L(me,"DIV",{class:!0});var ne=A(t);oe(n.$$.fragment,ne),ne.forEach(_),me.forEach(_),a=se(X),l=L(X,"DIV",{class:!0});var q=A(l);oe(c.$$.fragment,q),y=se(q),I=L(q,"DIV",{class:!0,"data-svelte-h":!0}),dn(I)!=="svelte-ko82kn"&&(I.innerHTML=P),q.forEach(_),this.h()},h(){g(t,"class","h-full w-full flex flex-col"),g(e,"class","pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden"),g(e,"id","messages-container"),g(I,"class","absolute bottom-1 text-xs text-gray-500 text-center line-clamp-1 right-0 left-0"),g(l,"class","pb-2")},m(X,me){z(X,e,me),S(e,t),ee(n,t,null),o[62](e),z(X,a,me),z(X,l,me),ee(c,l,null),S(l,y),S(l,I),R=!0,k||(N=Ae(e,"scroll",o[63]),k=!0)},p(X,me){var he;const ne={};me[0]&268435456&&(ne.chatId=X[28]),me[0]&1&&(ne.selectedModels=X[0]),me[0]&2&&(ne.atSelectedModel=X[1]),me[0]&67108864&&(ne.bottomPadding=X[26].length>0),!r&&me[0]&4194304&&(r=!0,ne.history=X[22],Je(()=>r=!1)),!i&&me[0]&128&&(i=!0,ne.autoScroll=X[7],Je(()=>i=!1)),!s&&me[0]&16777216&&(s=!0,ne.prompt=X[24],Je(()=>s=!1)),n.$set(ne);const q={};me[0]&4194304&&(q.history=X[22]),me[0]&8388608&&(q.taskIds=X[23]),me[0]&1&&(q.selectedModels=X[0]),me[1]&1&&(q.toolServers=X[31]),me[0]&536870912&&(q.transparentBackground=((he=X[29])==null?void 0:he.backgroundImageUrl)??!1),me[0]&268435464&&(q.onChange=X[64]),!u&&me[0]&67108864&&(u=!0,q.files=X[26],Je(()=>u=!1)),!d&&me[0]&16777216&&(d=!0,q.prompt=X[24],Je(()=>d=!1)),!f&&me[0]&128&&(f=!0,q.autoScroll=X[7],Je(()=>f=!1)),!h&&me[0]&131072&&(h=!0,q.selectedToolIds=X[17],Je(()=>h=!1)),!p&&me[0]&262144&&(p=!0,q.selectedFilterIds=X[18],Je(()=>p=!1)),!b&&me[0]&524288&&(b=!0,q.imageGenerationEnabled=X[19],Je(()=>b=!1)),!w&&me[0]&2097152&&(w=!0,q.codeInterpreterEnabled=X[21],Je(()=>w=!1)),!m&&me[0]&1048576&&(m=!0,q.webSearchEnabled=X[20],Je(()=>m=!1)),!v&&me[0]&2&&(v=!0,q.atSelectedModel=X[1],Je(()=>v=!1)),c.$set(q)},i(X){R||(T(n.$$.fragment,X),T(c.$$.fragment,X),R=!0)},o(X){O(n.$$.fragment,X),O(c.$$.fragment,X),R=!1},d(X){X&&(_(e),_(a),_(l)),te(n),o[62](null),te(c),k=!1,N()}}}function K2(o){let e,t,n,r,i,s,a,l;function c(p){o[58](p)}let u={chat:{id:o[28],chat:{title:o[32],models:o[0],system:o[29].system??void 0,params:o[27],history:o[22],timestamp:Date.now()}},history:o[22],title:o[32],shareEnabled:!!o[22].currentId,initNewChat:o[41]};o[0]!==void 0&&(u.selectedModels=o[0]),e=new uv({props:u}),o[57](e),ze.push(()=>Ze(e,"selectedModels",c));const d=[V2,F2],f=[];function h(p,b){var w;return b[0]&541065216&&(i=null),i==null&&(i=((w=p[29])==null?void 0:w.landingPageMode)==="chat"||Gn(p[22],p[22].currentId).length>0),i?0:1}return s=h(o,[-1,-1,-1,-1]),a=f[s]=d[s](o),{c(){$(e.$$.fragment),n=ie(),r=U("div"),a.c(),this.h()},l(p){oe(e.$$.fragment,p),n=se(p),r=L(p,"DIV",{class:!0});var b=A(r);a.l(b),b.forEach(_),this.h()},h(){g(r,"class","flex flex-col flex-auto z-10 w-full @container")},m(p,b){ee(e,p,b),z(p,n,b),z(p,r,b),f[s].m(r,null),l=!0},p(p,b){const w={};b[0]&943718401|b[1]&2&&(w.chat={id:p[28],chat:{title:p[32],models:p[0],system:p[29].system??void 0,params:p[27],history:p[22],timestamp:Date.now()}}),b[0]&4194304&&(w.history=p[22]),b[1]&2&&(w.title=p[32]),b[0]&4194304&&(w.shareEnabled=!!p[22].currentId),!t&&b[0]&1&&(t=!0,w.selectedModels=p[0],Je(()=>t=!1)),e.$set(w);let m=s;s=h(p,b),s===m?f[s].p(p,b):(Re(),O(f[m],1,1,()=>{f[m]=null}),Me(),a=f[s],a?a.p(p,b):(a=f[s]=d[s](p),a.c()),T(a,1),a.m(r,null))},i(p){l||(T(e.$$.fragment,p),T(a),l=!0)},o(p){O(e.$$.fragment,p),O(a),l=!1},d(p){p&&(_(n),_(r)),o[57](null),te(e,p),f[s].d()}}}function G2(o){var w;let e,t,n,r,i,s,a,l,c;e=new hf({props:{defaultSize:50,class:"h-full flex relative max-w-full flex-col",$$slots:{default:[K2]},$$scope:{ctx:o}}});function u(m){o[89](m)}function d(m){o[90](m)}function f(m){o[91](m)}function h(m){o[92](m)}function p(m){o[93](m)}let b={chatId:o[28],modelId:((w=o[2])==null?void 0:w.at(0))??null,models:o[2].reduce(o[87],[]),submitPrompt:o[45],stopResponse:o[47],showMessage:o[37],eventTarget:o[36]};return o[22]!==void 0&&(b.history=o[22]),o[25]!==void 0&&(b.chatFiles=o[25]),o[27]!==void 0&&(b.params=o[27]),o[26]!==void 0&&(b.files=o[26]),o[5]!==void 0&&(b.pane=o[5]),n=new T2({props:b}),o[88](n),ze.push(()=>Ze(n,"history",u)),ze.push(()=>Ze(n,"chatFiles",d)),ze.push(()=>Ze(n,"params",f)),ze.push(()=>Ze(n,"files",h)),ze.push(()=>Ze(n,"pane",p)),{c(){$(e.$$.fragment),t=ie(),$(n.$$.fragment)},l(m){oe(e.$$.fragment,m),t=se(m),oe(n.$$.fragment,m)},m(m,v){ee(e,m,v),z(m,t,v),ee(n,m,v),c=!0},p(m,v){var P;const y={};v[0]&1040057227|v[1]&3|v[3]&536870912&&(y.$$scope={dirty:v,ctx:m}),e.$set(y);const I={};v[0]&268435456&&(I.chatId=m[28]),v[0]&4&&(I.modelId=((P=m[2])==null?void 0:P.at(0))??null),v[0]&1073741828&&(I.models=m[2].reduce(m[87],[])),!r&&v[0]&4194304&&(r=!0,I.history=m[22],Je(()=>r=!1)),!i&&v[0]&33554432&&(i=!0,I.chatFiles=m[25],Je(()=>i=!1)),!s&&v[0]&134217728&&(s=!0,I.params=m[27],Je(()=>s=!1)),!a&&v[0]&67108864&&(a=!0,I.files=m[26],Je(()=>a=!1)),!l&&v[0]&32&&(l=!0,I.pane=m[5],Je(()=>l=!1)),n.$set(I)},i(m){c||(T(e.$$.fragment,m),T(n.$$.fragment,m),c=!0)},o(m){O(e.$$.fragment,m),O(n.$$.fragment,m),c=!1},d(m){m&&_(t),te(e,m),o[88](null),te(n,m)}}}function W2(o){let e,t,n,r,i,s,a,l,c,u,d,f,h;aa.title=e=`
		`+(o[32]?`${o[32].length>30?`${o[32].slice(0,30)}...`:o[32]} • ${o[33]}`:`${o[33]}`)+`
	`;function p(y){o[54](y)}let b={title:o[11],message:o[12],input:o[13],inputPlaceholder:o[14],inputValue:o[15]};o[10]!==void 0&&(b.show=o[10]),s=new Fp({props:b}),ze.push(()=>Ze(s,"show",p)),s.$on("confirm",o[55]),s.$on("cancel",o[56]);const w=[z2,B2],m=[];function v(y,I){return y[4]?y[4]?1:-1:0}return~(u=v(o))&&(d=m[u]=w[u](o)),{c(){t=ie(),n=U("audio"),i=ie(),$(s.$$.fragment),l=ie(),c=U("div"),d&&d.c(),this.h()},l(y){um("svelte-5280jy",aa.head).forEach(_),t=se(y),n=L(y,"AUDIO",{id:!0,src:!0,style:!0}),A(n).forEach(_),i=se(y),oe(s.$$.fragment,y),l=se(y),c=L(y,"DIV",{class:!0,id:!0});var P=A(c);d&&d.l(P),P.forEach(_),this.h()},h(){g(n,"id","audioElement"),oo(n.src,r="")||g(n,"src",r),tt(n,"display","none"),g(c,"class",f="h-screen max-h-[100dvh] transition-width duration-200 ease-in-out "+(o[34]?"  md:max-w-[calc(100%-260px)]":" ")+" w-full max-w-full flex flex-col"),g(c,"id","chat-container")},m(y,I){z(y,t,I),z(y,n,I),z(y,i,I),ee(s,y,I),z(y,l,I),z(y,c,I),~u&&m[u].m(c,null),h=!0},p(y,I){(!h||I[1]&6)&&e!==(e=`
		`+(y[32]?`${y[32].length>30?`${y[32].slice(0,30)}...`:y[32]} • ${y[33]}`:`${y[33]}`)+`
	`)&&(aa.title=e);const P={};I[0]&2048&&(P.title=y[11]),I[0]&4096&&(P.message=y[12]),I[0]&8192&&(P.input=y[13]),I[0]&16384&&(P.inputPlaceholder=y[14]),I[0]&32768&&(P.inputValue=y[15]),!a&&I[0]&1024&&(a=!0,P.show=y[10],Je(()=>a=!1)),s.$set(P);let R=u;u=v(y),u===R?~u&&m[u].p(y,I):(d&&(Re(),O(m[R],1,1,()=>{m[R]=null}),Me()),~u?(d=m[u],d?d.p(y,I):(d=m[u]=w[u](y),d.c()),T(d,1),d.m(c,null)):d=null),(!h||I[1]&8&&f!==(f="h-screen max-h-[100dvh] transition-width duration-200 ease-in-out "+(y[34]?"  md:max-w-[calc(100%-260px)]":" ")+" w-full max-w-full flex flex-col"))&&g(c,"class",f)},i(y){h||(T(s.$$.fragment,y),T(d),h=!0)},o(y){O(s.$$.fragment,y),O(d),h=!1},d(y){y&&(_(t),_(n),_(i),_(l),_(c)),te(s,y),~u&&m[u].d()}}}function Y2(o,e,t){let n,r,i,s,a,l,c,u,d,f,h,p,b,w,m,v,y;de(o,Go,B=>t(97,n=B)),de(o,mi,B=>t(3,r=B)),de(o,qo,B=>t(28,i=B)),de(o,qn,B=>t(29,s=B)),de(o,nr,B=>t(30,l=B)),de(o,Im,B=>t(99,c=B)),de(o,bo,B=>t(100,u=B)),de(o,Ar,B=>t(101,d=B)),de(o,pf,B=>t(31,f=B)),de(o,Wn,B=>t(102,h=B)),de(o,Gl,B=>t(103,p=B)),de(o,Ti,B=>t(104,b=B)),de(o,Xo,B=>t(105,w=B)),de(o,Ui,B=>t(32,m=B)),de(o,_f,B=>t(33,v=B)),de(o,ca,B=>t(34,y=B));const I=rn("i18n");de(o,I,B=>t(98,a=B));let{chatIdProp:P=""}=e,R=!0;const k=new EventTarget;let N,M,H=!0,V,Q,J=!1,E="",Y="",D=!1,W="",F="",G=null,K=[""],j,re=[],ue=[],X=[],me=!1,ne=!1,q=!1,he=null,Z={messages:{},currentId:null},x=null,_e="",Pe=[],De=[],ge={};const ct=()=>{K.length===0||K.length===1&&K[0]===""||(sessionStorage.selectedModels=JSON.stringify(K),sessionStorage.selectedModels)};let at=[""];const kt=()=>{at.filter(B=>B).length>0&&_t(),t(53,at=re)},_t=()=>{Dt(),t(18,X=[]),t(20,ne=!1),t(19,me=!1),t(21,q=!1)},Dt=async()=>{var ce,be,Le,ke;if(w||Xo.set(await Ba(localStorage.token)),K.length!==1&&!j)return;const B=j??l.find(we=>we.id===K[0]);B&&((be=(ce=B==null?void 0:B.info)==null?void 0:ce.meta)!=null&&be.toolIds)?t(17,ue=[...new Set([...((ke=(Le=B==null?void 0:B.info)==null?void 0:Le.meta)==null?void 0:ke.toolIds)??[]].filter(we=>w.find(Se=>Se.id===we)))]):t(17,ue=[])},Ot=async B=>{await $e();const ce=JSON.parse(JSON.stringify(i));let be=JSON.parse(JSON.stringify(B.id)),Le=[];for(be===null?Le=Object.keys(Z.messages).filter(ke=>Z.messages[ke].parentId===null):Le=Z.messages[be].childrenIds;Le.length!==0;)be=Le.at(-1),Le=Z.messages[be].childrenIds;if(t(22,Z.currentId=be,Z),await $e(),await $e(),await $e(),(s==null?void 0:s.scrollOnBranchChange)??!0){const ke=document.getElementById(`message-${B.id}`);ke&&ke.scrollIntoView({behavior:"smooth"})}await $e(),kn(ce,Z)},fn=async(B,ce)=>{var be,Le;if(B.chat_id===i){await $e();let ke=Z.messages[B.message_id];if(ke){const we=((be=B==null?void 0:B.data)==null?void 0:be.type)??null,Se=((Le=B==null?void 0:B.data)==null?void 0:Le.data)??null;if(we==="status")ke!=null&&ke.statusHistory?ke.statusHistory.push(Se):ke.statusHistory=[Se];else if(we==="chat:completion")nt(Se,ke,B.chat_id);else if(we==="chat:message:delta"||we==="message")ke.content+=Se.content;else if(we==="chat:message"||we==="replace")ke.content=Se.content;else if(we==="chat:message:files"||we==="files")ke.files=Se.files;else if(we==="chat:message:follow_ups")ke.followUps=Se.follow_ups,H&&le("smooth");else if(we==="chat:title")Ui.set(Se),Go.set(1),await Wo.set(await rr(localStorage.token,n));else if(we==="chat:tags")he=await ua(localStorage.token,i),Tm.set(await Fm(localStorage.token));else if(we==="source"||we==="citation")if((Se==null?void 0:Se.type)==="code_execution"){ke!=null&&ke.code_executions||(ke.code_executions=[]);const Ge=ke.code_executions.findIndex(lt=>lt.id===Se.id);Ge!==-1?ke.code_executions[Ge]=Se:ke.code_executions.push(Se),ke.code_executions=ke.code_executions}else ke!=null&&ke.sources?ke.sources.push(Se):ke.sources=[Se];else if(we==="notification"){const Ge=(Se==null?void 0:Se.type)??"info",lt=(Se==null?void 0:Se.content)??"";Ge==="success"?rt.success(lt):Ge==="error"?rt.error(lt):Ge==="warning"?rt.warning(lt):rt.info(lt)}else if(we==="confirmation")t(16,G=ce),t(13,D=!1),t(10,J=!0),t(11,E=Se.title),t(12,Y=Se.message);else if(we==="execute"){t(16,G=ce);try{const lt=await new Function(`return (async () => { ${Se.code} })()`)();ce&&ce(lt)}catch(Ge){console.error("Error executing code:",Ge)}}else we==="input"&&(t(16,G=ce),t(13,D=!0),t(10,J=!0),t(11,E=Se.title),t(12,Y=Se.message),t(14,W=Se.placeholder),t(15,F=(Se==null?void 0:Se.value)??""));t(22,Z.messages[B.message_id]=ke,Z)}}},en=async B=>{if(B.origin===window.origin){if(B.data.type==="input:prompt"){B.data.text;const ce=document.getElementById("chat-input");ce&&(t(24,_e=B.data.text),ce.focus())}B.data.type==="action:submit"&&(B.data.text,_e!==""&&(await $e(),wt(_e))),B.data.type==="input:prompt:submit"&&(B.data.text,B.data.text!==""&&(await $e(),wt(B.data.text)))}};let tn=null;Qn(async()=>{if(t(4,R=!0),window.addEventListener("message",en),c==null||c.on("chat-events",fn),tn=Gl.subscribe(async ce=>{ce.url.pathname==="/"&&(await $e(),Vt())}),localStorage.getItem(`chat-input${P?`-${P}`:""}`)){t(24,_e=""),t(26,De=[]),t(17,ue=[]),t(18,X=[]),t(20,ne=!1),t(19,me=!1),t(21,q=!1);try{const ce=JSON.parse(localStorage.getItem(`chat-input${P?`-${P}`:""}`));r||(t(24,_e=ce.prompt),t(26,De=ce.files),t(17,ue=ce.selectedToolIds),t(18,X=ce.selectedFilterIds),t(20,ne=ce.webSearchEnabled),t(19,me=ce.imageGenerationEnabled),t(21,q=ce.codeInterpreterEnabled))}catch{}}P||(t(4,R=!1),await $e()),Zt.subscribe(async ce=>{if(N&&!b)try{ce?M.openPane():N.collapse()}catch{}ce||(Wn.set(!1),Co.set(!1),go.set(!1))});const B=document.getElementById("chat-input");B==null||B.focus(),Wo.subscribe(()=>{})}),Bo(()=>{tn(),window.removeEventListener("message",en),c==null||c.off("chat-events",fn)});const nn=async B=>{var Le,ke,we,Se,Ge,lt;if(B.id,B.name,B.url,`${token}`,!(B!=null&&B.id)||!(B!=null&&B.name)||!(B!=null&&B.url)||!((Le=B==null?void 0:B.headers)!=null&&Le.Authorization))throw new Error("Invalid file data provided");const ce=wo(),be={type:"file",file:"",id:null,url:B.url,name:B.name,collection_name:"",status:"uploading",error:"",itemId:ce,size:0};try{t(26,De=[...De,be]),B.url;const Ct={headers:{Authorization:B.headers.Authorization,Accept:"*/*"},method:"GET"},Tt=await fetch(B.url,Ct);if(!Tt.ok){const Jn=await Tt.text();throw new Error(`Failed to fetch file (${Tt.status}): ${Jn}`)}const mt=Tt.headers.get("content-type")||"application/octet-stream",St=await Tt.blob();if(St.size===0)throw new Error("Retrieved file is empty");St.size,St.type;const Wt=new File([St],B.name,{type:St.type||mt});if(Wt.name,Wt.size,Wt.type,Wt.size===0)throw new Error("Created file is empty");let Rn=null;(Wt.type.startsWith("audio/")||Wt.type.startsWith("video/"))&&((we=(ke=s==null?void 0:s.audio)==null?void 0:ke.stt)!=null&&we.language)&&(Rn={language:(Ge=(Se=s==null?void 0:s.audio)==null?void 0:Se.stt)==null?void 0:Ge.language});const cn=await uploadFile(localStorage.token,Wt,Rn);if(!cn)throw new Error("Server returned null response for file upload");be.status="uploaded",be.file=cn,be.id=cn.id,be.size=Wt.size,be.collection_name=(lt=cn==null?void 0:cn.meta)==null?void 0:lt.collection_name,be.url=`${WEBUI_API_BASE_URL}/files/${cn.id}`,t(26,De),t(52,P),t(3,r),rt.success(a.t("File uploaded successfully"))}catch(Ct){console.error("Error uploading file:",Ct),t(26,De=De.filter(Tt=>Tt.itemId!==ce)),rt.error(a.t("Error uploading file: {{error}}",{error:Ct.message||"Unknown error"}))}},ve=async B=>{const ce={type:"doc",name:B,collection_name:"",status:"uploading",url:B,error:""};try{t(26,De=[...De,ce]);const be=await Gm(localStorage.token,"",B);be&&(ce.status="uploaded",ce.collection_name=be.collection_name,ce.file={...be.file,...ce.file},t(26,De),t(52,P),t(3,r))}catch(be){t(26,De=De.filter(Le=>Le.name!==B)),rt.error(JSON.stringify(be))}},sn=async B=>{const ce={type:"doc",name:B,collection_name:"",status:"uploading",context:"full",url:B,error:""};try{t(26,De=[...De,ce]);const be=await Wm(localStorage.token,B);be&&(ce.status="uploaded",ce.collection_name=be.collection_name,ce.file={...be.file,...ce.file},t(26,De),t(52,P),t(3,r))}catch(be){t(26,De=De.filter(Le=>Le.name!==B)),rt.error(`${be}`)}},Vt=async()=>{var Le,ke,we;const B=l.filter(Se=>{var Ge,lt;return!(((lt=(Ge=Se==null?void 0:Se.info)==null?void 0:Ge.meta)==null?void 0:lt.hidden)??!1)}).map(Se=>Se.id);if(p.url.searchParams.get("models")||p.url.searchParams.get("model")){const Se=(Le=p.url.searchParams.get("models")||p.url.searchParams.get("model")||"")==null?void 0:Le.split(",");if(Se.length===1)if(l.find(lt=>lt.id===Se[0]))t(0,K=Se);else{const lt=document.getElementById("model-selector-0-button");if(lt){lt.click(),await $e();const Ct=document.getElementById("model-search-input");Ct&&(Ct.focus(),Ct.value=Se[0],Ct.dispatchEvent(new Event("input")))}}else t(0,K=Se);t(0,K=K.filter(Ge=>l.map(lt=>lt.id).includes(Ge)))}else sessionStorage.selectedModels?(t(0,K=JSON.parse(sessionStorage.selectedModels)),sessionStorage.removeItem("selectedModels")):s!=null&&s.models?t(0,K=s==null?void 0:s.models):d!=null&&d.default_models&&(d==null||d.default_models.split(","),t(0,K=d==null?void 0:d.default_models.split(","))),t(0,K=K.filter(Se=>B.includes(Se)));(K.length===0||K.length===1&&K[0]==="")&&(B.length>0?t(0,K=[(B==null?void 0:B.at(0))??""]):t(0,K=[""])),await Zt.set(!1),await Wn.set(!1),await Co.set(!1),await go.set(!1),p.url.pathname.includes("/c/")&&window.history.replaceState(Z.state,"","/"),t(7,H=!0),_t(),await qo.set(""),await Ui.set(""),t(22,Z={messages:{},currentId:null}),t(25,Pe=[]),t(27,ge={}),p.url.searchParams.get("youtube")&&sn(`https://www.youtube.com/watch?v=${p.url.searchParams.get("youtube")}`),p.url.searchParams.get("load-url")&&await ve(p.url.searchParams.get("load-url")),p.url.searchParams.get("web-search")==="true"&&t(20,ne=!0),p.url.searchParams.get("image-generation")==="true"&&t(19,me=!0),p.url.searchParams.get("code-interpreter")==="true"&&t(21,q=!0),p.url.searchParams.get("tools")?t(17,ue=(ke=p.url.searchParams.get("tools"))==null?void 0:ke.split(",").map(Se=>Se.trim()).filter(Se=>Se)):p.url.searchParams.get("tool-ids")&&t(17,ue=(we=p.url.searchParams.get("tool-ids"))==null?void 0:we.split(",").map(Se=>Se.trim()).filter(Se=>Se)),p.url.searchParams.get("call")==="true"&&(Wn.set(!0),Zt.set(!0)),p.url.searchParams.get("q")&&(t(24,_e=p.url.searchParams.get("q")??""),_e&&(await $e(),wt(_e))),t(0,K=K.map(Se=>l.map(Ge=>Ge.id).includes(Se)?Se:""));const ce=await Ql(localStorage.token);ce?qn.set(ce.ui):qn.set(JSON.parse(localStorage.getItem("settings")??"{}"));const be=document.getElementById("chat-input");setTimeout(()=>be==null?void 0:be.focus(),0)},Jt=async()=>{var B,ce;if(qo.set(P),r&&mi.set(!1),he=await ua(localStorage.token,i).catch(async be=>(await Kl("/"),null)),he){await Vm(localStorage.token,i).catch(async Le=>[]);const be=he.chat;if(be){t(0,K=((be==null?void 0:be.models)??void 0)!==void 0?be.models:[be.models??""]),(u==null?void 0:u.role)==="admin"||(((ce=(B=u==null?void 0:u.permissions)==null?void 0:B.chat)==null?void 0:ce.multiple_models)??!0)||t(0,K=K.length>0?[K[0]]:[""]),t(53,at=K),t(22,Z=((be==null?void 0:be.history)??void 0)!==void 0?be.history:Bm(be.messages)),Ui.set(be.title);const Le=await Ql(localStorage.token);if(Le?await qn.set(Le.ui):await qn.set(JSON.parse(localStorage.getItem("settings")??"{}")),t(27,ge=(be==null?void 0:be.params)??{}),t(25,Pe=(be==null?void 0:be.files)??[]),t(7,H=!0),await $e(),Z.currentId)for(const we of Object.values(Z.messages))we.role==="assistant"&&(we.done=!0);const ke=await jm(localStorage.token,i).catch(we=>null);return ke&&t(23,x=ke.task_ids),await $e(),!0}else return null}},le=async(B="auto")=>{await $e(),V&&V.scrollTo({top:V.scrollHeight,behavior:B})},Xe=async(B,ce,be,Le)=>{const ke=await Zm(localStorage.token,{model:ce,messages:Le.map(we=>({id:we.id,role:we.role,content:we.content,info:we.info?we.info:void 0,timestamp:we.timestamp,...we.usage?{usage:we.usage}:{},...we.sources?{sources:we.sources}:{}})),filter_ids:X.length>0?X:void 0,model_item:l.find(we=>we.id===ce),chat_id:B,session_id:c==null?void 0:c.id,id:be}).catch(we=>(rt.error(`${we}`),Le.at(-1).error={content:we},null));if(ke!==null&&ke.messages)for(const we of ke.messages)we!=null&&we.id&&t(22,Z.messages[we.id]={...Z.messages[we.id],...Z.messages[we.id].content!==we.content?{originalContent:Z.messages[we.id].content}:{},...we},Z);await $e(),i==B&&(r||(he=await Xs(localStorage.token,B,{models:K,messages:Le,history:Z,params:ge,files:Pe}),Go.set(1),await Wo.set(await rr(localStorage.token,n)))),t(23,x=null)},vt=async(B,ce,be,Le,ke=null)=>{const we=Gn(Z,Le),Se=await Qm(localStorage.token,ce,{model:be,messages:we.map(Ge=>({id:Ge.id,role:Ge.role,content:Ge.content,info:Ge.info?Ge.info:void 0,timestamp:Ge.timestamp,...Ge.sources?{sources:Ge.sources}:{}})),...ke?{event:ke}:{},model_item:l.find(Ge=>Ge.id===be),chat_id:B,session_id:c==null?void 0:c.id,id:Le}).catch(Ge=>(rt.error(`${Ge}`),we.at(-1).error={content:Ge},null));if(Se!==null&&Se.messages)for(const Ge of Se.messages)t(22,Z.messages[Ge.id]={...Z.messages[Ge.id],...Z.messages[Ge.id].content!==Ge.content?{originalContent:Z.messages[Ge.id].content}:{},...Ge},Z);i==B&&(r||(he=await Xs(localStorage.token,B,{models:K,messages:we,history:Z,params:ge,files:Pe}),Go.set(1),await Wo.set(await rr(localStorage.token,n))))},fe=async(B,ce="")=>setInterval(()=>{c==null||c.emit("usage",{action:"chat",model:B,chat_id:ce})},1e3),qe=async B=>{if(t(24,_e=""),K.length===0)rt.error(a.t("Model not selected"));else{const ce=K[0],be=l.filter(Ct=>Ct.id===ce).at(0),Le=Gn(Z,Z.currentId),ke=Le.length!==0?Le.at(-1):null,we=wo(),Se=wo(),Ge={id:we,parentId:ke?ke.id:null,childrenIds:[Se],role:"user",content:B||`[PROMPT] ${we}`,timestamp:Math.floor(Date.now()/1e3)},lt={id:Se,parentId:we,childrenIds:[],role:"assistant",content:`[RESPONSE] ${Se}`,done:!0,model:ce,modelName:be.name??be.id,modelIdx:0,timestamp:Math.floor(Date.now()/1e3)};ke&&(ke.childrenIds.push(we),t(22,Z.messages[ke.id]=ke,Z)),t(22,Z.messages[we]=Ge,Z),t(22,Z.messages[Se]=lt,Z),t(22,Z.currentId=Se,Z),await $e(),H&&le(),Le.length===0?await hn(Z):await kn(i,Z)}},Ke=async({modelId:B,parentId:ce,messages:be})=>{const Le=l.filter(Se=>Se.id===B).at(0);let ke=Z.messages[ce],we=ke?ke.id:null;for(const Se of be){let Ge=wo();if(Se.role==="user"){const lt={id:Ge,parentId:we,childrenIds:[],timestamp:Math.floor(Date.now()/1e3),...Se};ke&&(ke.childrenIds.push(Ge),t(22,Z.messages[ke.id]=ke,Z)),t(22,Z.messages[Ge]=lt,Z),ke=lt,we=Ge}else{const lt={id:Ge,parentId:we,childrenIds:[],done:!0,model:Le.id,modelName:Le.name??Le.id,modelIdx:0,timestamp:Math.floor(Date.now()/1e3),...Se};ke&&(ke.childrenIds.push(Ge),t(22,Z.messages[ke.id]=ke,Z)),t(22,Z.messages[Ge]=lt,Z),ke=lt,we=Ge}}t(22,Z.currentId=we,Z),await $e(),H&&le(),be.length===0?await hn(Z):await kn(i,Z)},nt=async(B,ce,be)=>{var mt,St,Wt,Rn,cn,Jn,Fn,Ln,Fo,Mo,Vo,ti,ni,oi;const{id:Le,done:ke,choices:we,content:Se,sources:Ge,selected_model_id:lt,error:Ct,usage:Tt}=B;if(Ct&&await Kt(Ct,ce),Ge&&(ce.sources=Ge),we)if((St=(mt=we[0])==null?void 0:mt.message)!=null&&St.content)ce.content+=(Rn=(Wt=we[0])==null?void 0:Wt.message)==null?void 0:Rn.content;else{let En=((Jn=(cn=we[0])==null?void 0:cn.delta)==null?void 0:Jn.content)??"";if(!(ce.content==""&&En==`
`)){ce.content+=En,navigator.vibrate&&((s==null?void 0:s.hapticFeedback)??!1)&&navigator.vibrate(5);const Zn=js(Qs(ce.content),((Ln=(Fn=d==null?void 0:d.audio)==null?void 0:Fn.tts)==null?void 0:Ln.split_on)??"punctuation");Zn.pop(),Zn.length>0&&Zn[Zn.length-1]!==ce.lastSentence&&(ce.lastSentence=Zn[Zn.length-1],k.dispatchEvent(new CustomEvent("chat",{detail:{id:ce.id,content:Zn[Zn.length-1]}})))}}if(Se){ce.content=Se,navigator.vibrate&&((s==null?void 0:s.hapticFeedback)??!1)&&navigator.vibrate(5);const En=js(Qs(ce.content),((Mo=(Fo=d==null?void 0:d.audio)==null?void 0:Fo.tts)==null?void 0:Mo.split_on)??"punctuation");En.pop(),En.length>0&&En[En.length-1]!==ce.lastSentence&&(ce.lastSentence=En[En.length-1],k.dispatchEvent(new CustomEvent("chat",{detail:{id:ce.id,content:En[En.length-1]}})))}if(lt&&(ce.selectedModelId=lt,ce.arena=!0),Tt&&(ce.usage=Tt),t(22,Z.messages[ce.id]=ce,Z),ke){ce.done=!0,s.responseAutoCopy&&La(ce.content),s.responseAutoPlayback&&!h&&(await $e(),(Vo=document.getElementById(`speak-button-${ce.id}`))==null||Vo.click());let En=((oi=js(Qs(ce.content),((ni=(ti=d==null?void 0:d.audio)==null?void 0:ti.tts)==null?void 0:ni.split_on)??"punctuation"))==null?void 0:oi.at(-1))??"";En&&k.dispatchEvent(new CustomEvent("chat",{detail:{id:ce.id,content:En}})),k.dispatchEvent(new CustomEvent("chat:finish",{detail:{id:ce.id,content:ce.content}})),t(22,Z.messages[ce.id]=ce,Z),await Xe(be,ce.model,ce.id,Gn(Z,ce.id))}H&&le()},wt=async(B,{_raw:ce=!1}={})=>{var lt,Ct,Tt;const be=Gn(Z,Z.currentId),Le=K.map(mt=>l.map(St=>St.id).includes(mt)?mt:"");if(JSON.stringify(K)!==JSON.stringify(Le)&&t(0,K=Le),B===""&&De.length===0){rt.error(a.t("Please enter a prompt"));return}if(K.includes("")){rt.error(a.t("Model not selected"));return}if(be.length!=0&&be.at(-1).done!=!0)return;if(be.length!=0&&be.at(-1).error&&!be.at(-1).content){rt.error(a.t("Oops! There was an error in the previous response."));return}if(De.length>0&&De.filter(mt=>mt.type!=="image"&&mt.status==="uploading").length>0){rt.error(a.t("Oops! There are files still uploading. Please wait for the upload to complete."));return}if((((lt=d==null?void 0:d.file)==null?void 0:lt.max_count)??null)!==null&&De.length+Pe.length>((Ct=d==null?void 0:d.file)==null?void 0:Ct.max_count)){rt.error(a.t("You can only chat with a maximum of {{maxCount}} file(s) at a time.",{maxCount:(Tt=d==null?void 0:d.file)==null?void 0:Tt.max_count}));return}if(t(24,_e=""),!((s==null?void 0:s.richTextInput)??!0)){const mt=document.getElementById("chat-input");mt&&(await $e(),mt.style.height="")}const ke=JSON.parse(JSON.stringify(De));Pe.push(...ke.filter(mt=>["doc","file","collection"].includes(mt.type))),t(25,Pe=Pe.filter((mt,St,Wt)=>Wt.findIndex(Rn=>JSON.stringify(Rn)===JSON.stringify(mt))===St)),t(26,De=[]),t(24,_e="");let we=wo(),Se={id:we,parentId:be.length!==0?be.at(-1).id:null,childrenIds:[],role:"user",content:B,files:ke.length>0?ke:void 0,timestamp:Math.floor(Date.now()/1e3),models:K};t(22,Z.messages[we]=Se,Z),t(22,Z.currentId=we,Z),be.length!==0&&Z.messages[be.at(-1).id].childrenIds.push(we);const Ge=document.getElementById("chat-input");Ge==null||Ge.focus(),ct(),await pt(Z,B,we,{newChat:!0})},pt=async(B,ce,be,{modelId:Le=null,modelIdx:ke=null,newChat:we=!1}={})=>{H&&le();let Se=JSON.parse(JSON.stringify(i));B=JSON.parse(JSON.stringify(B));const Ge={};let lt=Le?[Le]:j!==void 0?[j.id]:K;for(const[Ct,Tt]of lt.entries()){const mt=l.filter(St=>St.id===Tt).at(0);if(mt){let St=wo(),Wt={parentId:be,id:St,childrenIds:[],role:"assistant",content:"",model:mt.id,modelName:mt.name??mt.id,modelIdx:ke||Ct,timestamp:Math.floor(Date.now()/1e3)};t(22,Z.messages[St]=Wt,Z),t(22,Z.currentId=St,Z),be!==null&&Z.messages[be]&&t(22,Z.messages[be].childrenIds=[...Z.messages[be].childrenIds,St],Z),Ge[`${Tt}-${ke||Ct}`]=St}}t(22,Z),we&&B.messages[B.currentId].parentId===null&&(Se=await hn(B)),await $e(),B=JSON.parse(JSON.stringify(Z)),await kn(Se,B),await Promise.all(lt.map(async(Ct,Tt)=>{var St,Wt,Rn;const mt=l.filter(cn=>cn.id===Ct).at(0);if(mt){Gn(B,be).some(Fo=>{var Mo;return(Mo=Fo.files)==null?void 0:Mo.some(Vo=>Vo.type==="image")})&&!(((Rn=(Wt=(St=mt.info)==null?void 0:St.meta)==null?void 0:Wt.capabilities)==null?void 0:Rn.vision)??!0)&&rt.error(a.t("Model {{modelName}} is not vision capable",{modelName:mt.name??mt.id}));let Fn=Ge[`${Ct}-${ke||Tt}`];const Ln=await fe(mt.id,Se);le(),await Mt(B,mt,Fn),Ln&&clearInterval(Ln)}else rt.error(a.t("Model {{modelId}} not found",{modelId:Ct}))})),Go.set(1),Wo.set(await rr(localStorage.token,n))},Mt=async(B,ce,be,Le)=>{var St,Wt,Rn,cn,Jn,Fn,Ln,Fo,Mo,Vo,ti,ni,oi,En,Zn,Nl,Dl,Hl,Ul;const ke=Gn(Z,Z.currentId),we=B.messages[be],Se=B.messages[we.parentId],Ge=ke.filter(ut=>ut.files).flatMap(ut=>ut.files);t(25,Pe=Pe.filter(ut=>Ge.some(Ni=>Ni.id===ut.id)));let lt=JSON.parse(JSON.stringify(Pe));lt.push(...((Se==null?void 0:Se.files)??[]).filter(ut=>["doc","file","collection"].includes(ut.type)),...((we==null?void 0:we.files)??[]).filter(ut=>["web_search_results"].includes(ut.type))),lt=lt.filter((ut,or,Ni)=>Ni.findIndex(Di=>JSON.stringify(Di)===JSON.stringify(ut))===or),le(),k.dispatchEvent(new CustomEvent("chat:start",{detail:{id:be}})),await $e();const Ct=((Wt=(St=ce==null?void 0:ce.info)==null?void 0:St.params)==null?void 0:Wt.stream_response)??((Rn=s==null?void 0:s.params)==null?void 0:Rn.stream_response)??(ge==null?void 0:ge.stream_response)??!0;let Tt=[ge!=null&&ge.system||s.system?{role:"system",content:`${Hm((ge==null?void 0:ge.system)??(s==null?void 0:s.system)??"",u==null?void 0:u.name,s!=null&&s.userLocation?await Xl(localStorage.token).catch(ut=>{console.error(ut)}):void 0)}`}:void 0,...Gn(B,be).map(ut=>({...ut,content:Um(ut.content)}))].filter(ut=>ut);Tt=Tt.map((ut,or,Ni)=>{var Di,Ll,Bl;return{role:ut.role,...((Di=ut.files)==null?void 0:Di.filter(ri=>ri.type==="image").length)>0&&ut.role==="user"?{content:[{type:"text",text:((Ll=ut==null?void 0:ut.merged)==null?void 0:Ll.content)??ut.content},...ut.files.filter(ri=>ri.type==="image").map(ri=>({type:"image_url",image_url:{url:ri.url}}))]}:{content:((Bl=ut==null?void 0:ut.merged)==null?void 0:Bl.content)??ut.content}}}).filter(ut=>{var or;return(ut==null?void 0:ut.role)==="user"||((or=ut==null?void 0:ut.content)==null?void 0:or.trim())});const mt=await Km(localStorage.token,{stream:Ct,model:ce.id,messages:Tt,params:{...s==null?void 0:s.params,...ge,stop:(ge==null?void 0:ge.stop)??((cn=s==null?void 0:s.params)==null?void 0:cn.stop)??void 0?((ge==null?void 0:ge.stop.split(",").map(ut=>ut.trim()))??s.params.stop).map(ut=>decodeURIComponent(JSON.parse('"'+ut.replace(/\"/g,'\\"')+'"'))):void 0},files:((lt==null?void 0:lt.length)??0)>0?lt:void 0,filter_ids:X.length>0?X:void 0,tool_ids:ue.length>0?ue:void 0,tool_servers:f,features:{image_generation:(Jn=d==null?void 0:d.features)!=null&&Jn.enable_image_generation&&((u==null?void 0:u.role)==="admin"||(Ln=(Fn=u==null?void 0:u.permissions)==null?void 0:Fn.features)!=null&&Ln.image_generation)?me:!1,code_interpreter:(Fo=d==null?void 0:d.features)!=null&&Fo.enable_code_interpreter&&((u==null?void 0:u.role)==="admin"||(Vo=(Mo=u==null?void 0:u.permissions)==null?void 0:Mo.features)!=null&&Vo.code_interpreter)?q:!1,web_search:(ti=d==null?void 0:d.features)!=null&&ti.enable_web_search&&((u==null?void 0:u.role)==="admin"||(oi=(ni=u==null?void 0:u.permissions)==null?void 0:ni.features)!=null&&oi.web_search)?ne||((s==null?void 0:s.webSearch)??!1)==="always":!1,memory:(s==null?void 0:s.memory)??!1},variables:{...Lm(u==null?void 0:u.name,s!=null&&s.userLocation?await Xl(localStorage.token).catch(ut=>{console.error(ut)}):void 0)},model_item:l.find(ut=>ut.id===ce.id),session_id:c==null?void 0:c.id,chat_id:i,id:be,background_tasks:{...!r&&(Tt.length==1||Tt.length==2&&((En=Tt.at(0))==null?void 0:En.role)==="system"&&((Zn=Tt.at(1))==null?void 0:Zn.role)==="user")&&(K[0]===ce.id||j!==void 0)?{title_generation:((Nl=s==null?void 0:s.title)==null?void 0:Nl.auto)??!0,tags_generation:(s==null?void 0:s.autoTags)??!0}:{},follow_up_generation:(s==null?void 0:s.autoFollowUps)??!0},...Ct&&(((Ul=(Hl=(Dl=ce.info)==null?void 0:Dl.meta)==null?void 0:Hl.capabilities)==null?void 0:Ul.usage)??!1)?{stream_options:{include_usage:!0}}:{}},`${gi}/api`).catch(async ut=>(rt.error(`${ut}`),we.error={content:ut},we.done=!0,t(22,Z.messages[be]=we,Z),t(22,Z.currentId=be,Z),null));mt&&(mt.error?await Kt(mt.error,we):x?x.push(mt.task_id):t(23,x=[mt.task_id])),await $e(),le()},Kt=async(B,ce)=>{let be="",Le;B&&(Le=B),console.error(Le),"detail"in Le?(rt.error(Le.detail),be=Le.detail):"error"in Le?"message"in Le.error?(rt.error(Le.error.message),be=Le.error.message):(rt.error(Le.error),be=Le.error):"message"in Le&&(rt.error(Le.message),be=Le.message),ce.error={content:a.t("Uh-oh! There was an issue with the response.")+`
`+be},ce.done=!0,ce.statusHistory&&(ce.statusHistory=ce.statusHistory.filter(ke=>ke.action!=="knowledge_search")),t(22,Z.messages[ce.id]=ce,Z)},an=async()=>{if(x){for(const ce of x)await Xm(localStorage.token,ce).catch(be=>(rt.error(`${be}`),null));t(23,x=null);const B=Z.messages[Z.currentId];for(const ce of Z.messages[B.parentId].childrenIds)t(22,Z.messages[ce].done=!0,Z);t(22,Z.messages[Z.currentId]=B,Z),H&&le()}},jt=async(B,ce)=>{let be=ce,Le=wo(),ke={id:Le,parentId:B,childrenIds:[],role:"user",content:be,models:K,timestamp:Math.floor(Date.now()/1e3)};B!==null&&t(22,Z.messages[B].childrenIds=[...Z.messages[B].childrenIds,Le],Z),t(22,Z.messages[Le]=ke,Z),t(22,Z.currentId=Le,Z),await $e(),H&&le(),await pt(Z,be,Le)},ln=async B=>{if(Z.currentId){let ce=Z.messages[B.parentId],be=ce.content;H&&le(),((ce==null?void 0:ce.models)??[...K]).length==1?await pt(Z,be,ce.id):await pt(Z,be,ce.id,{modelId:B.model,modelIdx:B.modelIdx})}},vn=async()=>{if(JSON.parse(JSON.stringify(i)),Z.currentId&&Z.messages[Z.currentId].done==!0){const B=Z.messages[Z.currentId];B.done=!1,await $e();const ce=l.filter(be=>be.id===((B==null?void 0:B.selectedModelId)??B.model)).at(0);ce&&await Mt(Z,ce,B.id)}},At=async(B,ce,be)=>{const Le=Z.messages[B],ke={status:!0,content:""};Le.merged=ke,t(22,Z.messages[B]=Le,Z);try{const[we,Se]=await Jm(localStorage.token,Le.model,Z.messages[Le.parentId].content,ce);if(we&&we.ok&&we.body){const Ge=await c_(we.body,s.splitLargeChunks);for await(const lt of Ge){const{value:Ct,done:Tt,sources:mt,error:St,usage:Wt}=lt;if(St||Tt)break;ke.content==""&&Ct==`
`||(ke.content+=Ct,t(22,Z.messages[B]=Le,Z),H&&le())}await kn(be,Z)}else console.error(we)}catch(we){console.error(we)}},hn=async B=>{let ce=i;return r?(ce="local",await qo.set("local")):(he=await zm(localStorage.token,{id:ce,title:a.t("New Chat"),models:K,system:s.system??void 0,params:ge,history:B,messages:Gn(B,B.currentId),tags:[],timestamp:Date.now()}),ce=he.id,await qo.set(ce),await Wo.set(await rr(localStorage.token,n)),Go.set(1),window.history.replaceState(B.state,"",`/c/${ce}`)),await $e(),ce},kn=async(B,ce)=>{i==B&&(r||(he=await Xs(localStorage.token,B,{models:K,history:ce,messages:Gn(ce,ce.currentId),params:ge,files:Pe}),Go.set(1),await Wo.set(await rr(localStorage.token,n))))};function Sn(B){J=B,t(10,J)}const Lt=B=>{B.detail?G(B.detail):G(!0)},Ro=()=>{G(!1)};function zo(B){ze[B?"unshift":"push"](()=>{Q=B,t(9,Q)})}function Or(B){K=B,t(0,K)}function Nr(B){Z=B,t(22,Z)}function Dr(B){H=B,t(7,H)}function Hr(B){_e=B,t(24,_e),t(52,P),t(3,r)}function Ur(B){ze[B?"unshift":"push"](()=>{V=B,t(8,V)})}const Lr=B=>{t(7,H=V.scrollHeight-V.scrollTop<=V.clientHeight+5)},Br=B=>{r||(B.prompt!==null?localStorage.setItem(`chat-input${i?`-${i}`:""}`,JSON.stringify(B)):localStorage.removeItem(`chat-input${i?`-${i}`:""}`))};function zr(B){De=B,t(26,De),t(52,P),t(3,r)}function Fr(B){_e=B,t(24,_e),t(52,P),t(3,r)}function Vr(B){H=B,t(7,H)}function Kr(B){ue=B,t(17,ue),t(52,P),t(3,r)}function Gr(B){X=B,t(18,X),t(52,P),t(3,r)}function Wr(B){me=B,t(19,me),t(52,P),t(3,r)}function Yr(B){q=B,t(21,q),t(52,P),t(3,r)}function qr(B){ne=B,t(20,ne),t(52,P),t(3,r)}function jr(B){j=B,t(1,j)}const Qr=async B=>{const{type:ce,data:be}=B.detail;ce==="web"?await ve(be):ce==="youtube"?await sn(be):ce==="google-drive"&&await nn(be)},Xr=async B=>{(B.detail||De.length>0)&&(await $e(),wt((s==null?void 0:s.richTextInput)??!0?B.detail.replaceAll(`

`,`
`):B.detail))};function Jr(B){De=B,t(26,De),t(52,P),t(3,r)}function Zr(B){_e=B,t(24,_e),t(52,P),t(3,r)}function xr(B){H=B,t(7,H)}function $r(B){ue=B,t(17,ue),t(52,P),t(3,r)}function ei(B){X=B,t(18,X),t(52,P),t(3,r)}function C(B){me=B,t(19,me),t(52,P),t(3,r)}function Fe(B){q=B,t(21,q),t(52,P),t(3,r)}function xe(B){ne=B,t(20,ne),t(52,P),t(3,r)}function ht(B){j=B,t(1,j)}const He=async B=>{const{type:ce,data:be}=B.detail;ce==="web"?await ve(be):ce==="youtube"&&await sn(be)},it=async B=>{(B.detail||De.length>0)&&(await $e(),wt((s==null?void 0:s.richTextInput)??!0?B.detail.replaceAll(`

`,`
`):B.detail))},Cn=(B,ce,be,Le)=>{const ke=l.find(we=>we.id===ce);return ke?[...B,ke]:B};function An(B){ze[B?"unshift":"push"](()=>{M=B,t(6,M)})}function Un(B){Z=B,t(22,Z)}function Gt(B){Pe=B,t(25,Pe)}function Bt(B){ge=B,t(27,ge)}function Ht(B){De=B,t(26,De),t(52,P),t(3,r)}function zt(B){N=B,t(5,N)}return o.$$set=B=>{"chatIdProp"in B&&t(52,P=B.chatIdProp)},o.$$.update=()=>{o.$$.dirty[0]&3&&t(2,re=j!==void 0?[j.id]:K),o.$$.dirty[0]&8|o.$$.dirty[1]&2097152&&P&&(async()=>{if(t(4,R=!0),t(24,_e=""),t(26,De=[]),t(17,ue=[]),t(18,X=[]),t(20,ne=!1),t(19,me=!1),localStorage.getItem(`chat-input${P?`-${P}`:""}`))try{const B=JSON.parse(localStorage.getItem(`chat-input${P?`-${P}`:""}`));r||(t(24,_e=B.prompt),t(26,De=B.files),t(17,ue=B.selectedToolIds),t(18,X=B.selectedFilterIds),t(20,ne=B.webSearchEnabled),t(19,me=B.imageGenerationEnabled),t(21,q=B.codeInterpreterEnabled))}catch{}if(P&&await Jt()){await $e(),t(4,R=!1),window.setTimeout(()=>le(),0);const B=document.getElementById("chat-input");B==null||B.focus()}else await Kl("/")})(),o.$$.dirty[0]&1|o.$$.dirty[1]&2097152&&K&&P!==""&&ct(),o.$$.dirty[0]&4|o.$$.dirty[1]&4194304&&JSON.stringify(re)!==JSON.stringify(at)&&kt()},[K,j,re,r,R,N,M,H,V,Q,J,E,Y,D,W,F,G,ue,X,me,ne,q,Z,x,_e,Pe,De,ge,i,s,l,f,m,v,y,I,k,Ot,nn,ve,sn,Vt,vt,qe,Ke,wt,pt,an,jt,ln,vn,At,P,at,Sn,Lt,Ro,zo,Or,Nr,Dr,Hr,Ur,Lr,Br,zr,Fr,Vr,Kr,Gr,Wr,Yr,qr,jr,Qr,Xr,Jr,Zr,xr,$r,ei,C,Fe,xe,ht,He,it,Cn,An,Un,Gt,Bt,Ht,zt]}class eS extends We{constructor(e){super(),Ye(this,e,Y2,W2,Qe,{chatIdProp:52},null,[-1,-1,-1,-1])}}export{eS as C};
//# sourceMappingURL=B4guKbOU.js.map
